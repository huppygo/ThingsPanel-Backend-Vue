(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-87cb92d4","chunk-f666a2e0","chunk-2d229260","chunk-2d0c1eaa"],{"398c":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{display:"flex"}},[a("el-select",{ref:"weekRef",staticStyle:{"margin-right":"10px"},attrs:{"no-data-text":e.$t("COMMON.SELECT_NO_DATA")},on:{change:e.handleChange},model:{value:e.weekValue,callback:function(t){e.weekValue=t},expression:"weekValue"}},e._l(e.weekOptions,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1),""!=e.weekValue?a("el-time-picker",{ref:"timeRef",attrs:{"value-format":"HH:mm",placeholder:e.$t("AUTOMATION.PLACEHOLDER.SELECT_TIME")},on:{change:e.handleChange},model:{value:e.timeValue,callback:function(t){e.timeValue=t},expression:"timeValue"}}):e._e()],1)},i=[],r=a("ade3"),o=(a("a9e3"),a("2fa3")),s=a("dbe1"),c={name:"WeeklySelector",props:{data:{type:[Object],default:function(){return{}}}},data:function(){return Object(r["a"])({weekValue:"",timeValue:"",weekOptions:[{label:this.$t("AUTOMATION.WEEK.MONDAY"),value:s["Week"].MONDAY},{label:this.$t("AUTOMATION.WEEK.TUESDAY"),value:s["Week"].THURSDAY},{label:this.$t("AUTOMATION.WEEK.WEDNESDAY"),value:s["Week"].WEDNESDAY},{label:this.$t("AUTOMATION.WEEK.THURSDAY"),value:s["Week"].THURSDAY},{label:this.$t("AUTOMATION.WEEK.FRIDAY"),value:s["Week"].FRIDAY},{label:this.$t("AUTOMATION.WEEK.SATURDAY"),value:s["Week"].SATURDAY},{label:this.$t("AUTOMATION.WEEK.SUDNAY"),value:s["Week"].SUNDAY}]},"timeValue","")},watch:{data:{handler:function(e){e&&e&&e.week&&e.time&&(console.log("RepeatTimeSelector",e),this.weekValue=Number(e.week),this.timeValue=e.time)},immediate:!0}},methods:{handleChange:function(){this.$emit("change",{week:this.weekValue,time:this.timeValue})},validate:function(){return this.weekValue&&""!==this.weekValue?!(!this.timeValue||""===this.timeValue)||(this.$refs.timeRef.focus(),Object(o["h"])(this.$t("AUTOMATION.ERROR.TIME")),!1):(this.$refs.weekRef.focus(),Object(o["h"])(this.$t("AUTOMATION.ERROR.WEEKLY")),!1)}}},l=c,d=a("2877"),u=Object(d["a"])(l,n,i,!1,null,"5c1470a3",null);t["default"]=u.exports},"47a2":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{display:"flex"}},[a("el-select",{ref:"dayRef",staticStyle:{"margin-right":"10px"},attrs:{"no-data-text":e.$t("COMMON.SELECT_NO_DATA")},on:{change:e.handleDayChange},model:{value:e.formData.day,callback:function(t){e.$set(e.formData,"day",t)},expression:"formData.day"}},e._l(e.dayOptions,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1),""!=e.formData.day?a("el-time-select",{ref:"timeRef",attrs:{"value-format":"HH:mm",placeholder:e.$t("AUTOMATION.PLACEHOLDER.SELECT_TIME")},on:{change:e.handleTimeChange},model:{value:e.formData.time,callback:function(t){e.$set(e.formData,"time",t)},expression:"formData.time"}}):e._e()],1)},i=[],r=(a("e9c4"),a("2fa3")),o={name:"MonthlySelector",props:{data:{type:[Object],default:function(){return{}}}},data:function(){return{formData:{day:"",time:""},dayOptions:[]}},watch:{data:{handler:function(e){e&&(console.log("MonthlySelector",e),this.formData=JSON.parse(JSON.stringify(e)))},immediate:!0}},created:function(){for(var e=1;e<=31;e++)this.dayOptions.push({label:e+"日",value:e})},methods:{handleDayChange:function(e){this.$emit("change",this.formData)},handleTimeChange:function(e){this.$emit("change",this.formData)},validate:function(){return this.formData.day&&""!==this.formData.day?!(!this.formData.time||""===this.formData.time)||(this.$refs.timeRef.focus(),Object(r["h"])("请选择时间"),!1):(this.$refs.dayRef.focus(),Object(r["h"])("请选择日期"),!1)}}},s=o,c=a("2877"),l=Object(c["a"])(s,n,i,!1,null,"5ca48678",null);t["default"]=l.exports},a351:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{display:"flex"}},[a("el-select",{ref:"typeRef",staticStyle:{width:"100px","margin-right":"10px"},attrs:{"no-data-text":e.$t("COMMON.SELECT_NO_DATA")},on:{change:e.handleTypeChange},model:{value:e.formData.type,callback:function(t){e.$set(e.formData,"type",t)},expression:"formData.type"}},[a("el-option",{attrs:{label:e.$t("AUTOMATION.PERHOUR"),value:"perHour"}}),a("el-option",{attrs:{label:e.$t("AUTOMATION.DAYS"),value:"days"}}),a("el-option",{attrs:{label:e.$t("AUTOMATION.WEEKLY"),value:"weekly"}}),a("el-option",{attrs:{label:e.$t("AUTOMATION.MONTHLY"),value:"monthly"}}),a("el-option",{attrs:{label:e.$t("AUTOMATION.CUSTOM_CRON"),value:"cron"}})],1),"perHour"==e.formData.type?a("div",{staticStyle:{display:"flex"}},[a("el-input",{ref:"perHourRef",on:{change:e.handlePerHourChange},model:{value:e.formData.perHour,callback:function(t){e.$set(e.formData,"perHour",t)},expression:"formData.perHour"}}),a("el-tooltip",{attrs:{placement:"top"}},[a("div",{attrs:{slot:"content"},slot:"content"},[e._v(e._s(e.$t("AUTOMATION.TIP.PERHOUR")))]),a("i",{staticClass:"el-icon-info",staticStyle:{margin:"10px"}})])],1):"days"==e.formData.type?a("div",{staticStyle:{display:"flex"}},[a("el-time-picker",{ref:"daysRef",attrs:{"value-format":"HH:mm",placeholder:e.$t("AUTOMATION.PLACEHOLDER.SELECT_TIME")},on:{change:e.handleDaysChange},model:{value:e.formData.days,callback:function(t){e.$set(e.formData,"days",t)},expression:"formData.days"}}),a("el-tooltip",{attrs:{placement:"top"}},[a("div",{attrs:{slot:"content"},slot:"content"},[e._v(e._s(e.$t("AUTOMATION.TIP.DAYS")))]),a("i",{staticClass:"el-icon-info",staticStyle:{margin:"10px"}})])],1):"weekly"==e.formData.type?a("div",{staticStyle:{display:"flex"}},[a("WeeklySelector",{ref:"weeklyRef",attrs:{data:e.formData.weekly},on:{change:e.handleWeeklyChange}}),a("el-tooltip",{attrs:{placement:"top"}},[a("div",{attrs:{slot:"content"},slot:"content"},[e._v(e._s(e.$t("AUTOMATION.TIP.WEEKLY")))]),a("i",{staticClass:"el-icon-info",staticStyle:{margin:"10px"}})])],1):"monthly"==e.formData.type?a("div",{staticStyle:{display:"flex"}},[a("MonthlySelector",{ref:"monthlyRef",attrs:{data:e.formData.monthly},on:{change:e.handleMonthlyChange}}),a("el-tooltip",{attrs:{placement:"top"}},[a("div",{attrs:{slot:"content"},slot:"content"},[e._v(e._s(e.$t("AUTOMATION.TIP.MONTHLY")))]),a("i",{staticClass:"el-icon-info",staticStyle:{margin:"10px"}})])],1):e._e(),"cron"==e.formData.type?a("div",{staticStyle:{display:"flex"}},[a("el-input",{ref:"cronRef",on:{change:e.handleCronChange},model:{value:e.formData.cron,callback:function(t){e.$set(e.formData,"cron",t)},expression:"formData.cron"}}),a("el-tooltip",{attrs:{placement:"top"}},[a("div",{attrs:{slot:"content"},slot:"content"},[a("span",{staticStyle:{"margin-right":"20px"}},[e._v("0/2 * * * *")]),a("span",[e._v(e._s(e.$t("AUTOMATION.TIP.CRON.LINE1")))]),a("br"),a("span",{staticStyle:{"margin-right":"20px"}},[e._v("0 0/2 * * *")]),a("span",[e._v(e._s(e.$t("AUTOMATION.TIP.CRON.LINE2")))]),a("br"),a("span",{staticStyle:{"margin-right":"20px"}},[e._v("15 10 * * *")]),a("span",[e._v(e._s(e.$t("AUTOMATION.TIP.CRON.LINE3")))]),a("br"),a("span",{staticStyle:{"margin-right":"20px"}},[e._v("0/5 14 * * *")]),a("span",[e._v(e._s(e.$t("AUTOMATION.TIP.CRON.LINE4")))]),a("br"),a("span",{staticStyle:{"margin-right":"20px"}},[e._v("0/5 14,18 * * *")]),a("span",[e._v(e._s(e.$t("AUTOMATION.TIP.CRON.LINE5")))]),a("br"),a("span",{staticStyle:{"margin-right":"20px"}},[e._v("15 10 ? *")]),a("span",[e._v(e._s(e.$t("AUTOMATION.TIP.CRON.LINE6")))]),a("br"),a("span",{staticStyle:{"margin-right":"20px"}},[e._v("15 10 15 * *")]),a("span",[e._v(e._s(e.$t("AUTOMATION.TIP.CRON.LINE7")))])]),a("i",{staticClass:"el-icon-info",staticStyle:{margin:"10px"}})])],1):e._e()],1)},i=[],r=(a("e9c4"),a("398c")),o=a("47a2"),s=a("2fa3"),c="0/2 * * * * 每2分钟触发\n0 0/2 * * * 每两小时触发<br/>15 10 * * * 每天上午的10:15触发<br/>0/5 14 * * *   在每天下午2点到下午2:55期间的每5分钟触发<br/>0/5 14,18 * * *      在每天下午2点到2:55期间和下午6点到6:55期间的每5分钟触发<br/>15 10 ? * MON-FRI   周一至周五的上午10:15触发<br/>15 10 15 * *  每月15日上午10:15触发",l={name:"RepeatTimeSelector",components:{WeeklySelector:r["default"],MonthlySelector:o["default"]},props:{data:{type:[Object],default:function(){return{}}}},data:function(){return{cronTip:c,formData:{type:"",perHour:"",day:"",weekly:{},monthly:{},cron:""}}},watch:{data:{handler:function(e){e&&(console.log("RepeatTimeSelector",e),this.formData=JSON.parse(JSON.stringify(e)))},immediate:!0}},methods:{handleTypeChange:function(e){this.$emit("change",{type:e})},handlePerHourChange:function(e){this.$emit("change",{type:"perHour",perHour:e})},handleDaysChange:function(e){console.log("handleDaysChange"),this.$emit("change",{type:"days",days:e})},handleWeeklyChange:function(e){this.$emit("change",{type:"weekly",weekly:e})},handleMonthlyChange:function(e){this.$emit("change",{type:"monthly",monthly:e})},handleCronChange:function(e){this.$emit("change",{type:"cron",cron:e})},validate:function(){return this.formData.type&&""!==this.formData.type?"perHour"!==this.formData.type||this.formData.perHour&&""!==this.formData.perHour?"days"!==this.formData.type||this.formData.days&&""!==this.formData.days?"cron"!==this.formData.type||this.formData.cron&&""!==this.formData.cron?!(this.$refs.weeklyRef&&!this.$refs.weeklyRef.validate())&&!(this.$refs.monthlyRef&&!this.$refs.monthlyRef.validate()):(this.$refs.cronRef.focus(),Object(s["h"])(this.$t("AUTOMATION.ERROR.CRON")),!1):(this.$refs.daysRef.focus(),Object(s["h"])(this.$t("AUTOMATION.ERROR.DAYS")),!1):(this.$refs.perHourRef.focus(),Object(s["h"])(this.$t("AUTOMATION.ERROR.PERHOUR")),!1):(this.$refs.typeRef.focus(),Object(s["h"])(this.$t("AUTOMATION.ERROR.DATE_TYPE")),!1)}}},d=l,u=a("2877"),p=Object(u["a"])(d,n,i,!1,null,"3db652d4",null);t["default"]=p.exports},dbe1:function(e,t,a){"use strict";a.r(t),a.d(t,"setConditions",(function(){return p})),a.d(t,"setActions",(function(){return f})),a.d(t,"getConditions",(function(){return y})),a.d(t,"getActions",(function(){return m})),a.d(t,"ConditionType",(function(){return i})),a.d(t,"StateMode",(function(){return r})),a.d(t,"TimeType",(function(){return s})),a.d(t,"RepeatTimeType",(function(){return c})),a.d(t,"Week",(function(){return l})),a.d(t,"ActionType",(function(){return d})),a.d(t,"CommandType",(function(){return u}));var n=a("5530"),i=(a("7db0"),a("d3b7"),a("b64b"),a("b0c0"),a("38cf"),a("25f0"),a("159b"),a("e9c4"),a("a9e3"),a("ac1f"),a("1276"),{device:"1",time:"2",getKey:function(e){return Object.keys(i).find((function(t){return i[t]===e}))}}),r={property:"1",event:"2",onlineState:"3",onlineDuration:"4",getKey:function(e){return Object.keys(r).find((function(t){return r[t]===e}))}},o={online:"1",offline:"2",onAndOff:"3",getKey:function(e){return Object.keys(o).find((function(t){return o[t]===e}))}},s={range:"0",once:"1",repeat:"2",custom:"3",getKey:function(e){return Object.keys(s).find((function(t){return s[t]===e}))}},c={perHour:"1",days:"2",weekly:"3",monthly:"4",cron:"5",getKey:function(e){return Object.keys(c).find((function(t){return c[t]===e}))}},l={SUNDAY:1,MONDAY:2,TUESDAY:3,WEDNESDAY:4,THURSDAY:5,FRIDAY:6,SATURDAY:7},d={device:"1",alarm:"2",scene:"3",getKey:function(e){return Object.keys(d).find((function(t){return d[t]===e}))}},u={property:1,service:2};function p(e){var t=1,a=function(e){var a={};if("device"===e.type)a={condition_type:i.device,device_id:e.data.deviceId,device_condition_type:r[e.data.state.mode]},a.device_condition_type===r.property?(a["v1"]=e.data.state.name,a["v2"]=e.data.state.operator.symbol,a["v3"]=e.data.state.operator.value,a["v4"]=r.property):a.device_condition_type===r.onlineState?a["v2"]=o[e.data.state.name]:a.device_condition_type===r.event&&(a["v1"]=e.data.state.name,a["v3"]=e.data.state.params,a["v4"]=r.event);else if("time"===e.type)switch(a={condition_type:i.time,time_condition_type:s[e.data.type]},a.time_condition_type){case s.once:a["v1"]=e.data.once.value;break;case s.repeat:var n=e.data.repeat;switch(a["v1"]=c[n.type].toString(),c[n.type]){case c.perHour:a["v3"]=n.perHour.toString();break;case c.days:a["v3"]=n.days.toString();break;case c.weekly:var l=n.weekly.week;a["v3"]=l.toString(),a["v4"]=n.weekly.time.toString();break;case c.monthly:a["v3"]=n.monthly.day.toString()+":"+n.monthly.time.toString();break;case c.cron:a["v3"]=n.cron.toString()}break;case s.range:a["v1"]=e.data.range[0],a["v2"]=e.data.range[1];break}return e.relation&&"or"==e.relation&&t++,a.group_number=t,a},n=[];return e.length>0&&e.forEach((function(e){n.push(a(e))})),n}function f(e,t){var a=function(e){var a={};switch(a.action_type=d[e.type],a.action_type){case d.device:e.data.forEach((function(e){var t={},r={},o=e.state;"command"===e.state.mode?(t["device_model"]="2",r["method"]=o.name,r["params"]=JSON.parse(o.params)):"property"===e.state.mode?(console.log("属性",e.state),t["device_model"]="1",r[e.state.name]=e.state.operator.value):"custom"===e.state.mode&&(t["device_model"]="3",r=e.state.params),t["instruct"]=r,i.push(Object(n["a"])(Object(n["a"])({},a),{},{device_id:e.deviceId,additional_info:JSON.stringify(t)}))}));break;case d.scene:a.scenario_strategy_id=e.value||"",i.push(a);break;case d.alarm:a.warning_strategy={},a.warning_strategy.id=e.data.id?e.data.id:"",a.warning_strategy.warning_strategy_name=t,a.warning_strategy.warning_level=e.data.warningLevel,a.warning_strategy.group=e.data.group,a.warning_strategy.repeat_count=Number(e.data.repeatTimes),a.warning_strategy.inform_way=e.data.notification,a.warning_strategy.warning_description=e.data.warning_description,i.push(a);break}},i=[];return e.length>0&&e.forEach((function(e){a(e)})),i}function y(e){var t=[],a=1;if(e&&e.length>0)for(var n=0;n<e.length;n++){var l=e[n],d=l.group_number,u={};if(0===n?u.relation="":d===a?u.relation="and":d>a&&(u.relation="or",a=d),l.condition_type==i.device){u.type=i.getKey(l.condition_type),u.data={projectId:l.business_id,groupId:l.asset_id,deviceId:l.device_id};var p="",f={},y="";switch(l.device_condition_type){case r.property:p=l.v1,f["symbol"]=l.v2,f["value"]=l.v3;break;case r.onlineState:p=o.getKey(l.v2);break;case r.event:p=l.v1,y=l.v3;break}u.data.state={name:p,mode:r.getKey(l.device_condition_type),operator:f,params:y},u.data.stateJSON=JSON.stringify(u.data.state)}else switch(u.type=i.getKey(l.condition_type),u.data={type:s.getKey(l.time_condition_type)},l.time_condition_type){case s.once:u.data.once={value:l.v1};break;case s.repeat:switch(u.data.repeat={type:c.getKey(l.v1)},l.v1){case c.perHour:u.data.repeat.perHour=l.v3;break;case c.days:u.data.repeat.days=l.v3;break;case c.weekly:u.data.repeat.weekly={week:l.v3,time:l.v4};break;case c.monthly:var m=l.v3.split(":");u.data.repeat.monthly={day:m[0],time:m[1]+":"+m[2]};break;case c.cron:u.data.repeat.cron=l.v3;break}break;case s.range:u.data.range=[l.v1,l.v2];break;case s.custom:break}t.push(u)}else t.push({});return t}function m(e){var t=[],a=[];return e.forEach((function(e){var n={};if(e.action_type===d.device){var i={projectId:e.business_id,groupId:e.asset_id,deviceId:e.device_id,state:{}},r=e.additional_info?JSON.parse(e.additional_info):{};if("1"===r.device_model){var o=Object.keys(r.instruct||{})[0];i.state={name:o,mode:"property",operator:{symbol:"",value:r.instruct?r.instruct[o]:""}},i.stateJSON=JSON.stringify(i.state)}else"2"===r.device_model?(i.state={name:r.instruct.method,mode:"command",params:JSON.stringify(r.instruct.params)},i.stateJSON=JSON.stringify(i.state)):"3"===r.device_model&&(i.state={name:"custom",mode:"custom",params:r.instruct},i.stateJSON=JSON.stringify(i.state));a.push(i)}else if(e.action_type===d.alarm){var s,c,l,u,p;n.type="alarm",n.data={id:(null===(s=e.warning_strategy)||void 0===s?void 0:s.id)||"",warningLevel:(null===(c=e.warning_strategy)||void 0===c?void 0:c.warning_level)||"",repeatTimes:(null===(l=e.warning_strategy)||void 0===l?void 0:l.repeat_count)||0,notification:(null===(u=e.warning_strategy)||void 0===u?void 0:u.inform_way)||"",warning_description:(null===(p=e.warning_strategy)||void 0===p?void 0:p.warning_description)||""},t.push(n)}else e.action_type===d.scene&&(n.type="scene",n.value=e.scenario_strategy_id,t.push(n))})),a.length>0&&t.push({type:"device",data:a}),t}}}]);