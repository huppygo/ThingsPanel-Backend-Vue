(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-799eea92","chunk-123faad2","chunk-33abd9de","chunk-2d0b2394"],{"1ef9":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{staticClass:"el-dark-dialog",attrs:{title:t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.TASK.ADD_UPGRADE"),"append-to-body":!0,visible:t.dialogVisible,width:"30%","before-close":function(){return t.dialogVisible=!1},"close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-form",{ref:"addTaskForm",staticClass:"el-dark-input",attrs:{"label-position":"left",model:t.form,rules:t.rules,"label-width":"150px"}},[a("el-form-item",{attrs:{label:t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.TASK.TASK_NAME"),prop:"task_name",required:""}},[a("el-input",{model:{value:t.form.task_name,callback:function(e){t.$set(t.form,"task_name",e)},expression:"form.task_name"}})],1),a("el-form-item",{attrs:{label:t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.TASK.UPGRADE_TIME"),prop:"upgrade_time_type",required:""}},[a("el-select",{model:{value:t.form.upgrade_time_type,callback:function(e){t.$set(t.form,"upgrade_time_type",e)},expression:"form.upgrade_time_type"}},[a("el-option",{attrs:{label:t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.TASK.UPGRADE_TIME_NOW"),value:"0"}}),a("el-option",{attrs:{label:t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.TASK.UPGRADE_TIME_WAIT"),value:"1"}})],1)],1),"1"===t.form.upgrade_time_type?a("el-form-item",[a("el-date-picker",{attrs:{type:"datetime",placeholder:t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.TASK.PLACEHOLDER2"),"value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:t.form.start_time,callback:function(e){t.$set(t.form,"start_time",e)},expression:"form.start_time"}})],1):t._e(),a("el-form-item",{attrs:{label:t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.TASK.CHOOSE_DEVICE"),prop:"select_device_flag",required:""}},[a("el-select",{model:{value:t.form.select_device_flag,callback:function(e){t.$set(t.form,"select_device_flag",e)},expression:"form.select_device_flag"}},[a("el-option",{attrs:{label:t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.TASK.CHOOSE_DEVICE_ALL"),value:"0"}}),a("el-option",{attrs:{label:t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.TASK.CHOOSE_DEVICE"),value:"1"}})],1)],1),"1"===t.form.select_device_flag?a("el-form-item",{attrs:{prop:"devices"}},[a("el-input",{attrs:{readonly:"",placeholder:t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.TASK.PLACEHOLDER1")},nativeOn:{click:function(e){t.selectDeviceDialogVisible=!0}},model:{value:t.deviceListStr,callback:function(e){t.deviceListStr=e},expression:"deviceListStr"}}),a("select-device",{attrs:{visible:t.selectDeviceDialogVisible,data:t.data},on:{"update:visible":function(e){t.selectDeviceDialogVisible=e},change:t.changeSelectionDevie}})],1):t._e(),a("el-form-item",{attrs:{label:t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.FIRMWARE_LIST_ADD.DESCRIPTION"),prop:"description"}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1),a("div",{staticClass:"text-right"},[a("el-button",{attrs:{type:"border"},on:{click:function(e){t.dialogVisible=!1}}},[t._v(t._s(t.$t("COMMON.CANCEL")))]),a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v(t._s(t.$t("COMMON.CONFIRM")))])],1)],1)],1)],1)},r=[],n=a("5530"),o=(a("d81d"),a("a15b"),a("b0c0"),a("dcc7")),s=a("56ce"),l=a("2fa3"),c={name:"AddTask",components:{SelectDevice:o["default"]},props:{visible:{type:[Boolean],default:!1},data:{type:[Object],default:function(){return{}}}},data:function(){return{form:{task_name:"",upgrade_time_type:"0",select_device_flag:"0",start_time:"",device:[],description:""},rules:{task_name:[{required:!0,message:"请输入任务名称",trigger:"blur"}],upgrade_time_type:[{required:!0,message:"请选择升级时间",trigger:"blur"}],select_device_flag:[{required:!0,message:"请选择设备",trigger:"blur"}]},selectDeviceDialogVisible:!1,deviceList:[],deviceListStr:""}},computed:{dialogVisible:{get:function(){return this.visible},set:function(t){this.$emit("update:visible",t)}}},watch:{dialogVisible:{handler:function(t){t&&(this.form={task_name:"",upgrade_time_type:"0",select_device_flag:"0",start_time:"",device:[],description:""})}}},methods:{changeSelectionDevie:function(t){this.deviceList=t.map((function(t){return t.id})),this.deviceListStr=t.map((function(t){return t.name})).join(",")},onSubmit:function(){var t=this;this.$refs.addTaskForm.validate((function(e){if(e){var a=t.$route.query,i=a.otaId,r=a.productId,o=Object(n["a"])({ota_id:i,product_id:r,device_id_list:t.deviceList,end_time:t.form.start_time},t.form);s["a"].taskAdd(o).then((function(e){var a=e.data;console.log(a),200===a.code&&(Object(l["i"])("添加成功！"),t.dialogVisible=!1,t.$emit("submit"))}))}}))}}},d=c,u=a("2877"),p=Object(u["a"])(d,i,r,!1,null,"67a84a8d",null);e["default"]=p.exports},"22ca":function(t,e,a){"use strict";a.r(e),a.d(e,"UpgradeState",(function(){return r}));a("7db0"),a("d3b7"),a("b64b");var i=a("f570"),r={all:["-1","所有状态"],unpushed:["0","待推送"],pushed:["1","已推送"],upgrading:["2","升级中"],upgraded:["3","升级成功"],failed:["4","升级失败"],cancelled:["5","已取消"],getText:function(t){return i["a"].t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.TASK.UPGRADE_STATUS_CODE."+t)},getKey:function(t){return Object.keys(r).find((function(e){return r[e]===t}))}}},"3cfe":function(t,e,a){"use strict";a("a9e3"),a("d3b7"),a("25f0");var i=a("2b0e");i["default"].mixin({methods:{formatDate:function(t){var e=1e3*parseInt(t),a=new Date(e),i=a.getFullYear(),r=a.getMonth()+1;r=r<10?"0"+r:r;var n=a.getDate();n=n<10?"0"+n:n;var o=a.getHours();o=o<10?"0"+o:o;var s=a.getMinutes();s=s<10?"0"+s:s;var l=a.getSeconds();l=l<10?"0"+l:l;var c=i+"-"+r+"-"+n+" "+o+":"+s+":"+l;return c},jsonTypeConvert:function(t,e){var a=(null===t||void 0===t?void 0:t.toLowerCase())||"";return"float"===a||"integer"===a||"number"===a?Number(e):e.toString()}}})},"56ce":function(t,e,a){"use strict";var i=a("18a6"),r=a("add0"),n="/tp_ota",o="/tp_ota_task",s="/tp_ota_device";e["a"]={add:function(t){return Object(i["a"])({url:n+"/add",method:"post",data:t})},list:function(t){return Object(i["a"])({url:n+"/list",method:"post",data:t})},delete:function(t){return Object(i["a"])({url:n+"/delete",method:"post",data:t})},uploadUrl:r["a"]+"api/file/up",taskList:function(t){return Object(i["a"])({url:o+"/list",method:"post",data:t})},taskAdd:function(t){return Object(i["a"])({url:o+"/add",method:"post",data:t})},taskDetailList:function(t){return Object(i["a"])({url:s+"/list",method:"post",data:t})},modifyUpgradeStatus:function(t){return Object(i["a"])({url:"/tp_ota_device/modfiyupdate",method:"post",data:t})}}},b6a2:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"rounded card p-4 el-table-transparent el-dark-input"},[a("el-row",{staticClass:"pt-3 pb-4 px-3",attrs:{type:"flex",gutter:20}},[a("el-col",{staticClass:"px-2 text-right",attrs:{span:12,offset:12}},[a("el-button",{attrs:{size:"medium",type:"border"},on:{click:t.handleCreate}},[t._v(t._s(t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.TASK.ADD_UPGRADE")))])],1)],1),a("el-form",{staticClass:"inline-edit"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{data:t.tableData}},[a("el-table-column",{attrs:{label:t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.TASK.TASK_NAME"),prop:"task_name",align:"left"}}),a("el-table-column",{attrs:{label:t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.TASK.TASK_STATUS"),prop:"task_status",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.getUpgradeStatus(e.row.task_status))+" ")]}}])}),a("el-table-column",{attrs:{label:t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.TASK.DEVICE_COUNT"),prop:"device_count",align:"center"}}),a("el-table-column",{attrs:{label:t.$t("PRODUCT_MANAGEMENT.BATCH_LIST.CREATEDATE"),prop:"created_at",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.created_at?t.formatDate(e.row.created_at):"--")+" ")]}}])}),a("el-table-column",{attrs:{align:"right",label:t.$t("PRODUCT_MANAGEMENT.BATCH_LIST.OPERATION"),width:"240px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"text-right"},[a("el-button",{staticClass:"mr-1",attrs:{type:"indigo",size:"mini"},on:{click:function(a){return t.viewTaskList(e.row)}}},[t._v(t._s(t.$t("COMMON.VIEW")))]),a("el-popconfirm",{attrs:{"confirm-button-text":t.$t("COMMON.CONFIRM"),"cancel-button-text":t.$t("COMMON.CANCEL"),title:"确定要取消升级吗？"},on:{confirm:function(a){return t.cancelTask(e.row)}}},[a("el-button",{directives:[{name:"loading",rawName:"v-loading",value:!!e.row.isLoading,expression:"!!scope.row.isLoading"}],staticClass:"mr-1",attrs:{slot:"reference",type:"danger",size:"mini"},slot:"reference"},[t._v(t._s(t.$t("COMMON.CANCEL")))])],1)],1)]}}])})],1)],1),a("div",{staticClass:"text-right py-3"},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:t.params.total,"current-page":t.params.current_page,"page-size":t.params.per_page},on:{"update:currentPage":function(e){return t.$set(t.params,"current_page",e)},"update:current-page":function(e){return t.$set(t.params,"current_page",e)},"current-change":t.getList}})],1),a("add-task",{attrs:{visible:t.addTaskDialogVisible,data:t.data},on:{"update:visible":function(e){t.addTaskDialogVisible=e},submit:t.getList}})],1)},r=[],n=(a("d3b7"),a("1ef9")),o=a("56ce"),s=(a("3cfe"),a("22ca")),l={name:"TaskList",components:{AddTask:n["default"]},props:{id:{type:[String],default:""},data:{type:[Object],default:function(){return{}}}},data:function(){return{tableData:[],loading:!1,params:{current_page:1,per_page:10,total:0},addTaskDialogVisible:!1,upgradeState:s["UpgradeState"]}},mounted:function(){this.getList()},methods:{getList:function(){var t=this;this.params.ota_id=this.$route.query.otaId,this.loading=!0,console.log("taskList",this.params),o["a"].taskList(this.params).then((function(e){var a,i,r=e.data;200===r.code&&(t.tableData=(null===(a=r.data)||void 0===a?void 0:a.data)||[],t.params.total=(null===(i=r.data)||void 0===i?void 0:i.total)||0)})).finally((function(){t.loading=!1}))},handleCreate:function(){this.addTaskDialogVisible=!0},viewTaskList:function(t){this.$router.push({name:"TaskDetail",query:{taskId:t.id}})},cancelTask:function(t){var e=this;t.isLoading=!0,o["a"].modifyUpgradeStatus({ota_task_id:t.id}).then((function(t){var a=t.data;200===a.code&&e.getList()}))},getUpgradeStatus:function(t){switch(t){case"0":return"待升级";case"1":return"升级中";case"2":return"已完成"}return"待升级"}}},c=l,d=a("2877"),u=Object(d["a"])(c,i,r,!1,null,"771f493a",null);e["default"]=u.exports},c4c8:function(t,e,a){"use strict";var i=a("18a6"),r=a("add0"),n="/tp_product",o="/tp_batch";e["a"]={add:function(t){return Object(i["a"])({url:n+"/add",method:"post",data:t})},edit:function(t){return Object(i["a"])({url:n+"/edit",method:"post",data:t})},del:function(t){return Object(i["a"])({url:n+"/delete",method:"post",data:t})},page:function(t){return Object(i["a"])({url:n+"/list",method:"post",data:t})},batchAdd:function(t){return Object(i["a"])({url:o+"/add",method:"post",data:t})},batchEdit:function(t){return Object(i["a"])({url:o+"/edit",method:"post",data:t})},batchDel:function(t){return Object(i["a"])({url:o+"/delete",method:"post",data:t})},batchPage:function(t){return Object(i["a"])({url:o+"/list",method:"post",data:t})},generateBatch:function(t){return Object(i["a"])({url:o+"/generate",method:"post",data:t})},uploadUrl:r["a"]+"api/file/up",importBatch:function(t){return Object(i["a"])({url:o+"/import",method:"post",data:t})},exportQRCodeAndData:function(t){return Object(i["a"])({url:o+"/export",method:"post",data:t})},getPreRegistration:function(t){return Object(i["a"])({url:"/tp_generate_device/list",method:"post",data:t})},generateDevice:function(t){return Object(i["a"])({url:"/tp_generate_device/activate",method:"post",data:t})},deletePreRegistration:function(t){return Object(i["a"])({url:"/tp_generate_device/delete",method:"post",data:t})},getDeviceListByProductId:function(t){return Object(i["a"])({url:"/device/listbyproduct",method:"post",data:t})},addTask:function(t){return Object(i["a"])({url:"/tp_ota_task/add",method:"post",data:t})}}},dcc7:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{staticClass:"el-dark-dialog",attrs:{title:"请选择设备",visible:t.dialogVisible,width:"30%","before-close":function(){return t.dialogVisible=!1},"close-on-click-modal":!1,"append-to-body":!0},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-form",{ref:"addTaskForm",staticClass:"inline-edit",attrs:{"label-position":"left",model:t.params,"hide-required-asterisk":!0}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{prop:"version"}},[a("el-input",{attrs:{placeholder:"版本筛选"},model:{value:t.params.version,callback:function(e){t.$set(t.params,"version",e)},expression:"params.version"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{prop:"device_name"}},[a("el-input",{attrs:{placeholder:"请输入设备名称"},model:{value:t.params.device_name,callback:function(e){t.$set(t.params,"device_name",e)},expression:"params.device_name"}})],1)],1),a("el-col",{staticClass:"text-right",attrs:{span:6,offset:2}},[a("el-button",{attrs:{type:"border"}},[t._v("搜索")])],1)],1),a("el-table",{staticClass:"table",attrs:{data:t.tableData},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),a("el-table-column",{attrs:{label:"设备名称",prop:"name",align:"center"}}),a("el-table-column",{attrs:{label:"版本号",prop:"current_version",align:"center"}}),a("el-table-column",{attrs:{label:"设备编号",prop:"device_code",align:"center","show-overflow-tooltip":!0}})],1),a("div",{staticClass:"text-right"},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:t.params.total,"current-page":t.params.current_page,"page-size":t.params.per_page},on:{"update:currentPage":function(e){return t.$set(t.params,"current_page",e)},"update:current-page":function(e){return t.$set(t.params,"current_page",e)},"current-change":t.getList}})],1),a("div",{staticClass:"text-right py-5"},[t._v(" 已选择"+t._s(t.params.count)+"个设备 "),a("el-button",{attrs:{type:"border"},on:{click:function(e){t.dialogVisible=!1}}},[t._v(t._s(t.$t("COMMON.CANCEL")))]),a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v(t._s(t.$t("COMMON.CONFIRM")))])],1)],1)],1)],1)},r=[],n=a("c4c8"),o=a("2fa3"),s={components:{},props:{visible:{type:[Boolean],default:!1},data:{type:[Object],default:function(){return{}}}},data:function(){return{tableData:[],params:{current_page:1,per_page:5,product_id:"",current_version:"",name:""},deviceSelection:[]}},computed:{dialogVisible:{get:function(){return this.visible},set:function(t){this.$emit("update:visible",t)}}},mounted:function(){this.getList()},methods:{getList:function(){var t=this;this.params.product_id=this.$route.query.productId,n["a"].getDeviceListByProductId(this.params).then((function(e){var a,i,r=e.data;200===r.code&&(t.tableData=(null===(a=r.data)||void 0===a?void 0:a.data)||[],t.params.total=(null===(i=r.data)||void 0===i?void 0:i.total)||0)}))},handleSelectionChange:function(t){this.deviceSelection=t},onSubmit:function(){console.log("SelectDevice",this.deviceSelection),0!==this.deviceSelection.length?(this.$emit("change",this.deviceSelection),this.dialogVisible=!1):Object(o["h"])("请至少选择一个设备")}}},l=s,c=(a("f8c8"),a("2877")),d=Object(c["a"])(l,i,r,!1,null,"4c6fd28c",null);e["default"]=d.exports},f657:function(t,e,a){},f8c8:function(t,e,a){"use strict";a("f657")}}]);