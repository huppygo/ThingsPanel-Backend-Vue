(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f666a2e0","chunk-2d229260"],{"398c":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{display:"flex"}},[a("el-select",{ref:"weekRef",staticStyle:{"margin-right":"10px"},attrs:{"no-data-text":e.$t("COMMON.SELECT_NO_DATA")},on:{change:e.handleChange},model:{value:e.weekValue,callback:function(t){e.weekValue=t},expression:"weekValue"}},e._l(e.weekOptions,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1),""!=e.weekValue?a("el-time-picker",{ref:"timeRef",attrs:{"value-format":"HH:mm",placeholder:e.$t("AUTOMATION.PLACEHOLDER.SELECT_TIME")},on:{change:e.handleChange},model:{value:e.timeValue,callback:function(t){e.timeValue=t},expression:"timeValue"}}):e._e()],1)},i=[],r=a("ade3"),o=(a("a9e3"),a("2fa3")),c=a("dbe1"),s={name:"WeeklySelector",props:{data:{type:[Object],default:function(){return{}}}},data:function(){return Object(r["a"])({weekValue:"",timeValue:"",weekOptions:[{label:this.$t("AUTOMATION.WEEK.MONDAY"),value:c["Week"].MONDAY},{label:this.$t("AUTOMATION.WEEK.TUESDAY"),value:c["Week"].THURSDAY},{label:this.$t("AUTOMATION.WEEK.WEDNESDAY"),value:c["Week"].WEDNESDAY},{label:this.$t("AUTOMATION.WEEK.THURSDAY"),value:c["Week"].THURSDAY},{label:this.$t("AUTOMATION.WEEK.FRIDAY"),value:c["Week"].FRIDAY},{label:this.$t("AUTOMATION.WEEK.SATURDAY"),value:c["Week"].SATURDAY},{label:this.$t("AUTOMATION.WEEK.SUDNAY"),value:c["Week"].SUNDAY}]},"timeValue","")},watch:{data:{handler:function(e){e&&e&&e.week&&e.time&&(console.log("RepeatTimeSelector",e),this.weekValue=Number(e.week),this.timeValue=e.time)},immediate:!0}},methods:{handleChange:function(){this.$emit("change",{week:this.weekValue,time:this.timeValue})},validate:function(){return this.weekValue&&""!==this.weekValue?!(!this.timeValue||""===this.timeValue)||(this.$refs.timeRef.focus(),Object(o["h"])(this.$t("AUTOMATION.ERROR.TIME")),!1):(this.$refs.weekRef.focus(),Object(o["h"])(this.$t("AUTOMATION.ERROR.WEEKLY")),!1)}}},d=s,u=a("2877"),l=Object(u["a"])(d,n,i,!1,null,"5c1470a3",null);t["default"]=l.exports},dbe1:function(e,t,a){"use strict";a.r(t),a.d(t,"setConditions",(function(){return p})),a.d(t,"setActions",(function(){return v})),a.d(t,"getConditions",(function(){return y})),a.d(t,"getActions",(function(){return m})),a.d(t,"ConditionType",(function(){return i})),a.d(t,"StateMode",(function(){return r})),a.d(t,"TimeType",(function(){return c})),a.d(t,"RepeatTimeType",(function(){return s})),a.d(t,"Week",(function(){return d})),a.d(t,"ActionType",(function(){return u})),a.d(t,"CommandType",(function(){return l}));var n=a("5530"),i=(a("7db0"),a("d3b7"),a("b64b"),a("b0c0"),a("38cf"),a("25f0"),a("159b"),a("e9c4"),a("a9e3"),a("ac1f"),a("1276"),{device:"1",time:"2",getKey:function(e){return Object.keys(i).find((function(t){return i[t]===e}))}}),r={property:"1",event:"2",onlineState:"3",onlineDuration:"4",getKey:function(e){return Object.keys(r).find((function(t){return r[t]===e}))}},o={online:"1",offline:"2",onAndOff:"3",getKey:function(e){return Object.keys(o).find((function(t){return o[t]===e}))}},c={range:"0",once:"1",repeat:"2",custom:"3",getKey:function(e){return Object.keys(c).find((function(t){return c[t]===e}))}},s={perHour:"1",days:"2",weekly:"3",monthly:"4",cron:"5",getKey:function(e){return Object.keys(s).find((function(t){return s[t]===e}))}},d={SUNDAY:1,MONDAY:2,TUESDAY:3,WEDNESDAY:4,THURSDAY:5,FRIDAY:6,SATURDAY:7},u={device:"1",alarm:"2",scene:"3",getKey:function(e){return Object.keys(u).find((function(t){return u[t]===e}))}},l={property:1,service:2};function p(e){var t=1,a=function(e){var a={};if("device"===e.type)a={condition_type:i.device,device_id:e.data.deviceId,device_condition_type:r[e.data.state.mode]},a.device_condition_type===r.property?(a["v1"]=e.data.state.name,a["v2"]=e.data.state.operator.symbol,a["v3"]=e.data.state.operator.value,a["v4"]=r.property):a.device_condition_type===r.onlineState?a["v2"]=o[e.data.state.name]:a.device_condition_type===r.event&&(a["v1"]=e.data.state.name,a["v3"]=e.data.state.params,a["v4"]=r.event);else if("time"===e.type)switch(a={condition_type:i.time,time_condition_type:c[e.data.type]},a.time_condition_type){case c.once:a["v1"]=e.data.once.value;break;case c.repeat:var n=e.data.repeat;switch(a["v1"]=s[n.type].toString(),s[n.type]){case s.perHour:a["v3"]=n.perHour.toString();break;case s.days:a["v3"]=n.days.toString();break;case s.weekly:var d=n.weekly.week;a["v3"]=d.toString(),a["v4"]=n.weekly.time.toString();break;case s.monthly:a["v3"]=n.monthly.day.toString()+":"+n.monthly.time.toString();break;case s.cron:a["v3"]=n.cron.toString()}break;case c.range:a["v1"]=e.data.range[0],a["v2"]=e.data.range[1];break}return e.relation&&"or"==e.relation&&t++,a.group_number=t,a},n=[];return e.length>0&&e.forEach((function(e){n.push(a(e))})),n}function v(e,t){var a=function(e){var a={};switch(a.action_type=u[e.type],a.action_type){case u.device:e.data.forEach((function(e){var t={},r={},o=e.state;"command"===e.state.mode?(t["device_model"]="2",r["method"]=o.name,r["params"]=JSON.parse(o.params)):"property"===e.state.mode?(console.log("属性",e.state),t["device_model"]="1",r[e.state.name]=e.state.operator.value):"custom"===e.state.mode&&(t["device_model"]="3",r=e.state.params),t["instruct"]=r,i.push(Object(n["a"])(Object(n["a"])({},a),{},{device_id:e.deviceId,additional_info:JSON.stringify(t)}))}));break;case u.scene:a.scenario_strategy_id=e.value||"",i.push(a);break;case u.alarm:a.warning_strategy={},a.warning_strategy.id=e.data.id?e.data.id:"",a.warning_strategy.warning_strategy_name=t,a.warning_strategy.warning_level=e.data.warningLevel,a.warning_strategy.group=e.data.group,a.warning_strategy.repeat_count=Number(e.data.repeatTimes),a.warning_strategy.inform_way=e.data.notification,a.warning_strategy.warning_description=e.data.warning_description,i.push(a);break}},i=[];return e.length>0&&e.forEach((function(e){a(e)})),i}function y(e){var t=[],a=1;if(e&&e.length>0)for(var n=0;n<e.length;n++){var d=e[n],u=d.group_number,l={};if(0===n?l.relation="":u===a?l.relation="and":u>a&&(l.relation="or",a=u),d.condition_type==i.device){l.type=i.getKey(d.condition_type),l.data={projectId:d.business_id,groupId:d.asset_id,deviceId:d.device_id};var p="",v={},y="";switch(d.device_condition_type){case r.property:p=d.v1,v["symbol"]=d.v2,v["value"]=d.v3;break;case r.onlineState:p=o.getKey(d.v2);break;case r.event:p=d.v1,y=d.v3;break}l.data.state={name:p,mode:r.getKey(d.device_condition_type),operator:v,params:y},l.data.stateJSON=JSON.stringify(l.data.state)}else switch(l.type=i.getKey(d.condition_type),l.data={type:c.getKey(d.time_condition_type)},d.time_condition_type){case c.once:l.data.once={value:d.v1};break;case c.repeat:switch(l.data.repeat={type:s.getKey(d.v1)},d.v1){case s.perHour:l.data.repeat.perHour=d.v3;break;case s.days:l.data.repeat.days=d.v3;break;case s.weekly:l.data.repeat.weekly={week:d.v3,time:d.v4};break;case s.monthly:var m=d.v3.split(":");l.data.repeat.monthly={day:m[0],time:m[1]+":"+m[2]};break;case s.cron:l.data.repeat.cron=d.v3;break}break;case c.range:l.data.range=[d.v1,d.v2];break;case c.custom:break}t.push(l)}else t.push({});return t}function m(e){var t=[],a=[];return e.forEach((function(e){var n={};if(e.action_type===u.device){var i={projectId:e.business_id,groupId:e.asset_id,deviceId:e.device_id,state:{}},r=e.additional_info?JSON.parse(e.additional_info):{};if("1"===r.device_model){var o=Object.keys(r.instruct||{})[0];i.state={name:o,mode:"property",operator:{symbol:"",value:r.instruct?r.instruct[o]:""}},i.stateJSON=JSON.stringify(i.state)}else"2"===r.device_model?(i.state={name:r.instruct.method,mode:"command",params:JSON.stringify(r.instruct.params)},i.stateJSON=JSON.stringify(i.state)):"3"===r.device_model&&(i.state={name:"custom",mode:"custom",params:r.instruct},i.stateJSON=JSON.stringify(i.state));a.push(i)}else if(e.action_type===u.alarm){var c,s,d,l,p;n.type="alarm",n.data={id:(null===(c=e.warning_strategy)||void 0===c?void 0:c.id)||"",warningLevel:(null===(s=e.warning_strategy)||void 0===s?void 0:s.warning_level)||"",repeatTimes:(null===(d=e.warning_strategy)||void 0===d?void 0:d.repeat_count)||0,notification:(null===(l=e.warning_strategy)||void 0===l?void 0:l.inform_way)||"",warning_description:(null===(p=e.warning_strategy)||void 0===p?void 0:p.warning_description)||""},t.push(n)}else e.action_type===u.scene&&(n.type="scene",n.value=e.scenario_strategy_id,t.push(n))})),a.length>0&&t.push({type:"device",data:a}),t}}}]);