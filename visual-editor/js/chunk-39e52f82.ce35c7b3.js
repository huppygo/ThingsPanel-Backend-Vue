(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-39e52f82","chunk-d7931cb8","chunk-65563274"],{"00a8":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"rounded p-4 card"},[i("el-row",{staticClass:"pt-3 pb-4 px-3",attrs:{type:"flex",gutter:20}},[i("el-col",{attrs:{span:12}},[i("TableTitle",[t._v(t._s(t.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.NOTICE")))])],1),i("el-col",{staticClass:"px-2 text-right",attrs:{span:12}},[i("el-button",{attrs:{size:"medium",type:"border"},on:{click:t.handleShowAdd}},[t._v(t._s(t.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.NOTICEADD")))])],1)],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{data:t.tableData},scopedSlots:t._u([{key:"empty",fn:function(){return[i("div",[t._v(t._s(t.$t("COMMON.TABLE_NO_DATA")))])]},proxy:!0}])},[i("el-table-column",{attrs:{label:t.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.NO"),type:"index",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",[t._v(t._s(10*(t.page-1)+e.$index+1))])]}}])}),i("el-table-column",{attrs:{prop:"group_name",label:t.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.NOTICENAME")}}),i("el-table-column",{attrs:{prop:"notification_type",label:t.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.NOTICETYPE")},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.notification_type?i("span",[t._v("成员通知")]):t._e(),2==e.row.notification_type?i("span",[t._v("邮箱通知")]):t._e(),3==e.row.notification_type?i("span",[t._v("webhook")]):t._e(),4==e.row.notification_type?i("span",[t._v("短信通知")]):t._e(),5==e.row.notification_type?i("span",[t._v("语音通知")]):t._e(),6==e.row.notification_type?i("span",[t._v("企业微信群机器人")]):t._e(),7==e.row.notification_type?i("span",[t._v("钉钉群机器人")]):t._e(),8==e.row.notification_type?i("span",[t._v("飞书群机器人")]):t._e()]}}])}),i("el-table-column",{attrs:{prop:"status",label:t.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.STATUS")},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-switch",{attrs:{"inactive-text":e.row.statusValue?t.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.SRARTED"):t.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.PUTONHOLD"),"active-text":""},on:{change:function(i){return t.handleSetStatus(e.row)}},model:{value:e.row.statusValue,callback:function(i){t.$set(e.row,"statusValue",i)},expression:"scope.row.statusValue"}})]}}])}),i("el-table-column",{attrs:{prop:"actions",label:t.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.OPERATION"),align:"left",width:"142px"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{staticClass:"mr-3",attrs:{size:"mini",type:"indigo"},on:{click:function(i){return t.handleShowEdit(e.row)}}},[t._v(t._s(t.$t("COMMON.EDIT")))]),i("el-popconfirm",{attrs:{"confirm-button-text":t.$t("COMMON.CONFIRM"),"cancel-button-text":t.$t("COMMON.CANCEL"),title:t.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.TITLE4")},on:{confirm:function(i){return t.handle_del(e.row.id)}}},[i("el-button",{attrs:{slot:"reference",size:"mini",type:"danger"},slot:"reference"},[t._v(t._s(t.$t("COMMON.DELETE")))])],1)]}}])})],1),i("div",{staticClass:"text-right py-3"},[i("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:t.data_count,"current-page":t.page,"page-size":t.per_page},on:{"update:currentPage":function(e){t.page=e},"update:current-page":function(e){t.page=e},"current-change":t.page_change}})],1),i("CreateForm",{attrs:{visible:t.dialogVisible,id:t.formId},on:{"update:visible":function(e){t.dialogVisible=e},submit:t.get_data}})],1)},n=[],o=(i("d3b7"),i("159b"),i("ce67")),s=i("239d"),r=i("0bb4"),l=(i("3cfe"),i("2fa3")),c={name:"notice",components:{CreateForm:o["default"],TableTitle:s["a"]},data:function(){return{dialogVisible:!1,formId:"",loading:!1,per_page:10,page:1,data_count:2,tableData:[]}},created:function(){this.get_data()},methods:{get_data:function(){var t=this,e={current_page:this.page,per_page:10};Object(r["e"])(e).then((function(e){200==e.status&&(t.tableData=e.data.data.data,t.tableData.forEach((function(t){t.statusValue=1==t.status})),t.data_count=e.data.data.total,t.loading=!1)}))},page_change:function(t){this.loading||(this.loading=!0,this.page=t,this.get_data())},handle_del:function(t){var e=this;Object(r["b"])({id:t}).then((function(t){200===t.data.code&&(e.get_data(),e.$message({message:"删除成功",center:!0,type:"success"}))}))},handleShowAdd:function(){this.formId="",this.dialogVisible=!0},handleShowEdit:function(t){this.formId=t.id,this.dialogVisible=!0},handleSetStatus:function(t){var e=this,i=t.statusValue?1:2;Object(r["f"])({id:t.id,switch:i}).then((function(t){200===t.data.code&&(e.get_data(),Object(l["i"])(1===i?e.$t("AUTOMATION.ENABLED"):e.$t("AUTOMATION.DISABLED")))}))}}},f=c,u=(i("2901"),i("2877")),d=Object(u["a"])(f,a,n,!1,null,"7c031db5",null);e["default"]=d.exports},"0bb4":function(t,e,i){"use strict";i.d(e,"e",(function(){return n})),i.d(e,"a",(function(){return o})),i.d(e,"d",(function(){return s})),i.d(e,"c",(function(){return r})),i.d(e,"b",(function(){return l})),i.d(e,"g",(function(){return c})),i.d(e,"f",(function(){return f}));var a=i("18a6");function n(t){return Object(a["a"])({url:"/notification/list",method:"post",data:t})}function o(t){return Object(a["a"])({url:"/notification/save",method:"post",data:t})}function s(t){return Object(a["a"])({url:"/notification/save",method:"post",data:t})}function r(t){return Object(a["a"])({url:"/notification/detail",method:"post",data:t})}function l(t){return Object(a["a"])({url:"/notification/delete",method:"post",data:t})}function c(t){return Object(a["a"])({url:"/user/index",method:"post",data:t})}function f(t){return Object(a["a"])({url:"/notification/switch",method:"post",data:t})}},1750:function(t,e,i){"use strict";i("d5c0")},"239d":function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("h3",{staticClass:"table-title h3 font-weight-bolder m-0 pt-2"},[t._t("default")],2)},n=[],o={name:"TableTitle"},s=o,r=i("2877"),l=Object(r["a"])(s,a,n,!1,null,"2001a59c",null);e["a"]=l.exports},2901:function(t,e,i){"use strict";i("7770")},"3cfe":function(t,e,i){"use strict";i("a9e3"),i("d3b7"),i("25f0");var a=i("2b0e");a["default"].mixin({methods:{formatDate:function(t){var e=1e3*parseInt(t),i=new Date(e),a=i.getFullYear(),n=i.getMonth()+1;n=n<10?"0"+n:n;var o=i.getDate();o=o<10?"0"+o:o;var s=i.getHours();s=s<10?"0"+s:s;var r=i.getMinutes();r=r<10?"0"+r:r;var l=i.getSeconds();l=l<10?"0"+l:l;var c=a+"-"+n+"-"+o+" "+s+":"+r+":"+l;return c},jsonTypeConvert:function(t,e){var i=(null===t||void 0===t?void 0:t.toLowerCase())||"";return"float"===i||"integer"===i||"number"===i?Number(e):e.toString()}}})},7770:function(t,e,i){},"8dc8":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{display:"flex"}},[i("el-select",{ref:"userRef",staticStyle:{width:"200px","margin-right":"10px"},on:{change:t.handleUserChange},model:{value:t.formData.user_id,callback:function(e){t.$set(t.formData,"user_id",e)},expression:"formData.user_id"}},t._l(t.userOptions,(function(t,e){return i("el-option",{key:e,attrs:{label:t.name,value:t.id}})})),1),i("el-checkbox-group",{model:{value:t.list,callback:function(e){t.list=e},expression:"list"}},t._l(t.dataList,(function(e,a){return i("el-checkbox",{key:a,attrs:{label:e.label},on:{change:function(i){return t.chooseChange(i,e)}}},[t._v(t._s(e.name))])})),1)],1)},n=[],o=(i("e9c4"),i("0bb4")),s=i("2fa3"),r=i("f570"),l={name:"DeviceTypeSelector",components:{},props:{option:{type:[Object],default:function(){return{operator:!0}}},data:{type:[Object],default:function(){return{}}}},data:function(){return{formData:{user_id:"",list:[],is_email:0,is_message:0,is_phone:0},list:[],userOptions:[],params:{page:1,limit:100},dataList:[{name:r["a"].t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.EMAIL"),label:"is_email"},{name:r["a"].t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.SMS"),label:"is_message"},{name:r["a"].t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.PHONE"),label:"is_phone"}]}},watch:{data:{handler:function(t){if(t){var e=[];for(var i in t)console.log(i),1===t[i]&&e.push(i);this.list=e,this.formData=JSON.parse(JSON.stringify(t)),console.log("formData",this.formData)}},immediate:!0}},created:function(){this.getUser()},methods:{handleUserChange:function(t){this.formData.user_id=t,this.updateData()},chooseChange:function(t,e){"is_email"===e.label?this.formData.is_email=t?1:0:"is_message"===e.label?this.formData.is_message=t?1:0:"is_phone"===e.label&&(this.formData.is_phone=t?1:0),this.updateData()},updateData:function(){console.log("updateData",this.formData),this.$emit("change",this.formData)},getUser:function(){var t=this;Object(o["g"])(this.params).then((function(e){200===e.data.code&&(t.userOptions=e.data.data.data)}))},validate:function(){var t=this.$refs,e=this.formData;return e.user_id&&""!==e.user_id?!(!this.list||0===this.list.length)||(Object(s["h"])(this.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.PLACEHOLDER4")),!1):(t.userRef.focus(),Object(s["h"])(this.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.PLACEHOLDER3")),!1)}}},c=l,f=i("2877"),u=Object(f["a"])(c,a,n,!1,null,"4979be05",null);e["default"]=u.exports},ce67:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-dialog",{staticClass:"el-dark-dialog",attrs:{title:t.id?t.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.EDITTITLE"):t.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.ADDTITLE"),"close-on-click-modal":!1,"before-close":t.handleClose,visible:t.dialogVisible,width:"60%",height:"60%",top:"10vh"},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("el-form",{ref:"CreateForm",attrs:{"label-position":"left","label-width":"140px",model:t.form}},[i("el-form-item",{attrs:{label:t.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.GROUPNAME"),required:""}},[i("el-input",{ref:"nameRef",model:{value:t.form.group_name,callback:function(e){t.$set(t.form,"group_name",e)},expression:"form.group_name"}})],1),i("el-form-item",{attrs:{label:t.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.DESC"),required:""}},[i("el-input",{ref:"descRef",staticClass:"el-dark-input",attrs:{type:"textarea"},model:{value:t.form.desc,callback:function(e){t.$set(t.form,"desc",e)},expression:"form.desc"}})],1),i("el-form-item",{attrs:{label:t.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.METHOD"),required:""}},[i("el-select",{ref:"selRef",staticClass:"w-100",attrs:{placeholder:t.$t("COMMON.PLACEHOLDER5")},on:{change:t.handleTypeChange},model:{value:t.form.notification_type,callback:function(e){t.$set(t.form,"notification_type",e)},expression:"form.notification_type"}},[i("el-option",{attrs:{label:"成员通知",value:1}}),i("el-option",{attrs:{label:"邮箱通知",value:2}}),i("el-option",{attrs:{label:"短信通知",value:4}}),i("el-option",{attrs:{label:"语音通知",value:5}}),i("el-option",{attrs:{label:"企业微信群机器人",value:6}}),i("el-option",{attrs:{label:"钉钉群机器人",value:7}}),i("el-option",{attrs:{label:"飞书群机器人",value:8}}),i("el-option",{attrs:{label:"webhook",value:3}})],1)],1),1==t.noticeType?i("div",[i("el-form-item",{attrs:{label:t.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.SETMETHOD"),required:""}},t._l(t.form.commands,(function(e,a){return i("div",{key:a,staticStyle:{display:"flex","margin-bottom":"10px"}},[i("DeviceTypeSelector",{ref:"deviceTypeRef",refInFor:!0,attrs:{data:e.data,option:{operator:!1}},on:{change:function(i){return t.handleCommandChange(e,i)}}}),0==a?i("el-button",{staticStyle:{"margin-left":"auto"},attrs:{type:"indigo",size:"small"},on:{click:function(i){return t.handleAddCommand(e)}}},[t._v(t._s(t.$t("COMMON.ADD")))]):t._e(),a>0?i("el-button",{staticStyle:{"margin-left":"auto"},attrs:{type:"danger",size:"small"},on:{click:function(i){return t.handleDeleteCommand(e)}}},[t._v(t._s(t.$t("COMMON.DELETE")))]):t._e()],1)})),0)],1):t._e(),2==t.noticeType?i("div",[i("el-form-item",{attrs:{label:t.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.SETEMAIL"),required:""}},[i("el-input",{staticClass:"el-dark-input",attrs:{type:"textarea",placeholder:t.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.PLACEHOLDER6")},model:{value:t.form.email,callback:function(e){t.$set(t.form,"email",e)},expression:"form.email"}})],1)],1):t._e(),4==t.noticeType?i("div",[i("el-form-item",{attrs:{label:t.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.SETSMS"),required:""}},[i("el-input",{staticClass:"el-dark-input",attrs:{type:"textarea",placeholder:t.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.PLACEHOLDER7")},model:{value:t.form.message,callback:function(e){t.$set(t.form,"message",e)},expression:"form.message"}})],1)],1):t._e(),5==t.noticeType?i("div",[i("el-form-item",{attrs:{label:t.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.SETVOICE"),required:""}},[i("el-input",{staticClass:"el-dark-input",attrs:{type:"textarea",placeholder:t.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.PLACEHOLDER8")},model:{value:t.form.phone,callback:function(e){t.$set(t.form,"phone",e)},expression:"form.phone"}})],1)],1):t._e(),3==t.noticeType||6==t.noticeType||7==t.noticeType||8==t.noticeType?i("div",[i("el-form-item",{attrs:{label:t.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.SETURL"),required:""}},[i("el-input",{model:{value:t.form.webhook,callback:function(e){t.$set(t.form,"webhook",e)},expression:"form.webhook"}})],1)],1):t._e(),i("div",{staticStyle:{display:"flex","justify-content":"center"}},[i("el-button",{staticClass:"cancel-button",attrs:{type:"cancel",size:"medium",plain:""},on:{click:t.cancelDialog}},[t._v(t._s(t.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.CANCEL")))]),i("el-button",{staticClass:"medium",attrs:{type:"save",size:"medium"},on:{click:t.onSubmit}},[t._v(t._s(t.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.SAVE")))])],1)],1)],1)],1)},n=[],o=(i("c740"),i("a434"),i("e9c4"),i("d81d"),i("2fa3")),s=i("8dc8"),r=i("0bb4"),l={name:"CreateForm",components:{DeviceTypeSelector:s["default"]},props:{id:{default:null},visible:{type:[Boolean],default:!1}},computed:{dialogVisible:{get:function(){return this.visible},set:function(t){this.$emit("update:visible",t)}}},watch:{visible:{handler:function(t){t?this.id?this.getDetail(this.id):this.form={group_name:"",desc:"",notification_type:"",commands:[{data:{}}],notification_config:{},email:"",message:"",phone:"",webhook:""}:this.form={}}}},data:function(){return{noticeType:"",form:{group_name:"",desc:"",notification_type:"",commands:[{data:{}}],notification_config:{},email:"",message:"",phone:"",webhook:""}}},created:function(){},methods:{handleTypeChange:function(t){this.form.notification_type=t,this.noticeType=t},handleAddCommand:function(){this.form.commands.push({data:{}})},handleCommandChange:function(t,e){t.data=e},handleDeleteCommand:function(t){var e=this.form.commands.findIndex((function(e){return e==t}));this.form.commands.splice(e,1)},getDetail:function(t){var e=this;Object(r["c"])({id:t}).then((function(t){if(console.log(t,"res"),200===t.data.code){var i=t.data.data;if("{}"!==i){var a=e.getCommands(JSON.parse(JSON.stringify(i))),n=JSON.parse(JSON.stringify(i));n.commands=a,e.noticeType=n.notification_type;var o=JSON.parse(JSON.stringify(i)),s=JSON.parse(o.notification_config);n.email=s.email,n.message=s.message,n.phone=s.phone,n.webhook=s.webhook,e.form=n}}}))},getCommands:function(t){var e=(null===t||void 0===t?void 0:t.notification_members)||[{data:{}}],i=e.map((function(t){return{data:{is_email:t.is_email,is_message:t.is_message,is_phone:t.is_phone,user_id:t.users_id}}}));return i},onSubmit:function(){var t=this;if(this.validate()){var e=JSON.parse(JSON.stringify(this.form)),i={};if(this.id){var a=JSON.parse(e.notification_config);1===e.notification_type?(e.notification_config={},e.notification_members=this.form.commands.map((function(t){return{user_id:t.data.user_id,is_email:t.data.is_email,is_message:t.data.is_message,is_phone:t.data.is_phone}}))):2===e.notification_type?(a.email=this.form.email,i.email=a.email,e.notification_config=i):4===e.notification_type?(a.message=this.form.message,i.message=a.message,e.notification_config=i):5===e.notification_type?(a.phone=this.form.phone,i.phone=a.phone,e.notification_config=i):3!==e.notification_type&&6!==e.notification_type&&7!==e.notification_type&&8!==e.notification_type||(a.webhook=this.form.webhook,i.webhook=a.webhook,e.notification_config=i)}else 1===e.notification_type?(e.notification_config={},e.notification_members=this.form.commands.map((function(t){return{user_id:t.data.user_id,is_email:t.data.is_email,is_message:t.data.is_message,is_phone:t.data.is_phone}}))):2===e.notification_type?e.notification_config.email=this.form.email:4===e.notification_type?e.notification_config.message=this.form.message:5===e.notification_type?e.notification_config.phone=this.form.phone:3!==e.notification_type&&6!==e.notification_type&&7!==e.notification_type&&8!==e.notification_type||(e.notification_config.webhook=this.form.webhook);this.id?Object(r["d"])(e).then((function(e){200===e.data.code&&(t.$emit("submit"),t.noticeType="",t.dialogVisible=!1,t.$message({message:"编辑成功",center:!0,type:"success"}))})):Object(r["a"])(e).then((function(e){200===e.data.code&&(t.$emit("submit"),t.noticeType="",t.dialogVisible=!1,t.$message({message:"新建成功",center:!0,type:"success"}))}))}},handleClose:function(){this.form={},this.noticeType="",this.dialogVisible=!1},cancelDialog:function(){this.form={},this.noticeType="",this.dialogVisible=!1},validate:function(){if(!this.form.group_name||""===this.form.group_name)return this.$refs.nameRef.focus(),Object(o["h"])(this.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.PLACEHOLDER")),!1;if(!this.form.desc||""===this.form.desc)return this.$refs.descRef.focus(),Object(o["h"])(this.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.PLACEHOLDER1")),!1;if(!this.form.notification_type||""===this.form.notification_type)return this.$refs.selRef.focus(),Object(o["h"])(this.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.PLACEHOLDER2")),!1;if(2===this.noticeType&&(!this.form.email||""===this.form.email))return Object(o["h"])(this.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.PLACEHOLDER5")),!1;if(4===this.noticeType&&(!this.form.message||""===this.form.message))return Object(o["h"])(this.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.PLACEHOLDER10")),!1;if(5===this.noticeType&&(!this.form.phone||""===this.form.phone))return Object(o["h"])(this.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.PLACEHOLDER10")),!1;if((3===this.noticeType||6===this.noticeType||7===this.noticeType||8===this.noticeType)&&(!this.form.webhook||""===this.form.webhook))return Object(o["h"])(this.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.PLACEHOLDER7")),!1;if(1===this.noticeType)for(var t=0;t<this.$refs.deviceTypeRef.length;t++){var e=this.$refs.deviceTypeRef[t];if(!e.validate())return!1}return!0}}},c=l,f=(i("1750"),i("2877")),u=Object(f["a"])(c,a,n,!1,null,"14516f72",null);e["default"]=u.exports},d5c0:function(t,e,i){}}]);