(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4b98f3d4","chunk-57f2f762","chunk-2d0cc9d7"],{1079:function(t,e,a){},"239d":function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("h3",{staticClass:"table-title h3 font-weight-bolder m-0 pt-2"},[t._t("default")],2)},o=[],i={name:"TableTitle"},l=i,n=a("2877"),s=Object(n["a"])(l,r,o,!1,null,"2001a59c",null);e["a"]=s.exports},"3cfe":function(t,e,a){"use strict";a("a9e3"),a("d3b7"),a("25f0");var r=a("2b0e");r["default"].mixin({methods:{formatDate:function(t){var e=1e3*parseInt(t),a=new Date(e),r=a.getFullYear(),o=a.getMonth()+1;o=o<10?"0"+o:o;var i=a.getDate();i=i<10?"0"+i:i;var l=a.getHours();l=l<10?"0"+l:l;var n=a.getMinutes();n=n<10?"0"+n:n;var s=a.getSeconds();s=s<10?"0"+s:s;var c=r+"-"+o+"-"+i+" "+l+":"+n+":"+s;return c},jsonTypeConvert:function(t,e){var a=(null===t||void 0===t?void 0:t.toLowerCase())||"";return"float"===a||"integer"===a||"number"===a?Number(e):e.toString()}}})},"3df9":function(t,e,a){"use strict";a("1079")},"4f4c":function(t,e,a){"use strict";a.r(e),a.d(e,"data",(function(){return r}));var r=[{name:"电表",version:"1.0.2",parent:"",model:""}]},"56cd":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"rounded card p-4 el-table-transparent el-dark-input"},[a("el-row",{staticClass:"pt-3 pb-4 px-3",attrs:{type:"flex",gutter:20}},[a("el-col",{attrs:{span:12}},[a("TableTitle",[t._v(t._s(t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.FIRMWAREUPGRADE")))])],1),a("el-col",{staticClass:"px-2 text-right",attrs:{span:12}},[a("el-button",{attrs:{size:"medium",type:"border"},on:{click:t.handleCreate}},[t._v(t._s(t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.ADDFIRMWARE")))])],1)],1),a("el-row",{staticClass:"pt-3 pb-4 px-3",attrs:{type:"flex",gutter:20}},[a("el-col",{attrs:{span:4}},[a("el-select",{attrs:{placeholder:t.$t("COMMON.PLACEHOLDER5")},model:{value:t.params.product_id,callback:function(e){t.$set(t.params,"product_id",e)},expression:"params.product_id"}},[a("el-option",{key:"all",attrs:{label:t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.ALL_PRODUCTS"),value:"all"}}),t._l(t.productList,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],2)],1),a("el-col",{attrs:{span:4}},[a("el-tooltip",{attrs:{effect:"dark",content:t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.PLACEHOLDER1"),placement:"top"}},[a("el-input",{attrs:{placeholder:t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.PLACEHOLDER1")},model:{value:t.params.package_name,callback:function(e){t.$set(t.params,"package_name",e)},expression:"params.package_name"}})],1)],1),a("el-col",{attrs:{span:4}},[a("el-button",{attrs:{type:"border"},on:{click:t.getList}},[t._v(t._s(t.$t("COMMON.SEARCH")))])],1)],1),a("el-form",{staticClass:"inline-edit"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{data:t.tableData},scopedSlots:t._u([{key:"empty",fn:function(){return[a("div",[t._v(t._s(t.$t("COMMON.TABLE_NO_DATA")))])]},proxy:!0}])},[a("el-table-column",{attrs:{label:t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.FIRMWARE_LIST_ADD.PACKAGE_NAME"),prop:"package_name",align:"left"}}),a("el-table-column",{attrs:{label:t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.FIRMWARE_LIST_ADD.PACKAGE_VERSION"),prop:"package_version",align:"center"}}),a("el-table-column",{attrs:{label:t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.FIRMWARE_LIST_ADD.BELONGINGPRODUCT"),prop:"product_name",align:"center"}}),a("el-table-column",{attrs:{label:t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.FIRMWARE_LIST_ADD.PACKAGE_NAME"),prop:"package_module",align:"center"}}),a("el-table-column",{attrs:{label:t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.FIRMWARE_LIST_ADD.DESCRIPTION"),prop:"description",align:"center"}}),a("el-table-column",{attrs:{label:t.$t("PRODUCT_MANAGEMENT.BATCH_LIST.CREATEDATE"),prop:"created_at",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.created_at?t.formatDate(e.row.created_at):"--")+" ")]}}])}),a("el-table-column",{attrs:{align:"center",label:t.$t("PRODUCT_MANAGEMENT.BATCH_LIST.OPERATION"),width:"240px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"text-center"},[a("el-button",{staticClass:"mr-1",attrs:{type:"indigo",size:"mini"},on:{click:function(a){return t.viewTaskList(e.row)}}},[t._v(t._s(t.$t("COMMON.VIEW")))]),a("el-popconfirm",{staticClass:"mr-1",attrs:{"confirm-button-text":t.$t("COMMON.CONFIRM"),"cancel-button-text":t.$t("COMMON.CANCEL"),title:t.$t("AUTOMATION.TITLE4")},on:{confirm:function(a){return t.handleDelete(e.row)}}},[a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{slot:"reference",size:"mini",type:"danger"},slot:"reference"},[t._v(t._s(t.$t("PRODUCT_MANAGEMENT.BATCH_LIST.DELETE")))])],1)],1)]}}])})],1)],1),a("div",{staticClass:"text-right py-3"},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:t.params.total,"current-page":t.params.current_page,"page-size":t.params.per_page},on:{"update:currentPage":function(e){return t.$set(t.params,"current_page",e)},"update:current-page":function(e){return t.$set(t.params,"current_page",e)},"current-change":t.getList}})],1),a("add-package",{attrs:{visible:t.addPackageDialogVisible},on:{"update:visible":function(e){t.addPackageDialogVisible=e},submit:t.getList}})],1)},o=[],i=(a("d3b7"),a("239d")),l=a("ac1fd"),n=a("56ce"),s=a("c4c8"),c=(a("3cfe"),a("4f4c")),d={name:"FirmwareUpgrade",components:{TableTitle:i["a"],AddPackage:l["default"]},data:function(){return{tableData:[],loading:!1,params:{package_name:"",current_page:1,per_page:10,total:0,product_id:"all"},addPackageDialogVisible:!1,productList:[]}},mounted:function(){this.getProductList(),this.getList()},methods:{getProductList:function(){var t=this;this.loading=!0,s["a"].page({current_page:1,per_page:9999}).then((function(e){var a,r=e.data;200===r.code&&(t.productList=(null===(a=r.data)||void 0===a?void 0:a.data)||[])})).finally((function(){t.loading=!1}))},getList:function(){var t=this;this.params.product_id="all"===this.params.product_id?"":this.params.product_id,n["a"].list(this.params).then((function(e){var a,r=e.data;(console.log(r),200===r.code)&&(t.tableData=(null===(a=r.data)||void 0===a?void 0:a.data)||[],t.params.total=r.data.total)})),this.tableData=c["data"],console.log(this.tableData)},handleCreate:function(){this.addPackageDialogVisible=!0},viewTaskList:function(t){this.$router.push({name:"OTATask",query:{otaId:t.id,productId:t.product_id}})},handleDelete:function(t){var e=this;n["a"].delete({id:t.id}).then((function(t){var a=t.data;200===a.code&&(e.$message.success("删除成功"),e.getList())}))}}},u=d,p=a("2877"),_=Object(p["a"])(u,r,o,!1,null,"4febe7d4",null);e["default"]=_.exports},"56ce":function(t,e,a){"use strict";var r=a("18a6"),o=a("add0"),i="/tp_ota",l="/tp_ota_task",n="/tp_ota_device";e["a"]={add:function(t){return Object(r["a"])({url:i+"/add",method:"post",data:t})},list:function(t){return Object(r["a"])({url:i+"/list",method:"post",data:t})},delete:function(t){return Object(r["a"])({url:i+"/delete",method:"post",data:t})},uploadUrl:o["a"]+"api/file/up",taskList:function(t){return Object(r["a"])({url:l+"/list",method:"post",data:t})},taskAdd:function(t){return Object(r["a"])({url:l+"/add",method:"post",data:t})},taskDetailList:function(t){return Object(r["a"])({url:n+"/list",method:"post",data:t})},modifyUpgradeStatus:function(t){return Object(r["a"])({url:"/tp_ota_device/modfiyupdate",method:"post",data:t})}}},ac1fd:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"firmware-create"},[a("el-dialog",{staticClass:"el-dark-dialog",attrs:{title:t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.FIRMWARE_LIST_ADD.ADD_PACKAGE"),visible:t.dialogVisible,width:"540px","before-close":function(){return t.dialogVisible=!1},"close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-form",{ref:"firmwareCreateForm",attrs:{rules:t.rules,"label-position":"left",model:t.form,"label-width":"150px"}},[a("el-form-item",{attrs:{label:t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.FIRMWARE_LIST_ADD.PACKAGE_NAME"),prop:"package_name",required:""}},[a("el-tooltip",{attrs:{effect:"dark",content:"支持中文、英文、数字、下划线（_）、中划线（-）、小括号（()），必须以中文、英文或数字开头，长度不能超过 40 个字符",placement:"top"}},[a("el-input",{attrs:{maxlength:"40","show-word-limit":""},model:{value:t.form.package_name,callback:function(e){t.$set(t.form,"package_name",e)},expression:"form.package_name"}})],1)],1),a("el-form-item",{attrs:{label:t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.FIRMWARE_LIST_ADD.BELONGINGPRODUCT"),prop:"product_id"}},[a("el-select",{attrs:{placeholder:t.$t("COMMON.PLACEHOLDER5")},model:{value:t.form.product_id,callback:function(e){t.$set(t.form,"product_id",e)},expression:"form.product_id"}},t._l(t.productList,(function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.id}})})),1)],1),a("el-form-item",{attrs:{label:t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.FIRMWARE_LIST_ADD.PACKAGE_MODULE"),prop:"package_module"}},[a("el-tooltip",{attrs:{effect:"dark",content:"支持英文字母、数字、点、中划线和下划线，长度限制 1～64 个字符",placement:"top"}},[a("el-input",{model:{value:t.form.package_module,callback:function(e){t.$set(t.form,"package_module",e)},expression:"form.package_module"}})],1)],1),a("el-form-item",{attrs:{label:t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.FIRMWARE_LIST_ADD.PACKAGE_VERSION"),prop:"package_version"}},[a("el-tooltip",{attrs:{effect:"dark",content:"仅支持英文字母、数字、点号（.）、中划线（-）和下划线（_），长度限制为 1~64 个字符",placement:"top"}},[a("el-input",{attrs:{placeholder:"例：v1.0.0"},model:{value:t.form.package_version,callback:function(e){t.$set(t.form,"package_version",e)},expression:"form.package_version"}})],1)],1),a("el-form-item",{attrs:{label:t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.FIRMWARE_LIST_ADD.SIGNTYPE"),prop:"signature_algorithm"}},[a("el-select",{model:{value:t.form.signature_algorithm,callback:function(e){t.$set(t.form,"signature_algorithm",e)},expression:"form.signature_algorithm"}},[a("el-option",{attrs:{label:"MD5",value:"MD5"}}),a("el-option",{attrs:{label:"SHA256",value:"SHA256"}})],1)],1),a("el-form-item",{attrs:{label:t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.FIRMWARE_LIST_ADD.UPLOAD_PACKAGE"),required:"",prop:"packageUrl"}},[a("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:t.uploadUrl,headers:t.headers,data:{type:"upgradePackage"},accept:".bin,.tar,.gz,.tar.xz,.zip,.gzip,.apk,.dav,.pack","file-list":t.fileList,limit:2,"on-change":t.onUploadChange,"on-success":t.onUploadSuccess,"auto-upload":!1}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"border"},slot:"trigger"},[t._v(t._s(t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.FIRMWARE_LIST_ADD.CHOOSE_FILE")))]),a("el-tooltip",{attrs:{effect:"dark",content:"仅支持 bin、tar、gz、tar.xz、zip、gzip、apk、dav、pack 类型的文件，文件名支持中文、英文字母、数字和下划线，长度限制1~32个字符，文件总大小最大为1000MB",placement:"top"}},[a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"success"},on:{click:t.submitUpload}},[t._v(t._s(t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.FIRMWARE_LIST_ADD.UPLOAD_TO_SERVER")))])],1)],1)],1),a("el-form-item",{attrs:{label:t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.FIRMWARE_LIST_ADD.DESCRIPTION"),prop:"description"}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1),a("el-form-item",{staticStyle:{"line-height":"30px"},attrs:{label:t.$t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.FIRMWARE_LIST_ADD.OTHER_CONFIG")}},t._l(t.form.additional_info,(function(e,r){return a("el-row",{key:r},[a("el-col",{staticStyle:{"margin-right":"10px"},attrs:{span:7}},[a("el-input",{attrs:{size:"small",placeholder:"key"},model:{value:e.key,callback:function(a){t.$set(e,"key",a)},expression:"config.key"}})],1),a("el-col",{staticStyle:{"margin-right":"10px"},attrs:{span:7}},[a("el-input",{attrs:{size:"small",placeholder:"value"},model:{value:e.value,callback:function(a){t.$set(e,"value",a)},expression:"config.value"}})],1),a("el-col",{attrs:{span:6,offset:2}},[0===r?a("el-button",{attrs:{size:"small",type:"border"},on:{click:t.handleAddConfig}},[t._v(t._s(t.$t("COMMON.ADD")))]):a("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(a){return t.handleDeleteConfig(e)}}},[t._v(t._s(t.$t("COMMON.DELETE")))])],1)],1)})),1),a("div",{staticClass:"text-right"},[a("el-button",{attrs:{type:"border"},on:{click:function(e){t.dialogVisible=!1}}},[t._v(t._s(t.$t("COMMON.CANCEL")))]),a("el-button",{attrs:{type:"primary"},on:{click:t.handleSubmit}},[t._v(t._s(t.$t("COMMON.CONFIRM")))])],1)],1)],1)],1)},o=[],i=(a("e9c4"),a("d3b7"),a("159b"),a("c740"),a("a434"),a("fb6a"),a("c1df")),l=a.n(i),n=a("f570"),s=a("c4c8"),c=a("56ce"),d=a("30ab"),u=a("2fa3"),p=a("add0"),_={name:"AddPackage",props:{visible:{type:[Boolean],default:!1},data:{type:[Object],default:function(){return{}}}},computed:{dialogVisible:{get:function(){return this.visible},set:function(t){this.$emit("update:visible",t)}}},data:function(){return{form:{product_id:"",package_name:"",package_version:"",package_url:"",packageUrl:"",package_module:"default",signature_algorithm:"MD5",description:"",additional_info:[{}]},uploadUrl:c["a"].uploadUrl,fileList:[],headers:{Authorization:"Bearer "+d["a"].getToken()},productList:[],rules:{product_id:[{required:!0,message:n["a"].t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.FIRMWARE_LIST_ADD.PLACEHOLDER1")}],package_name:[{required:!0,message:n["a"].t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.FIRMWARE_LIST_ADD.PLACEHOLDER2")}],package_module:[{required:!0,message:n["a"].t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.FIRMWARE_LIST_ADD.PLACEHOLDER2")}],packageUrl:[{required:!0,message:"请上传升级包！"}],package_version:[{required:!0,message:n["a"].t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.FIRMWARE_LIST_ADD.PLACEHOLDER3")}],sign:[{required:!0,message:n["a"].t("PRODUCT_MANAGEMENT.FIRMWARE_LIST.FIRMWARE_LIST_ADD.PLACEHOLDER4")}]}}},mounted:function(){this.getProductList()},methods:{getProductList:function(){var t=this,e={current_page:1,per_page:9999};s["a"].page(e).then((function(e){var a,r=e.data;200===r.code&&(t.productList=(null===(a=r.data)||void 0===a?void 0:a.data)||[])}))},handleSubmit:function(){var t=this;console.log("handleSubmit",this.form,this.fileList),this.$refs.firmwareCreateForm.validate((function(e){if(e){var a=JSON.parse(JSON.stringify(t.form)),r={};a.additional_info.forEach((function(t){r[t.key]=t.value})),a.additional_info=JSON.stringify(r),a.created_at=l()().format("YYYY-MM-DD HH:mm:ss"),c["a"].add(a).then((function(e){var a=e.data;console.log("handleSubmit",a),200===a.code&&(t.dialogVisible=!1,Object(u["i"])("添加成功!"),t.$emit("submit"))}))}}))},handleAddConfig:function(){this.form.additional_info.push({})},handleDeleteConfig:function(t){var e=this.form.additional_info.findIndex((function(e){return e===t}));this.form.additional_info.splice(e,1)},removeDotSlash:function(t){return 0===t.indexOf("./")?t.slice(2):t},submitUpload:function(){this.$refs.upload.submit()},onUploadChange:function(t,e){this.fileList=[],this.fileList.push(t)},onUploadSuccess:function(t,e,a){console.log("onUploadSuccess",t,e,a),200===t.code?(this.form.packageUrl=p["a"]+this.removeDotSlash(t.data),this.form.package_path=this.form.packageUrl,this.form.package_url=this.form.packageUrl):this.$message.error(t.msg)}}},f=_,m=(a("3df9"),a("2877")),A=Object(m["a"])(f,r,o,!1,null,null,null);e["default"]=A.exports},c4c8:function(t,e,a){"use strict";var r=a("18a6"),o=a("add0"),i="/tp_product",l="/tp_batch";e["a"]={add:function(t){return Object(r["a"])({url:i+"/add",method:"post",data:t})},edit:function(t){return Object(r["a"])({url:i+"/edit",method:"post",data:t})},del:function(t){return Object(r["a"])({url:i+"/delete",method:"post",data:t})},page:function(t){return Object(r["a"])({url:i+"/list",method:"post",data:t})},batchAdd:function(t){return Object(r["a"])({url:l+"/add",method:"post",data:t})},batchEdit:function(t){return Object(r["a"])({url:l+"/edit",method:"post",data:t})},batchDel:function(t){return Object(r["a"])({url:l+"/delete",method:"post",data:t})},batchPage:function(t){return Object(r["a"])({url:l+"/list",method:"post",data:t})},generateBatch:function(t){return Object(r["a"])({url:l+"/generate",method:"post",data:t})},uploadUrl:o["a"]+"api/file/up",importBatch:function(t){return Object(r["a"])({url:l+"/import",method:"post",data:t})},exportQRCodeAndData:function(t){return Object(r["a"])({url:l+"/export",method:"post",data:t})},getPreRegistration:function(t){return Object(r["a"])({url:"/tp_generate_device/list",method:"post",data:t})},generateDevice:function(t){return Object(r["a"])({url:"/tp_generate_device/activate",method:"post",data:t})},deletePreRegistration:function(t){return Object(r["a"])({url:"/tp_generate_device/delete",method:"post",data:t})},getDeviceListByProductId:function(t){return Object(r["a"])({url:"/device/listbyproduct",method:"post",data:t})},addTask:function(t){return Object(r["a"])({url:"/tp_ota_task/add",method:"post",data:t})}}}}]);