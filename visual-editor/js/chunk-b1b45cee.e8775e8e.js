(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b1b45cee","chunk-2d21e594"],{"3a4d":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{display:"flex"}},[n("el-select",{ref:"weekRef",staticStyle:{"margin-right":"10px"},on:{change:e.handleChange},model:{value:e.weekValue,callback:function(t){e.weekValue=t},expression:"weekValue"}},e._l(e.weekOptions,(function(e,t){return n("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1),""!=e.weekValue?n("el-time-picker",{ref:"timeRef",attrs:{"value-format":"HH:mm",placeholder:e.$t("AUTOMATION.PLACEHOLDER.SELECT_TIME")},on:{change:e.handleChange},model:{value:e.timeValue,callback:function(t){e.timeValue=t},expression:"timeValue"}}):e._e()],1)},i=[],r=(n("a9e3"),n("2fa3")),o=n("d4d2"),c={name:"WeeklySelector",props:{data:{type:[Object],default:function(){return{}}}},data:function(){return{weekValue:"",timeValue:"",weekOptions:[{label:this.$t("AUTOMATION.WEEK.MONDAY"),value:o["Week"].MONDAY},{label:this.$t("AUTOMATION.WEEK.TUESDAY"),value:o["Week"].THURSDAY},{label:this.$t("AUTOMATION.WEEK.WEDNESDAY"),value:o["Week"].WEDNESDAY},{label:this.$t("AUTOMATION.WEEK.THURSDAY"),value:o["Week"].THURSDAY},{label:this.$t("AUTOMATION.WEEK.FRIDAY"),value:o["Week"].FRIDAY},{label:this.$t("AUTOMATION.WEEK.SATURDAY"),value:o["Week"].SATURDAY},{label:this.$t("AUTOMATION.WEEK.SUDNAY"),value:o["Week"].SUNDAY}]}},watch:{data:{handler:function(e){e&&e.week&&e.time&&(console.log("RepeatTimeSelector",e),this.weekValue=Number(e.week),this.timeValue=e.time)},immediate:!0}},methods:{handleChange:function(){this.$emit("change",{week:this.weekValue,time:this.timeValue})},validate:function(){return this.weekValue&&""!==this.weekValue?!(!this.timeValue||""===this.timeValue)||(this.$refs.timeRef.focus(),Object(r["h"])(this.$t("AUTOMATION.ERROR.TIME")),!1):(this.$refs.weekRef.focus(),Object(r["h"])(this.$t("AUTOMATION.ERROR.WEEKLY")),!1)}}},s=c,d=n("2877"),u=Object(d["a"])(s,a,i,!1,null,"f5d5480c",null);t["default"]=u.exports},d4d2:function(e,t,n){"use strict";n.r(t),n.d(t,"setConditions",(function(){return p})),n.d(t,"setActions",(function(){return y})),n.d(t,"getConditions",(function(){return v})),n.d(t,"getActions",(function(){return g})),n.d(t,"ConditionType",(function(){return i})),n.d(t,"StateMode",(function(){return r})),n.d(t,"TimeType",(function(){return c})),n.d(t,"RepeatTimeType",(function(){return s})),n.d(t,"Week",(function(){return d})),n.d(t,"ActionType",(function(){return u})),n.d(t,"CommandType",(function(){return l}));var a=n("5530"),i=(n("7db0"),n("d3b7"),n("b64b"),n("b0c0"),n("38cf"),n("25f0"),n("159b"),n("e9c4"),n("a9e3"),n("a15b"),n("ac1f"),n("1276"),{device:"1",time:"2",getKey:function(e){return Object.keys(i).find((function(t){return i[t]===e}))}}),r={property:"1",event:"2",onlineState:"3",onlineDuration:"4",getKey:function(e){return Object.keys(r).find((function(t){return r[t]===e}))}},o={online:"1",offline:"2",onAndOff:"3",getKey:function(e){return Object.keys(o).find((function(t){return o[t]===e}))}},c={range:"0",once:"1",repeat:"2",custom:"3",getKey:function(e){return Object.keys(c).find((function(t){return c[t]===e}))}},s={perHour:"1",days:"2",weekly:"3",monthly:"4",cron:"5",getKey:function(e){return Object.keys(s).find((function(t){return s[t]===e}))}},d={SUNDAY:1,MONDAY:2,TUESDAY:3,WEDNESDAY:4,THURSDAY:5,FRIDAY:6,SATURDAY:7},u={device:"1",alarm:"2",scene:"3",getKey:function(e){return Object.keys(u).find((function(t){return u[t]===e}))}},l={property:1,service:2};function p(e){var t=1,n=function(e){var n={};if(console.log("Object.keys(c)",e),"device"===e.type)n={condition_type:i.device,device_id:e.data.deviceId,device_condition_type:r[e.data.state.mode]},n.device_condition_type===r.property?(n["v1"]=e.data.state.name,n["v2"]=e.data.state.operator.symbol,n["v3"]=e.data.state.operator.value):n.device_condition_type===r.onlineState&&(n["v2"]=o[e.data.state.name]);else if("time"===e.type){switch(console.log("时间条件",e),n={condition_type:i.time,time_condition_type:c[e.data.type]},n.time_condition_type){case c.once:n["v1"]=e.data.once.value;break;case c.repeat:var a=e.data.repeat;switch(n["v1"]=s[a.type].toString(),s[a.type]){case s.perHour:n["v3"]=a.perHour.toString();break;case s.days:n["v3"]=a.days.toString();break;case s.weekly:var d=a.weekly.week;n["v3"]=d.toString(),n["v4"]=a.weekly.time.toString();break;case s.monthly:n["v3"]=a.monthly.day.toString()+":"+a.monthly.time.toString();break;case s.cron:n["v3"]=a.cron.toString()}break;case c.range:n["v1"]=e.data.range[0],n["v2"]=e.data.range[1];break}console.log("setConditions",n)}return e.relation&&"or"==e.relation&&t++,n.group_number=t,n},a=[];return e.length>0&&e.forEach((function(e){a.push(n(e))})),a}function y(e,t){var n=function(e){var n={};switch(n.action_type=u[e.type],console.log("====washAction",e,n),n.action_type){case u.device:e.data.forEach((function(e){var t={};t[e.state.name]=e.state.operator.value;var r={device_model:"1",instruct:t};i.push(Object(a["a"])(Object(a["a"])({},n),{},{device_id:e.deviceId,additional_info:JSON.stringify(r)}))}));break;case u.scene:n.scenario_strategy_id=e.value||"",i.push(n);break;case u.alarm:n.warning_strategy={},n.warning_strategy.id=e.data.id?e.data.id:"",n.warning_strategy.warning_strategy_name=t,n.warning_strategy.warning_level=e.data.warningLevel,n.warning_strategy.group=e.data.group,n.warning_strategy.repeat_count=Number(e.data.repeatTimes),n.warning_strategy.inform_way=e.data.notification.join(","),n.warning_strategy.warning_description=e.data.warning_description,i.push(n);break}},i=[];return e.length>0&&e.forEach((function(e){n(e)})),i}function v(e){var t=[],n=1;return console.log("getConditions",e),e&&e.length>0?e.forEach((function(e,a){console.log(a,e.group_number);var d=e.group_number,u={};if(0===a?u.relation="":d===n?u.relation="and":d>n&&(u.relation="or",n=d),e.condition_type==i.device){u.type=i.getKey(e.condition_type),u.data={projectId:e.business_id,groupId:e.asset_id,deviceId:e.device_id};var l="";switch(e.device_condition_type){case r.property:l=e.v1;break;case r.onlineState:l=o.getKey(e.v2);break}console.log(u.data.state),u.data.state={name:l,mode:r.getKey(e.device_condition_type),operator:{symbol:e.v2,value:e.v3}}}else switch(u.type=i.getKey(e.condition_type),u.data={type:c.getKey(e.time_condition_type)},e.time_condition_type){case c.once:u.data.once={value:e.v1};break;case c.repeat:switch(u.data.repeat={type:s.getKey(e.v1)},e.v1){case s.perHour:u.data.repeat.perHour=e.v3;break;case s.days:u.data.repeat.days=e.v3;break;case s.weekly:u.data.repeat.weekly={week:e.v3,time:e.v4};break;case s.monthly:var p=e.v3.split(":");u.data.repeat.monthly={day:p[0],time:p[1]+":"+p[2]};break;case s.cron:u.data.repeat.cron=e.v3;break}break;case c.range:u.data.range=[e.v1,e.v2];break;case c.custom:break}t.push(u)})):t.push({}),t}function g(e){var t=[],n=[];return e.forEach((function(e){var a={};if(e.action_type===u.device){var i={projectId:e.business_id,groupId:e.asset_id,deviceId:e.device_id,state:{}},r=e.additional_info?JSON.parse(e.additional_info):{},o=Object.keys(r.instruct||{})[0];i.state={name:o,mode:"property",operator:{symbol:"",value:r.instruct?r.instruct[o]:""}},n.push(i)}else if(e.action_type===u.alarm){var c,s,d,l,p;a.type="alarm",a.data={id:(null===(c=e.warning_strategy)||void 0===c?void 0:c.id)||"",warningLevel:(null===(s=e.warning_strategy)||void 0===s?void 0:s.warning_level)||"",repeatTimes:(null===(d=e.warning_strategy)||void 0===d?void 0:d.repeat_count)||0,notification:(null===(l=e.warning_strategy)||void 0===l?void 0:l.inform_way.split(","))||[],warning_description:(null===(p=e.warning_strategy)||void 0===p?void 0:p.warning_description)||""},t.push(a)}else e.action_type===u.scene&&(a.type="scene",a.value=e.scenario_strategy_id,t.push(a))})),n.length>0&&t.push({type:"device",data:n}),console.log("getActions.actionList",t),t}}}]);