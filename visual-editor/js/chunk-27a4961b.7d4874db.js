(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-27a4961b","chunk-62835bb6","chunk-2f642956"],{"239d":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("h3",{staticClass:"table-title h3 font-weight-bolder m-0 pt-2"},[t._t("default")],2)},r=[],o={name:"TableTitle"},n=o,l=a("2877"),s=Object(l["a"])(n,i,r,!1,null,"2001a59c",null);e["a"]=s.exports},"3ed6":function(t,e,a){"use strict";a("e236")},"9cab":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"el-dark-dialog",attrs:{title:t.$t("PRODUCT_MANAGEMENT.BATCH_LIST.CREATEBATCH"),visible:t.dialogVisible,width:"400px","before-close":t.handleClose,"close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-form",{attrs:{inline:!1,"label-position":"left","label-width":"80px",model:t.formData,rules:t.formRules}},[a("el-row",[a("el-form-item",{attrs:{label:t.$t("PRODUCT_MANAGEMENT.BATCH_LIST.BATCHNUMBER"),prop:"batch_number"}},[a("el-input",{model:{value:t.formData.batch_number,callback:function(e){t.$set(t.formData,"batch_number",e)},expression:"formData.batch_number"}})],1)],1),a("el-row",[a("el-form-item",{attrs:{label:t.$t("COMMON.COUNT"),prop:"device_number"}},[a("el-input-number",{model:{value:t.formData.device_number,callback:function(e){t.$set(t.formData,"device_number",e)},expression:"formData.device_number"}})],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"save"},on:{click:t.handleSubmit}},[t._v(t._s(t.$t("COMMON.CREATE")))])],1)],1)},r=[],o=a("5530"),n=a("c4c8"),l=a("2fa3"),s=a("f570"),c=!0,d={name:"CreateBatch",props:{visible:{type:[Boolean],default:!1},data:{type:[Object],default:function(){return{}}}},data:function(){return{formData:{batch_number:"",device_number:0},formRules:{batch_number:[{required:c,message:s["a"].t("PRODUCT_MANAGEMENT.BATCH_LIST.PLACEHOLDER1")}],number:[{required:c,message:s["a"].t("PRODUCT_MANAGEMENT.BATCH_LIST.PLACEHOLDER4"),type:"number"}]},productOptions:[]}},computed:{dialogVisible:{get:function(){return this.visible},set:function(t){this.$emit("update:visible",t)}}},methods:{handleSubmit:function(){var t=this;this.data.id||n["a"].batchAdd(Object(o["a"])({product_id:this.data.product_id},this.formData)).then((function(e){var a=e.data;console.log("result",a),200===a.code&&(t.$emit("submit"),Object(l["i"])("创建批次成功！"),t.dialogVisible=!1)}))},handleClose:function(){this.dialogVisible=!1}}},u=d,p=(a("3ed6"),a("2877")),b=Object(p["a"])(u,i,r,!1,null,"7d3a39b4",null);e["default"]=b.exports},c4c8:function(t,e,a){"use strict";var i=a("18a6"),r=a("add0"),o="/tp_product",n="/tp_batch";e["a"]={add:function(t){return Object(i["a"])({url:o+"/add",method:"post",data:t})},edit:function(t){return Object(i["a"])({url:o+"/edit",method:"post",data:t})},del:function(t){return Object(i["a"])({url:o+"/delete",method:"post",data:t})},page:function(t){return Object(i["a"])({url:o+"/list",method:"post",data:t})},batchAdd:function(t){return Object(i["a"])({url:n+"/add",method:"post",data:t})},batchEdit:function(t){return Object(i["a"])({url:n+"/edit",method:"post",data:t})},batchDel:function(t){return Object(i["a"])({url:n+"/delete",method:"post",data:t})},batchPage:function(t){return Object(i["a"])({url:n+"/list",method:"post",data:t})},generateBatch:function(t){return Object(i["a"])({url:n+"/generate",method:"post",data:t})},uploadUrl:r["a"]+"api/file/up",importBatch:function(t){return Object(i["a"])({url:n+"/import",method:"post",data:t})},exportQRCodeAndData:function(t){return Object(i["a"])({url:n+"/export",method:"post",data:t})},getPreRegistration:function(t){return Object(i["a"])({url:"/tp_generate_device/list",method:"post",data:t})},generateDevice:function(t){return Object(i["a"])({url:"/tp_generate_device/activate",method:"post",data:t})},deletePreRegistration:function(t){return Object(i["a"])({url:"/tp_generate_device/delete",method:"post",data:t})},getDeviceListByProductId:function(t){return Object(i["a"])({url:"/device/listbyproduct",method:"post",data:t})},addTask:function(t){return Object(i["a"])({url:"/tp_ota_task/add",method:"post",data:t})}}},d985:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{staticClass:"el-dark-dialog",attrs:{title:t.$t("PRODUCT_MANAGEMENT.BATCH_LIST.IMPORTDATA"),visible:t.dialogVisible,width:"400px","before-close":t.handleClose,"close-on-click-modal":!1},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("div",{staticClass:"dialog-footer text-center",attrs:{slot:"head"},slot:"head"},[a("el-button",{attrs:{type:"save"},on:{click:t.handleSubmit}},[t._v(t._s(t.$t("COMMON.CONFIRM")))])],1),a("el-form",{ref:"formRef",attrs:{"label-position":"left","label-width":"80px",model:t.form,rules:t.rules}},[a("el-form-item",{attrs:{label:t.$t("PRODUCT_MANAGEMENT.BATCH_LIST.BATCHNUMBER"),required:"",prop:"batch_number"}},[a("el-input",{model:{value:t.form.batch_number,callback:function(e){t.$set(t.form,"batch_number",e)},expression:"form.batch_number"}})],1),a("el-form-item",{attrs:{label:t.$t("PRODUCT_MANAGEMENT.BATCH_LIST.FILE"),required:"",prop:"file"}},[a("el-upload",{staticClass:"upload-demo",staticStyle:{float:"left"},attrs:{action:t.uploadUrl,headers:t.headers,data:{type:"importBatch"},"file-list":t.fileList,accept:".xlsx,.xls","on-success":t.onUploadSuccess}},[a("el-button",{attrs:{size:"small",type:"primary"}},[t._v(t._s(t.$t("PRODUCT_MANAGEMENT.BATCH_LIST.UPLOAD")))])],1),a("el-link",{staticStyle:{"margin-left":"20px"},attrs:{type:"success",href:t.downloadUrl,underline:!1}},[t._v(t._s(t.$t("PRODUCT_MANAGEMENT.BATCH_LIST.DOWNLOAD_TEMPLATE")))])],1)],1),a("div",{staticClass:"dialog-footer text-center",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"save"},on:{click:t.handleSubmit}},[t._v(t._s(t.$t("COMMON.CONFIRM")))])],1)],1)],1)},r=[],o=a("c4c8"),n=a("30ab"),l=Object({NODE_ENV:"production",BASE_URL:"/"}).VUE_APP_BASE_URL||document.location.protocol+"//"+document.domain+":9999/",s={components:{},props:{visible:{type:Boolean,default:!1},data:{type:Object,default:function(){}}},computed:{dialogVisible:{get:function(){return this.visible},set:function(t){this.$emit("update:visible",t)}}},data:function(){return{fileList:[],uploadUrl:o["a"].uploadUrl,headers:{Authorization:"Bearer "+n["a"].getToken()},form:{batch_number:"",file:""},rules:{batch_number:[{required:!0,message:"请输入批次号",trigger:"blur"},{min:1,max:20,message:"长度在 1 到 20 个字符",trigger:"blur"}],file:[{required:!0,message:"请上传文件",trigger:"blur"}]},downloadUrl:l+"/files/init-images/batch_devices_template.xlsx"}},methods:{onUploadSuccess:function(t,e,a){console.log(t,t.data),this.form.file=t.data},handleClose:function(){this.dialogVisible=!1},handleSubmit:function(){var t=this;console.log(this.form),this.form.product_id=this.$route.query.product_id,this.$refs.formRef.validate((function(e){if(!e)return!1;o["a"].importBatch(t.form).then((function(e){t.$message.success("导入成功"),t.dialogVisible=!1,t.$emit("submit")}))}))}}},c=s,d=a("2877"),u=Object(d["a"])(c,i,r,!1,null,"76263e2c",null);e["default"]=u.exports},e236:function(t,e,a){},f9d8:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"rounded card p-4 el-table-transparent el-dark-input"},[a("el-row",{staticClass:"pt-3 pb-4 px-3",attrs:{type:"flex",gutter:20}},[a("el-col",{attrs:{span:12}},[a("TableTitle",[t._v(t._s(t.params.product_name)+" - "+t._s(t.$t("PRODUCT_MANAGEMENT.BATCH_LIST.BATCHLIST")))])],1),a("el-col",{staticClass:"px-2 text-right",attrs:{span:12}},[a("el-button",{attrs:{size:"medium",type:"border"},on:{click:t.handleCreate}},[t._v(t._s(t.$t("PRODUCT_MANAGEMENT.BATCH_LIST.CREATEBATCH")))]),a("el-button",{attrs:{size:"medium",type:"border"},on:{click:t.handleImport}},[t._v(t._s(t.$t("PRODUCT_MANAGEMENT.BATCH_LIST.IMPORTDATA")))])],1)],1),a("el-form",{staticClass:"inline-edit"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{data:t.tableData}},[a("el-table-column",{attrs:{label:t.$t("PRODUCT_MANAGEMENT.BATCH_LIST.BATCHNUMBER"),prop:"batch_number",align:"left"}}),a("el-table-column",{attrs:{label:t.$t("PRODUCT_MANAGEMENT.BATCH_LIST.DEVICENUMBER"),prop:"device_number",align:"center"}}),a("el-table-column",{attrs:{label:t.$t("PRODUCT_MANAGEMENT.BATCH_LIST.CREATEDATE"),prop:"created",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.created?e.row.created:"--")+" ")]}}])}),a("el-table-column",{attrs:{align:"right",label:t.$t("PRODUCT_MANAGEMENT.BATCH_LIST.OPERATION"),width:"320px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"text-right"},["1"!==e.row.generate_flag?a("el-button",{staticClass:"mr-1",attrs:{type:"indigo",size:"mini"},on:{click:function(a){return t.generateData(e.row)}}},[t._v(t._s(t.$t("PRODUCT_MANAGEMENT.BATCH_LIST.GENERATEDATA")))]):t._e(),"1"==e.row.generate_flag?a("el-button",{staticClass:"mr-1",attrs:{type:"indigo",size:"mini"},on:{click:function(a){return t.viewPreRegistration(e.row)}}},[t._v(t._s(t.$t("PRODUCT_MANAGEMENT.BATCH_LIST.VIEW_PREREGISTRATION")))]):t._e(),"1"==e.row.generate_flag?a("el-button",{staticClass:"mr-1",attrs:{type:"indigo",size:"mini",loading:t.exportLoading},on:{click:function(a){return t.exportQRCodeAndData(e.row)}}},[t._v(t._s(t.$t("PRODUCT_MANAGEMENT.BATCH_LIST.EXPORT")))]):t._e(),a("el-popconfirm",{staticClass:"mr-1",attrs:{"confirm-button-text":t.$t("COMMON.CONFIRM"),"cancel-button-text":t.$t("COMMON.CANCEL"),title:t.$t("AUTOMATION.TITLE4")},on:{confirm:function(a){return t.handleDelete(e.row)}}},[a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{slot:"reference",size:"mini",type:"danger"},slot:"reference"},[t._v(t._s(t.$t("PRODUCT_MANAGEMENT.BATCH_LIST.DELETE")))])],1)],1)]}}])})],1)],1),a("div",{staticClass:"text-right py-3"},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:t.params.total,"current-page":t.params.current_page,"page-size":t.params.per_page},on:{"update:currentPage":function(e){return t.$set(t.params,"current_page",e)},"update:current-page":function(e){return t.$set(t.params,"current_page",e)},"current-change":t.getBatchList}})],1),a("create-batch",{attrs:{visible:t.createDialogVisible,data:t.params},on:{"update:visible":function(e){t.createDialogVisible=e},submit:t.getBatchList}}),a("import-batch",{attrs:{visible:t.importDialogVisible},on:{"update:visible":function(e){t.importDialogVisible=e},submit:t.getBatchList}}),a("el-dialog",{staticClass:"el-dark-dialog el-dark-input",attrs:{width:"30%",title:t.$t("PRODUCT_MANAGEMENT.BATCH_LIST.EXPORT"),visible:t.exportVisible},on:{"update:visible":function(e){t.exportVisible=e}}},[a("div",{staticClass:"text-center"},[a("p",[t._v(t._s(t.downloadUrl?t.downloadUrl.split("/").pop().toString():t.$t("PRODUCT_MANAGEMENT.BATCH_LIST.GENERATE_WAIT")))]),a("p",[a("a",{attrs:{href:t.downloadUrl}},[t._v(t._s(t.$t("PRODUCT_MANAGEMENT.BATCH_LIST.CLICKDOWNLOAD")))])])])])],1)},r=[],o=(a("d3b7"),a("d81d"),a("239d")),n=a("c4c8"),l=a("9cab"),s=a("d985"),c=a("2fa3"),d=a("3de1"),u={name:"BatchList",components:{TableTitle:o["a"],CreateBatch:l["default"],ImportBatch:s["default"]},data:function(){return{tableData:[],loading:!1,params:{total:0,current_page:1,per_page:10},createDialogVisible:!1,exportLoading:!1,importDialogVisible:!1,generateEnabled:!0,exportVisible:!1,exporting:!1,downloadUrl:""}},mounted:function(){this.$route.query.product_id&&(this.params.product_id=this.$route.query.product_id,this.params.product_name=this.$route.query.product_name),console.log(this.params),this.getBatchList()},methods:{getBatchList:function(){var t=this;this.loading=!0,n["a"].batchPage(this.params).then((function(e){var a=e.data;200==a.code&&(t.tableData=a.data.data.map((function(t){return t.created=Object(d["a"])(t.created_time),t})),console.log("tableData",t.tableData))})).finally((function(){t.loading=!1}))},viewPreRegistration:function(t){console.log("viewPreRegistration",this.$route.query,t);var e=this.$route.query,a=(e.product_id,e.product_name);this.$router.push({path:"/product/batch/pre-registration",query:{batchId:t.id,productName:a,batchNumber:t.batch_number}})},handleCreate:function(){this.createDialogVisible=!0},handleDelete:function(t){var e=this;n["a"].batchDel({id:t.id}).then((function(t){var a=t.data;200==a.code&&e.getBatchList()}))},generateData:function(t){var e=this;this.generateEnabled&&(this.generateEnabled=!1,n["a"].generateBatch({id:t.id}).then((function(t){var a=t.data;200==a.code&&(e.getBatchList(),Object(c["i"])("批次生成成功！"))})).finally((function(){e.generateEnabled=!0})))},exportQRCodeAndData:function(t){var e=this;this.exportLoading=!0,n["a"].exportQRCodeAndData({id:t.id}).then((function(t){var a=t.data;200==a.code?(e.downloadUrl=a.data,e.exportVisible=!0):e.exportVisible=!1})).finally((function(){e.exportLoading=!1}))},exportData:function(t){},handleImport:function(){this.importDialogVisible=!0}}},p=u,b=a("2877"),m=Object(b["a"])(p,i,r,!1,null,"3d740a76",null);e["default"]=m.exports}}]);