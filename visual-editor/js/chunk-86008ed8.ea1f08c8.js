(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-86008ed8","chunk-d258d5a8"],{2206:function(t,e,a){},2712:function(t,e,a){"use strict";a("57eb")},"2cd9":function(t,e,a){"use strict";a("2206")},"57eb":function(t,e,a){},a44a:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"el-dark-dialog el-dark-input",attrs:{width:"800px",title:t.$t("DEVICE_MANAGEMENT.CUSTOM_SCRIPT.TITLE"),"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,visible:t.dialogVisible,"append-to-body":!0},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-form",{ref:"customForm",attrs:{model:t.formData,rules:t.formRule}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:t.$t("DEVICE_MANAGEMENT.CUSTOM_SCRIPT.COMPANYNAME"),prop:"companyName"}},[a("el-input",{model:{value:t.formData.company,callback:function(e){t.$set(t.formData,"company",e)},expression:"formData.company"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:t.$t("DEVICE_MANAGEMENT.CUSTOM_SCRIPT.PRODUCTNAME"),prop:"productName"}},[a("el-input",{model:{value:t.formData.product_name,callback:function(e){t.$set(t.formData,"product_name",e)},expression:"formData.product_name"}})],1)],1)],1),a("p",{staticClass:"code-editor-label"},[t._v(t._s(t.$t("DEVICE_MANAGEMENT.CUSTOM_SCRIPT.TEXT1")))]),a("CodeEditor",{key:"upside",staticClass:"dark-code-editor",staticStyle:{width:"100%",height:"260px","overflow-y":"auto"},attrs:{min_height:"260px",copy_code:!0,hide_header:!1,theme:"dark",wrap_code:!0},model:{value:t.formData.script_content_a,callback:function(e){t.$set(t.formData,"script_content_a",e)},expression:"formData.script_content_a"}}),a("p",{staticClass:"code-editor-label"},[t._v(t._s(t.$t("DEVICE_MANAGEMENT.CUSTOM_SCRIPT.TEXT2")))]),a("CodeEditor",{key:"down",staticClass:"dark-code-editor",staticStyle:{width:"100%",height:"260px"},attrs:{min_height:"260px",copy_code:!0,hide_header:!1,theme:"dark",wrap_code:!0},model:{value:t.formData.script_content_b,callback:function(e){t.$set(t.formData,"script_content_b",e)},expression:"formData.script_content_b"}}),a("el-tabs",{model:{value:t.testTabValue,callback:function(e){t.testTabValue=e},expression:"testTabValue"}},[a("el-tab-pane",{attrs:{label:"模拟输入",name:"input"}},[a("div",{staticStyle:{"margin-bottom":"4px"}},[a("span",[t._v("Topic： ")]),a("el-select",{attrs:{size:"small"},model:{value:t.formData.topic,callback:function(e){t.$set(t.formData,"topic",e)},expression:"formData.topic"}},[a("el-option",{attrs:{label:"device/attributes",value:"device/attributes"}}),a("el-option",{attrs:{label:"device/event ",value:"device/event "}}),a("el-option",{attrs:{label:"gateway/attributes ",value:"gateway/attributes "}}),a("el-option",{attrs:{label:"gateway/event ",value:"gateway/event "}})],1)],1),a("CodeEditor",{key:"input",staticClass:"dark-code-editor",staticStyle:{width:"100%",height:"100px"},attrs:{min_height:"100px",copy_code:!0,hide_header:!0,theme:"dark",wrap_code:!0},model:{value:t.formData.msg_content,callback:function(e){t.$set(t.formData,"msg_content",e)},expression:"formData.msg_content"}})],1),a("el-tab-pane",{attrs:{label:"运行结果",name:"result"}},[a("CodeEditor",{key:"result",staticClass:"dark-code-editor",staticStyle:{width:"100%",height:"100px"},attrs:{min_height:"100px",copy_code:!0,hide_header:!0,theme:"dark",wrap_code:!0,read_only:!0},model:{value:t.formData.result,callback:function(e){t.$set(t.formData,"result",e)},expression:"formData.result"}})],1)],1),a("div",{staticStyle:{"margin-top":"10px",display:"flex","justify-content":"center"}},[a("el-button",{attrs:{type:"save"},on:{click:t.onUpTest}},[t._v("上行脚本调试")]),a("el-button",{attrs:{type:"save"},on:{click:t.onDownTest}},[t._v("下行脚本调试")]),a("el-button",{attrs:{type:"save"},on:{click:t.onSubmit}},[t._v(t._s(t.$t("DEVICE_MANAGEMENT.CUSTOM_SCRIPT.SAVE")))]),a("el-button",{attrs:{type:"save"},on:{click:t.onPublish}},[t._v("发布")]),a("el-button",{staticStyle:{color:"#000"},attrs:{type:"cancel"},on:{click:t.closeDialog}},[t._v(t._s(t.$t("DEVICE_MANAGEMENT.CUSTOM_SCRIPT.CANCEL")))])],1)],1),a("login-store",{attrs:{visible:t.loginStoreDialogVisible},on:{"update:visible":function(e){t.loginStoreDialogVisible=e}}})],1)},o=[],i=a("ed09"),r=a("f314"),s=(a("2fa3"),a("73f5")),c=a("aa98"),l=a("f8b4"),p=a("dd94"),d=a("6eee"),u=" function encodeInp(msg, topic){\n    // 将设备自定义msg（自定义形式）数据转换为json形式数据, 设备上报数据到物联网平台时调用\n    // 入参：topic string 设备上报消息的 topic\n    // 入参：msg byte[] 数组 不能为空\n    // 出参：string\n    // 处理完后将对象转回字符串形式\n    // 例，byte[]转string：var msgString = String.fromCharCode.apply(null, msg);\n    // 例，string转jsonObj：msgJson = JSON.parse(msgString);\n    // 例，jsonObj转string：msgString = JSON.stringify(msgJson);\n    var msgString = String.fromCharCode.apply(null, msg);\n    return msgString;\n }",m=" function encodeInp(msg, topic){\n    // 将平台规范的msg（json形式）数据转换为设备自定义形式数据, 物联网平台发送数据到设备时调用\n    // 入参：topic string 设备上报消息的 topic\n    // 入参：msg byte[] 数组 不能为空\n    // 出参：string\n    // 处理完后将对象转回字符串形式\n    // 例，byte[]转string：var msgString = String.fromCharCode.apply(null, msg);\n    // 例，string转jsonObj：msgJson = JSON.parse(msgString);\n    // 例，jsonObj转string：msgString = JSON.stringify(msgJson);\n    var msgString = String.fromCharCode.apply(null, msg);\n    return msgString;\n }",g=Object(i["c"])({name:"CustomExchangeAgreement",components:{CodeEditor:r["a"],LoginStore:l["default"]},props:{dialogVisible:{type:[Boolean],default:!1},data:{type:[Object],default:{}},device:{type:[Object]},connectInfo:{type:[Object,Array]}},setup:function(t,e){var a=Object(p["a"])(),n=(a.route,Object(i["h"])({id:"",company:"",product_name:"",script_content_a:u,script_content_b:m,script_type:"javascript",topic:"device/attributes",msg_content:"{}",result:""})),o={company:[{required:!0,message:"请输入公司名称"}],product_name:[{required:!0,message:"请输入产品名称"}]};function r(t){Object(c["l"])({current_page:1,per_page:10,id:t}).then((function(t){var e=t.data;if(200==e.code){var a=e.data.data[0];n.company=a.company,n.product_name=a.product_name,n.script_content_a=a.script_content_a,console.log("getCustomExchangeAgreementList",n.script_content_a),n.script_content_b=a.script_content_b}}))}function l(){e.emit("update:dialogVisible",!1)}Object(i["j"])((function(){return t.dialogVisible}),(function(e){e&&(n.id=t.data.id,n.protocol_type=t.data.protocol_type,n.id?r(n.id):(n.company="",n.product_name="",n.script_content_a=u,n.script_content_b=m))}));var g=Object(i["i"])(null),b=Object(i["i"])("input");function f(){var t=n.script_content_a,e=n.msg_content,a=n.topic;v(t,e,a)}function _(){var e=n.script_content_b,a=n.msg_content,o=n.topic;v(e,a,o+"/"+t.device.token)}function v(t,e,a){n.result="",Object(c["y"])({script_content:t,msg_content:e,topic_content:a}).then((function(t){var e=t.data;e.code,n.result=e.message,b.value="result"}))}function h(){n.script_name=n.company+""+n.product_name,n.protocol_type=t.device.protocol,n.device_type=t.device.device_type,n.script_content_a=n.script_content_a,n.script_content_b=n.script_content_b,g.value.validate((function(t){if(!t)return!1;n.id?Object(c["k"])(n).then((function(t){var a=t.data;200==a.code&&e.emit("submit",n.id)})):Object(c["a"])(n).then((function(t){var a=t.data;200==a.code&&e.emit("submit",a.data.id)}))}))}var y=Object(i["i"])(!1);function C(){var e=d["a"].getters.getStoreAuthenticated;if(e){var a={productCompany:n.company,productName:n.product_name,protocolType:t.device.protocol,scriptAuthor:"",scriptDescribe:"",scriptName:n.company+""+n.product_name,uplinkScript:n.script_content_a,downlinkScript:n.script_content_b};s["a"].publish.script(a).then((function(t){var e=t.data;console.log(e)}))}else y.value=!0}return{customForm:g,formRule:o,formData:n,closeDialog:l,onUpTest:f,onDownTest:_,testTabValue:b,onSubmit:h,onPublish:C,loginStoreDialogVisible:y}}}),b=g,f=(a("2cd9"),a("2877")),_=Object(f["a"])(b,n,o,!1,null,"b96d1dee",null);e["default"]=_.exports},dd94:function(t,e,a){"use strict";a.d(e,"a",(function(){return o}));var n=a("ed09");function o(){var t=Object(n["d"])();return{route:t.proxy.$route,router:t.proxy.$router}}},f8b4:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-dialog",{staticClass:"el-dark-dialog",attrs:{title:"登录应用商店",visible:t.dialogVisible,width:"30%","before-close":function(){return t.handleCancel()},"close-on-click-modal":!1,"append-to-body":!0},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-form",{ref:"LoginForm",staticClass:"inline-edit",attrs:{"label-position":"left",model:t.formData,rules:t.formRules,"hide-required-asterisk":!0}},[a("el-form-item",{attrs:{label:"用户名",prop:"username"}},[a("el-input",{model:{value:t.formData.username,callback:function(e){t.$set(t.formData,"username",e)},expression:"formData.username"}})],1),a("el-form-item",{attrs:{label:"密码",prop:"password"}},[a("el-input",{attrs:{"show-password":""},model:{value:t.formData.password,callback:function(e){t.$set(t.formData,"password",e)},expression:"formData.password"}})],1),a("div",{staticClass:"text-right py-5"},[a("el-link",{staticClass:"link-signup",attrs:{href:"http://r.thingspanel.cn/",type:"success",target:"_blank"}},[t._v("没有账号？去创建")]),a("el-button",{attrs:{type:"border"},on:{click:t.handleCancel}},[t._v(t._s(t.$t("COMMON.CANCEL")))]),a("el-button",{attrs:{type:"primary",loading:t.btnLoading},on:{click:t.handleSubmit}},[t._v(t._s(t.$t("COMMON.LOG1")))])],1)],1)],1)],1)},o=[],i=(a("d3b7"),a("8252")),r=a("2fa3"),s={components:{},props:{visible:{type:[Boolean],default:!1},login:{type:[Function],default:function(){}}},data:function(){return{formData:{username:"",password:""},formRules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}]},btnLoading:!1}},computed:{dialogVisible:{get:function(){return this.visible},set:function(t){this.$emit("update:visible",t)}}},methods:{handleCancel:function(){this.dialogVisible=!1,this.login({code:400,msg:"取消登录"})},handleSubmit:function(){var t=this;this.btnLoading=!0,this.$refs.LoginForm.validate((function(e){if(!e)return t.btnLoading=!1,!1;t.$store.dispatch(i["a"],t.formData).then((function(e){0===e.code&&(Object(r["i"])("登录成功！"),t.dialogVisible=!1,t.login({code:200,msg:"登录成功"}))})).finally((function(){t.btnLoading=!1}))}))}}},c=s,l=(a("2712"),a("2877")),p=Object(l["a"])(c,n,o,!1,null,"1836bc6e",null);e["default"]=p.exports}}]);