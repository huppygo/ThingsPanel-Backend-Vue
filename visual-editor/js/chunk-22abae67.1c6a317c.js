(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-22abae67","chunk-5932f52e","chunk-dd4c3bfc","chunk-25211498","chunk-4c859791","chunk-2d0b3628","chunk-2d0c5aba"],{"045f":function(t,e,a){"use strict";a("455b")},"0474":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-row",{staticStyle:{"margin-bottom":"10px"}},[a("el-col",[a("el-button",{attrs:{type:"border",size:"medium"},on:{click:t.showDialog}},[t._v(t._s(t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.ATTRIBUTE.DELIVERY_ATTRIBUTE")))])],1)],1),a("el-row",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.attributeLoading,expression:"attributeLoading"}],staticStyle:{width:"100%"},attrs:{data:t.attributeList},scopedSlots:t._u([{key:"empty",fn:function(){return[a("div",[t._v(t._s(t.$t("COMMON.TABLE_NO_DATA")))])]},proxy:!0}])},[a("el-table-column",{attrs:{prop:"key",label:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.ATTRIBUTE.ATTRIBUTE_IDENTIFIER"),"min-width":"90",align:"center"}}),a("el-table-column",{attrs:{prop:"name",label:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.ATTRIBUTE.ATTRIBUTE_NAME"),"min-width":"80",align:"center"}}),a("el-table-column",{attrs:{prop:"str_v",label:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.ATTRIBUTE.ATTRIBUTE_VALUE"),"min-width":"80",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.str_v?e.row.str_v:e.row.dbl_v)+" ")]}}])}),a("el-table-column",{attrs:{prop:"ts",label:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.ATTRIBUTE.UPDATE_TIME"),"min-width":"100",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.transformTimestamp(e.row.ts))+" ")]}}])}),a("el-table-column",{attrs:{prop:"value",label:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.ATTRIBUTE.HISTORY_DATA"),"min-width":"50",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("i",{staticClass:"el-icon-notebook-2",staticStyle:{padding:"3px 5px",cursor:"pointer"},on:{click:function(a){return t.showDeviceHistory(e.row.key)}}})]}}])}),a("el-table-column",{attrs:{prop:"value",label:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.ATTRIBUTE.CHART_ANALYSIS"),"min-width":"50",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.isShowDataChart(e.row)?a("i",{staticClass:"el-icon-pie-chart",staticStyle:{padding:"3px 5px",cursor:"pointer"},on:{click:function(a){return t.showDeviceDataChart(e.row.key)}}}):a("i",{staticClass:"el-icon-pie-chart",staticStyle:{padding:"3px 5px",cursor:"not-allowed"}})]}}])}),a("el-table-column",{attrs:{prop:"value",label:t.$t("COMMON.OPERATION"),"min-width":"50",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-popconfirm",{attrs:{"confirm-button-text":t.$t("COMMON.CONFIRM"),"cancel-button-text":t.$t("COMMON.CANCEL"),title:t.$t("COMMON.DELETE_CONFIRM")},on:{confirm:function(a){return t.deleteHistoryData(e.row.key)}}},[a("el-button",{attrs:{slot:"reference",size:"mini",type:"border"},slot:"reference"},[t._v(" "+t._s(t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.ATTRIBUTE.DELETE_HISTORY_DATA"))+" ")])],1)]}}])})],1)],1),a("el-dialog",{staticClass:"el-dark-dialog el-dark-input dialog-css",attrs:{title:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.ATTRIBUTE.DELIVERY_ATTRIBUTE"),width:"30%","close-on-press-escape":!1,"show-close":"","append-to-body":"",visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e},close:t.handleClose}},[a("div",[a("h3",[t._v(t._s(t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.ATTRIBUTE.ATTRIBUTE_JSON_OBJECT")))])]),a("CodeEditor",{key:"upside",staticClass:"dark-code-editor",staticStyle:{width:"100%",height:"260px","overflow-y":"auto"},attrs:{min_height:"260px",copy_code:!0,hide_header:!1,theme:"dark",wrap_code:!0},model:{value:t.deliveryAttribute,callback:function(e){t.deliveryAttribute=e},expression:"deliveryAttribute"}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"cancel"},on:{click:t.handleClose}},[t._v(t._s(t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.CANCEL")))]),a("el-button",{attrs:{type:"save"},on:{click:t.handleSubmit}},[t._v(t._s(t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.CONFIRM")))])],1)],1),a("DeviceHistory",{attrs:{visible:t.deviceHistoryVisible,device:t.device,attributeName:t.attributeName},on:{"update:visible":function(e){t.deviceHistoryVisible=e}}}),a("DeviceDataChart",{attrs:{visible:t.deviceDataChartVisible,device:t.device,attributeName:t.attributeName},on:{"update:visible":function(e){t.deviceDataChartVisible=e}}})],1)},n=[],o=(a("d3b7"),a("4de4"),a("f314")),r=a("aa98"),s=a("3de1"),l=a("31e1"),c=a("6d09"),d=a("2fa3"),u=a("f570"),p={name:"Attribute",components:{CodeEditor:o["a"],DeviceHistory:l["default"],DeviceDataChart:c["default"]},props:{device:{type:[Object],default:function(){return{}}}},data:function(){return{dialogVisible:!1,deviceHistoryVisible:!1,deviceDataChartVisible:!1,attributeName:"",deliveryAttribute:"",attributeList:[],tableData:[],attributeLoading:!1}},computed:{},watch:{},mounted:function(){console.log("DeviceAttribute",this.device),this.getAttributeList()},methods:{getAttributeList:function(){var t=this;this.attributeLoading=!0,Object(r["c"])({device_id:this.device.id}).then((function(e){var a=e.data;if(console.debug("====getAttributeList",a),200==a.code){var i=a.data?a.data:[];t.attributeList=i.filter((function(t){return"systime"!==t.key&&"SYS_ONLINE"!==t.key}))}})).finally((function(){t.attributeLoading=!1}))},handleClose:function(){this.dialogVisible=!1,this.deliveryAttribute=""},showDialog:function(){this.dialogVisible=!0},transformTimestamp:function(t){return Object(s["a"])(t)},showDeviceHistory:function(t){this.deviceHistoryVisible=!0,this.attributeName=t},showDeviceDataChart:function(t){this.deviceDataChartVisible=!0,this.attributeName=t},deleteHistoryData:function(t){var e=this;this.attributeLoading=!0,Object(r["d"])({device_id:this.device.id,attribute:t}).then((function(t){var a=t.data;200===a.code?Object(d["i"])(u["a"].t("COMMON.DELETE_SUCCESS")):Object(d["h"])(u["a"].t("COMMON.DELETE_FAILED")),e.getAttributeList()}))},handleSubmit:function(){var t;try{t=JSON.parse(this.deliveryAttribute)}catch(e){t={}}console.debug("handleSubmit",t),Object(r["z"])({device_id:this.device.id,values:t}).then((function(t){var e=t.data;200===e.code?Object(d["i"])(u["a"].t("COMMON.EDIT_SUCCESS")):Object(d["h"])(u["a"].t("COMMON.EDIT_FAILED"))}))},isShowDataChart:function(t){if(!t)return!1;var e=t.str_v?t.str_v:t.dbl_v;return!e||"number"===typeof e}}},f=p,m=(a("2449"),a("2877")),h=Object(m["a"])(f,i,n,!1,null,"8adb6202",null);e["default"]=h.exports},"1da1":function(t,e,a){"use strict";a.d(e,"a",(function(){return n}));a("d3b7");function i(t,e,a,i,n,o,r){try{var s=t[o](r),l=s.value}catch(c){return void a(c)}s.done?e(l):Promise.resolve(l).then(i,n)}function n(t){return function(){var e=this,a=arguments;return new Promise((function(n,o){var r=t.apply(e,a);function s(t){i(r,n,o,s,l,"next",t)}function l(t){i(r,n,o,s,l,"throw",t)}s(void 0)}))}}},2449:function(t,e,a){"use strict";a("6fc1")},"27c0":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{width:"100%"}},[a("el-row",{staticClass:"pt-3 pb-4 px-3 el-dark-input",attrs:{type:"flex",gutter:10}},[a("el-col",{attrs:{span:5}},[a("el-select",{attrs:{size:"medium",placeholder:t.$t("SYSTEM_LOG.DEVICE_LOG.OPERATIONTYPE"),clearable:""},model:{value:t.params.operation_type,callback:function(e){t.$set(t.params,"operation_type",e)},expression:"params.operation_type"}},[a("el-option",{attrs:{label:t.$t("SYSTEM_LOG.DEVICE_LOG.TIMINGTRIGGER"),value:"1"}}),a("el-option",{attrs:{label:t.$t("SYSTEM_LOG.DEVICE_LOG.MANUALCONTROL"),value:"2"}}),a("el-option",{attrs:{label:t.$t("SYSTEM_LOG.DEVICE_LOG.AUTOMATICCONTROL"),value:"3"}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-select",{attrs:{placeholder:t.$t("SYSTEM_LOG.DEVICE_LOG.SELECTSENDRESULTS"),clearable:"",size:"medium"},model:{value:t.params.send_result,callback:function(e){t.$set(t.params,"send_result",e)},expression:"params.send_result"}},[a("el-option",{attrs:{label:t.$t("SYSTEM_LOG.DEVICE_LOG.SUCCESSFUL"),value:"1"}}),a("el-option",{attrs:{label:t.$t("SYSTEM_LOG.DEVICE_LOG.FAILURE"),value:"2"}})],1)],1),a("el-col",{attrs:{span:14}},[a("el-button",{staticClass:"butStyle",attrs:{type:"border",size:"medium"},on:{click:function(e){return t.handleSearch()}}},[t._v(t._s(t.$t("SYSTEM_LOG.DEVICE_LOG.SEARCH")))]),a("el-button",{staticClass:"butStyle",attrs:{type:"default",size:"medium"},on:{click:function(e){return t.handleReset()}}},[t._v(t._s(t.$t("SYSTEM_LOG.DEVICE_LOG.RESET")))])],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.logLoading,expression:"logLoading"}],attrs:{data:t.tableData},scopedSlots:t._u([{key:"empty",fn:function(){return[a("div",[t._v(t._s(t.$t("COMMON.TABLE_NO_DATA")))])]},proxy:!0}])},[a("el-table-column",{attrs:{label:t.$t("SYSTEM_LOG.DEVICE_LOG.NUMBERID"),type:"index",width:"50",align:"left"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(10*(t.params.page-1)+e.$index+1))])]}}])}),a("el-table-column",{attrs:{label:t.$t("SYSTEM_LOG.DEVICE_LOG.BUSINESSNAME1"),width:"150",align:"left",prop:"business_name"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticClass:"cursor-pointer",on:{click:function(a){return t.handleSearch({business_name:e.row.business_name})}}},[t._v(t._s(e.row.business_name))])]}}])}),a("el-table-column",{attrs:{label:t.$t("SYSTEM_LOG.DEVICE_LOG.DEVICENAME1"),prop:"device_name",width:"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.device_name)+" ")]}}])}),a("el-table-column",{attrs:{label:t.$t("SYSTEM_LOG.DEVICE_LOG.DWVICEGROUPNAME1"),prop:"asset_name",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticClass:"cursor-pointer",on:{click:function(a){return t.handleSearch({asset_name:e.row.asset_name})}}},[t._v(t._s(e.row.asset_name))])]}}])}),a("el-table-column",{attrs:{label:t.$t("SYSTEM_LOG.DEVICE_LOG.INSTRUCTION1"),prop:"instruct"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.instruct)+" ")]}}])}),a("el-table-column",{attrs:{label:t.$t("SYSTEM_LOG.DEVICE_LOG.OPERATIONTYPE1"),prop:"operation_type",width:"90"},scopedSlots:t._u([{key:"default",fn:function(e){return["1"==e.row.operation_type?a("el-tag",{staticClass:"tag-operation-type"},[t._v(t._s(t.$t("SYSTEM_LOG.DEVICE_LOG.TIMINGTRIGGER")))]):t._e(),"2"==e.row.operation_type?a("el-tag",{staticClass:"tag-operation-type"},[t._v(t._s(t.$t("SYSTEM_LOG.DEVICE_LOG.MANUALCONTROL")))]):t._e(),"3"==e.row.operation_type?a("el-tag",{staticClass:"tag-operation-type"},[t._v(t._s(t.$t("SYSTEM_LOG.DEVICE_LOG.AUTOMATICCONTROL")))]):t._e()]}}])}),a("el-table-column",{attrs:{label:t.$t("SYSTEM_LOG.DEVICE_LOG.OPERATE_USER"),prop:"operation_type",width:"90"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.row.user_name,placement:"top-start"}},[a("span",[t._v(t._s(e.row.user_name?e.row.user_name.length>10?e.row.user_name.substr(0,5)+"...":e.row.user_name:""))])])]}}])}),a("el-table-column",{attrs:{label:t.$t("SYSTEM_LOG.DEVICE_LOG.TRIGGERINGTIME1"),prop:"cteate_time",width:"90"}}),a("el-table-column",{attrs:{label:t.$t("SYSTEM_LOG.DEVICE_LOG.SENDTHERESULIT1"),prop:"send_result",align:"center",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return["1"==e.row.send_result?a("el-tag",{staticClass:"tag-success"},[t._v(t._s(t.$t("SYSTEM_LOG.DEVICE_LOG.SUCCESSFUL")))]):a("el-tag",{staticClass:"tag-failed"},[t._v(t._s(t.$t("SYSTEM_LOG.DEVICE_LOG.FAILURE")))])]}}])}),a("el-table-column",{attrs:{label:t.$t("SYSTEM_LOG.DEVICE_LOG.PROTOCOLTYPE1"),prop:"protocol_type",align:"center",width:"80"}})],1),a("div",{staticClass:"text-right py-3"},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:t.logTotal,"current-page":t.params.page,"page-size":t.params.limit},on:{"update:currentPage":function(e){return t.$set(t.params,"page",e)},"update:current-page":function(e){return t.$set(t.params,"page",e)},"current-change":t.getOperationIndex}})],1)],1)},n=[],o=(a("d3b7"),a("7b99")),r={name:"DevicePlugin",components:{},props:{data:{type:Object,default:function(){return{}}},device:{type:[Object],default:function(){return{}}}},data:function(){return{tableData:[],attributeLoading:!1,logLoading:!1,logTotal:0,params:{device_id:this.device.id,business_name:"",per_page:10,current_page:1,asset_name:"",operation_type:"",send_result:""}}},computed:{formData:{get:function(){return this.data},set:function(t){this.$emit("update:data",t)}}},watch:{},mounted:function(){console.log("DevicePlugin",this.device),this.queryValue()},methods:{queryValue:function(){var t=this;this.logLoading=!0;var e=Object({NODE_ENV:"production",BASE_URL:"/"}).VUE_APP_BASE_URL||document.location.origin+"/";o["a"].post(e+"api/conditions/log/index",this.params).then((function(e){var a=e.data;200==a.code&&(console.log(a.data.data),t.tableData=a.data.data,t.logTotal=a.data.total,t.logLoading=!1)})).finally((function(){t.logLoading=!1}))},handleSearch:function(t){t&&("business_name"in t&&is_string(t.business_name)&&(this.params.business_name=t.business_name),"asset_name"in t&&is_string(t.asset_name)&&(this.params.asset_name=t.asset_name),"operation_type"in t&&is_string(t.operation_type)&&(this.params.operation_type=t.operation_type),"send_result"in t&&is_string(t.send_result)&&(this.params.send_result=t.send_result)),this.params.current_page=1,this.queryValue()},getOperationIndex:function(t){this.logLoading=!0,this.params.current_page=t,this.queryValue()},handleReset:function(){this.params={device_id:this.device.id,business_name:"",per_page:10,current_page:1,asset_name:"",operation_type:"",send_result:""},this.queryValue()}}},s=r,l=a("2877"),c=Object(l["a"])(s,i,n,!1,null,"3f44b20b",null);e["default"]=c.exports},"31e1":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"el-dark-dialog el-dark-input",attrs:{title:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.ATTRIBUTE_HISTORY_DATA"),width:"50%","close-on-press-escape":!1,"show-close":"","append-to-body":"",visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e},close:t.handleClose}},[a("div",[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:11}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{clearable:!1,"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetimerange","start-placeholder":t.$t("DATA_MANAGEMENT.PLACEHOLDER5"),"range-separator":t.$t("DATA_MANAGEMENT.PLACEHOLDER6"),"end-placeholder":t.$t("DATA_MANAGEMENT.PLACEHOLDER7")},on:{change:function(e){return t.getHistoryData()}},model:{value:t.choosedTimeRange,callback:function(e){t.choosedTimeRange=e},expression:"choosedTimeRange"}})],1),a("el-col",{attrs:{span:3}},[a("el-button",{attrs:{type:"border",size:"medium"},on:{click:function(e){return t.handleRefresh()}}},[t._v(t._s(t.$t("COMMON.REFRESH")))])],1),a("el-col",{staticStyle:{float:"right"},attrs:{span:3}},[a("el-popconfirm",{attrs:{"confirm-button-text":t.$t("COMMON.CONFIRM"),"cancel-button-text":t.$t("COMMON.CANCEL"),title:t.$t("COMMON.EXPORT_CONFIRM")},on:{confirm:function(e){return t.handleExport()}}},[a("el-button",{attrs:{slot:"reference",type:"border",size:"medium"},slot:"reference"},[t._v(t._s(t.$t("COMMON.EXPORT")))])],1)],1)],1),a("el-table",{attrs:{data:t.historyData},scopedSlots:t._u([{key:"empty",fn:function(){return[a("div",[t._v(t._s(t.$t("COMMON.TABLE_NO_DATA")))])]},proxy:!0}])},[a("el-table-column",{attrs:{type:"index",width:"50",align:"center"}}),a("el-table-column",{attrs:{prop:"time",label:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.TIMESTAMP"),"min-width":"200",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(t.transformTimestamp(e.row.ts)))])]}}])}),a("el-table-column",{attrs:{prop:"key",label:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.ATTRIBUTE.ATTRIBUTE_IDENTIFIER"),"min-width":"200",align:"center"}},[t._v(t._s(this.attributeName))]),a("el-table-column",{attrs:{prop:"value",label:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.VALUE"),"min-width":"200",align:"center"}})],1),a("div",{staticClass:"text-center py-3"},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{staticStyle:{display:"inline-block"},attrs:{span:8}},[a("el-button",{staticStyle:{width:"45px","border-color":"#747474"},attrs:{icon:"el-icon-back",type:"border",disabled:1===this.page,size:"small"},on:{click:function(e){return t.pageChange(t.page-1)}}}),a("el-button",{staticStyle:{width:"45px","border-color":"#747474"},attrs:{icon:"el-icon-right",type:"border",disabled:this.dataCount!==this.pageSize,size:"small"},on:{click:function(e){return t.pageChange(t.page+1)}}})],1)],1)],1)],1),a("el-dialog",{staticClass:"el-dark-dialog el-dark-input",attrs:{width:"30%","append-to-body":"",title:t.$t("COMMON.EXPORT"),visible:t.exportVisible},on:{"update:visible":function(e){t.exportVisible=e}}},[a("div",{staticClass:"text-center"},[a("p",[t._v(t._s(t.downloadUrl?t.downloadUrl.split("/").pop().toString():t.$t("COMMON.GENERATE_WAIT")))]),t.exporting?t._e():a("p",[a("a",{attrs:{href:t.downloadUrl}},[t._v(t._s(t.$t("COMMON.DOWNLOAD")))])])])])],1)},n=[],o=(a("d3b7"),a("aa98")),r=a("3de1"),s={name:"DeviceHistory",props:{visible:{type:[Boolean],default:!1},data:{type:Object,default:function(){return{}}},device:{type:[Object],default:function(){return{}}},attributeName:{type:String,default:""}},data:function(){var t=Date.now();return{historyData:[],positionShow:!1,locationArray:[],choosedTimeRange:[new Date(t-36e5),new Date(t)],isCopy:!1,pageSize:10,page:1,dataCount:0,exporting:!1,exportVisible:!1,downloadUrl:""}},computed:{formData:{get:function(){return this.data},set:function(t){this.$emit("update:data",t)}},dialogVisible:{get:function(){return this.visible},set:function(t){this.$emit("update:visible",t)}}},watch:{dialogVisible:{handler:function(t){console.debug("DeviceHistory",this),t&&this.getHistoryData()}}},mounted:function(){},methods:{getHistoryData:function(t,e){var a=this,i=1e3*new Date(this.choosedTimeRange[0]).getTime(),n=1e3*new Date(this.choosedTimeRange[1]).getTime();Object(o["t"])({device_id:this.device.id,key:this.attributeName,start_time:i,end_time:n,page:t||this.page,page_records:e||this.pageSize}).then((function(t){var e=t.data;console.debug("====getHistoryData",e),200==e.code&&(a.historyData=e.data?e.data:[],a.dataCount=a.historyData.length),console.debug(a.historyData)}))},handleClose:function(){this.dialogVisible=!1,this.page=1,this.pageSize=10},transformTimestamp:function(t){return Object(r["a"])(t)},pageChange:function(t){this.page=t,this.getHistoryData()},handleExport:function(){var t=this;if(!this.exporting){this.exporting=!0,this.exportVisible=!0;var e=1e3*new Date(this.choosedTimeRange[0]).getTime(),a=1e3*new Date(this.choosedTimeRange[1]).getTime();Object(o["t"])({device_id:this.device.id,key:this.attributeName,start_time:e,end_time:a,page:this.page,page_records:this.pageSize,export_excel:!0}).then((function(e){var a=e.data;console.debug("====handleExport",a),200==a.code&&(t.downloadUrl=a.data?a.data:"")})).finally((function(){t.exporting=!1}))}},handleRefresh:function(){var t=Date.now();this.choosedTimeRange=[new Date(t-36e5),new Date(t)],this.getHistoryData()}}},l=s,c=(a("045f"),a("2877")),d=Object(c["a"])(l,i,n,!1,null,"de42b222",null);e["default"]=d.exports},"3a08":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticStyle:{display:"flex",float:"left","margin-bottom":"10px"}},[""!==t.eventSubject?a("span",[t._v("设备上报事件主题: "+t._s(t.eventSubject))]):t._e()]),a("div",{staticStyle:{display:"flex",float:"right","margin-bottom":"10px"}},[a("el-button",{attrs:{type:"border",size:"medium"},on:{click:t.getList}},[t._v("刷新")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{data:t.tableData}},[a("el-table-column",{attrs:{label:"事件标识符",prop:"event_identify",width:"240"}}),a("el-table-column",{attrs:{label:"事件上报时间",prop:"report_time",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){return a("templace",{},[t._v(" "+t._s(t.dateFormat(e.row.report_time))+" ")])}}])}),a("el-table-column",{attrs:{label:"事件参数",prop:"data",width:"auto"}})],1),a("div",{staticClass:"text-right py-3"},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:t.total,"current-page":t.params.current_page,"page-size":t.params.per_page},on:{"update:currentPage":function(e){return t.$set(t.params,"current_page",e)},"update:current-page":function(e){return t.$set(t.params,"current_page",e)},"current-change":t.getList}})],1)],1)},n=[],o=a("5530"),r=a("aa98"),s=a("3de1"),l={components:{},props:{device:{type:[Object],default:function(){return{}}}},data:function(){return{dateFormat:s["a"],loading:!1,tableData:[],total:0,params:{current_page:1,per_page:10},eventSubject:"device/event"}},mounted:function(){"1"===this.device.device_type?this.eventSubject="device/event":"2"===this.device.device_type&&"MQTT"===this.device.protocol?this.eventSubject="gateway/event":this.eventSubject="",console.log("event.device",this.device),this.getList()},methods:{getList:function(){var t=this;Object(r["o"])(Object(o["a"])({device_id:this.device.device},this.params)).then((function(e){var a=e.data;200===a.code&&(t.tableData=a.data.data,t.total=a.data.total)})).catch((function(t){console.log(t)}))}}},c=l,d=a("2877"),u=Object(d["a"])(c,i,n,!1,null,"160a47aa",null);e["default"]=u.exports},"3b63":function(t,e,a){"use strict";var i=a("18a6");e["a"]={add:function(t){return Object(i["a"])({url:"/tp_protocol_plugin/add",method:"post",data:t})},edit:function(t){return Object(i["a"])({url:"/tp_protocol_plugin/edit",method:"post",data:t})},del:function(t){return Object(i["a"])({url:"/tp_protocol_plugin/delete",method:"post",data:t})},page:function(t){return Object(i["a"])({url:"/tp_protocol_plugin/list",method:"post",data:t})},getWVPDevices:function(t){return Object(i["a"])({url:"/wvp/query/devices",method:"post",data:t})},callPlayWVP:function(t){return Object(i["a"])({url:"/wvp/play/start/",method:"post",data:t})},commandPlayerPTZ:function(t){return Object(i["a"])({url:"/wvp/ptz",method:"post",data:t})},getRecordList:function(t){return Object(i["a"])({url:"/gb_record/query",method:"post",data:t})},getRecordURL:function(t){return Object(i["a"])({url:"/playback/start",method:"post",data:t})},stopRecordPlay:function(t){return Object(i["a"])({url:"/wvp/play/stop",method:"post",data:t})}}},"3fa2":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticStyle:{"margin-top":"20px"}},[a("el-form",{attrs:{"label-position":"left",model:t.formData,"label-width":"120px"}},[a("el-form-item",{attrs:{label:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.FIRMWARE_VERSION")}},[t._v(" "+t._s(t.device.current_version||"")+" ")])],1)],1)])},n=[],o={name:"DevicePlugin",components:{},props:{data:{type:Object,default:function(){return{}}},device:{type:[Object],default:function(){return{}}}},data:function(){return{dialogVisible:!1,deviceHistoryVisible:!1,deviceDataChartVisible:!1,attributeName:"",deliveryAttribute:"",attributeList:[],tableData:[],attributeLoading:!1,logLoading:!1,logTotal:0,params:{device_id:this.device.id,business_name:"",per_page:10,current_page:1,asset_name:"",operation_type:"",send_result:""}}},computed:{formData:{get:function(){return this.data},set:function(t){this.$emit("update:data",t)}}},watch:{},mounted:function(){console.log("DevicePlugin",this.device)},methods:{}},r=o,s=a("2877"),l=Object(s["a"])(r,i,n,!1,null,"5828e910",null);e["default"]=l.exports},"455b":function(t,e,a){},"4df3":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"el-dark-dialog el-dark-input",attrs:{title:t.device.name+" - "+t.$t("DEVICE_MANAGEMENT.DEVICE_DETAIL"),width:"60%","close-on-press-escape":!1,"show-close":!1,"append-to-body":!0,visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e},close:t.handleClose}},[a("div",{staticClass:"container-fluid"},[a("el-tabs",{model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},t._l(t.tabList,(function(t){return a("el-tab-pane",{key:t.value,attrs:{label:t.label,name:t.value}})})),1),"deviceAttribute"==t.activeName?a("device-attribute",{attrs:{data:t.attrFormData,initAttributeCard:t.initAttributeCard,device:t.device,wvpDevice:t.wvpDeviceList},on:{"update:data":function(e){t.attrFormData=e},"update:initAttributeCard":function(e){t.initAttributeCard=e},"update:init-attribute-card":function(e){t.initAttributeCard=e}}}):"configParse"==t.activeName?a("data-parse",{ref:"dataParse",attrs:{data:t.formData,attrs:t.formAttr},on:{"update:data":function(e){t.formData=e}}}):"attribute"==t.activeName?a("attribute",{attrs:{device:t.device}}):"runningStatus"==t.activeName?a("running-info",{attrs:{data:t.runningFormData,device:t.device},on:{"update:data":function(e){t.runningFormData=e}}}):"event"==t.activeName?a("event",{attrs:{data:t.eventFormData,device:t.device},on:{"update:data":function(e){t.eventFormData=e}}}):"command"==t.activeName?a("command",{attrs:{data:t.commandFormData,device:t.device},on:{"update:data":function(e){t.commandFormData=e}}}):"devicePlugin"==t.activeName?a("device-plugin",{attrs:{data:t.attrFormData,device:t.device},on:{"update:data":function(e){t.attrFormData=e}}}):"deviceLog"==t.activeName?a("device-log",{attrs:{data:t.attrFormData,device:t.device},on:{"update:data":function(e){t.attrFormData=e}}}):t._e()],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"cancel"},on:{click:t.handleClose}},[t._v(t._s(t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.CANCEL")))]),a("el-button",{attrs:{type:"save"},on:{click:t.handleSubmit}},[t._v(t._s(t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.CONFIRM")))])],1)])},n=[],o=a("5530"),r=(a("e9c4"),a("4de4"),a("d3b7"),a("2ca0"),a("18a6")),s={getFormAttr:function(t){return Object(r["a"])({url:"/form/config",method:"post",data:t})},updateDeviceConfig:function(t){return Object(r["a"])({url:"/device/update_only",method:"post",data:t})}},l=a("3b63"),c=a("2fa3"),d=a("8553"),u=a("daa1"),p=a("3fa2"),f=a("27c0"),m=a("5592"),h=a("3a08"),v=a("7509"),b=a("0474"),_=a("f570"),g=[{value:"deviceAttribute",label:_["a"].t("DEVICE_MANAGEMENT.DEVICE_CONFIG.OVERVIEW")},{value:"configParse",label:_["a"].t("DEVICE_MANAGEMENT.DEVICE_CONFIG.DATAANALYSIS")},{value:"attribute",label:_["a"].t("DEVICE_MANAGEMENT.DEVICE_CONFIG.PROPERTIES_REPORT")},{value:"runningStatus",label:_["a"].t("DEVICE_MANAGEMENT.DEVICE_CONFIG.OPERATION")},{value:"event",label:_["a"].t("DEVICE_MANAGEMENT.DEVICE_CONFIG.EVENT_REPORT")},{value:"command",label:_["a"].t("DEVICE_MANAGEMENT.DEVICE_CONFIG.COMMAND_DELIVERY")},{value:"devicePlugin",label:_["a"].t("DEVICE_MANAGEMENT.DEVICE_CONFIG.DEVICE_PLUGIN")},{value:"deviceLog",label:_["a"].t("DEVICE_MANAGEMENT.DEVICE_CONFIG.DEVICE_LOG")}],E={name:"DeviceDetail",components:{DataParse:d["default"],DeviceAttribute:u["default"],DevicePlugin:p["default"],DeviceLog:f["default"],Attribute:b["default"],RunningInfo:m["default"],Event:h["default"],Command:v["default"]},props:{dialogVisible:{type:[Boolean],default:!1},device:{type:[Object],default:function(){return{}}}},data:function(){return{activeName:"",tabList:[],formAttr:[],formData:{},attrFormData:{},runningFormData:{thresholdTime:0},formRule:{},location:"",wvpDeviceList:[],eventFormData:{},commandFormData:{},initAttributeCard:!0}},watch:{activeName:{handler:function(t){this.initAttributeCard="deviceAttribute"===t}},dialogVisible:{handler:function(t){var e=this;if(!1===t&&(this.initAttributeCard=!1),t){console.log("====DeviceConfigForm.newValue",this.device),this.location=this.device.location?this.device.location:"";var a=this.device.additional_info&&"null"!=this.device.additional_info?JSON.parse(this.device.additional_info):{runningInfo:{thresholdTime:0}};if(this.attrFormData={d_id:this.device.d_id,subDeviceVideoAddress:a.video_address},this.runningFormData=a.runningInfo?Object(o["a"])(Object(o["a"])({},a.runningInfo),{},{location:this.device.location,subDeviceAddress:this.device.subDeviceAddress}):{},this.formData={},"{}"==JSON.stringify(this.device)||""==this.device)return;if("3"==this.device.device_type||"1"==this.device.device_type&&"mqtt"!=this.device.protocol){this.tabList=JSON.parse(JSON.stringify(g)),this.activeName="deviceAttribute";var i="1"==this.device.device_type?"1":"2";s.getFormAttr({protocol_type:this.device.protocol,device_type:i}).then((function(t){var a=t.data;200==a.code&&a.data&&a.data.config?(e.formAttr=a.data.config,console.log("data.data.config",a.data.config),console.log("this.device.protocol_config",e.device.protocol_config),"{}"!=e.device.protocol_config&&""!=e.device.protocol_config&&void 0!=e.device.protocol_config&&(e.formData=JSON.parse(e.device.protocol_config))):(e.tabList=e.tabList.filter((function(t){return"configParse"!==t.value})),e.activeName="deviceAttribute")}))}else this.tabList=JSON.parse(JSON.stringify(g)),this.tabList=this.tabList.filter((function(t){return"configParse"!==t.value})),this.activeName="deviceAttribute",this.formRule={location:[{required:!1,message:_["a"].t("DEVICE_MANAGEMENT.DEVICE_CONFIG.PLACEHOLDER3"),trigger:"change"}]},2==this.device.device_type&&this.device.protocol.startsWith("WVP_")&&this.getWVPDeviceList();this.initAttributeCard="deviceAttribute"===this.activeName}}}},methods:{handleClose:function(){this.$emit("update:dialogVisible",!1)},getWVPDeviceList:function(){var t=this;l["a"].getWVPDevices({id:this.device.id,count:"9999",page:"1"}).then((function(e){var a=e.data;console.log("====getWVPDeviceList",a),200==a.code&&(t.wvpDeviceList=a.data.list?a.data.list:[])}))},handleSubmit:function(){var t=this;console.log("====DeviceConfigForm",this.formData);var e=function(){var e=t.device,a=t.device.additional_info&&"null"!=t.device.additional_info?JSON.parse(t.device.additional_info):{};a.runningInfo=t.runningFormData,a.video_address=t.attrFormData.subDeviceVideoAddress;var i={id:e.id,d_id:t.attrFormData.d_id,additional_info:JSON.stringify(a),location:t.runningFormData.location,sub_device_addr:t.runningFormData.subDeviceAddress,protocol_config:JSON.stringify(Object(o["a"])({DeviceId:e.id,AccessToken:e.token},t.formData))};console.log("====DeviceConfigForm.config",i,t.attrFormData),s.updateDeviceConfig(i).then((function(e){var a=e.data;200==a.code&&(Object(c["i"])("配置成功！"),t.handleClose(),t.$emit("submit"))}))};this.$refs["dataParse"]?this.$refs["dataParse"].validate((function(t){console.log("====DeviceConfigForm.valid",t),t&&e()})):e()}}},y=E,D=a("2877"),C=Object(D["a"])(y,i,n,!1,null,"760112ee",null);e["default"]=C.exports},5592:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-form",{attrs:{"label-position":"left",model:t.formData,"label-width":"120px"}},[a("el-form-item",{attrs:{label:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.OFFLINETIME"),prop:"thresholdTime"}},[a("el-input-number",{attrs:{"controls-position":"right",size:"small",min:0},model:{value:t.formData.thresholdTime,callback:function(e){t.$set(t.formData,"thresholdTime",e)},expression:"formData.thresholdTime"}}),t._v(" 秒 ")],1),"3"==t.device.device_type?a("el-form-item",{attrs:{label:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.SUBDEVICEADDRESS")}},[a("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.PLACEHOLDER1")},model:{value:t.formData.subDeviceAddress,callback:function(e){t.$set(t.formData,"subDeviceAddress",e)},expression:"formData.subDeviceAddress"}})],1):t._e(),a("el-form-item",{attrs:{label:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.DEVICELOCATION")}},[a("el-input",{staticStyle:{width:"100%"},attrs:{readonly:"",placeholder:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.PLACEHOLDER2")},nativeOn:{click:function(e){return t.showCheckLocation.apply(null,arguments)}},model:{value:t.formData.location,callback:function(e){t.$set(t.formData,"location",e)},expression:"formData.location"}})],1)],1),t.positionShow?a("device-location-config",{attrs:{"maker-position":t.locationArray,"dialog-visible":t.positionShow},on:{"update:makerPosition":function(e){t.locationArray=e},"update:maker-position":function(e){t.locationArray=e},"update:dialogVisible":function(e){t.positionShow=e},"update:dialog-visible":function(e){t.positionShow=e}}}):t._e()],1)},n=[],o=(a("a15b"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{top:"5vh","append-to-body":!0,title:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.DEVICE_LOCATION.GET_MAP_LOCATION"),visible:t.dialogVisible,"before-close":t.handleClose,width:"1000px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("div",{staticClass:"amap-page-container"},[a("el-row",{staticStyle:{"margin-bottom":"20px"},attrs:{gutter:20,type:"flex",align:"middle",justify:"center"}},[a("el-col",{attrs:{span:9}},[a("el-amap-search-box",{staticClass:"search-box",attrs:{"search-option":t.searchOption,"on-search-result":t.onSearchResult}})],1),a("el-col",{staticStyle:{color:"white",height:"100%"},attrs:{span:12}},[a("div",{staticClass:"toolbar",staticStyle:{color:"white",height:"100%"}},[a("div",[t._v(" "+t._s(t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.DEVICE_LOCATION.CURRENT_COORDINATE"))+": "+t._s(t.lng)+", "+t._s(t.lat)+" ")]),a("div",[t._v(" "+t._s(t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.DEVICE_LOCATION.CURRENT_LOCATION"))+": "+t._s(t.address)+" ")])])]),a("el-col",{attrs:{span:3}},[a("el-button",{attrs:{type:"primary"},on:{click:t.select}},[t._v(t._s(t.$t("COMMON.CONFIRM")))])],1)],1),a("el-amap",{ref:"centerMap",staticClass:"amap-box",attrs:{vid:"amap","amap-manager":t.amapManager,plugin:t.plugin,center:t.center,zoom:t.zoom,viewMode:"3D",events:t.events}},t._l(t.markers,(function(t,e){return a("el-amap-marker",{key:e,attrs:{position:t.position}})})),1)],1)])}),r=[],s=(a("d3b7"),a("159b"),a("8f9b")),l=new s["AMapManager"],c={name:"DeviceLocationConfig",props:{dialogVisible:{type:Boolean,default:!1},makerPosition:{type:Array,default:function(){return[121.59996,31.197646]}}},data:function(){var t=this;return{zoom:7,center:[121.59996,31.197646],amapManager:l,address:"",cityCode:"",searchOption:{city:"上海",citylimit:!1},mapCenter:[121.59996,31.197646],markers:[],plugin:[{pName:"ToolBar",events:{init:function(t){}}},{pName:"Geolocation",events:{init:function(e){console.error("init geolocation"),e.getCurrentPosition((function(e,a){console.error(a,e,"getCurrentPosition"),a&&a.position&&(console.log(a),t.address=a.formattedAddress,t.center=[a.position.lng,a.position.lat],t.loaded=!0,t.$nextTick(),t.lng=a.position.lng,t.lat=a.position.lat)}))}}}],events:{click:function(e){var a=e.lnglat,i=a.lng,n=a.lat;t.lng=i,t.lat=n,t.markers[0]={position:[i,n]};var o=new AMap.Geocoder({radius:1e3,extensions:"all"});o.getAddress([i,n],(function(e,a){"complete"===e&&"OK"===a.info&&a&&a.regeocode&&(t.address=a.regeocode.formattedAddress,t.$nextTick())}))}},lng:0,lat:0}},created:function(){this.mapCenter=this.makerPosition,this.lng=this.makerPosition[0],this.lat=this.makerPosition[1]},methods:{onSearchResult:function(t){var e=0,a=0;if(t.length>0){t.forEach((function(t){var i=t.lng,n=t.lat;a+=i,e+=n}));var i={lng:a/t.length,lat:e/t.length};this.mapCenter=[i.lng,i.lat]}},handleClose:function(t){this.$emit("update:dialogVisible",!1),this.$nextTick((function(){t()}))},select:function(){this.$emit("update:dialogVisible",!1),this.$emit("update:makerPosition",this.markers[0].position)}}},d=c,u=(a("6b09"),a("2877")),p=Object(u["a"])(d,o,r,!1,null,"d8cfda08",null),f=p.exports,m={components:{DeviceLocationConfig:f},props:{data:{type:Object,default:function(){return{}}},device:{type:[Object],default:function(){return{}}}},data:function(){return{positionShow:!1,locationArray:[]}},watch:{locationArray:function(t){this.formData.location=t.join(",")}},computed:{formData:{get:function(){return this.data},set:function(t){this.$emit("update:data",t)}}},methods:{showCheckLocation:function(){this.positionShow=!0}}},h=m,v=Object(u["a"])(h,i,n,!1,null,"2ccd00e5",null);e["default"]=v.exports},6316:function(t,e,a){},"6b09":function(t,e,a){"use strict";a("aee2")},"6fc1":function(t,e,a){},7509:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticStyle:{"justify-content":"space-between",display:"flex","margin-bottom":"10px"}},[a("span",[t._v(t._s(t.subscribeTitle))]),a("el-button",{attrs:{type:"border",size:"medium"},on:{click:t.getList}},[t._v("刷新")])],1),a("div",{staticStyle:{display:"flex",float:"left","margin-bottom":"10px"}},[a("el-button",{attrs:{type:"border",size:"medium"},on:{click:function(e){t.commandDialogVisible=!0}}},[t._v("下发命令")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{data:t.tableData}},[a("el-table-column",{attrs:{label:"命令标识符",prop:"command_identify",width:"240"}}),a("el-table-column",{attrs:{label:"命令参数",prop:"data",width:"auto"}}),a("el-table-column",{attrs:{label:"命令下发时间",prop:"send_time",width:"auto"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.dateFormat(e.row.send_time))+" ")]}}])}),a("el-table-column",{attrs:{label:"状态",prop:"send_status",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s("1"==e.row.send_status?t.$t("AUTOMATION.SUCEESSFUL"):t.$t("AUTOMATION.FAILURE"))+" ")]}}])})],1),a("div",{staticClass:"text-right py-3"},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:t.total,"current-page":t.params.current_page,"page-size":t.params.per_page},on:{"update:currentPage":function(e){return t.$set(t.params,"current_page",e)},"update:current-page":function(e){return t.$set(t.params,"current_page",e)},"current-change":t.getList}})],1),a("el-dialog",{attrs:{title:"下发命令","append-to-body":!0,visible:t.commandDialogVisible,width:"30%","before-close":t.handleClose},on:{"update:visible":function(e){t.commandDialogVisible=e}}},[a("el-form",{ref:"ruleFormRef",staticClass:"el-dark-input",attrs:{"label-position":"left",model:t.commandFormData,rules:t.commandFormRule,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"命令标识符",prop:"command_identifier"}},[a("el-select",{attrs:{filterable:"","allow-create":""},on:{change:t.handleChangeCommandId},model:{value:t.commandFormData.command_identifier,callback:function(e){t.$set(t.commandFormData,"command_identifier",e)},expression:"commandFormData.command_identifier"}},t._l(t.commands,(function(e,i){return a("el-option",{key:i,attrs:{label:e.commandName,value:e.commandId}},[a("span",{staticStyle:{float:"left"}},[t._v(t._s(e.commandName))]),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[t._v(t._s(e.commandId))])])})),1)],1),a("el-form-item",{attrs:{label:"命令参数",prop:"command_data"}},[a("el-input",{attrs:{type:"textarea",rows:12},model:{value:t.commandFormData.command_data,callback:function(e){t.$set(t.commandFormData,"command_data",e)},expression:"commandFormData.command_data"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"cancel"},on:{click:t.handleClose}},[t._v("取消")]),a("el-button",{attrs:{type:"save"},on:{click:t.handleSendCommand}},[t._v("发送")])],1)],1)],1)},n=[],o=a("5530"),r=(a("c740"),a("d3b7"),a("159b"),a("e9c4"),a("aa98")),s=a("2fa3"),l=a("3de1"),c={components:{},props:{device:{type:[Object],default:function(){return{}}}},data:function(){return{dateFormat:l["a"],loading:!1,tableData:[],total:0,params:{current_page:1,per_page:10},commandDialogVisible:!1,commandFormData:{command_data:"{}"},commands:[],commandFormRule:{command_identifier:[{required:!0,message:"请选择命令标识符",trigger:"change"}],command_data:[{required:!0,message:"请输入命令内容",trigger:"blur"}]},subscribeTitle:"设备订阅命令主题:  device/command/"+this.device.token}},mounted:function(){"1"===this.device.device_type?this.subscribeTitle="设备订阅命令主题:  device/command/"+this.device.token:"2"===this.device.device_type&&"MQTT"===this.device.protocol?this.subscribeTitle="设备订阅命令主题:  gateway/command/"+this.device.token:this.subscribeTitle="",console.log("Command.device",this.device),this.getList(),this.getDeviceCommandList()},methods:{getList:function(){var t=this;Object(r["m"])(Object(o["a"])({device_id:this.device.device},this.params)).then((function(e){var a=e.data;200===a.code&&(t.tableData=a.data.data,t.total=a.data.total,console.log(t.tableData))}))},getDeviceCommandList:function(){var t=this;Object(r["n"])({device_id:this.device.device}).then((function(e){var a=e.data;200===a.code&&(t.commands=a.data)}))},handleChangeCommandId:function(t){var e=this;this.commands.findIndex((function(a){if(a.commandId===t){console.log("command.commandParams",a.commandParams);var i={};a.commandParams.forEach((function(t){switch(t.type.toLowerCase()){case"text":i[t.identifier]="";break;case"integer":case"float":case"number":i[t.identifier]=0;break;case"object":i[t.identifier]={};break;case"list":i[t.identifier]=[];break;default:i[t.identifier]="";break}})),e.commandFormData.command_data=JSON.stringify(i,null,4),console.log("params",i)}})),console.log("handleChangeCommandId",t,this.commands)},handleSendCommand:function(){var t=this;this.$refs["ruleFormRef"].validate((function(e){if(!e)return!1;Object(r["u"])(Object(o["a"])({device_id:t.device.device},t.commandFormData)).then((function(e){var a=e.data;200===a.code&&(Object(s["i"])("命令下发成功"),t.commandDialogVisible=!1,t.getList())}))}))},handleClose:function(){this.commandDialogVisible=!1}}},d=c,u=a("2877"),p=Object(u["a"])(d,i,n,!1,null,"20a3b64b",null);e["default"]=p.exports},8553:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{margin:"20px 0"}},[a("el-form",{ref:"configForm",attrs:{model:t.formData,rules:t.formRules,"label-width":"260px"}},t._l(t.attrs,(function(e,i){return a("el-form-item",{key:i,attrs:{label:e.label,prop:e.dataKey}},["input"===e.type&&"number"!==e.validate.type?a("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:e.placeholder},model:{value:t.formData[e.dataKey],callback:function(a){t.$set(t.formData,e.dataKey,a)},expression:"formData[attr.dataKey]"}}):"input"===e.type&&"number"===e.validate.type?a("el-input-number",{staticStyle:{width:"80%"},attrs:{placeholder:e.placeholder},model:{value:t.formData[e.dataKey],callback:function(a){t.$set(t.formData,e.dataKey,a)},expression:"formData[attr.dataKey]"}}):"select"===e.type?a("el-select",{staticStyle:{width:"80%"},model:{value:t.formData[e.dataKey],callback:function(a){t.$set(t.formData,e.dataKey,a)},expression:"formData[attr.dataKey]"}},t._l(e.options,(function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.value}})})),1):t._e(),"table"===e.type?a("el-button",{attrs:{type:"save",size:"medium"},on:{click:function(a){return t.handleShowTableDialog(e)}}},[t._v(t._s(e.label))]):t._e()],1)})),1),a("data-parse-table",{attrs:{visible:t.dialogVisible,attrs:t.currentTableAttr,data:t.currentTableData},on:{"update:visible":function(e){t.dialogVisible=e},"update:data":function(e){t.currentTableData=e},submit:t.handleTableSubmit}})],1)},n=[],o=(a("d3b7"),a("159b"),a("fb6a"),a("4d63"),a("c607"),a("ac1f"),a("2c3e"),a("25f0"),a("e9c4"),a("d9e2"),a("d2f4")),r={components:{DataParseTable:o["default"]},props:{data:{type:Object,default:function(){return{}}},attrs:{type:Array,default:function(){return[]}}},data:function(){return{dialogVisible:!1,currentTableAttr:{},currentTableData:[]}},computed:{formRules:{get:function(){var t={};return this.attrs.forEach((function(e){if("table"!==e.type&&(t[e.dataKey]=[e.validate],e.validate.rules)){var a=e.validate.rules.slice(1,-1),i=new RegExp(a);t[e.dataKey].push({pattern:i,message:e.validate.message,trigger:"blur"})}})),t}},formData:{get:function(){if(console.log("computed.data",JSON.stringify(this.data)),this.data&&"{}"!==JSON.stringify(this.data))return this.data;var t={};return this.attrs.forEach((function(e){console.log("computed.forEach.attr",e),"input"===e.type?t[e.dataKey]="number"===e.validate.type?0:"":"table"===e.type&&(t[e.dataKey]=[])})),console.log("computed.obj",t),t}}},watch:{formData:{handler:function(t){console.log("watch.formData",t),JSON.stringify(t)!==JSON.stringify(this.data)&&this.$emit("update:data",t)},deep:!0,immediate:!0}},methods:{handleShowTableDialog:function(t){console.log("handleShowTableDialog",t),this.currentTableAttr=t,this.currentTableData=this.formData[t.dataKey],this.dialogVisible=!0},handleTableSubmit:function(t){console.log("handleTableSubmit",t),this.formData[this.currentTableAttr.dataKey]=t},validate:function(t){console.log("this.$refs.tableRef",this.$refs.tableRef),console.log("dataparse.formData",this.formData);try{this.$refs.configForm.validate((function(t){if(!t)throw new Error("")})),t(!0)}catch(e){console.log(e),t(!1)}}}},s=r,l=(a("9a74"),a("2877")),c=Object(l["a"])(s,i,n,!1,null,"3167314c",null);e["default"]=c.exports},"96cf":function(t,e,a){var i=function(t){"use strict";var e,a=Object.prototype,i=a.hasOwnProperty,n="function"===typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",r=n.asyncIterator||"@@asyncIterator",s=n.toStringTag||"@@toStringTag";function l(t,e,a){return Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(L){l=function(t,e,a){return t[e]=a}}function c(t,e,a,i){var n=e&&e.prototype instanceof v?e:v,o=Object.create(n.prototype),r=new w(i||[]);return o._invoke=N(t,a,r),o}function d(t,e,a){try{return{type:"normal",arg:t.call(e,a)}}catch(L){return{type:"throw",arg:L}}}t.wrap=c;var u="suspendedStart",p="suspendedYield",f="executing",m="completed",h={};function v(){}function b(){}function _(){}var g={};l(g,o,(function(){return this}));var E=Object.getPrototypeOf,y=E&&E(E(S([])));y&&y!==a&&i.call(y,o)&&(g=y);var D=_.prototype=v.prototype=Object.create(g);function C(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function a(n,o,r,s){var l=d(t[n],t,o);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"===typeof u&&i.call(u,"__await")?e.resolve(u.__await).then((function(t){a("next",t,r,s)}),(function(t){a("throw",t,r,s)})):e.resolve(u).then((function(t){c.value=t,r(c)}),(function(t){return a("throw",t,r,s)}))}s(l.arg)}var n;function o(t,i){function o(){return new e((function(e,n){a(t,i,e,n)}))}return n=n?n.then(o,o):o()}this._invoke=o}function N(t,e,a){var i=u;return function(n,o){if(i===f)throw new Error("Generator is already running");if(i===m){if("throw"===n)throw o;return M()}a.method=n,a.arg=o;while(1){var r=a.delegate;if(r){var s=A(r,a);if(s){if(s===h)continue;return s}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(i===u)throw i=m,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);i=f;var l=d(t,e,a);if("normal"===l.type){if(i=a.done?m:p,l.arg===h)continue;return{value:l.arg,done:a.done}}"throw"===l.type&&(i=m,a.method="throw",a.arg=l.arg)}}}function A(t,a){var i=t.iterator[a.method];if(i===e){if(a.delegate=null,"throw"===a.method){if(t.iterator["return"]&&(a.method="return",a.arg=e,A(t,a),"throw"===a.method))return h;a.method="throw",a.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var n=d(i,t.iterator,a.arg);if("throw"===n.type)return a.method="throw",a.arg=n.arg,a.delegate=null,h;var o=n.arg;return o?o.done?(a[t.resultName]=o.value,a.next=t.nextLoc,"return"!==a.method&&(a.method="next",a.arg=e),a.delegate=null,h):o:(a.method="throw",a.arg=new TypeError("iterator result is not an object"),a.delegate=null,h)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function w(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function S(t){if(t){var a=t[o];if(a)return a.call(t);if("function"===typeof t.next)return t;if(!isNaN(t.length)){var n=-1,r=function a(){while(++n<t.length)if(i.call(t,n))return a.value=t[n],a.done=!1,a;return a.value=e,a.done=!0,a};return r.next=r}}return{next:M}}function M(){return{value:e,done:!0}}return b.prototype=_,l(D,"constructor",_),l(_,"constructor",b),b.displayName=l(_,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"===typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,_):(t.__proto__=_,l(t,s,"GeneratorFunction")),t.prototype=Object.create(D),t},t.awrap=function(t){return{__await:t}},C(O.prototype),l(O.prototype,r,(function(){return this})),t.AsyncIterator=O,t.async=function(e,a,i,n,o){void 0===o&&(o=Promise);var r=new O(c(e,a,i,n),o);return t.isGeneratorFunction(a)?r:r.next().then((function(t){return t.done?t.value:r.next()}))},C(D),l(D,s,"Generator"),l(D,o,(function(){return this})),l(D,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var a in t)e.push(a);return e.reverse(),function a(){while(e.length){var i=e.pop();if(i in t)return a.value=i,a.done=!1,a}return a.done=!0,a}},t.values=S,w.prototype={constructor:w,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(I),!t)for(var a in this)"t"===a.charAt(0)&&i.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0],e=t.completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var a=this;function n(i,n){return s.type="throw",s.arg=t,a.next=i,n&&(a.method="next",a.arg=e),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var r=this.tryEntries[o],s=r.completion;if("root"===r.tryLoc)return n("end");if(r.tryLoc<=this.prev){var l=i.call(r,"catchLoc"),c=i.call(r,"finallyLoc");if(l&&c){if(this.prev<r.catchLoc)return n(r.catchLoc,!0);if(this.prev<r.finallyLoc)return n(r.finallyLoc)}else if(l){if(this.prev<r.catchLoc)return n(r.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return n(r.finallyLoc)}}}},abrupt:function(t,e){for(var a=this.tryEntries.length-1;a>=0;--a){var n=this.tryEntries[a];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var r=o?o.completion:{};return r.type=t,r.arg=e,o?(this.method="next",this.next=o.finallyLoc,h):this.complete(r)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var a=this.tryEntries[e];if(a.finallyLoc===t)return this.complete(a.completion,a.afterLoc),I(a),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var a=this.tryEntries[e];if(a.tryLoc===t){var i=a.completion;if("throw"===i.type){var n=i.arg;I(a)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(t,a,i){return this.delegate={iterator:S(t),resultName:a,nextLoc:i},"next"===this.method&&(this.arg=e),h}},t}(t.exports);try{regeneratorRuntime=i}catch(n){"object"===typeof globalThis?globalThis.regeneratorRuntime=i:Function("r","regeneratorRuntime = r")(i)}},"9a6c":function(t,e,a){"use strict";a("c4ff")},"9a74":function(t,e,a){"use strict";a("6316")},"9ac2":function(t,e,a){},aee2:function(t,e,a){},b2eb:function(t,e,a){"use strict";a.d(e,"a",(function(){return s}));var i=a("1da1"),n=a("5530"),o=(a("96cf"),a("e9c4"),a("30ab")),r=(a("add0"),"ws://ws.qylian.cn/ws/device/current"),s=function(){var t=null,e=null,a=null,s=function(i){"undefined"===typeof WebSocket?alert("您的浏览器不支持socket"):(t=new WebSocket(r),t.onerror=function(e){console.log("ws连接发生错误",e),t=null,i&&i({code:401,message:"连接失败"})},t.onopen=function(){console.log("ws连接成功",new Date),e&&e(),i&&i({code:200,message:"连接成功"})},t.onclose=function(){console.log("ws连接关闭",new Date),t=null,a&&a(),i&&i({code:400,message:"连接关闭"})})},l=function(t){e=t},c=function(t){a=t},d=function(e){var a=Object(n["a"])(Object(n["a"])({},e),{},{token:o["a"].getToken()});t&&t.send(JSON.stringify(a))},u=function(e){t&&(t.onmessage=function(t){console.log("onMessage",t.data),e&&e(t.data)})},p=function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t){e.next=4;break}return e.next=3,t.close();case 3:t=null;case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{init:s,send:d,onReady:l,onClose:c,onMessage:u,close:p}}},c4ff:function(t,e,a){},d2f4:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"el-dark-dialog el-dark-input",attrs:{title:"配置",width:"80%","close-on-click-modal":!1,"close-on-press-escape":!1,"append-to-body":!0,visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e},close:function(e){t.dialogVisible=!1}}},[a("el-table",{attrs:{data:t.tableData},on:{"update:data":function(e){t.tableData=e}}},[t._l(t.tableAttrs.array,(function(e,i){return a("el-table-column",{key:i,attrs:{prop:e.dataKey,label:e.label,width:"auto"},scopedSlots:t._u([{key:"default",fn:function(i){return[a("el-form",{ref:"tableRef",refInFor:!0,attrs:{model:i.row,rules:e.rules}},[a("el-form-item",{attrs:{prop:e.dataKey}},["input"===e.type?[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.placeholder,placement:"top-start"}},["number"===e.validate.type?a("el-input-number",{attrs:{size:"small",placeholder:e.placeholder},model:{value:i.row[e.dataKey],callback:function(a){t.$set(i.row,e.dataKey,a)},expression:"scope.row[item.dataKey]"}}):a("el-input",{attrs:{size:"small",placeholder:e.placeholder},model:{value:i.row[e.dataKey],callback:function(a){t.$set(i.row,e.dataKey,a)},expression:"scope.row[item.dataKey]"}})],1)]:"select"===e.type?[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.placeholder,placement:"top-start"}},[a("el-select",{attrs:{size:"small",placeholder:e.placeholder},model:{value:i.row[e.dataKey],callback:function(a){t.$set(i.row,e.dataKey,a)},expression:"scope.row[item.dataKey]"}},t._l(e.options,(function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.value}})})),1)],1),a("span",{staticClass:"el-form-input_tip el-form-item__error",attrs:{slot:"error"},slot:"error"},[t._v(" "+t._s(e.validate.message)+" ")])]:t._e()],2)],1)]}}],null,!0)})})),a("el-table-column",{attrs:{prop:"handle",label:"操作",width:"100",align:"right"},scopedSlots:t._u([{key:"header",fn:function(e){return[a("el-button",{attrs:{type:"save",size:"small"},on:{click:t.handleAdd}},[t._v("新增")])]}},{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){return t.handleDel(e.$index,e.row)}}},[t._v("删除")])]}}])})],2),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"cancel"},on:{click:function(e){t.dialogVisible=!1}}},[t._v(t._s(t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.CANCEL")))]),a("el-button",{attrs:{type:"save"},on:{click:function(e){return t.handleSubmit(t.tableData)}}},[t._v(t._s(t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.CONFIRM")))])],1)],1)},n=[],o=(a("e9c4"),a("d3b7"),a("159b"),a("fb6a"),a("4d63"),a("c607"),a("ac1f"),a("2c3e"),a("25f0"),a("a434"),a("d9e2"),{components:{},props:{visible:{type:[Boolean],default:!1},attrs:{type:[Object],default:function(){return{}}},data:{type:[Array],default:function(){return[]}}},data:function(){return{}},computed:{dialogVisible:{get:function(){return this.visible},set:function(t){this.$emit("update:visible",t)}},tableAttrs:{get:function(){var t=JSON.parse(JSON.stringify(this.attrs));return t.array&&t.array.forEach((function(t){if(t.rules={},t.rules[t.dataKey]=[t.validate],t.validate.rules){var e=t.validate.rules.slice(1,-1),a=new RegExp(e);t.rules[t.dataKey].push({pattern:a,message:t.validate.message,trigger:"blur"})}})),console.log("attrs",t),t}},tableData:{get:function(){return JSON.parse(JSON.stringify(this.data))}}},methods:{handleAdd:function(){var t={};this.attrs.array.forEach((function(e){t[e.dataKey]=""})),this.tableData.push(t)},handleEdit:function(t,e,a){console.log("handleEdit",t,e,a)},handleDel:function(t,e){this.tableData[this.attrs.dataKey].splice(t,1),console.log("handleDel",t,this.tableData)},handleSubmit:function(t){try{for(var e=!0,a=0;a<this.$refs.tableRef.length;a++)this.$refs.tableRef[a].validate((function(t){if(!t)throw t=!1,new Error("")}));e&&(console.log("handleSubmit1",this.tableData),this.$emit("submit",JSON.parse(JSON.stringify(this.tableData))),this.dialogVisible=!1)}catch(i){}}}}),r=o,s=(a("9a6c"),a("2877")),l=Object(s["a"])(r,i,n,!1,null,"3d58c06c",null);e["default"]=l.exports},daa1:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{"margin-top":"20px"}},[a("el-form",{attrs:{"label-position":"left",model:t.formData,"label-width":"120px"}},[a("el-form-item",{attrs:{label:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.DEVICE_ID")}},[a("el-tooltip",{attrs:{effect:"dark",content:t.isCopy?t.$t("DEVICE_MANAGEMENT.EDIT_PARAMETER.COPIED"):t.$t("DEVICE_MANAGEMENT.EDIT_PARAMETER.COPY")}},[a("el-input",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:t.device.device,expression:"device.device",arg:"copy"}],staticStyle:{width:"30%"},attrs:{readonly:""},nativeOn:{click:function(e){return t.handleCopy.apply(null,arguments)}},model:{value:t.device.device,callback:function(e){t.$set(t.device,"device",e)},expression:"device.device"}})],1)],1),"2"==t.device.device_type&&t.device.protocol.startsWith("WVP_")?a("el-form-item",{attrs:{label:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.LABLE1")}},[a("el-select",{staticStyle:{width:"100%"},model:{value:t.formData.d_id,callback:function(e){t.$set(t.formData,"d_id",e)},expression:"formData.d_id"}},t._l(t.wvpDevice,(function(e,i){return a("el-option",{key:e.deviceId,attrs:{label:e.deviceId+" ["+e.createTime+"] "+(1==e.online?t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.ONLINE"):t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.OFFLINE")),value:e.deviceId}})})),1)],1):t._e(),"2"!==t.device.device_type?a("div",{staticStyle:{"margin-bottom":"30px"}},[a("el-row",{staticStyle:{"flex-wrap":"wrap"},attrs:{gutter:12,type:"flex"}},t._l(t.deviceAttributeCardList,(function(e){return"systime"!==e.key&&"SYS_ONLINE"!==e.key?a("el-col",{key:e.key,staticStyle:{"min-width":"250px","margin-bottom":"10px"},attrs:{xs:24,sm:12,md:8,lg:8,xl:6}},[a("div",{staticStyle:{"background-color":"#2d3d88","border-radius":"4px",border:"1px solid #EBEEF5"}},[a("div",{staticStyle:{padding:"10px 10px 10px 20px",height:"30px"}},[a("span",{staticStyle:{"font-size":"18px"}},[t._v(t._s(e.name))]),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.CHECK_TIMING_CHART"),placement:"top-start"}},[t.isShowDataChart(e)?a("i",{staticClass:"el-icon-pie-chart",staticStyle:{float:"right",padding:"3px 5px",cursor:"pointer"},on:{click:function(a){return t.showDeviceDataChart(e)}}}):a("i",{staticClass:"el-icon-pie-chart",staticStyle:{float:"right",padding:"3px 5px",cursor:"not-allowed"}})]),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.CHECK_HISTORY_DATA"),placement:"top-start"}},[a("i",{staticClass:"el-icon-notebook-2",staticStyle:{float:"right",padding:"3px 5px",cursor:"pointer"},on:{click:function(a){return t.showDeviceHistory(e)}}})])],1),a("div",{staticStyle:{height:"3px !important"}},[a("hr",{staticStyle:{"border-top":"1px solid rgb(255 255 255 / 99%)"}})]),a("div",{staticStyle:{height:"115px",padding:"10px 5px 0px 10px"}},[a("div",{staticStyle:{height:"63px"}},[a("el-tooltip",{attrs:{content:t.getCardFullValue(e),placement:"top"}},[a("div",{staticStyle:{display:"flex"}},[a("div",{staticClass:"card_value_content"},[t._v(t._s(e.str_v?e.str_v:e.dbl_v))]),a("div",{staticClass:"card_value_unit"},[t._v(t._s(e.unit||""))])])])],1),a("div",{staticStyle:{float:"right",padding:"3px 5px","margin-bottom":"3px","margin-top":"11px"}},[t._v(t._s(t.calculateUpdateTime(e.ts)))])])])]):t._e()})),1)],1):t._e()],1),a("DeviceHistory",{attrs:{visible:t.deviceHistoryVisible,device:t.device,attributeName:t.choosedAttribute},on:{"update:visible":function(e){t.deviceHistoryVisible=e}}}),a("DeviceDataChart",{attrs:{visible:t.deviceDataChartVisible,device:t.device,attributeName:t.choosedAttribute},on:{"update:visible":function(e){t.deviceDataChartVisible=e}}})],1)},n=[],o=(a("99af"),a("31e1")),r=a("6d09"),s=a("f570"),l=a("aa98"),c=a("b2eb"),d={components:{DeviceHistory:o["default"],DeviceDataChart:r["default"]},props:{data:{type:Object,default:function(){return{}}},device:{type:[Object],default:function(){return{}}},wvpDevice:{type:Array,default:function(){return[]}},initAttributeCard:{type:Boolean,default:!1}},data:function(){return{isCopy:!1,choosedAttribute:"",deviceHistoryVisible:!1,deviceDataChartVisible:!1,deviceAttributeCardList:[],socket:null,firstLoad:!1}},computed:{formData:{get:function(){return this.data},set:function(t){this.$emit("update:data",t)}}},watch:{initAttributeCard:{handler:function(t){t&&(console.debug("initAttributeCard",t),this.getDeviceAttributeCardList())}}},beforeDestroy:function(){this.socket&&this.socket.close()},mounted:function(){console.log("DeviceAttribute",this.device),this.getDeviceAttributeCardList(),this.updateComponents()},methods:{getDeviceAttributeCardList:function(){var t=this;Object(l["c"])({device_id:this.device.id}).then((function(e){console.debug("====getDeviceAttributeCardList",e),200===e.data.code&&(t.deviceAttributeCardList=e.data.data?e.data.data:[])}))},handleCopy:function(){this.isCopy=!0},showDeviceHistory:function(t){this.choosedAttribute=t.key,this.deviceHistoryVisible=!0},showDeviceDataChart:function(t){this.choosedAttribute=t.key,this.deviceDataChartVisible=!0},calculateUpdateTime:function(t){var e=s["a"].t("COMMON.CURRENT_LANGUAGE"),a=Date.now(),i=a-parseInt(t/1e3);if(i<0)return"";for(var n=Math.floor(i/1e3),o=Math.floor(n/60),r=Math.floor(o/60),l=Math.floor(r/24),c=Math.floor(l/7),d=Math.floor(l/30),u=Math.floor(l/365),p=["年","个月","周","天","小时","分钟","秒"],f=["year(s)","month(s)","week(s)","day(s)","hour(s)","minute(s)","second(s)"],m="中文"===e?p:f,h=[u,d,c,l,r,o,n],v=0;v<h.length;v++)if(h[v]>0)return"中文"===e?"".concat(h[v]).concat(m[v],"前更新"):"Updated ".concat(h[v]," ").concat(m[v]," ago");return"中文"===e?"刚刚更新":"Just updated"},isShowDataChart:function(t){if(!t)return!1;var e=t.str_v?t.str_v:t.dbl_v;return!e||"number"===typeof e},getCardFullValue:function(t){var e=String(t.str_v?t.str_v:t.dbl_v);return t.unit&&(e+=" "+t.unit),console.error(t,e),e},updateComponents:function(){var t=this;console.error(this.device,this.websocket),this.socket&&(this.socket.close(),this.socket=null),this.socket=new c["a"],this.socket.init((function(t){})),this.socket.onReady((function(){t.socket.send({device_id:t.device.device})})),this.socket.onMessage((function(e){if(t.firstLoad)try{var a=JSON.parse(e);console.error(a);for(var i=1e3*new Date(a.ts).getTime(),n=0;n<t.deviceAttributeCardList.length;n++){var o=t.deviceAttributeCardList[n],r=a[o.key];void 0!==r&&(o.str_v=r,o.ts=i)}}catch(s){}else t.firstLoad=!0}))}}},u=d,p=(a("dc04"),a("2877")),f=Object(p["a"])(u,i,n,!1,null,"c3f5288a",null);e["default"]=f.exports},dc04:function(t,e,a){"use strict";a("9ac2")}}]);