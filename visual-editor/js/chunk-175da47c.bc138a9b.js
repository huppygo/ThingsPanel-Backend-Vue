(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-175da47c","chunk-548098a9","chunk-783f1143","chunk-2d212c35"],{"2b6d":function(t,e,n){"use strict";n.d(e,"d",(function(){return o})),n.d(e,"a",(function(){return r})),n.d(e,"c",(function(){return i})),n.d(e,"b",(function(){return u}));var a=n("18a6");function o(t){return Object(a["a"])({url:"/business/index",method:"post",data:t})}function r(t){return Object(a["a"])({url:"/business/add",method:"post",data:t})}function i(t){return Object(a["a"])({url:"/business/edit",method:"post",data:t})}function u(t){return Object(a["a"])({url:"/business/delete",method:"post",data:t})}},"308f":function(t,e,n){"use strict";n.d(e,"c",(function(){return r})),n.d(e,"j",(function(){return i})),n.d(e,"d",(function(){return u})),n.d(e,"e",(function(){return d})),n.d(e,"f",(function(){return c})),n.d(e,"i",(function(){return s})),n.d(e,"g",(function(){return l})),n.d(e,"h",(function(){return f})),n.d(e,"a",(function(){return p})),n.d(e,"b",(function(){return m}));var a=n("5530"),o=(n("2ca0"),n("d3b7"),n("d81d"),n("18a6"));function r(){return Object(o["a"])({url:"/asset/index",method:"post"})}function i(t){return Object(o["a"])({url:"/structure/field",method:"post",data:t})}function u(t){return Object(o["a"])({url:"/asset/list",method:"post",data:t})}function d(t){return Object(o["a"])({url:"/asset/list/a",method:"post",data:t})}function c(t){return Object(o["a"])({url:"/asset/list/b",method:"post",data:t})}function s(t){var e=function(t){return t&&t.startsWith("/")?t.substring(1):t};return new Promise((function(n,a){Object(o["a"])({url:"/asset/list/d",method:"post",data:t}).then((function(t){var a=t.data.data.map((function(t){return t.device_group=e(t.device_group),t}));t.data.data=a,n(t)})).catch((function(t){a(t)}))}))}function l(t){return Object(o["a"])({url:"/asset/list/c",method:"post",data:t})}function f(t){return Object(o["a"])({url:"/asset/update_only",method:"post",data:t})}function p(t){return Object(o["a"])({url:"/asset/add_only",method:"post",data:t})}function m(t){return Object(o["a"])({url:"/asset/delete",method:"post",data:Object(a["a"])({type:1},t)})}},"448a":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"command-device-box"},t._l(t.commands,(function(e,a){return n("div",{key:a,staticStyle:{display:"flex","margin-bottom":"10px"}},[n("DeviceTypeSelector",{ref:"deviceTypeRef",refInFor:!0,attrs:{option:{operator:!1},data:e},on:{change:function(n){return t.handleCommandChange(e,n)}}}),0==a?n("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"indigo",size:"small"},on:{click:t.handleAddCommand}},[t._v(t._s(t.$t("AUTOMATION.ADD_LINE")))]):t._e(),a>0?n("el-button",{staticStyle:{"margin-left":"auto"},attrs:{type:"danger",size:"small"},on:{click:function(n){return t.handleDeleteCommand(e)}}},[t._v(t._s(t.$t("AUTOMATION.DELETE")))]):t._e()],1)})),0)},o=[],r=(n("e9c4"),n("c740"),n("a434"),n("7667")),i={name:"CommandDevice",components:{DeviceTypeSelector:r["default"]},props:{data:{type:[Array],default:function(){return[]}}},data:function(){return{commands:[]}},watch:{data:{handler:function(t){t&&t.length>0?this.commands=JSON.parse(JSON.stringify(t)):this.commands=[{}]},immediate:!0}},methods:{handleCommandChange:function(t,e){for(var n in e)t[n]=e[n];this.$emit("change",this.commands)},handleAddCommand:function(){this.commands.push({})},handleDeleteCommand:function(t){var e=this.commands.findIndex((function(e){return e==t}));this.commands.splice(e,1)},validate:function(){for(var t=0;t<this.commands.length;t++)if(this.$refs.deviceTypeRef&&!this.$refs.deviceTypeRef[t].validate())return!1;return!0}}},u=i,d=(n("b013"),n("2877")),c=Object(d["a"])(u,a,o,!1,null,"07049751",null);e["default"]=c.exports},7667:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{display:"flex"}},[n("el-select",{ref:"projectRef",staticStyle:{width:"100px","margin-right":"10px"},attrs:{placeholder:t.$t("AUTOMATION.PLACEHOLDER.SELECT_PROJECT")},on:{change:t.handleProjectChange},model:{value:t.formData.projectId,callback:function(e){t.$set(t.formData,"projectId",e)},expression:"formData.projectId"}},t._l(t.projectOptions,(function(t,e){return n("el-option",{key:e,attrs:{label:t.name,value:t.id}})})),1),t.formData.projectId?n("el-select",{ref:"groupRef",staticStyle:{width:"100px","margin-right":"10px"},attrs:{placeholder:t.$t("AUTOMATION.PLACEHOLDER.SELECT_GROUP")},on:{change:t.handleGroupChange},model:{value:t.formData.groupId,callback:function(e){t.$set(t.formData,"groupId",e)},expression:"formData.groupId"}},t._l(t.groupOptions,(function(t,e){return n("el-option",{key:e,attrs:{label:t.device_group,value:t.id}})})),1):t._e(),t.formData.groupId?n("el-cascader",{ref:"deviceRef",staticStyle:{width:"100px","margin-right":"10px"},attrs:{placeholder:t.$t("AUTOMATION.PLACEHOLDER.SELECT_DEVICE"),options:t.deviceOptions,clearable:"",props:{checkStrictly:!0,emitPath:!1}},on:{change:t.handleDeviceChange},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.node,o=e.data;return[n("span",[t._v(t._s(o.label))]),a.isLeaf?t._e():n("span",[t._v(" ("+t._s(o.children.length)+") ")])]}}],null,!1,1996962598),model:{value:t.formData.device,callback:function(e){t.$set(t.formData,"device",e)},expression:"formData.device"}}):t._e(),t.formData.device?n("el-select",{ref:"stateRef",staticStyle:{width:"100px","margin-right":"10px"},on:{change:t.handleStateChange},model:{value:t.formData.messageType,callback:function(e){t.$set(t.formData,"messageType",e)},expression:"formData.messageType"}},t._l(t.stateOptions,(function(t,e){return n("el-option",{key:e,attrs:{label:t.name,value:t.messageType}})})),1):t._e()],1)},o=[],r=n("5530"),i=(n("e9c4"),n("d81d"),n("7db0"),n("d3b7"),n("b0c0"),n("2b6d")),u=n("308f"),d=n("aa98"),c=n("9448"),s=n("2fa3"),l=(n("f570"),{name:"DeviceTypeSelector",components:{},props:{option:{type:[Object],default:function(){return{operator:!0}}},data:{type:[Object],default:function(){return{}}}},data:function(){return{formData:{projectId:"",groupId:"",deviceId:"",device:"",messageType:""},projectOptions:[],groupOptions:[],deviceOptions:[],stateOptions:[{name:"属性上报",messageType:1},{name:"属性下发",messageType:2},{name:"事件上报",messageType:3},{name:"自定义上报",messageType:4}]}},watch:{data:{handler:function(t){console.log("data",t),t&&(this.formData=JSON.parse(JSON.stringify(t)),console.log("formData",this.formData))},immediate:!0},"formData.projectId":{handler:function(t){t&&this.getGroupList(t)},immediate:!0},"formData.groupId":{handler:function(t){t&&(console.log("formData.groupId",t),this.getDeviceList(t))},immediate:!0}},created:function(){this.getProjectList()},methods:{handleProjectChange:function(t){this.formData.projectId=t,this.formData.groupId="",this.updateData(),this.getGroupList(t)},handleGroupChange:function(t){console.log("handleGroupChange",t),this.formData.groupId=t,this.formData.deviceId="",this.updateData(),this.getDeviceList(t)},handleDeviceChange:function(t){var e=this.$refs.deviceRef,n=e.getCheckedNodes()[0].data;console.log("handleDeviceChange.device",this.formData.device),this.formData.deviceId=n.value,this.updateData()},handleStateChange:function(t){this.formData.state=t,this.updateData()},handleDurationChange:function(t){this.formData.state.duration=t,this.updateData()},handleOperatorChange:function(t){this.formData.state.operator=t,this.updateData()},updateData:function(){console.log("updateData",this.formData),this.$emit("change",this.formData)},getProjectList:function(){var t=this;Object(i["d"])({limit:100,page:1}).then((function(e){var n,a=e.data;200==a.code&&(t.projectOptions=(null===(n=a.data)||void 0===n?void 0:n.data)||[])}))},getGroupList:function(t){var e=this;Object(u["i"])({business_id:t}).then((function(t){var n=t.data;200==n.code&&(e.groupOptions=(null===n||void 0===n?void 0:n.data)||[])}))},getDeviceList:function(t){var e=this,n={current_page:1,per_page:9999,asset_id:t};Object(d["r"])(n).then((function(t){var n=t.data;if(console.log(n,"res"),200==n.code){var a,o=(null===(a=n.data)||void 0===a?void 0:a.data)||[];e.deviceOptions=o.map((function(t){return{label:t.device_name,value:t.device,pluginId:t.type}})),e.formData.deviceId&&(e.formData.device=e.deviceOptions.find((function(t){return t.value==e.formData.deviceId})),e.updateData())}}))},getStateList:function(t){var e=this;if(console.log("getStateList",t),this.stateOptions=[],this.option.operator&&(this.stateOptions.push({label:this.$t("AUTOMATION.ONLINE_STATUS"),options:[{mode:"onlineDuration",label:this.$t("AUTOMATION.ONLINE_DURATION"),name:"onlineDuration"}]}),this.stateOptions.push({label:this.$t("AUTOMATION.ONLINE_OFFLINE"),options:[{mode:"onlineState",label:this.$t("AUTOMATION.ONLINE"),name:"online"},{mode:"onlineState",label:this.$t("AUTOMATION.OFFLINE"),name:"offline"},{mode:"onlineState",label:this.$t("AUTOMATION.ONLINE_OFFLINE"),name:"onAndOff"}]})),t){var n={current_page:1,per_page:9999,id:t};c["a"].page(n).then((function(t){var n=t.data;if(200==n.code){var a,o,i,u=(null===(a=n.data)||void 0===a||null===(o=a.data[0])||void 0===o?void 0:o.chart_data)||"{}",d=JSON.parse(u),c=(null===(i=d.tsl)||void 0===i?void 0:i.properties)||[],s=c.map((function(t){return e.formData.state&&e.formData.state.name===t.name&&(e.formData.state=Object(r["a"])(Object(r["a"])({},e.formData.state),{},{unit:t.unit,type:t.type})),{label:t.title,name:t.name,unit:t.unit,mode:"property",type:t.dataType}}));e.stateOptions.push({label:e.$t("AUTOMATION.PROPERTY"),options:s}),console.log(e.stateOptions),e.updateData()}}))}else this.updateData()},validate:function(){var t=this.$refs,e=this.formData;return e.projectId&&""!==e.projectId?e.groupId&&""!==e.groupId?e.device&&""!==e.device?e.messageType&&""!==e.messageType?!(t.onlineDurationRef&&!t.onlineDurationRef.validate())&&!(t.operatorSelectorRef&&!t.operatorSelectorRef.validate()):(t.stateRef.focus(),Object(s["h"])(this.$t("AUTOMATION.ERROR.MESSAGETYPE")),!1):(t.deviceRef.focus(),Object(s["h"])(this.$t("AUTOMATION.ERROR.DEVICE")),!1):(t.groupRef.focus(),Object(s["h"])(this.$t("AUTOMATION.ERROR.GROUP")),!1):(t.projectRef.focus(),Object(s["h"])(this.$t("AUTOMATION.ERROR.PROJECT")),!1)}}}),f=l,p=n("2877"),m=Object(p["a"])(f,a,o,!1,null,"737c8286",null);e["default"]=m.exports},9448:function(t,e,n){"use strict";var a=n("18a6");e["a"]={add:function(t){return Object(a["a"])({url:"/device/model/add",method:"post",data:t})},edit:function(t){return Object(a["a"])({url:"/device/model/edit",method:"post",data:t})},del:function(t){return Object(a["a"])({url:"/device/model/delete",method:"post",data:t})},page:function(t){return Object(a["a"])({url:"/device/model/list",method:"post",data:t})},tree:function(t){return Object(a["a"])({url:"/device/model/tree",method:"post",data:t})},category:function(t){return Object(a["a"])({url:"/dict/list/",method:"post",data:t})},map:function(t){return Object(a["a"])({url:"/device/map",method:"post",data:t})},equip:function(t){return Object(a["a"])({url:"/kv/current/symbol",method:"post",data:t})},state:function(t){return Object(a["a"])({url:"/device/status",method:"post",data:t})}}},aa98:function(t,e,n){"use strict";n.d(e,"g",(function(){return o})),n.d(e,"f",(function(){return r})),n.d(e,"j",(function(){return i})),n.d(e,"h",(function(){return u})),n.d(e,"i",(function(){return d})),n.d(e,"x",(function(){return c})),n.d(e,"b",(function(){return s})),n.d(e,"c",(function(){return l})),n.d(e,"t",(function(){return f})),n.d(e,"v",(function(){return p})),n.d(e,"w",(function(){return m})),n.d(e,"z",(function(){return h})),n.d(e,"r",(function(){return O})),n.d(e,"p",(function(){return v})),n.d(e,"A",(function(){return b})),n.d(e,"l",(function(){return g})),n.d(e,"a",(function(){return j})),n.d(e,"k",(function(){return D})),n.d(e,"e",(function(){return y})),n.d(e,"y",(function(){return T})),n.d(e,"q",(function(){return I})),n.d(e,"m",(function(){return _})),n.d(e,"n",(function(){return A})),n.d(e,"u",(function(){return E})),n.d(e,"o",(function(){return R})),n.d(e,"d",(function(){return N})),n.d(e,"s",(function(){return S}));var a=n("18a6");function o(t){return Object(a["a"])({url:"/index/show",method:"post",data:t})}function r(t){return Object(a["a"])({url:"/device/add_only",method:"post",data:t})}function i(t){return Object(a["a"])({url:"/device/update_only",method:"post",data:t})}function u(t){return Object(a["a"])({url:"/device/delete",method:"post",data:t})}function d(t){return Object(a["a"])({url:"/device/data",method:"post",data:t})}function c(t){return Object(a["a"])({url:"/structure/field",method:"post",data:t})}function s(t){return Object(a["a"])({url:"/kv/current",method:"post",data:t})}function l(t){return Object(a["a"])({url:"/kv/current/detail",method:"post",data:t})}function f(t){return Object(a["a"])({url:"/kv/history/data",method:"post",data:t})}function p(t){return Object(a["a"])({url:"/kv/statistic",method:"post",data:t})}function m(t){return Object(a["a"])({url:"/kv/statistic/batch",method:"post",data:t})}function h(t){return Object(a["a"])({url:"/device/operating_device",method:"post",data:t})}function O(t){return Object(a["a"])({url:"/device/list/tree",method:"post",data:t})}function v(t){return Object(a["a"])({url:"/device/data",method:"post",data:t})}function b(t){return Object(a["a"])({url:"/device/update_only",method:"post",data:t})}function g(t){return Object(a["a"])({url:"/tp_script/list",method:"post",data:t})}function j(t){return Object(a["a"])({url:"/tp_script/add",method:"post",data:t})}function D(t){return Object(a["a"])({url:"/tp_script/edit",method:"post",data:t})}function y(t){return Object(a["a"])({url:"/tp_script/delete",method:"post",data:t})}function T(t){return Object(a["a"])({url:"/tp_script/quiz",method:"post",data:t})}function I(t){return Object(a["a"])({url:"/device/status",method:"post",data:t})}function _(t){return Object(a["a"])({url:"/device/command/history/list",method:"post",data:t})}function A(t){return Object(a["a"])({url:"/device/command/list",method:"post",data:t})}function E(t){return Object(a["a"])({url:"/device/command/send",method:"post",data:t})}function R(t){return Object(a["a"])({url:"/device/event/history/list",method:"post",data:t})}function N(t){return Object(a["a"])({url:"/kv/history/delete",method:"post",data:t})}function S(){return Object(a["a"])({url:"/home/system/time",method:"post"})}},b013:function(t,e,n){"use strict";n("f06d")},f06d:function(t,e,n){}}]);