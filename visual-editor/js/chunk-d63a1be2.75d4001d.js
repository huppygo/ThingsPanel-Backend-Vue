(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d63a1be2","chunk-548098a9","chunk-6813415d","chunk-4f2db8e0","chunk-2d212c35"],{"308f":function(e,t,a){"use strict";a.d(t,"c",(function(){return i})),a.d(t,"j",(function(){return o})),a.d(t,"d",(function(){return u})),a.d(t,"e",(function(){return c})),a.d(t,"f",(function(){return l})),a.d(t,"i",(function(){return d})),a.d(t,"g",(function(){return s})),a.d(t,"h",(function(){return f})),a.d(t,"a",(function(){return p})),a.d(t,"b",(function(){return m}));var n=a("5530"),r=(a("2ca0"),a("d3b7"),a("d81d"),a("18a6"));function i(){return Object(r["a"])({url:"/asset/index",method:"post"})}function o(e){return Object(r["a"])({url:"/structure/field",method:"post",data:e})}function u(e){return Object(r["a"])({url:"/asset/list",method:"post",data:e})}function c(e){return Object(r["a"])({url:"/asset/list/a",method:"post",data:e})}function l(e){return Object(r["a"])({url:"/asset/list/b",method:"post",data:e})}function d(e){var t=function(e){return e&&e.startsWith("/")?e.substring(1):e};return new Promise((function(a,n){Object(r["a"])({url:"/asset/list/d",method:"post",data:e}).then((function(e){var n=e.data.data.map((function(e){return e.device_group=t(e.device_group),e}));e.data.data=n,a(e)})).catch((function(e){n(e)}))}))}function s(e){return Object(r["a"])({url:"/asset/list/c",method:"post",data:e})}function f(e){return Object(r["a"])({url:"/asset/update_only",method:"post",data:e})}function p(e){return Object(r["a"])({url:"/asset/add_only",method:"post",data:e})}function m(e){return Object(r["a"])({url:"/asset/delete",method:"post",data:Object(n["a"])({type:1},e)})}},"75f9":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-select",{staticClass:"w-100",attrs:{clearable:e.clearable,filterable:e.filterable,placeholder:e.$t("DATA_MANAGEMENT.PLACEHOLDER3"),"no-data-text":e.$t("PUBLIC.NODATA")},on:{change:function(t){return e.handleChange()}},model:{value:e.deviceGroupId,callback:function(t){e.deviceGroupId=t},expression:"deviceGroupId"}},e._l(e.deviceGroupOptions,(function(e){return a("el-option",{key:e.id,attrs:{value:e.id,label:e.device_group}})})),1)},r=[],i=a("ed09"),o=a("308f"),u=Object(i["c"])({name:"DeviceGroupSelector",props:{clearable:{default:!0},filterable:{default:!0},business_id:{required:!0},asset_id:{required:!0},showAll:{default:!1}},setup:function(e,t){var a=Object(i["i"])([]);function n(){if(!e.showAll)return!1;a.value.unshift({device_group:"所有设备分组",id:"all"})}var r=Object(i["a"])({get:function(){return e.asset_id},set:function(e){t.emit("update:asset_id",e)}});function u(){t.emit("change")}return Object(i["j"])((function(){return e.business_id}),(function(){var t=e.business_id;t&&Object(o["i"])({business_id:t}).then((function(e){var t,r=e.data;200===r.code&&r.data&&(a.value=r.data),"all"!==(null===(t=a.value[0])||void 0===t?void 0:t.id)&&n()}))}),{immediate:!0}),n(),{deviceGroupId:r,deviceGroupOptions:a,handleChange:u}}}),c=u,l=a("2877"),d=Object(l["a"])(c,n,r,!1,null,"69d383fb",null);t["a"]=d.exports},"8b5c":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.error_message?a("el-alert",{staticClass:"mb-4",attrs:{title:"提交的数据有误",type:"error",description:e.error_message,"show-icon":""}}):e._e()},r=[],i={name:"FormAlert",props:{error_message:{require:!0,default:""}}},o=i,u=a("2877"),c=Object(u["a"])(o,n,r,!1,null,"695af04c",null);t["a"]=c.exports},9172:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return u}));var n=a("ed09"),r=a("9282"),i=a("f570"),o=a("9448");function u(e){var t=Object(n["i"])([]);Object(n["j"])((function(){return e.pluginId}),(function(e){if(e){var a={current_page:1,per_page:10,id:e};o["a"].page(a).then((function(e){var a=e.data;if(200==a.code&&a.data.data&&a.data.data.length>0){var n=a.data.data[0].chart_data?a.data.data[0].chart_data:"{}",r=JSON.parse(n);t.value=r.tsl.properties}}))}}),{immediate:!0});var a=Object(n["i"])([]);Object(r["a"])().then((function(e){var t=e.data;200===t.code&&t.data&&(a.value=t.data)}));var u=Object(n["i"])([{label:i["a"].t("AUTOMATION.OR"),value:"||"},{label:i["a"].t("AUTOMATION.AND"),value:"&&"}]),c=Object(n["i"])([{label:"设备条件类型",value:1},{label:"时间条件类型",value:2}]);return{triggerOptions:t,symbolOptions:a,operatorOptions:u,typeOptions:c}}},9282:function(e,t,a){"use strict";a.d(t,"g",(function(){return r})),a.d(t,"f",(function(){return i})),a.d(t,"b",(function(){return o})),a.d(t,"a",(function(){return u})),a.d(t,"c",(function(){return c})),a.d(t,"e",(function(){return l})),a.d(t,"d",(function(){return d}));var n=a("18a6");function r(e){return Object(n["a"])({url:"/asset/work_index",method:"post",data:e})}function i(e){return Object(n["a"])({url:"/warning/show",method:"post",data:e})}function o(e){return Object(n["a"])({url:"/dashboard/device",method:"post",data:e})}function u(){return Object(n["a"])({url:"/automation/symbol",method:"post"})}function c(e){return Object(n["a"])({url:"/warning/add",method:"post",data:e})}function l(e){return Object(n["a"])({url:"/warning/edit",method:"post",data:e})}function d(e){return Object(n["a"])({url:"/warning/delete",method:"post",data:e})}},9448:function(e,t,a){"use strict";var n=a("18a6");t["a"]={add:function(e){return Object(n["a"])({url:"/device/model/add",method:"post",data:e})},edit:function(e){return Object(n["a"])({url:"/device/model/edit",method:"post",data:e})},del:function(e){return Object(n["a"])({url:"/device/model/delete",method:"post",data:e})},page:function(e){return Object(n["a"])({url:"/device/model/list",method:"post",data:e})},tree:function(e){return Object(n["a"])({url:"/device/model/tree",method:"post",data:e})},category:function(e){return Object(n["a"])({url:"/dict/list/",method:"post",data:e})},map:function(e){return Object(n["a"])({url:"/device/map",method:"post",data:e})},equip:function(e){return Object(n["a"])({url:"/kv/current/symbol",method:"post",data:e})},state:function(e){return Object(n["a"])({url:"/device/status",method:"post",data:e})}}},a796:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"el-dark-dialog",attrs:{title:e.current_item.id?e.$t("AUTOMATION.ALARM_STRATEGY.EDIT_ALARM_STRATEGY"):e.$t("AUTOMATION.ALARM_STRATEGY.ADD_ALARM_STRATEGY"),visible:e.showDialog,width:"50%","close-on-click-modal":!1},on:{"update:visible":function(t){e.showDialog=t}}},[a("el-form",{ref:"alarmFormRef",attrs:{model:e.formData,"label-position":"top","hide-required-asterisk":""}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$t("AUTOMATION.ALARM_STRATEGY.ALARM_STRATEGY_NAME"),prop:"name",rules:e.rules.name}},[a("el-input",{attrs:{placeholder:e.$t("AUTOMATION.ALARM_STRATEGY.PLACEHOLDER1")},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$t("AUTOMATION.ALARM_STRATEGY.ALARM_STRATEGY_DESCRIBE"),prop:"describe",rules:e.rules.describe}},[a("el-input",{attrs:{placeholder:e.$t("AUTOMATION.ALARM_STRATEGY.PLACEHOLDER2")},model:{value:e.formData.describe,callback:function(t){e.$set(e.formData,"describe",t)},expression:"formData.describe"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$t("AUTOMATION.GROUP"),prop:"sensor",rules:e.rules.sensor}},[a("DeviceGroupSelector",{attrs:{business_id:e.business_id,asset_id:e.formData.sensor,clearable:!1},on:{"update:asset_id":function(t){return e.$set(e.formData,"sensor",t)},change:e.handleDeviceGroupChange}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$t("AUTOMATION.DEVICE"),prop:"bid",rules:e.rules.bid}},[a("DeviceSelector",{attrs:{asset_id:e.formData.sensor,device_id:e.formData.bid,plugin_id:e.formData.pluginId,clearable:!1},on:{"update:device_id":function(t){return e.$set(e.formData,"bid",t)},"update:plugin_id":function(t){return e.$set(e.formData,"pluginId",t)},change:e.handleDeviceChange}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("AUTOMATION.TRIGGERING_CONDITION")}},[e._l(e.formData.config,(function(t,n){return[a("el-row",{attrs:{gutter:20}},[t.operator?a("el-col",{staticClass:"py-5",attrs:{span:3}},[a("el-form-item",[a("el-select",{attrs:{"no-data-text":e.$t("COMMON.SELECT_NO_DATA")},model:{value:t.operator,callback:function(a){e.$set(t,"operator",a)},expression:"config_item.operator"}},e._l(e.operatorOptions,(function(e,t){return a("el-option",{key:t,attrs:{value:e.value,label:e.label}})})),1)],1)],1):e._e()],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{prop:"config."+n+".field",rules:e.rules["config.field"]}},[a("el-select",{staticClass:"w-100",attrs:{"no-data-text":e.$t("COMMON.SELECT_NO_DATA"),placeholder:e.$t("AUTOMATION.PLACEHOLDER2")},model:{value:t.field,callback:function(a){e.$set(t,"field",a)},expression:"config_item.field"}},e._l(e.triggerOptions,(function(e,t){return a("el-option",{key:t,attrs:{value:e.name,label:e.title}})})),1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{prop:"config."+n+".condition",rules:e.rules["config.condition"]}},[a("el-select",{staticClass:"w-100",attrs:{"no-data-text":e.$t("COMMON.SELECT_NO_DATA"),placeholder:e.$t("AUTOMATION.PLACEHOLDER3")},model:{value:t.condition,callback:function(a){e.$set(t,"condition",a)},expression:"config_item.condition"}},e._l(e.symbolOptions,(function(t,n){return a("el-option",{key:n,attrs:{value:t.id,label:t.name}},[e._v(e._s(t.id))])})),1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{prop:"config."+n+".value",rules:e.rules["config.value"]}},[a("el-input",{staticClass:"w-100",attrs:{placeholder:e.$t("AUTOMATION.PLACEHOLDER4")},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"config_item.value"}})],1)],1),a("el-col",{attrs:{span:6}},[0===n?a("el-button",{attrs:{type:"indigo",size:"medium"},on:{click:e.addLine}},[e._v(e._s(e.$t("AUTOMATION.ADD_LINE")))]):a("el-popconfirm",{attrs:{"confirm-button-text":e.$t("COMMON.CONFIRM"),"cancel-button-text":e.$t("COMMON.CANCEL"),title:e.$t("AUTOMATION.TITLE4")},on:{confirm:function(a){return e.removeLine(t)}}},[a("el-button",{attrs:{slot:"reference",type:"danger",size:"medium"},slot:"reference"},[e._v(e._s(e.$t("AUTOMATION.DELETE")))])],1)],1)],1)]}))],2)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("AUTOMATION.ALARM_TYPE")}},[a("el-checkbox-group",{attrs:{size:"small"},on:{change:e.handleAlarmChange},model:{value:e.formData.warningChecked,callback:function(t){e.$set(e.formData,"warningChecked",t)},expression:"formData.warningChecked"}},[a("el-checkbox",{attrs:{label:"email"}},[e._v(e._s(e.$t("AUTOMATION.EMAIL")))]),a("el-checkbox",{attrs:{label:"sms",disabled:""}},[e._v(e._s(e.$t("AUTOMATION.SMS")))]),a("el-checkbox",{attrs:{label:"dingtalk",disabled:""}},[e._v(e._s(e.$t("AUTOMATION.DING_TALK")))]),a("el-checkbox",{attrs:{label:"enterpriseWeChat",disabled:""}},[e._v(e._s(e.$t("AUTOMATION.ENTERPRISE_WECHAT")))])],1)],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.$t("AUTOMATION.INFORMATION")}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.formData.message,callback:function(t){e.$set(e.formData,"message",t)},expression:"formData.message"}})],1)],1)],1),a("FormAlert",{attrs:{error_message:e.error_message}}),a("div",{staticClass:"text-right"},[a("el-button",{attrs:{size:"medium",type:"cancel"},on:{click:function(t){return e.handleCancel()}}},[e._v(e._s(e.$t("AUTOMATION.CANCEL")))]),a("el-button",{attrs:{size:"medium",type:"save"},on:{click:function(t){return e.handleSave()}}},[e._v(e._s(e.$t("AUTOMATION.SAVE")))])],1)],1)],1)},r=[],i=(a("e9c4"),a("d3b7"),a("a434"),a("ed09")),o=a("75f9"),u=a("f1b1"),c=a("9172"),l=a("9282"),d=a("8b5c"),s=a("854b"),f=a("aa98"),p=a("f570"),m=Object(i["c"])({name:"AlarmEditForm",components:{DeviceGroupSelector:o["a"],DeviceSelector:u["default"],FormAlert:d["a"]},props:{business_id:{required:!0,type:String},current_item:{required:!0,type:Object},alarmDialogVisible:{type:Boolean,default:!1},add_alarm:{required:!0,type:Function},update_alarm:{required:!0,type:Function}},setup:function(e,t){var a=Object(i["a"])({get:function(){return!!e.alarmDialogVisible},set:function(e){t.emit("update:alarmDialogVisible",e)}}),n=Object(i["i"])(),r=Object(i["h"])({id:"",wid:e.business_id,name:"",describe:"",sensor:"",bid:"",pluginId:"",config:[{field:"",condition:"",value:""}],message:"",other_message:"",warningChecked:[]}),o=Object(i["i"])("");function u(e){r.other_message="",e.indexOf("email")>-1&&(r.other_message=s["i"].state.user.email)}function d(){var t=JSON.parse(JSON.stringify(e.current_item));for(var a in r)a in t&&(r[a]=t[a]),"bid"==a&&Object(f["i"])({id:t[a]}).then((function(e){var t=e.data;200==t.code&&(r.pluginId=t.data.type)}));t.other_message&&(r.warningChecked=["email"])}Object(i["j"])((function(){return e.current_item}),(function(){d()}),{immediate:!0});var m=Object(i["h"])({name:[{required:!0,message:p["a"].t("AUTOMATION.ALARM_STRATEGY.PLACEHOLDER3")}],describe:[{required:!0,message:p["a"].t("AUTOMATION.ALARM_STRATEGY.PLACEHOLDER4")}],sensor:[{required:!0,message:p["a"].t("AUTOMATION.ALARM_STRATEGY.PLACEHOLDER5")}],bid:[{required:!0,message:p["a"].t("AUTOMATION.ALARM_STRATEGY.PLACEHOLDER6")}],"config.field":[{required:!0,message:p["a"].t("AUTOMATION.ALARM_STRATEGY.PLACEHOLDER7")}],"config.condition":[{required:!0,message:p["a"].t("AUTOMATION.ALARM_STRATEGY.PLACEHOLDER8")}],"config.value":[{required:!0,message:p["a"].t("AUTOMATION.ALARM_STRATEGY.PLACEHOLDER9")}]}),O=Object(i["i"])(!1);function b(){n.value.validate((function(t){t&&(o.value="",O.value||(O.value=!0,v(r).then((function(t){var a=t.data;200===a.code?(A(),r.id?e.update_alarm(e.current_item,r):e.add_alarm(r)):o.value=a.message})).finally((function(){O.value=!1}))))}))}function v(e){var t=JSON.parse(JSON.stringify(e));return t.config=JSON.stringify(t.config),e.id?Object(l["e"])(t):Object(l["c"])(t)}function A(){t.emit("update:alarmDialogVisible",!1)}var h=Object(c["default"])(r),_=h.triggerOptions,g=h.symbolOptions,T=h.operatorOptions;function j(){r.bid="",r.config=[{field:"",condition:"",value:""}]}function E(e,t){console.log("handleDeviceChange.deviceId",e),console.log("handleDeviceChange.pluginId",t),r.pluginId=t,console.log("handleDeviceChange.formData",r),r.config=[{field:"",condition:"",value:""}]}function D(){r.config.push({operator:"&&",field:"",condition:"",value:""})}function M(e){var t=r.config.indexOf(e);r.config.splice(t,1)}return{showDialog:a,alarmFormRef:n,formData:r,error_message:o,rules:m,handleSave:b,handleCancel:A,triggerOptions:_,symbolOptions:g,operatorOptions:T,handleAlarmChange:u,addLine:D,removeLine:M,handleDeviceGroupChange:j,handleDeviceChange:E}}}),O=m,b=a("2877"),v=Object(b["a"])(O,n,r,!1,null,"17ec988f",null);t["default"]=v.exports},aa98:function(e,t,a){"use strict";a.d(t,"g",(function(){return r})),a.d(t,"f",(function(){return i})),a.d(t,"j",(function(){return o})),a.d(t,"h",(function(){return u})),a.d(t,"i",(function(){return c})),a.d(t,"x",(function(){return l})),a.d(t,"b",(function(){return d})),a.d(t,"c",(function(){return s})),a.d(t,"t",(function(){return f})),a.d(t,"v",(function(){return p})),a.d(t,"w",(function(){return m})),a.d(t,"z",(function(){return O})),a.d(t,"r",(function(){return b})),a.d(t,"p",(function(){return v})),a.d(t,"A",(function(){return A})),a.d(t,"l",(function(){return h})),a.d(t,"a",(function(){return _})),a.d(t,"k",(function(){return g})),a.d(t,"e",(function(){return T})),a.d(t,"y",(function(){return j})),a.d(t,"q",(function(){return E})),a.d(t,"m",(function(){return D})),a.d(t,"n",(function(){return M})),a.d(t,"u",(function(){return I})),a.d(t,"o",(function(){return N})),a.d(t,"d",(function(){return C})),a.d(t,"s",(function(){return L}));var n=a("18a6");function r(e){return Object(n["a"])({url:"/index/show",method:"post",data:e})}function i(e){return Object(n["a"])({url:"/device/add_only",method:"post",data:e})}function o(e){return Object(n["a"])({url:"/device/update_only",method:"post",data:e})}function u(e){return Object(n["a"])({url:"/device/delete",method:"post",data:e})}function c(e){return Object(n["a"])({url:"/device/data",method:"post",data:e})}function l(e){return Object(n["a"])({url:"/structure/field",method:"post",data:e})}function d(e){return Object(n["a"])({url:"/kv/current",method:"post",data:e})}function s(e){return Object(n["a"])({url:"/kv/current/detail",method:"post",data:e})}function f(e){return Object(n["a"])({url:"/kv/history/data",method:"post",data:e})}function p(e){return Object(n["a"])({url:"/kv/statistic",method:"post",data:e})}function m(e){return Object(n["a"])({url:"/kv/statistic/batch",method:"post",data:e})}function O(e){return Object(n["a"])({url:"/device/operating_device",method:"post",data:e})}function b(e){return Object(n["a"])({url:"/device/list/tree",method:"post",data:e})}function v(e){return Object(n["a"])({url:"/device/data",method:"post",data:e})}function A(e){return Object(n["a"])({url:"/device/update_only",method:"post",data:e})}function h(e){return Object(n["a"])({url:"/tp_script/list",method:"post",data:e})}function _(e){return Object(n["a"])({url:"/tp_script/add",method:"post",data:e})}function g(e){return Object(n["a"])({url:"/tp_script/edit",method:"post",data:e})}function T(e){return Object(n["a"])({url:"/tp_script/delete",method:"post",data:e})}function j(e){return Object(n["a"])({url:"/tp_script/quiz",method:"post",data:e})}function E(e){return Object(n["a"])({url:"/device/status",method:"post",data:e})}function D(e){return Object(n["a"])({url:"/device/command/history/list",method:"post",data:e})}function M(e){return Object(n["a"])({url:"/device/command/list",method:"post",data:e})}function I(e){return Object(n["a"])({url:"/device/command/send",method:"post",data:e})}function N(e){return Object(n["a"])({url:"/device/event/history/list",method:"post",data:e})}function C(e){return Object(n["a"])({url:"/kv/history/delete",method:"post",data:e})}function L(){return Object(n["a"])({url:"/home/system/time",method:"post"})}},f1b1:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-select",{staticClass:"w-100",attrs:{clearable:e.clearable,filterable:e.filterable,placeholder:e.$t("AUTOMATION.PLACEHOLDER1"),"no-data-text":e.$t("COMMON.SELECT_NO_DATA")},on:{change:e.handleChange},model:{value:e.deviceId,callback:function(t){e.deviceId=t},expression:"deviceId"}},e._l(e.deviceOptions,(function(e,t){return a("el-option",{key:t,attrs:{value:e.id,label:e.name}})})),1)},r=[],i=(a("4de4"),a("d3b7"),a("7db0"),a("ed09")),o=a("9282"),u=Object(i["c"])({name:"DeviceSelector",props:{clearable:{default:!0},filterable:{default:!0},asset_id:{required:!0},device_id:{required:!0}},setup:function(e,t){var a=Object(i["i"])([]),n=Object(i["a"])({get:function(){return e.device_id},set:function(e){t.emit("update:device_id",e)}});function r(e){var n=a.value.find((function(t){return t.id==e}));t.emit("change",e,n.type)}return Object(i["j"])((function(){return e.asset_id}),(function(){var t=e.asset_id;t&&Object(o["b"])({asset_id:t}).then((function(e){var t=e.data;if(200===t.code&&t.data){var n=t.data.filter((function(e){return"2"!=e.device_type}));a.value=n}}))}),{immediate:!0}),{deviceId:n,deviceOptions:a,handleChange:r}}}),c=u,l=a("2877"),d=Object(l["a"])(c,n,r,!1,null,"9b524ad4",null);t["default"]=d.exports}}]);