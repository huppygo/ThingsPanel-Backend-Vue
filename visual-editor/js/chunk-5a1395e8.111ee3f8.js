(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5a1395e8","chunk-b1b45cee","chunk-2d21e594","chunk-2d0c1137"],{"3a4d":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{display:"flex"}},[a("el-select",{ref:"weekRef",staticStyle:{"margin-right":"10px"},on:{change:e.handleChange},model:{value:e.weekValue,callback:function(t){e.weekValue=t},expression:"weekValue"}},e._l(e.weekOptions,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1),""!=e.weekValue?a("el-time-picker",{ref:"timeRef",attrs:{"value-format":"HH:mm",placeholder:e.$t("AUTOMATION.PLACEHOLDER.SELECT_TIME")},on:{change:e.handleChange},model:{value:e.timeValue,callback:function(t){e.timeValue=t},expression:"timeValue"}}):e._e()],1)},i=[],r=(a("a9e3"),a("2fa3")),o=a("d4d2"),s={name:"WeeklySelector",props:{data:{type:[Object],default:function(){return{}}}},data:function(){return{weekValue:"",timeValue:"",weekOptions:[{label:this.$t("AUTOMATION.WEEK.MONDAY"),value:o["Week"].MONDAY},{label:this.$t("AUTOMATION.WEEK.TUESDAY"),value:o["Week"].THURSDAY},{label:this.$t("AUTOMATION.WEEK.WEDNESDAY"),value:o["Week"].WEDNESDAY},{label:this.$t("AUTOMATION.WEEK.THURSDAY"),value:o["Week"].THURSDAY},{label:this.$t("AUTOMATION.WEEK.FRIDAY"),value:o["Week"].FRIDAY},{label:this.$t("AUTOMATION.WEEK.SATURDAY"),value:o["Week"].SATURDAY},{label:this.$t("AUTOMATION.WEEK.SUDNAY"),value:o["Week"].SUNDAY}]}},watch:{data:{handler:function(e){e&&e.week&&e.time&&(console.log("RepeatTimeSelector",e),this.weekValue=Number(e.week),this.timeValue=e.time)},immediate:!0}},methods:{handleChange:function(){this.$emit("change",{week:this.weekValue,time:this.timeValue})},validate:function(){return this.weekValue&&""!==this.weekValue?!(!this.timeValue||""===this.timeValue)||(this.$refs.timeRef.focus(),Object(r["h"])(this.$t("AUTOMATION.ERROR.TIME")),!1):(this.$refs.weekRef.focus(),Object(r["h"])(this.$t("AUTOMATION.ERROR.WEEKLY")),!1)}}},l=s,c=a("2877"),d=Object(c["a"])(l,n,i,!1,null,"f5d5480c",null);t["default"]=d.exports},4500:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{display:"flex"}},[a("el-select",{ref:"dayRef",staticStyle:{"margin-right":"10px"},on:{change:e.handleDayChange},model:{value:e.formData.day,callback:function(t){e.$set(e.formData,"day",t)},expression:"formData.day"}},e._l(e.dayOptions,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1),""!=e.formData.day?a("el-time-select",{ref:"timeRef",attrs:{"value-format":"HH:mm",placeholder:e.$t("AUTOMATION.PLACEHOLDER.SELECT_TIME")},on:{change:e.handleTimeChange},model:{value:e.formData.time,callback:function(t){e.$set(e.formData,"time",t)},expression:"formData.time"}}):e._e()],1)},i=[],r=(a("e9c4"),a("2fa3")),o={name:"MonthlySelector",props:{data:{type:[Object],default:function(){return{}}}},data:function(){return{formData:{day:"",time:""},dayOptions:[]}},watch:{data:{handler:function(e){e&&(console.log("MonthlySelector",e),this.formData=JSON.parse(JSON.stringify(e)))},immediate:!0}},created:function(){for(var e=1;e<=31;e++)this.dayOptions.push({label:e+"日",value:e})},methods:{handleDayChange:function(e){this.$emit("change",this.formData)},handleTimeChange:function(e){this.$emit("change",this.formData)},validate:function(){return this.formData.day&&""!==this.formData.day?!(!this.formData.time||""===this.formData.time)||(this.$refs.timeRef.focus(),Object(r["h"])("请选择时间"),!1):(this.$refs.dayRef.focus(),Object(r["h"])("请选择日期"),!1)}}},s=o,l=a("2877"),c=Object(l["a"])(s,n,i,!1,null,"5fd5d356",null);t["default"]=c.exports},"51bd":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{display:"flex"}},[a("el-select",{ref:"typeRef",staticStyle:{width:"100px","margin-right":"10px"},on:{change:e.handleTypeChange},model:{value:e.formData.type,callback:function(t){e.$set(e.formData,"type",t)},expression:"formData.type"}},[a("el-option",{attrs:{label:e.$t("AUTOMATION.PERHOUR"),value:"perHour"}}),a("el-option",{attrs:{label:e.$t("AUTOMATION.DAYS"),value:"days"}}),a("el-option",{attrs:{label:e.$t("AUTOMATION.WEEKLY"),value:"weekly"}}),a("el-option",{attrs:{label:e.$t("AUTOMATION.MONTHLY"),value:"monthly"}}),a("el-option",{attrs:{label:e.$t("AUTOMATION.CUSTOM_CRON"),value:"cron"}})],1),"perHour"==e.formData.type?a("div",{staticStyle:{display:"flex"}},[a("el-input",{ref:"perHourRef",on:{change:e.handlePerHourChange},model:{value:e.formData.perHour,callback:function(t){e.$set(e.formData,"perHour",t)},expression:"formData.perHour"}}),a("el-tooltip",{attrs:{placement:"top"}},[a("div",{attrs:{slot:"content"},slot:"content"},[e._v(e._s(e.$t("AUTOMATION.TIP.PERHOUR")))]),a("i",{staticClass:"el-icon-info",staticStyle:{margin:"10px"}})])],1):"days"==e.formData.type?a("div",{staticStyle:{display:"flex"}},[a("el-time-picker",{ref:"daysRef",attrs:{"value-format":"HH:mm",placeholder:e.$t("AUTOMATION.PLACEHOLDER.SELECT_TIME")},on:{change:e.handleDaysChange},model:{value:e.formData.days,callback:function(t){e.$set(e.formData,"days",t)},expression:"formData.days"}}),a("el-tooltip",{attrs:{placement:"top"}},[a("div",{attrs:{slot:"content"},slot:"content"},[e._v(e._s(e.$t("AUTOMATION.TIP.DAYS")))]),a("i",{staticClass:"el-icon-info",staticStyle:{margin:"10px"}})])],1):"weekly"==e.formData.type?a("div",{staticStyle:{display:"flex"}},[a("WeeklySelector",{ref:"weeklyRef",attrs:{data:e.formData.weekly},on:{change:e.handleWeeklyChange}}),a("el-tooltip",{attrs:{placement:"top"}},[a("div",{attrs:{slot:"content"},slot:"content"},[e._v(e._s(e.$t("AUTOMATION.TIP.WEEKLY")))]),a("i",{staticClass:"el-icon-info",staticStyle:{margin:"10px"}})])],1):"monthly"==e.formData.type?a("div",{staticStyle:{display:"flex"}},[a("MonthlySelector",{ref:"monthlyRef",attrs:{data:e.formData.monthly},on:{change:e.handleMonthlyChange}}),a("el-tooltip",{attrs:{placement:"top"}},[a("div",{attrs:{slot:"content"},slot:"content"},[e._v(e._s(e.$t("AUTOMATION.TIP.MONTHLY")))]),a("i",{staticClass:"el-icon-info",staticStyle:{margin:"10px"}})])],1):e._e(),"cron"==e.formData.type?a("div",{staticStyle:{display:"flex"}},[a("el-input",{ref:"cronRef",on:{change:e.handleCronChange},model:{value:e.formData.cron,callback:function(t){e.$set(e.formData,"cron",t)},expression:"formData.cron"}}),a("el-tooltip",{attrs:{placement:"top"}},[a("div",{attrs:{slot:"content"},slot:"content"},[a("span",{staticStyle:{"margin-right":"20px"}},[e._v("0/2 * * * *")]),a("span",[e._v(e._s(e.$t("AUTOMATION.TIP.CRON.LINE1")))]),a("br"),a("span",{staticStyle:{"margin-right":"20px"}},[e._v("0 0/2 * * *")]),a("span",[e._v(e._s(e.$t("AUTOMATION.TIP.CRON.LINE2")))]),a("br"),a("span",{staticStyle:{"margin-right":"20px"}},[e._v("15 10 * * *")]),a("span",[e._v(e._s(e.$t("AUTOMATION.TIP.CRON.LINE3")))]),a("br"),a("span",{staticStyle:{"margin-right":"20px"}},[e._v("0/5 14 * * *")]),a("span",[e._v(e._s(e.$t("AUTOMATION.TIP.CRON.LINE4")))]),a("br"),a("span",{staticStyle:{"margin-right":"20px"}},[e._v("0/5 14,18 * * *")]),a("span",[e._v(e._s(e.$t("AUTOMATION.TIP.CRON.LINE5")))]),a("br"),a("span",{staticStyle:{"margin-right":"20px"}},[e._v("15 10 ? *")]),a("span",[e._v(e._s(e.$t("AUTOMATION.TIP.CRON.LINE6")))]),a("br"),a("span",{staticStyle:{"margin-right":"20px"}},[e._v("15 10 15 * *")]),a("span",[e._v(e._s(e.$t("AUTOMATION.TIP.CRON.LINE7")))])]),a("i",{staticClass:"el-icon-info",staticStyle:{margin:"10px"}})])],1):e._e()],1)},i=[],r=(a("e9c4"),a("3a4d")),o=a("4500"),s=a("2fa3"),l="0/2 * * * * 每2分钟触发\n0 0/2 * * * 每两小时触发<br/>15 10 * * * 每天上午的10:15触发<br/>0/5 14 * * *   在每天下午2点到下午2:55期间的每5分钟触发<br/>0/5 14,18 * * *      在每天下午2点到2:55期间和下午6点到6:55期间的每5分钟触发<br/>15 10 ? * MON-FRI   周一至周五的上午10:15触发<br/>15 10 15 * *  每月15日上午10:15触发",c={name:"RepeatTimeSelector",components:{WeeklySelector:r["default"],MonthlySelector:o["default"]},props:{data:{type:[Object],default:function(){return{}}}},data:function(){return{cronTip:l,formData:{type:"",perHour:"",day:"",weekly:{},monthly:{},cron:""}}},watch:{data:{handler:function(e){e&&(console.log("RepeatTimeSelector",e),this.formData=JSON.parse(JSON.stringify(e)))},immediate:!0}},methods:{handleTypeChange:function(e){this.$emit("change",{type:e})},handlePerHourChange:function(e){this.$emit("change",{type:"perHour",perHour:e})},handleDaysChange:function(e){console.log("handleDaysChange"),this.$emit("change",{type:"days",days:e})},handleWeeklyChange:function(e){this.$emit("change",{type:"weekly",weekly:e})},handleMonthlyChange:function(e){this.$emit("change",{type:"monthly",monthly:e})},handleCronChange:function(e){this.$emit("change",{type:"cron",cron:e})},validate:function(){return this.formData.type&&""!==this.formData.type?"perHour"!==this.formData.type||this.formData.perHour&&""!==this.formData.perHour?"days"!==this.formData.type||this.formData.days&&""!==this.formData.days?"cron"!==this.formData.type||this.formData.cron&&""!==this.formData.cron?!(this.$refs.weeklyRef&&!this.$refs.weeklyRef.validate())&&!(this.$refs.monthlyRef&&!this.$refs.monthlyRef.validate()):(this.$refs.cronRef.focus(),Object(s["h"])(this.$t("AUTOMATION.ERROR.CRON")),!1):(this.$refs.daysRef.focus(),Object(s["h"])(this.$t("AUTOMATION.ERROR.DAYS")),!1):(this.$refs.perHourRef.focus(),Object(s["h"])(this.$t("AUTOMATION.ERROR.PERHOUR")),!1):(this.$refs.typeRef.focus(),Object(s["h"])(this.$t("AUTOMATION.ERROR.DATE_TYPE")),!1)}}},d=c,u=a("2877"),p=Object(u["a"])(d,n,i,!1,null,"7cbed0b2",null);t["default"]=p.exports},d4d2:function(e,t,a){"use strict";a.r(t),a.d(t,"setConditions",(function(){return p})),a.d(t,"setActions",(function(){return f})),a.d(t,"getConditions",(function(){return y})),a.d(t,"getActions",(function(){return h})),a.d(t,"ConditionType",(function(){return i})),a.d(t,"StateMode",(function(){return r})),a.d(t,"TimeType",(function(){return s})),a.d(t,"RepeatTimeType",(function(){return l})),a.d(t,"Week",(function(){return c})),a.d(t,"ActionType",(function(){return d})),a.d(t,"CommandType",(function(){return u}));var n=a("5530"),i=(a("7db0"),a("d3b7"),a("b64b"),a("b0c0"),a("38cf"),a("25f0"),a("159b"),a("e9c4"),a("a9e3"),a("a15b"),a("ac1f"),a("1276"),{device:"1",time:"2",getKey:function(e){return Object.keys(i).find((function(t){return i[t]===e}))}}),r={property:"1",event:"2",onlineState:"3",onlineDuration:"4",getKey:function(e){return Object.keys(r).find((function(t){return r[t]===e}))}},o={online:"1",offline:"2",onAndOff:"3",getKey:function(e){return Object.keys(o).find((function(t){return o[t]===e}))}},s={range:"0",once:"1",repeat:"2",custom:"3",getKey:function(e){return Object.keys(s).find((function(t){return s[t]===e}))}},l={perHour:"1",days:"2",weekly:"3",monthly:"4",cron:"5",getKey:function(e){return Object.keys(l).find((function(t){return l[t]===e}))}},c={SUNDAY:1,MONDAY:2,TUESDAY:3,WEDNESDAY:4,THURSDAY:5,FRIDAY:6,SATURDAY:7},d={device:"1",alarm:"2",scene:"3",getKey:function(e){return Object.keys(d).find((function(t){return d[t]===e}))}},u={property:1,service:2};function p(e){var t=1,a=function(e){var a={};if(console.log("Object.keys(c)",e),"device"===e.type)a={condition_type:i.device,device_id:e.data.deviceId,device_condition_type:r[e.data.state.mode]},a.device_condition_type===r.property?(a["v1"]=e.data.state.name,a["v2"]=e.data.state.operator.symbol,a["v3"]=e.data.state.operator.value):a.device_condition_type===r.onlineState&&(a["v2"]=o[e.data.state.name]);else if("time"===e.type){switch(console.log("时间条件",e),a={condition_type:i.time,time_condition_type:s[e.data.type]},a.time_condition_type){case s.once:a["v1"]=e.data.once.value;break;case s.repeat:var n=e.data.repeat;switch(a["v1"]=l[n.type].toString(),l[n.type]){case l.perHour:a["v3"]=n.perHour.toString();break;case l.days:a["v3"]=n.days.toString();break;case l.weekly:var c=n.weekly.week;a["v3"]=c.toString(),a["v4"]=n.weekly.time.toString();break;case l.monthly:a["v3"]=n.monthly.day.toString()+":"+n.monthly.time.toString();break;case l.cron:a["v3"]=n.cron.toString()}break;case s.range:a["v1"]=e.data.range[0],a["v2"]=e.data.range[1];break}console.log("setConditions",a)}return e.relation&&"or"==e.relation&&t++,a.group_number=t,a},n=[];return e.length>0&&e.forEach((function(e){n.push(a(e))})),n}function f(e,t){var a=function(e){var a={};switch(a.action_type=d[e.type],console.log("====washAction",e,a),a.action_type){case d.device:e.data.forEach((function(e){var t={};t[e.state.name]=e.state.operator.value;var r={device_model:"1",instruct:t};i.push(Object(n["a"])(Object(n["a"])({},a),{},{device_id:e.deviceId,additional_info:JSON.stringify(r)}))}));break;case d.scene:a.scenario_strategy_id=e.value||"",i.push(a);break;case d.alarm:a.warning_strategy={},a.warning_strategy.id=e.data.id?e.data.id:"",a.warning_strategy.warning_strategy_name=t,a.warning_strategy.warning_level=e.data.warningLevel,a.warning_strategy.group=e.data.group,a.warning_strategy.repeat_count=Number(e.data.repeatTimes),a.warning_strategy.inform_way=e.data.notification.join(","),a.warning_strategy.warning_description=e.data.warning_description,i.push(a);break}},i=[];return e.length>0&&e.forEach((function(e){a(e)})),i}function y(e){var t=[],a=1;return console.log("getConditions",e),e&&e.length>0?e.forEach((function(e,n){console.log(n,e.group_number);var c=e.group_number,d={};if(0===n?d.relation="":c===a?d.relation="and":c>a&&(d.relation="or",a=c),e.condition_type==i.device){d.type=i.getKey(e.condition_type),d.data={projectId:e.business_id,groupId:e.asset_id,deviceId:e.device_id};var u="";switch(e.device_condition_type){case r.property:u=e.v1;break;case r.onlineState:u=o.getKey(e.v2);break}console.log(d.data.state),d.data.state={name:u,mode:r.getKey(e.device_condition_type),operator:{symbol:e.v2,value:e.v3}}}else switch(d.type=i.getKey(e.condition_type),d.data={type:s.getKey(e.time_condition_type)},e.time_condition_type){case s.once:d.data.once={value:e.v1};break;case s.repeat:switch(d.data.repeat={type:l.getKey(e.v1)},e.v1){case l.perHour:d.data.repeat.perHour=e.v3;break;case l.days:d.data.repeat.days=e.v3;break;case l.weekly:d.data.repeat.weekly={week:e.v3,time:e.v4};break;case l.monthly:var p=e.v3.split(":");d.data.repeat.monthly={day:p[0],time:p[1]+":"+p[2]};break;case l.cron:d.data.repeat.cron=e.v3;break}break;case s.range:d.data.range=[e.v1,e.v2];break;case s.custom:break}t.push(d)})):t.push({}),t}function h(e){var t=[],a=[];return e.forEach((function(e){var n={};if(e.action_type===d.device){var i={projectId:e.business_id,groupId:e.asset_id,deviceId:e.device_id,state:{}},r=e.additional_info?JSON.parse(e.additional_info):{},o=Object.keys(r.instruct||{})[0];i.state={name:o,mode:"property",operator:{symbol:"",value:r.instruct?r.instruct[o]:""}},a.push(i)}else if(e.action_type===d.alarm){var s,l,c,u,p;n.type="alarm",n.data={id:(null===(s=e.warning_strategy)||void 0===s?void 0:s.id)||"",warningLevel:(null===(l=e.warning_strategy)||void 0===l?void 0:l.warning_level)||"",repeatTimes:(null===(c=e.warning_strategy)||void 0===c?void 0:c.repeat_count)||0,notification:(null===(u=e.warning_strategy)||void 0===u?void 0:u.inform_way.split(","))||[],warning_description:(null===(p=e.warning_strategy)||void 0===p?void 0:p.warning_description)||""},t.push(n)}else e.action_type===d.scene&&(n.type="scene",n.value=e.scenario_strategy_id,t.push(n))})),a.length>0&&t.push({type:"device",data:a}),console.log("getActions.actionList",t),t}}}]);