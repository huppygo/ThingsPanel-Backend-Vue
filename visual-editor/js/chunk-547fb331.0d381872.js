(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-547fb331","chunk-2d212c35"],{7509:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticStyle:{"justify-content":"space-between",display:"flex","margin-bottom":"10px"}},[a("span",[t._v(t._s(t.subscribeTitle))]),a("el-button",{attrs:{type:"border",size:"medium"},on:{click:t.getList}},[t._v("刷新")])],1),a("div",{staticStyle:{display:"flex",float:"left","margin-bottom":"10px"}},[a("el-button",{attrs:{type:"border",size:"medium"},on:{click:function(e){t.commandDialogVisible=!0}}},[t._v("下发命令")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{data:t.tableData}},[a("el-table-column",{attrs:{label:"命令标识符",prop:"command_identify",width:"240"}}),a("el-table-column",{attrs:{label:"命令参数",prop:"data",width:"auto"}}),a("el-table-column",{attrs:{label:"命令下发时间",prop:"send_time",width:"auto"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.dateFormat(e.row.send_time))+" ")]}}])}),a("el-table-column",{attrs:{label:"状态",prop:"send_status",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s("1"==e.row.send_status?t.$t("AUTOMATION.SUCEESSFUL"):t.$t("AUTOMATION.FAILURE"))+" ")]}}])})],1),a("div",{staticClass:"text-right py-3"},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:t.total,"current-page":t.params.current_page,"page-size":t.params.per_page},on:{"update:currentPage":function(e){return t.$set(t.params,"current_page",e)},"update:current-page":function(e){return t.$set(t.params,"current_page",e)},"current-change":t.getList}})],1),a("el-dialog",{attrs:{title:"下发命令","append-to-body":!0,visible:t.commandDialogVisible,width:"30%","before-close":t.handleClose},on:{"update:visible":function(e){t.commandDialogVisible=e}}},[a("el-form",{ref:"ruleFormRef",staticClass:"el-dark-input",attrs:{"label-position":"left",model:t.commandFormData,rules:t.commandFormRule,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"命令标识符",prop:"command_identifier"}},[a("el-select",{attrs:{filterable:"","allow-create":""},on:{change:t.handleChangeCommandId},model:{value:t.commandFormData.command_identifier,callback:function(e){t.$set(t.commandFormData,"command_identifier",e)},expression:"commandFormData.command_identifier"}},t._l(t.commands,(function(e,n){return a("el-option",{key:n,attrs:{label:e.commandName,value:e.commandId}},[a("span",{staticStyle:{float:"left"}},[t._v(t._s(e.commandName))]),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[t._v(t._s(e.commandId))])])})),1)],1),a("el-form-item",{attrs:{label:"命令参数",prop:"command_data"}},[a("el-input",{attrs:{type:"textarea",rows:12},model:{value:t.commandFormData.command_data,callback:function(e){t.$set(t.commandFormData,"command_data",e)},expression:"commandFormData.command_data"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"cancel"},on:{click:t.handleClose}},[t._v("取消")]),a("el-button",{attrs:{type:"save"},on:{click:t.handleSendCommand}},[t._v("发送")])],1)],1)],1)},o=[],r=a("5530"),i=(a("c740"),a("d3b7"),a("159b"),a("e9c4"),a("aa98")),d=a("2fa3"),c=a("3de1"),u={components:{},props:{device:{type:[Object],default:function(){return{}}}},data:function(){return{dateFormat:c["a"],loading:!1,tableData:[],total:0,params:{current_page:1,per_page:10},commandDialogVisible:!1,commandFormData:{command_data:"{}"},commands:[],commandFormRule:{command_identifier:[{required:!0,message:"请选择命令标识符",trigger:"change"}],command_data:[{required:!0,message:"请输入命令内容",trigger:"blur"}]},subscribeTitle:"设备订阅命令主题:  device/command/"+this.device.token}},mounted:function(){"1"===this.device.device_type?this.subscribeTitle="设备订阅命令主题:  device/command/"+this.device.token:"2"===this.device.device_type&&"MQTT"===this.device.protocol?this.subscribeTitle="设备订阅命令主题:  gateway/command/"+this.device.token:this.subscribeTitle="",console.log("Command.device",this.device),this.getList(),this.getDeviceCommandList()},methods:{getList:function(){var t=this;Object(i["m"])(Object(r["a"])({device_id:this.device.device},this.params)).then((function(e){var a=e.data;200===a.code&&(t.tableData=a.data.data,t.total=a.data.total,console.log(t.tableData))}))},getDeviceCommandList:function(){var t=this;Object(i["n"])({device_id:this.device.device}).then((function(e){var a=e.data;200===a.code&&(t.commands=a.data)}))},handleChangeCommandId:function(t){var e=this;this.commands.findIndex((function(a){if(a.commandId===t){console.log("command.commandParams",a.commandParams);var n={};a.commandParams.forEach((function(t){switch(t.type.toLowerCase()){case"text":n[t.identifier]="";break;case"integer":case"float":case"number":n[t.identifier]=0;break;case"object":n[t.identifier]={};break;case"list":n[t.identifier]=[];break;default:n[t.identifier]="";break}})),e.commandFormData.command_data=JSON.stringify(n,null,4),console.log("params",n)}})),console.log("handleChangeCommandId",t,this.commands)},handleSendCommand:function(){var t=this;this.$refs["ruleFormRef"].validate((function(e){if(!e)return!1;Object(i["u"])(Object(r["a"])({device_id:t.device.device},t.commandFormData)).then((function(e){var a=e.data;200===a.code&&(Object(d["i"])("命令下发成功"),t.commandDialogVisible=!1,t.getList())}))}))},handleClose:function(){this.commandDialogVisible=!1}}},s=u,l=a("2877"),m=Object(l["a"])(s,n,o,!1,null,"20a3b64b",null);e["default"]=m.exports},aa98:function(t,e,a){"use strict";a.d(e,"g",(function(){return o})),a.d(e,"f",(function(){return r})),a.d(e,"j",(function(){return i})),a.d(e,"h",(function(){return d})),a.d(e,"i",(function(){return c})),a.d(e,"x",(function(){return u})),a.d(e,"b",(function(){return s})),a.d(e,"c",(function(){return l})),a.d(e,"t",(function(){return m})),a.d(e,"v",(function(){return f})),a.d(e,"w",(function(){return p})),a.d(e,"z",(function(){return b})),a.d(e,"r",(function(){return h})),a.d(e,"p",(function(){return v})),a.d(e,"A",(function(){return g})),a.d(e,"l",(function(){return _})),a.d(e,"a",(function(){return O})),a.d(e,"k",(function(){return j})),a.d(e,"e",(function(){return y})),a.d(e,"y",(function(){return k})),a.d(e,"q",(function(){return w})),a.d(e,"m",(function(){return D})),a.d(e,"n",(function(){return C})),a.d(e,"u",(function(){return F})),a.d(e,"o",(function(){return x})),a.d(e,"d",(function(){return S})),a.d(e,"s",(function(){return T}));var n=a("18a6");function o(t){return Object(n["a"])({url:"/index/show",method:"post",data:t})}function r(t){return Object(n["a"])({url:"/device/add_only",method:"post",data:t})}function i(t){return Object(n["a"])({url:"/device/update_only",method:"post",data:t})}function d(t){return Object(n["a"])({url:"/device/delete",method:"post",data:t})}function c(t){return Object(n["a"])({url:"/device/data",method:"post",data:t})}function u(t){return Object(n["a"])({url:"/structure/field",method:"post",data:t})}function s(t){return Object(n["a"])({url:"/kv/current",method:"post",data:t})}function l(t){return Object(n["a"])({url:"/kv/current/detail",method:"post",data:t})}function m(t){return Object(n["a"])({url:"/kv/history/data",method:"post",data:t})}function f(t){return Object(n["a"])({url:"/kv/statistic",method:"post",data:t})}function p(t){return Object(n["a"])({url:"/kv/statistic/batch",method:"post",data:t})}function b(t){return Object(n["a"])({url:"/device/operating_device",method:"post",data:t})}function h(t){return Object(n["a"])({url:"/device/list/tree",method:"post",data:t})}function v(t){return Object(n["a"])({url:"/device/data",method:"post",data:t})}function g(t){return Object(n["a"])({url:"/device/update_only",method:"post",data:t})}function _(t){return Object(n["a"])({url:"/tp_script/list",method:"post",data:t})}function O(t){return Object(n["a"])({url:"/tp_script/add",method:"post",data:t})}function j(t){return Object(n["a"])({url:"/tp_script/edit",method:"post",data:t})}function y(t){return Object(n["a"])({url:"/tp_script/delete",method:"post",data:t})}function k(t){return Object(n["a"])({url:"/tp_script/quiz",method:"post",data:t})}function w(t){return Object(n["a"])({url:"/device/status",method:"post",data:t})}function D(t){return Object(n["a"])({url:"/device/command/history/list",method:"post",data:t})}function C(t){return Object(n["a"])({url:"/device/command/list",method:"post",data:t})}function F(t){return Object(n["a"])({url:"/device/command/send",method:"post",data:t})}function x(t){return Object(n["a"])({url:"/device/event/history/list",method:"post",data:t})}function S(t){return Object(n["a"])({url:"/kv/history/delete",method:"post",data:t})}function T(){return Object(n["a"])({url:"/home/system/time",method:"post"})}}}]);