(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d4ddc5c","chunk-7ba597da","chunk-08889ec6","chunk-b534a8e6","chunk-293af22b","chunk-171dd702","chunk-2d21dc08","chunk-2d21e3e2"],{"2aec":function(t,e,a){},"373a":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"command-device-box"},t._l(t.commands,(function(e,n){return a("div",{key:n,staticStyle:{display:"flex","margin-bottom":"10px"}},[a("DeviceTypeSelector",{ref:"deviceTypeRef",refInFor:!0,attrs:{option:{operator:!1,mode:"action"},data:e},on:{change:function(a){return t.handleCommandChange(e,a)}}}),0==n?a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"indigo",size:"small"},on:{click:t.handleAddCommand}},[t._v(t._s(t.$t("AUTOMATION.ADD_LINE")))]):t._e(),n>0?a("el-button",{staticStyle:{"margin-left":"auto"},attrs:{type:"danger",size:"small"},on:{click:function(a){return t.handleDeleteCommand(e)}}},[t._v(t._s(t.$t("AUTOMATION.DELETE")))]):t._e()],1)})),0)},i=[],o=(a("e9c4"),a("c740"),a("a434"),a("5c97")),r={name:"CommandDevice",components:{DeviceTypeSelector:o["default"]},props:{data:{type:[Array],default:function(){return[]}}},data:function(){return{commands:[]}},watch:{data:{handler:function(t){console.log("CommandDevice.data",t),t&&t.length>0?this.commands=JSON.parse(JSON.stringify(t)):this.commands=[{}]},immediate:!0,deep:!0}},methods:{handleCommandChange:function(t,e){for(var a in e)t[a]=e[a];this.$emit("change",this.commands)},handleAddCommand:function(){this.commands.push({})},handleDeleteCommand:function(t){var e=this.commands.findIndex((function(e){return e==t}));this.commands.splice(e,1)},validate:function(){for(var t=0;t<this.commands.length;t++)if(this.$refs.deviceTypeRef&&!this.$refs.deviceTypeRef[t].validate())return!1;return!0}}},s=r,c=(a("d8e4"),a("2877")),l=Object(c["a"])(s,n,i,!1,null,"1af50c93",null);e["default"]=l.exports},"507f":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"scene-device-box",staticStyle:{display:"flex"}},[t._v(" "+t._s(t.$t("AUTOMATION.ACTIVATE"))),a("span",{staticStyle:{color:"red","margin-left":"6px"}},[t._v("*")]),a("el-select",{ref:"sceneIdRef",staticStyle:{width:"300px","margin-left":"10px","margin-right":"10px"},attrs:{"no-data-text":t.$t("COMMON.SELECT_NO_DATA")},on:{change:t.handleChange},model:{value:t.sceneId,callback:function(e){t.sceneId=e},expression:"sceneId"}},t._l(t.options,(function(t,e){return a("el-option",{key:e,attrs:{label:t.scenario_name,value:t.id}})})),1)],1)},i=[],o=a("6d73"),r=a("2fa3"),s={name:"SceneSelector",props:{value:{type:[String],default:""}},data:function(){return{sceneId:"",options:[]}},created:function(){this.getSceneList()},methods:{getSceneList:function(){var t=this;o["a"].Scene.list({current_page:1,per_page:9999}).then((function(e){var a,n=e.data;200===n.code&&(t.options=(null===(a=n.data)||void 0===a?void 0:a.data)||[],t.sceneId=t.value)}))},handleChange:function(t){this.$emit("change",t)},validate:function(){return!(!this.sceneId||""===this.sceneId)||(this.$refs.sceneIdRef.focus(),Object(r["h"])($t("AUTOMATION.ERROR.SCENE")),!1)}}},c=s,l=(a("f7c2"),a("2877")),d=Object(l["a"])(c,n,i,!1,null,"0782eaf4",null);e["default"]=d.exports},6324:function(t,e,a){"use strict";a("2aec")},"6d73":function(t,e,a){"use strict";var n=a("18a6");e["a"]={Scene:{list:function(t){return Object(n["a"])({url:"/scenario/strategy/list",method:"post",data:t})},add:function(t){return Object(n["a"])({url:"/scenario/strategy/add",method:"post",data:t})},edit:function(t){return Object(n["a"])({url:"/scenario/strategy/edit",method:"post",data:t})},delete:function(t){return Object(n["a"])({url:"/scenario/strategy/delete",method:"post",data:t})},get:function(t){return Object(n["a"])({url:"/scenario/strategy/detail",method:"post",data:t})},logList:function(t){return Object(n["a"])({url:"/v1/scenario/log/list",method:"post",data:t})},logDetail:function(t){return Object(n["a"])({url:"/v1/scenario/log/detail/list",method:"post",data:t})},active:function(t){return Object(n["a"])({url:"/scenario/strategy/activate",method:"post",data:t})}},Control:{add:function(t){return Object(n["a"])({url:"/v1/automation/add",method:"post",data:t})},edit:function(t){return Object(n["a"])({url:"/v1/automation/edit",method:"post",data:t})},delete:function(t){return Object(n["a"])({url:"/v1/automation/delete",method:"post",data:t})},enabled:function(t){return Object(n["a"])({url:"/v1/automation/enabled",method:"post",data:t})},list:function(t){return Object(n["a"])({url:"/v1/automation/list",method:"post",data:t})},get:function(t){return Object(n["a"])({url:"/v1/automation/detail",method:"post",data:t})},logList:function(t){return Object(n["a"])({url:"/v1/automation/log/list",method:"post",data:t})},logDetail:function(t){return Object(n["a"])({url:"/v1/automation/log/detail/list",method:"post",data:t})}}}},"7e7b":function(t,e,a){},"9eab":function(t,e,a){},b470:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{width:"100%"}},[a("el-form-item",{attrs:{label:t.$t("AUTOMATION.IF")}},t._l(t.conditions,(function(e,n){return a("div",{key:n,staticStyle:{display:"flex","margin-bottom":"10px"}},[e.relation?a("el-select",{ref:"relationRef",refInFor:!0,staticStyle:{position:"absolute",width:"60px","margin-right":"10px"},attrs:{"no-data-text":t.$t("COMMON.SELECT_NO_DATA"),placeholder:""},on:{change:function(a){return t.handleRelationChange(e,a)}},model:{value:e.relation,callback:function(a){t.$set(e,"relation",a)},expression:"condition.relation"}},[a("el-option",{attrs:{label:t.$t("AUTOMATION.AND"),value:"and"}}),a("el-option",{attrs:{label:t.$t("AUTOMATION.OR"),value:"or"}})],1):t._e(),a("el-select",{ref:"typeRef",refInFor:!0,staticStyle:{width:"140px","margin-left":"70px","margin-right":"10px"},attrs:{"no-data-text":t.$t("COMMON.SELECT_NO_DATA"),placeholder:t.$t("COMMON.PLACEHOLDER5")},model:{value:e.type,callback:function(a){t.$set(e,"type",a)},expression:"condition.type"}},[a("el-option",{attrs:{label:t.$t("AUTOMATION.DEVICE_CONDITION"),value:"device"}}),a("el-option",{attrs:{label:t.$t("AUTOMATION.TIME_CONDITION"),value:"time"}})],1),"device"==e.type?["device"==e.type?a("DeviceTypeSelector",{ref:"deviceTypeSelectorRef",refInFor:!0,staticStyle:{width:"100%"},attrs:{data:e.data},on:{change:function(a){return t.handleDeviceChange(e,a)}}}):t._e()]:"time"==e.type?a("TimeTypeSelector",{ref:"timeTypeSelectorRef",refInFor:!0,attrs:{data:e.data},on:{change:function(a){return t.handleTimeChange(e,a)}}}):t._e(),a("div",{staticStyle:{width:"120px","margin-left":"auto",height:"40px"}},[0==n?a("el-button",{staticStyle:{"margin-left":"auto",height:"40px"},attrs:{type:"indigo",size:"small"},on:{click:t.handleAddCondition}},[t._v(t._s(t.$t("AUTOMATION.ADD_LINE")))]):t._e(),n>0?a("el-button",{staticStyle:{"margin-left":"auto",height:"40px"},attrs:{type:"danger",size:"small"},on:{click:function(a){return t.handleDeleteCondition(e)}}},[t._v(t._s(t.$t("AUTOMATION.DELETE")))]):t._e()],1)],2)})),0)],1)},i=[],o=(a("e9c4"),a("c740"),a("a434"),a("d40c")),r=a("5c97"),s=a("2fa3"),c={name:"ConditionForm",components:{DeviceTypeSelector:r["default"],TimeTypeSelector:o["default"]},props:{data:{type:[Array],default:function(){return[]}}},data:function(){return{conditions:[]}},watch:{data:{handler:function(t){t&&(this.conditions=JSON.parse(JSON.stringify(t)))},immediate:!0}},methods:{handleAddCondition:function(){this.conditions.push({type:"device",relation:"and",data:{}})},handleDeleteCondition:function(t){var e=this.conditions.findIndex((function(e){return e==t}));this.conditions.splice(e,1),this.$emit("change",this.conditions)},handleRelationChange:function(t,e){t.relation=e,this.$emit("change",this.conditions)},handleDeviceChange:function(t,e){t.data=e,this.$emit("change",this.conditions)},handleTimeChange:function(t,e){t.data=JSON.parse(JSON.stringify(e)),this.$emit("change",this.conditions)},validate:function(){for(var t=0;t<this.conditions.length;t++){var e=this.conditions[t];if(t>0&&(!e.relation||""===e.relation))return this.$refs.relationRef[t]&&this.$refs.relationRef[t].focus(),Object(s["h"])(this.$t("AUTOMATION.ERROR.RELATION")),!1;if(!e.type||""===e.type)return this.$refs.typeRef[t].focus(),Object(s["h"])(this.$t("AUTOMATION.ERROR.CONDITION_TYPE")),!1}if(this.$refs.deviceTypeSelectorRef)for(var a=0;a<this.$refs.deviceTypeSelectorRef.length;a++){var n=this.$refs.deviceTypeSelectorRef[a];if(!n.validate())return!1}if(this.$refs.timeTypeSelectorRef)for(var i=0;i<this.$refs.timeTypeSelectorRef.length;i++){var o=this.$refs.timeTypeSelectorRef[i];if(!o.validate())return!1}return!0}}},l=c,d=a("2877"),u=Object(d["a"])(l,n,i,!1,null,"034d07cf",null);e["default"]=u.exports},d347:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{display:"flex"}},[a("el-date-picker",{ref:"startRef",staticStyle:{"margin-right":"10px",width:"270px"},attrs:{clearable:!1,format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",placeholder:t.$t("AUTOMATION.PLACEHOLDER.START_DATE")+" YYYY-MM-DD hh:mm:ss"},on:{change:t.handleChange},model:{value:t.startValue,callback:function(e){t.startValue=e},expression:"startValue"}}),a("el-date-picker",{ref:"endRef",staticStyle:{"margin-right":"10px",width:"270px"},attrs:{clearable:!1,format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",placeholder:t.$t("AUTOMATION.PLACEHOLDER.END_DATE")+" YYYY-MM-DD hh:mm:ss"},on:{change:t.handleChange},model:{value:t.endValue,callback:function(e){t.endValue=e},expression:"endValue"}})],1)},i=[],o=a("2fa3"),r={name:"DateRangeSelector",props:{value:{type:[Array],default:function(){return["",""]}}},data:function(){return{}},computed:{startValue:{get:function(){return this.value&&this.value.length>0?this.value[0]:""},set:function(t){this.$emit("update:value",[t,this.endValue])}},endValue:{get:function(){return this.value&&this.value.length>1?this.value[1]:""},set:function(t){this.$emit("update:value",[this.startValue,t])}}},methods:{handleChange:function(t){this.$emit("change",[this.startValue,this.endValue])},validate:function(){return this.startValue?!!this.endValue||(this.$refs.endRef.focus(),Object(o["h"])(this.$t("AUTOMATION.ERROR.END_DATE")),!1):(this.$refs.startRef.focus(),Object(o["h"])(this.$t("AUTOMATION.ERROR.START_DATE")),!1)}}},s=r,c=a("2877"),l=Object(c["a"])(s,n,i,!1,null,"a9443820",null);e["default"]=l.exports},d40c:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{display:"flex"}},[a("el-select",{ref:"typeRef",staticStyle:{width:"100px","margin-right":"10px"},on:{change:t.handleTimeTypeChange},model:{value:t.formData.type,callback:function(e){t.$set(t.formData,"type",e)},expression:"formData.type"}},[a("el-option",{attrs:{label:t.$t("AUTOMATION.ONCE"),value:"once"}}),a("el-option",{attrs:{label:t.$t("AUTOMATION.REPEAT"),value:"repeat"}}),a("el-option",{attrs:{label:t.$t("AUTOMATION.RANGE"),value:"range"}})],1),"once"==t.formData.type?a("OnceTimeSelector",{ref:"onceRef",attrs:{data:t.formData.once},on:{change:t.handleOnceTimeChange}}):"repeat"==t.formData.type?a("RepeatTimeSelector",{ref:"repeatRef",attrs:{data:t.formData.repeat},on:{change:t.handleRepeatTimeChange}}):"range"==t.formData.type?a("DateRangeSelector",{ref:"rangeRef",attrs:{value:t.formData.range},on:{"update:value":function(e){return t.$set(t.formData,"range",e)},change:t.handleDateRangeChange}}):t._e()],1)},i=[],o=(a("e9c4"),a("38cf"),a("d572")),r=a("a351"),s=a("d347"),c=a("2fa3"),l={name:"TimeTypeSelector",components:{OnceTimeSelector:o["default"],RepeatTimeSelector:r["default"],DateRangeSelector:s["default"]},props:{data:{type:[Object],default:function(){}}},data:function(){return{value:"",formData:{type:"once",once:{},repeat:{},range:{}},params:{type:"",once:{},repeat:{},range:""}}},watch:{data:{handler:function(t){t&&(console.log("TimeTypeSelector.data",t),this.formData=JSON.parse(JSON.stringify(t)))},immediate:!0}},methods:{handleTimeTypeChange:function(t){this.initParams(),this.params.type=t,this.updateData()},handleOnceTimeChange:function(t){this.initParams(),this.params.type="once",this.params.once={value:t},this.updateData()},handleRepeatTimeChange:function(t){this.initParams(),this.params.type="repeat",this.params.repeat=t,this.updateData()},handleDateRangeChange:function(t){this.initParams(),this.params.type="range",this.params.range=t,this.updateData()},initParams:function(){this.params={type:"",once:{},repeat:{}}},updateData:function(){console.log("TimeTypeSelector",this.params),this.$emit("change",this.params)},validate:function(){return this.formData.type&&""!==this.formData.type?this.$refs.onceRef&&this.$refs.onceRef.validate()||this.$refs.rangeRef&&this.$refs.rangeRef.validate()||this.$refs.repeatRef&&this.$refs.repeatRef.validate():(this.$refs.typeRef.focus(),Object(c["h"])(this.$t("AUTOMATION.ERROR.TIME_TYPE")),!1)}}},d=l,u=a("2877"),f=Object(u["a"])(d,n,i,!1,null,"5858bd98",null);e["default"]=f.exports},d4ea:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"el-dark-dialog",attrs:{title:t.formData.id?t.$t("AUTOMATION.EDIT_RULE"):t.$t("AUTOMATION.ADD_RULE"),"close-on-click-modal":!1,visible:t.dialogVisible,height:"60%",top:"10vh","custom-class":"edit-dialog"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-form",{ref:"formRules",attrs:{"label-position":"left","label-width":"85px",model:t.formData}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:t.$t("AUTOMATION.RULE_NAME"),required:""}},[a("el-input",{ref:"nameRef",model:{value:t.formData.automation_name,callback:function(e){t.$set(t.formData,"automation_name",e)},expression:"formData.automation_name"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:t.$t("AUTOMATION.RULE_DESCRIBE")}},[a("el-input",{ref:"describeRef",model:{value:t.formData.automation_described,callback:function(e){t.$set(t.formData,"automation_described",e)},expression:"formData.automation_described"}})],1)],1),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:t.$t("AUTOMATION.PRIORITY")}},[a("div",{staticStyle:{display:"inline-flex"}},[a("el-input-number",{ref:"priorityRef",attrs:{min:0,max:100},model:{value:t.formData.priority,callback:function(e){t.$set(t.formData,"priority",e)},expression:"formData.priority"}}),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.$t("AUTOMATION.TIP.PRIORITY"),placement:"top-start"}},[a("i",{staticClass:"el-icon-info",staticStyle:{"margin-left":"10px","margin-top":"10px"}})])],1)])],1)],1),a("ConditionForm",{ref:"conditionRef",attrs:{data:t.formData.conditions},on:{change:t.handleConditionChange}}),a("ActionForm",{ref:"actionRef",attrs:{data:t.formData.actions},on:{change:t.handleActionChange}}),a("div",{staticClass:"text-right"},[t.formData.id?a("el-button",{attrs:{size:"medium",type:"save"},on:{click:function(e){return t.handleSaveAndStart()}}},[t._v(t._s(t.$t("AUTOMATION.SAVE_START")))]):t._e(),a("el-button",{attrs:{size:"medium",type:"cancel"},on:{click:function(e){return t.handleSave()}}},[t._v(t._s(t.$t("AUTOMATION.SAVE")))])],1)],1)],1)},i=[],o=a("5530"),r=a("1da1"),s=(a("96cf"),a("e9c4"),a("d3b7"),a("25f0"),a("b470")),c=a("d58c"),l=a("6d73"),d=a("2fa3"),u=a("dbe1"),f={name:"EditForm",components:{ConditionForm:s["default"],ActionForm:c["default"]},props:{visible:{type:[Boolean],default:!1},data:{type:[Object],default:function(){return{}}}},data:function(){return{formData:{automation_name:"",automation_described:"",priority:"",conditions:[{data:{state:{}}}],actions:[]}}},computed:{dialogVisible:{get:function(){return this.visible},set:function(t){t||(this.formData={}),this.$emit("update:visible",t)}}},watch:{visible:{handler:function(t){t&&this.initFormData()},immediate:!0}},methods:{initFormData:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var a,n,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.data.id){e.next=4;break}t.formData={automation_name:"",automation_described:"",priority:"",conditions:[{}],actions:[]},e.next=9;break;case 4:return e.next=6,l["a"].Control.get({id:t.data.id});case 6:a=e.sent,n=a.data,200===n.code&&(i=JSON.parse(JSON.stringify((null===n||void 0===n?void 0:n.data)||{})),t.formData=Object(o["a"])(Object(o["a"])({},i),{},{conditions:Object(u["getConditions"])(i.automation_conditions),actions:Object(u["getActions"])(i.automation_actions)}));case 9:case"end":return e.stop()}}),e)})))()},handleConditionChange:function(t){this.formData.conditions=t},handleActionChange:function(t){this.formData.actions=t},handleSaveAndStart:function(){this.handleSave(1)},validate:function(){return this.formData.automation_name&&""!==this.formData.automation_name?!!this.$refs.conditionRef.validate()&&!!this.$refs.actionRef.validate():(this.$refs.nameRef.focus(),Object(d["h"])(this.$t("AUTOMATION.PLACEHOLDER10")),!1)},handleSave:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this.validate()){var a=JSON.parse(JSON.stringify(this.formData));a.enabled=e.toString(),a.automation_conditions=Object(u["setConditions"])(a.conditions),delete a.conditions,a.automation_actions=Object(u["setActions"])(a.actions,this.formData.automation_name),delete a.actions,a.id?l["a"].Control.edit(a).then((function(e){var a=e.data;200===a.code&&(t.$emit("submit"),Object(d["i"])(t.$t("AUTOMATION.EDIT_SUCCESSFULLY")),t.dialogVisible=!1)})).finally((function(){})):l["a"].Control.add(a).then((function(e){var a=e.data;200===a.code&&(t.$emit("submit"),Object(d["i"])(t.$t("AUTOMATION.ADD_SUCCESSFULLY")),t.dialogVisible=!1)})).finally((function(){}))}}}},h=f,m=(a("6324"),a("2877")),p=Object(m["a"])(h,n,i,!1,null,"393c254f",null);e["default"]=p.exports},d572:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{display:"flex"}},[a("el-date-picker",{ref:"datePicker",attrs:{type:"datetime",placeholder:t.$t("AUTOMATION.PLACEHOLDER.SELECT_DATE_TIME"),format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss"},on:{change:t.handleValueChange},model:{value:t.formData.value,callback:function(e){t.$set(t.formData,"value",e)},expression:"formData.value"}}),a("el-tooltip",{attrs:{placement:"top"}},[a("div",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(t.$t("AUTOMATION.TIP.ONCE_TIME")))]),a("i",{staticClass:"el-icon-info",staticStyle:{margin:"10px"}})])],1)},i=[],o=(a("e9c4"),a("2fa3")),r={name:"OnceTimeSelector",props:{data:{type:[Object],default:function(){return{}}}},data:function(){return{formData:{value:""}}},watch:{data:{handler:function(t){t&&(this.formData=JSON.parse(JSON.stringify(t)))},immediate:!0}},methods:{handleValueChange:function(t){this.$emit("change",t)},validate:function(){return!(!this.formData.value||""===this.formData.value)||(this.$refs.datePicker.focus(),Object(o["h"])(this.$t("AUTOMATION.ERROR.DATE_TIME")),!1)}}},s=r,c=a("2877"),l=Object(c["a"])(s,n,i,!1,null,"5c7dbb60",null);e["default"]=l.exports},d58c:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:t.$t("AUTOMATION.THEN")}},[t._l(t.actions,(function(e,n){return a("div",{key:n,staticStyle:{display:"flex","margin-bottom":"10px"}},[a("el-select",{ref:"actionTypeRef",refInFor:!0,staticStyle:{width:"130px","margin-right":"20px"},attrs:{"no-data-text":t.$t("COMMON.SELECT_NO_DATA"),placeholder:t.$t("AUTOMATION.PLACEHOLDER.ACTION_TYPE"),disabled:t.actions.length>n+1},model:{value:e.type,callback:function(a){t.$set(e,"type",a)},expression:"action.type"}},t._l(e.typeOptions,(function(t,e){return a("el-option",{key:e,attrs:{label:t.label,value:t.value}})})),1),"device"==e.type?a("CommandDevice",{ref:"commandRef",refInFor:!0,staticStyle:{width:"100%"},attrs:{data:e.data},on:{change:function(a){return t.handleCommandChange(e,a)}}}):t._e(),"scene"==e.type?a("SceneSelector",{ref:"sceneRef",refInFor:!0,staticStyle:{width:"100%"},attrs:{value:e.value},on:{change:function(a){return t.handleSceneChange(e,a)}}}):t._e(),"alarm"==e.type?a("AlarmNotification",{ref:"alarmRef",refInFor:!0,staticStyle:{width:"100%"},attrs:{data:e.data},on:{change:function(a){return t.handleAlarmChange(e,a)}}}):t._e(),a("div",{staticStyle:{"margin-left":"20px"}},[a("el-button",{staticStyle:{height:"40px"},attrs:{type:"danger",size:"small","v-if":t.actions.length>0},on:{click:function(a){return t.handleDeleteAction(e)}}},[t._v(t._s(t.$t("AUTOMATION.DELETE")))])],1)],1)})),a("el-button",{attrs:{type:"border",size:"mini",disabled:t.actions.length>2},on:{click:t.handleAddAction}},[t._v(t._s(t.$t("AUTOMATION.ADD_ACTION_TYPE")))])],2)],1)},i=[],o=a("ade3"),r=(a("e9c4"),a("d3b7"),a("159b"),a("c740"),a("a434"),a("d81d"),a("4de4"),a("2fa3")),s=a("373a"),c=a("507f"),l=a("12c3"),d=a("f570"),u=[{label:d["a"].t("AUTOMATION.OPERATING_DEVICE"),value:"device"},{label:d["a"].t("AUTOMATION.ACTIVATION_SCENARIO"),value:"scene"},{label:d["a"].t("AUTOMATION.TRIGGER_ALARM"),value:"alarm"}],f={name:"ActionForm",components:{CommandDevice:s["default"],SceneSelector:c["default"],AlarmNotification:l["default"]},props:{data:{type:[Array],default:function(){return[]}}},data:function(){return{actions:[{type:"",typeOptions:u,disabled:!1}]}},watch:{data:{handler:function(t){t&&(this.actions=JSON.parse(JSON.stringify(t)),console.log("ActionForm.data",JSON.stringify(this.actions)),this.setActionTypeOptions())},immediate:!0}},created:function(){},methods:Object(o["a"])({setActionTypeOptions:function(){var t=JSON.parse(JSON.stringify(u));this.actions.forEach((function(e){if(e.type){e.typeOptions=JSON.parse(JSON.stringify(t));var a=t.findIndex((function(t){return t.value==e.type}));t.splice(a,1)}}))},handleAddAction:function(){var t=this.actions.every((function(t){return""!=t.type}));if(t){var e=this.actions.map((function(t){return t.type})),a=u.filter((function(t){return!e.some((function(e){return e==t.value}))}));this.actions.push({type:"",typeOptions:a,disabled:!1})}else Object(r["h"])(this.$t("AUTOMATION.ERROR.ACTION_TYPE"))},handleDeleteAction:function(t){var e=this.actions.findIndex((function(e){return e==t}));this.actions.splice(e,1),this.setActionTypeOptions(),this.updateData()},handleCommandChange:function(t,e){t.data=e,t.type="device",this.updateData()},handleSceneChange:function(t,e){t.type="scene",t.value=e,this.updateData()},handleAlarmChange:function(t,e){t.data=e,this.updateData()},updateData:function(){this.actions.forEach((function(t){delete t.typeOptions,delete t.disabled})),this.$emit("change",this.actions)},validate:function(){if(0===this.actions.length)return Object(r["h"])(this.$t("AUTOMATIN.ERROR.ACTION_TYPE")),!1;for(var t=0;t<this.actions.length;t++){var e=this.actions[t];if(!e.type||""===e.type)return this.$refs.actionTypeRef[t].focus(),Object(r["h"])(this.$t("AUTOMATION.ERROR.ATLEAST_ONE_ACTION_TYPE")),!1;if(this.$refs.commandRef&&this.$refs.commandRef.length>0&&!this.$refs.commandRef[0].validate())return!1;if(this.$refs.sceneRef&&this.$refs.sceneRef.length>0&&!this.$refs.sceneRef[0].validate())return!1;if(this.$refs.alarmRef&&this.$refs.alarmRef.length>0&&!this.$refs.alarmRef[0].validate())return!1}return!0}},"handleDeleteAction",(function(t){var e=this.actions.findIndex((function(e){return e==t}));this.actions.splice(e,1),this.setActionTypeOptions(),this.updateData()}))},h=f,m=a("2877"),p=Object(m["a"])(h,n,i,!1,null,"01f3fbb0",null);e["default"]=p.exports},d8e4:function(t,e,a){"use strict";a("9eab")},f7c2:function(t,e,a){"use strict";a("7e7b")}}]);