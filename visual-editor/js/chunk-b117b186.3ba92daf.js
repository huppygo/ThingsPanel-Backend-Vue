(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b117b186","chunk-3265fb2a"],{"6d73":function(t,e,n){"use strict";var a=n("18a6");e["a"]={Scene:{list:function(t){return Object(a["a"])({url:"/scenario/strategy/list",method:"post",data:t})},add:function(t){return Object(a["a"])({url:"/scenario/strategy/add",method:"post",data:t})},edit:function(t){return Object(a["a"])({url:"/scenario/strategy/edit",method:"post",data:t})},delete:function(t){return Object(a["a"])({url:"/scenario/strategy/delete",method:"post",data:t})},get:function(t){return Object(a["a"])({url:"/scenario/strategy/detail",method:"post",data:t})},logList:function(t){return Object(a["a"])({url:"/v1/scenario/log/list",method:"post",data:t})},logDetail:function(t){return Object(a["a"])({url:"/v1/scenario/log/detail/list",method:"post",data:t})},active:function(t){return Object(a["a"])({url:"/scenario/strategy/activate",method:"post",data:t})}},Control:{add:function(t){return Object(a["a"])({url:"/v1/automation/add",method:"post",data:t})},edit:function(t){return Object(a["a"])({url:"/v1/automation/edit",method:"post",data:t})},delete:function(t){return Object(a["a"])({url:"/v1/automation/delete",method:"post",data:t})},enabled:function(t){return Object(a["a"])({url:"/v1/automation/enabled",method:"post",data:t})},list:function(t){return Object(a["a"])({url:"/v1/automation/list",method:"post",data:t})},get:function(t){return Object(a["a"])({url:"/v1/automation/detail",method:"post",data:t})},logList:function(t){return Object(a["a"])({url:"/v1/automation/log/list",method:"post",data:t})},logDetail:function(t){return Object(a["a"])({url:"/v1/automation/log/detail/list",method:"post",data:t})}}}},a681:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-form-item",{staticStyle:{width:"100%"},attrs:{label:t.$t("AUTOMATION.THEN")}},[t._l(t.actions,(function(e,a){return n("div",{key:a,staticStyle:{display:"flex","margin-bottom":"10px"}},[n("el-select",{ref:"actionTypeRef",refInFor:!0,staticStyle:{width:"120px","margin-right":"20px"},attrs:{placeholder:t.$t("AUTOMATION.PLACEHOLDER.ACTION_TYPE"),disabled:t.actions.length>a+1},on:{change:function(n){return t.handleChangeActionType(e,n)}},model:{value:e.type,callback:function(n){t.$set(e,"type",n)},expression:"action.type"}},t._l(e.typeOptions,(function(t,e){return n("el-option",{key:e,attrs:{label:t.label,value:t.value}})})),1),"device"==e.type?n("CommandDevice",{ref:"commandRef",refInFor:!0,attrs:{data:e.data},on:{change:function(n){return t.handleCommandChange(e,n)}}}):t._e(),"scene"==e.type?n("SceneSelector",{ref:"sceneRef",refInFor:!0,attrs:{value:e.value},on:{change:function(n){return t.handleSceneChange(e,n)}}}):t._e(),"alarm"==e.type?n("AlarmNotification",{ref:"alarmRef",refInFor:!0,attrs:{data:e.data},on:{change:function(n){return t.handleAlarmChange(e,n)}}}):t._e(),n("div",{staticStyle:{"margin-left":"20px"}},[n("el-button",{staticStyle:{height:"40px"},attrs:{type:"danger",size:"small","v-if":t.actions.length>0},on:{click:function(n){return t.handleDeleteAction(e)}}},[t._v(t._s(t.$t("AUTOMATION.DELETE")))])],1)],1)})),n("el-button",{attrs:{type:"border",size:"mini",disabled:t.actions.length>2},on:{click:t.handleAddAction}},[t._v(t._s(t.$t("AUTOMATION.ADD_ACTION_TYPE")))])],2)],1)},i=[],o=(n("e9c4"),n("d3b7"),n("159b"),n("c740"),n("a434"),n("d81d"),n("4de4"),n("2fa3")),r=n("448a"),s=n("fef2"),c=n("6d6e"),l=n("f570"),d=[{label:l["a"].t("AUTOMATION.OPERATING_DEVICE"),value:"device"},{label:l["a"].t("AUTOMATION.ACTIVATION_SCENARIO"),value:"scene"},{label:l["a"].t("AUTOMATION.TRIGGER_ALARM"),value:"alarm"}],u={name:"ActionForm",components:{CommandDevice:r["default"],SceneSelector:s["default"],AlarmNotification:c["default"]},props:{data:{type:[Array],default:function(){return[]}}},data:function(){return{actions:[{type:"",typeOptions:d,disabled:!1}]}},watch:{data:{handler:function(t){t&&(this.actions=JSON.parse(JSON.stringify(t)),this.setActionTypeOptions())},immediate:!0}},created:function(){},methods:{setActionTypeOptions:function(){var t=JSON.parse(JSON.stringify(d));this.actions.forEach((function(e){if(e.type){e.typeOptions=JSON.parse(JSON.stringify(t));var n=t.findIndex((function(t){return t.value==e.type}));t.splice(n,1)}}))},handleChangeActionType:function(t,e){},handleAddAction:function(){var t=this.actions.every((function(t){return""!=t.type}));if(t){var e=this.actions.map((function(t){return t.type})),n=d.filter((function(t){return!e.some((function(e){return e==t.value}))}));this.actions.push({type:"",typeOptions:n,disabled:!1})}else Object(o["h"])(this.$t("AUTOMATION.ERROR.ACTION_TYPE"))},handleDeleteAction:function(t){var e=this.actions.findIndex((function(e){return e==t}));this.actions.splice(e,1),this.setActionTypeOptions(),this.updateData()},handleCommandChange:function(t,e){console.log("====handleCommandChange====",t,e),t.data=e,t.type="device",this.updateData()},handleSceneChange:function(t,e){t.type="scene",t.value=e,this.updateData()},handleAlarmChange:function(t,e){t.data=e,this.updateData()},updateData:function(){this.actions.forEach((function(t){delete t.typeOptions,delete t.disabled})),this.$emit("change",this.actions)},validate:function(){if(0===this.actions.length)return Object(o["h"])(this.$t("AUTOMATIN.ERROR.ACTION_TYPE")),!1;for(var t=0;t<this.actions.length;t++){var e=this.actions[t];if(!e.type||""===e.type)return this.$refs.actionTypeRef[t].focus(),Object(o["h"])(this.$t("AUTOMATION.ERROR.ATLEAST_ONE_ACTION_TYPE")),!1;if(console.log(this.$refs.commandRef,this.$refs.sceneRef,this.$refs.alarmRef),this.$refs.commandRef&&this.$refs.commandRef.length>0&&!this.$refs.commandRef[0].validate())return!1;if(this.$refs.sceneRef&&this.$refs.sceneRef.length>0&&!this.$refs.sceneRef[0].validate())return!1;if(this.$refs.alarmRef&&this.$refs.alarmRef.length>0&&!this.$refs.alarmRef[0].validate())return!1}return!0}}},f=u,h=n("2877"),p=Object(h["a"])(f,a,i,!1,null,"b830ad54",null);e["default"]=p.exports},fef2:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{display:"flex"}},[t._v(" "+t._s(t.$t("AUTOMATION.ACTIVATE"))),n("span",{staticStyle:{color:"red","margin-left":"6px"}},[t._v("*")]),n("el-select",{ref:"sceneIdRef",staticStyle:{width:"300px","margin-left":"10px","margin-right":"10px"},on:{change:t.handleChange},model:{value:t.sceneId,callback:function(e){t.sceneId=e},expression:"sceneId"}},t._l(t.options,(function(t,e){return n("el-option",{key:e,attrs:{label:t.scenario_name,value:t.id}})})),1)],1)},i=[],o=n("6d73"),r=n("2fa3"),s={name:"SceneSelector",props:{value:{type:[String],default:""}},data:function(){return{sceneId:"",options:[]}},created:function(){this.getSceneList()},methods:{getSceneList:function(){var t=this;o["a"].Scene.list({current_page:1,per_page:9999}).then((function(e){var n,a=e.data;200===a.code&&(t.options=(null===(n=a.data)||void 0===n?void 0:n.data)||[],t.sceneId=t.value)}))},handleChange:function(t){this.$emit("change",t)},validate:function(){return!(!this.sceneId||""===this.sceneId)||(this.$refs.sceneIdRef.focus(),Object(r["h"])($t("AUTOMATION.ERROR.SCENE")),!1)}}},c=s,l=n("2877"),d=Object(l["a"])(c,a,i,!1,null,"7afe8573",null);e["default"]=d.exports}}]);