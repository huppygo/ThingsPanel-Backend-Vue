(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-231a4932","chunk-2d212c35"],{"045f":function(t,e,n){"use strict";n("455b")},"31e1":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-dialog",{staticClass:"el-dark-dialog el-dark-input",attrs:{title:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.ATTRIBUTE_HISTORY_DATA"),width:"50%","close-on-press-escape":!1,"show-close":"","append-to-body":"",visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e},close:t.handleClose}},[n("div",[n("el-row",{attrs:{gutter:10}},[n("el-col",{attrs:{span:11}},[n("el-date-picker",{staticStyle:{width:"100%"},attrs:{clearable:!1,"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetimerange","start-placeholder":t.$t("DATA_MANAGEMENT.PLACEHOLDER5"),"range-separator":t.$t("DATA_MANAGEMENT.PLACEHOLDER6"),"end-placeholder":t.$t("DATA_MANAGEMENT.PLACEHOLDER7")},on:{change:function(e){return t.getHistoryData()}},model:{value:t.choosedTimeRange,callback:function(e){t.choosedTimeRange=e},expression:"choosedTimeRange"}})],1),n("el-col",{attrs:{span:3}},[n("el-button",{attrs:{type:"border",size:"medium"},on:{click:function(e){return t.handleRefresh()}}},[t._v(t._s(t.$t("COMMON.REFRESH")))])],1),n("el-col",{staticStyle:{float:"right"},attrs:{span:3}},[n("el-popconfirm",{attrs:{"confirm-button-text":t.$t("COMMON.CONFIRM"),"cancel-button-text":t.$t("COMMON.CANCEL"),title:t.$t("COMMON.EXPORT_CONFIRM")},on:{confirm:function(e){return t.handleExport()}}},[n("el-button",{attrs:{slot:"reference",type:"border",size:"medium"},slot:"reference"},[t._v(t._s(t.$t("COMMON.EXPORT")))])],1)],1)],1),n("el-table",{attrs:{data:t.historyData},scopedSlots:t._u([{key:"empty",fn:function(){return[n("div",[t._v(t._s(t.$t("COMMON.TABLE_NO_DATA")))])]},proxy:!0}])},[n("el-table-column",{attrs:{type:"index",width:"50",align:"center"}}),n("el-table-column",{attrs:{prop:"time",label:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.TIMESTAMP"),"min-width":"200",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",[t._v(t._s(t.transformTimestamp(e.row.ts)))])]}}])}),n("el-table-column",{attrs:{prop:"key",label:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.ATTRIBUTE.ATTRIBUTE_IDENTIFIER"),"min-width":"200",align:"center"}},[t._v(t._s(this.attributeName))]),n("el-table-column",{attrs:{prop:"value",label:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.VALUE"),"min-width":"200",align:"center"}})],1),n("div",{staticClass:"text-center py-3"},[n("el-row",{attrs:{type:"flex",justify:"center"}},[n("el-col",{staticStyle:{display:"inline-block"},attrs:{span:8}},[n("el-button",{staticStyle:{width:"45px","border-color":"#747474"},attrs:{icon:"el-icon-back",type:"border",disabled:1===this.page,size:"small"},on:{click:function(e){return t.pageChange(t.page-1)}}}),n("el-button",{staticStyle:{width:"45px","border-color":"#747474"},attrs:{icon:"el-icon-right",type:"border",disabled:this.dataCount!==this.pageSize,size:"small"},on:{click:function(e){return t.pageChange(t.page+1)}}})],1)],1)],1)],1),n("el-dialog",{staticClass:"el-dark-dialog el-dark-input",attrs:{width:"30%","append-to-body":"",title:t.$t("COMMON.EXPORT"),visible:t.exportVisible},on:{"update:visible":function(e){t.exportVisible=e}}},[n("div",{staticClass:"text-center"},[n("p",[t._v(t._s(t.downloadUrl?t.downloadUrl.split("/").pop().toString():t.$t("COMMON.GENERATE_WAIT")))]),t.exporting?t._e():n("p",[n("a",{attrs:{href:t.downloadUrl}},[t._v(t._s(t.$t("COMMON.DOWNLOAD")))])])])])],1)},i=[],o=(n("d3b7"),n("aa98")),r=n("3de1"),d={name:"DeviceHistory",props:{visible:{type:[Boolean],default:!1},data:{type:Object,default:function(){return{}}},device:{type:[Object],default:function(){return{}}},attributeName:{type:String,default:""}},data:function(){var t=Date.now();return{historyData:[],positionShow:!1,locationArray:[],choosedTimeRange:[new Date(t-36e5),new Date(t)],isCopy:!1,pageSize:10,page:1,dataCount:0,exporting:!1,exportVisible:!1,downloadUrl:""}},computed:{formData:{get:function(){return this.data},set:function(t){this.$emit("update:data",t)}},dialogVisible:{get:function(){return this.visible},set:function(t){this.$emit("update:visible",t)}}},watch:{dialogVisible:{handler:function(t){console.debug("DeviceHistory",this),t&&this.getHistoryData()}}},mounted:function(){},methods:{getHistoryData:function(t,e){var n=this,a=1e3*new Date(this.choosedTimeRange[0]).getTime(),i=1e3*new Date(this.choosedTimeRange[1]).getTime();Object(o["t"])({device_id:this.device.id,key:this.attributeName,start_time:a,end_time:i,page:t||this.page,page_records:e||this.pageSize}).then((function(t){var e=t.data;console.debug("====getHistoryData",e),200==e.code&&(n.historyData=e.data?e.data:[],n.dataCount=n.historyData.length),console.debug(n.historyData)}))},handleClose:function(){this.dialogVisible=!1,this.page=1,this.pageSize=10},transformTimestamp:function(t){return Object(r["a"])(t)},pageChange:function(t){this.page=t,this.getHistoryData()},handleExport:function(){var t=this;if(!this.exporting){this.exporting=!0,this.exportVisible=!0;var e=1e3*new Date(this.choosedTimeRange[0]).getTime(),n=1e3*new Date(this.choosedTimeRange[1]).getTime();Object(o["t"])({device_id:this.device.id,key:this.attributeName,start_time:e,end_time:n,page:this.page,page_records:this.pageSize,export_excel:!0}).then((function(e){var n=e.data;console.debug("====handleExport",n),200==n.code&&(t.downloadUrl=n.data?n.data:"")})).finally((function(){t.exporting=!1}))}},handleRefresh:function(){var t=Date.now();this.choosedTimeRange=[new Date(t-36e5),new Date(t)],this.getHistoryData()}}},c=d,u=(n("045f"),n("2877")),s=Object(u["a"])(c,a,i,!1,null,"de42b222",null);e["default"]=s.exports},"455b":function(t,e,n){},aa98:function(t,e,n){"use strict";n.d(e,"g",(function(){return i})),n.d(e,"f",(function(){return o})),n.d(e,"j",(function(){return r})),n.d(e,"h",(function(){return d})),n.d(e,"i",(function(){return c})),n.d(e,"x",(function(){return u})),n.d(e,"b",(function(){return s})),n.d(e,"c",(function(){return l})),n.d(e,"t",(function(){return p})),n.d(e,"v",(function(){return h})),n.d(e,"w",(function(){return f})),n.d(e,"z",(function(){return m})),n.d(e,"r",(function(){return b})),n.d(e,"p",(function(){return g})),n.d(e,"A",(function(){return O})),n.d(e,"l",(function(){return v})),n.d(e,"a",(function(){return y})),n.d(e,"k",(function(){return E})),n.d(e,"e",(function(){return _})),n.d(e,"y",(function(){return T})),n.d(e,"q",(function(){return D})),n.d(e,"m",(function(){return C})),n.d(e,"n",(function(){return A})),n.d(e,"u",(function(){return w})),n.d(e,"o",(function(){return M})),n.d(e,"d",(function(){return N})),n.d(e,"s",(function(){return j}));var a=n("18a6");function i(t){return Object(a["a"])({url:"/index/show",method:"post",data:t})}function o(t){return Object(a["a"])({url:"/device/add_only",method:"post",data:t})}function r(t){return Object(a["a"])({url:"/device/update_only",method:"post",data:t})}function d(t){return Object(a["a"])({url:"/device/delete",method:"post",data:t})}function c(t){return Object(a["a"])({url:"/device/data",method:"post",data:t})}function u(t){return Object(a["a"])({url:"/structure/field",method:"post",data:t})}function s(t){return Object(a["a"])({url:"/kv/current",method:"post",data:t})}function l(t){return Object(a["a"])({url:"/kv/current/detail",method:"post",data:t})}function p(t){return Object(a["a"])({url:"/kv/history/data",method:"post",data:t})}function h(t){return Object(a["a"])({url:"/kv/statistic",method:"post",data:t})}function f(t){return Object(a["a"])({url:"/kv/statistic/batch",method:"post",data:t})}function m(t){return Object(a["a"])({url:"/device/operating_device",method:"post",data:t})}function b(t){return Object(a["a"])({url:"/device/list/tree",method:"post",data:t})}function g(t){return Object(a["a"])({url:"/device/data",method:"post",data:t})}function O(t){return Object(a["a"])({url:"/device/update_only",method:"post",data:t})}function v(t){return Object(a["a"])({url:"/tp_script/list",method:"post",data:t})}function y(t){return Object(a["a"])({url:"/tp_script/add",method:"post",data:t})}function E(t){return Object(a["a"])({url:"/tp_script/edit",method:"post",data:t})}function _(t){return Object(a["a"])({url:"/tp_script/delete",method:"post",data:t})}function T(t){return Object(a["a"])({url:"/tp_script/quiz",method:"post",data:t})}function D(t){return Object(a["a"])({url:"/device/status",method:"post",data:t})}function C(t){return Object(a["a"])({url:"/device/command/history/list",method:"post",data:t})}function A(t){return Object(a["a"])({url:"/device/command/list",method:"post",data:t})}function w(t){return Object(a["a"])({url:"/device/command/send",method:"post",data:t})}function M(t){return Object(a["a"])({url:"/device/event/history/list",method:"post",data:t})}function N(t){return Object(a["a"])({url:"/kv/history/delete",method:"post",data:t})}function j(){return Object(a["a"])({url:"/home/system/time",method:"post"})}}}]);