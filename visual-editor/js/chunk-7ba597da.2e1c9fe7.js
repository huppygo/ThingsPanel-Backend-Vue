(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7ba597da","chunk-08889ec6","chunk-b534a8e6"],{"373a":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"command-device-box"},t._l(t.commands,(function(e,a){return n("div",{key:a,staticStyle:{display:"flex","margin-bottom":"10px"}},[n("DeviceTypeSelector",{ref:"deviceTypeRef",refInFor:!0,attrs:{option:{operator:!1,mode:"action"},data:e},on:{change:function(n){return t.handleCommandChange(e,n)}}}),0==a?n("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"indigo",size:"small"},on:{click:t.handleAddCommand}},[t._v(t._s(t.$t("AUTOMATION.ADD_LINE")))]):t._e(),a>0?n("el-button",{staticStyle:{"margin-left":"auto"},attrs:{type:"danger",size:"small"},on:{click:function(n){return t.handleDeleteCommand(e)}}},[t._v(t._s(t.$t("AUTOMATION.DELETE")))]):t._e()],1)})),0)},i=[],o=(n("e9c4"),n("c740"),n("a434"),n("5c97")),c={name:"CommandDevice",components:{DeviceTypeSelector:o["default"]},props:{data:{type:[Array],default:function(){return[]}}},data:function(){return{commands:[]}},watch:{data:{handler:function(t){console.log("CommandDevice.data",t),t&&t.length>0?this.commands=JSON.parse(JSON.stringify(t)):this.commands=[{}]},immediate:!0,deep:!0}},methods:{handleCommandChange:function(t,e){for(var n in e)t[n]=e[n];this.$emit("change",this.commands)},handleAddCommand:function(){this.commands.push({})},handleDeleteCommand:function(t){var e=this.commands.findIndex((function(e){return e==t}));this.commands.splice(e,1)},validate:function(){for(var t=0;t<this.commands.length;t++)if(this.$refs.deviceTypeRef&&!this.$refs.deviceTypeRef[t].validate())return!1;return!0}}},s=c,r=(n("d8e4"),n("2877")),l=Object(r["a"])(s,a,i,!1,null,"1af50c93",null);e["default"]=l.exports},"507f":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"scene-device-box",staticStyle:{display:"flex"}},[t._v(" "+t._s(t.$t("AUTOMATION.ACTIVATE"))),n("span",{staticStyle:{color:"red","margin-left":"6px"}},[t._v("*")]),n("el-select",{ref:"sceneIdRef",staticStyle:{width:"300px","margin-left":"10px","margin-right":"10px"},attrs:{"no-data-text":t.$t("COMMON.SELECT_NO_DATA")},on:{change:t.handleChange},model:{value:t.sceneId,callback:function(e){t.sceneId=e},expression:"sceneId"}},t._l(t.options,(function(t,e){return n("el-option",{key:e,attrs:{label:t.scenario_name,value:t.id}})})),1)],1)},i=[],o=n("6d73"),c=n("2fa3"),s={name:"SceneSelector",props:{value:{type:[String],default:""}},data:function(){return{sceneId:"",options:[]}},created:function(){this.getSceneList()},methods:{getSceneList:function(){var t=this;o["a"].Scene.list({current_page:1,per_page:9999}).then((function(e){var n,a=e.data;200===a.code&&(t.options=(null===(n=a.data)||void 0===n?void 0:n.data)||[],t.sceneId=t.value)}))},handleChange:function(t){this.$emit("change",t)},validate:function(){return!(!this.sceneId||""===this.sceneId)||(this.$refs.sceneIdRef.focus(),Object(c["h"])($t("AUTOMATION.ERROR.SCENE")),!1)}}},r=s,l=(n("f7c2"),n("2877")),d=Object(l["a"])(r,a,i,!1,null,"0782eaf4",null);e["default"]=d.exports},"6d73":function(t,e,n){"use strict";var a=n("18a6");e["a"]={Scene:{list:function(t){return Object(a["a"])({url:"/scenario/strategy/list",method:"post",data:t})},add:function(t){return Object(a["a"])({url:"/scenario/strategy/add",method:"post",data:t})},edit:function(t){return Object(a["a"])({url:"/scenario/strategy/edit",method:"post",data:t})},delete:function(t){return Object(a["a"])({url:"/scenario/strategy/delete",method:"post",data:t})},get:function(t){return Object(a["a"])({url:"/scenario/strategy/detail",method:"post",data:t})},logList:function(t){return Object(a["a"])({url:"/v1/scenario/log/list",method:"post",data:t})},logDetail:function(t){return Object(a["a"])({url:"/v1/scenario/log/detail/list",method:"post",data:t})},active:function(t){return Object(a["a"])({url:"/scenario/strategy/activate",method:"post",data:t})}},Control:{add:function(t){return Object(a["a"])({url:"/v1/automation/add",method:"post",data:t})},edit:function(t){return Object(a["a"])({url:"/v1/automation/edit",method:"post",data:t})},delete:function(t){return Object(a["a"])({url:"/v1/automation/delete",method:"post",data:t})},enabled:function(t){return Object(a["a"])({url:"/v1/automation/enabled",method:"post",data:t})},list:function(t){return Object(a["a"])({url:"/v1/automation/list",method:"post",data:t})},get:function(t){return Object(a["a"])({url:"/v1/automation/detail",method:"post",data:t})},logList:function(t){return Object(a["a"])({url:"/v1/automation/log/list",method:"post",data:t})},logDetail:function(t){return Object(a["a"])({url:"/v1/automation/log/detail/list",method:"post",data:t})}}}},"7e7b":function(t,e,n){},"9eab":function(t,e,n){},d58c:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-form-item",{staticStyle:{width:"100%"},attrs:{label:t.$t("AUTOMATION.THEN")}},[t._l(t.actions,(function(e,a){return n("div",{key:a,staticStyle:{display:"flex","margin-bottom":"10px"}},[n("el-select",{ref:"actionTypeRef",refInFor:!0,staticStyle:{width:"130px","margin-right":"20px"},attrs:{"no-data-text":t.$t("COMMON.SELECT_NO_DATA"),placeholder:t.$t("AUTOMATION.PLACEHOLDER.ACTION_TYPE"),disabled:t.actions.length>a+1},model:{value:e.type,callback:function(n){t.$set(e,"type",n)},expression:"action.type"}},t._l(e.typeOptions,(function(t,e){return n("el-option",{key:e,attrs:{label:t.label,value:t.value}})})),1),"device"==e.type?n("CommandDevice",{ref:"commandRef",refInFor:!0,staticStyle:{width:"100%"},attrs:{data:e.data},on:{change:function(n){return t.handleCommandChange(e,n)}}}):t._e(),"scene"==e.type?n("SceneSelector",{ref:"sceneRef",refInFor:!0,staticStyle:{width:"100%"},attrs:{value:e.value},on:{change:function(n){return t.handleSceneChange(e,n)}}}):t._e(),"alarm"==e.type?n("AlarmNotification",{ref:"alarmRef",refInFor:!0,staticStyle:{width:"100%"},attrs:{data:e.data},on:{change:function(n){return t.handleAlarmChange(e,n)}}}):t._e(),n("div",{staticStyle:{"margin-left":"20px"}},[n("el-button",{staticStyle:{height:"40px"},attrs:{type:"danger",size:"small","v-if":t.actions.length>0},on:{click:function(n){return t.handleDeleteAction(e)}}},[t._v(t._s(t.$t("AUTOMATION.DELETE")))])],1)],1)})),n("el-button",{attrs:{type:"border",size:"mini",disabled:t.actions.length>2},on:{click:t.handleAddAction}},[t._v(t._s(t.$t("AUTOMATION.ADD_ACTION_TYPE")))])],2)],1)},i=[],o=n("ade3"),c=(n("e9c4"),n("d3b7"),n("159b"),n("c740"),n("a434"),n("d81d"),n("4de4"),n("2fa3")),s=n("373a"),r=n("507f"),l=n("12c3"),d=n("f570"),u=[{label:d["a"].t("AUTOMATION.OPERATING_DEVICE"),value:"device"},{label:d["a"].t("AUTOMATION.ACTIVATION_SCENARIO"),value:"scene"},{label:d["a"].t("AUTOMATION.TRIGGER_ALARM"),value:"alarm"}],f={name:"ActionForm",components:{CommandDevice:s["default"],SceneSelector:r["default"],AlarmNotification:l["default"]},props:{data:{type:[Array],default:function(){return[]}}},data:function(){return{actions:[{type:"",typeOptions:u,disabled:!1}]}},watch:{data:{handler:function(t){t&&(this.actions=JSON.parse(JSON.stringify(t)),console.log("ActionForm.data",JSON.stringify(this.actions)),this.setActionTypeOptions())},immediate:!0}},created:function(){},methods:Object(o["a"])({setActionTypeOptions:function(){var t=JSON.parse(JSON.stringify(u));this.actions.forEach((function(e){if(e.type){e.typeOptions=JSON.parse(JSON.stringify(t));var n=t.findIndex((function(t){return t.value==e.type}));t.splice(n,1)}}))},handleAddAction:function(){var t=this.actions.every((function(t){return""!=t.type}));if(t){var e=this.actions.map((function(t){return t.type})),n=u.filter((function(t){return!e.some((function(e){return e==t.value}))}));this.actions.push({type:"",typeOptions:n,disabled:!1})}else Object(c["h"])(this.$t("AUTOMATION.ERROR.ACTION_TYPE"))},handleDeleteAction:function(t){var e=this.actions.findIndex((function(e){return e==t}));this.actions.splice(e,1),this.setActionTypeOptions(),this.updateData()},handleCommandChange:function(t,e){t.data=e,t.type="device",this.updateData()},handleSceneChange:function(t,e){t.type="scene",t.value=e,this.updateData()},handleAlarmChange:function(t,e){t.data=e,this.updateData()},updateData:function(){this.actions.forEach((function(t){delete t.typeOptions,delete t.disabled})),this.$emit("change",this.actions)},validate:function(){if(0===this.actions.length)return Object(c["h"])(this.$t("AUTOMATIN.ERROR.ACTION_TYPE")),!1;for(var t=0;t<this.actions.length;t++){var e=this.actions[t];if(!e.type||""===e.type)return this.$refs.actionTypeRef[t].focus(),Object(c["h"])(this.$t("AUTOMATION.ERROR.ATLEAST_ONE_ACTION_TYPE")),!1;if(this.$refs.commandRef&&this.$refs.commandRef.length>0&&!this.$refs.commandRef[0].validate())return!1;if(this.$refs.sceneRef&&this.$refs.sceneRef.length>0&&!this.$refs.sceneRef[0].validate())return!1;if(this.$refs.alarmRef&&this.$refs.alarmRef.length>0&&!this.$refs.alarmRef[0].validate())return!1}return!0}},"handleDeleteAction",(function(t){var e=this.actions.findIndex((function(e){return e==t}));this.actions.splice(e,1),this.setActionTypeOptions(),this.updateData()}))},h=f,m=n("2877"),p=Object(m["a"])(h,a,i,!1,null,"01f3fbb0",null);e["default"]=p.exports},d8e4:function(t,e,n){"use strict";n("9eab")},f7c2:function(t,e,n){"use strict";n("7e7b")}}]);