(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ce51249a","chunk-426c6b30","chunk-86008ed8","chunk-5932f52e","chunk-dd4c3bfc","chunk-25211498","chunk-d258d5a8","chunk-4c859791","chunk-3099839e","chunk-0eda7c29","chunk-30734cf0","chunk-2d0b9d55","chunk-2d0d2f7e","chunk-2d2094f0","chunk-2d0b3628","chunk-2d0c5aba"],{"045f":function(e,t,a){"use strict";a("455b")},"0474":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",{staticStyle:{"margin-bottom":"10px"}},[a("el-col",[a("el-button",{attrs:{type:"border",size:"medium"},on:{click:e.showDialog}},[e._v(e._s(e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.ATTRIBUTE.DELIVERY_ATTRIBUTE")))])],1)],1),a("el-row",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.attributeLoading,expression:"attributeLoading"}],staticStyle:{width:"100%"},attrs:{data:e.attributeList},scopedSlots:e._u([{key:"empty",fn:function(){return[a("div",[e._v(e._s(e.$t("COMMON.TABLE_NO_DATA")))])]},proxy:!0}])},[a("el-table-column",{attrs:{prop:"key",label:e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.ATTRIBUTE.ATTRIBUTE_IDENTIFIER"),"min-width":"90",align:"center"}}),a("el-table-column",{attrs:{prop:"name",label:e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.ATTRIBUTE.ATTRIBUTE_NAME"),"min-width":"80",align:"center"}}),a("el-table-column",{attrs:{prop:"str_v",label:e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.ATTRIBUTE.ATTRIBUTE_VALUE"),"min-width":"80",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.str_v?t.row.str_v:t.row.dbl_v)+" ")]}}])}),a("el-table-column",{attrs:{prop:"ts",label:e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.ATTRIBUTE.UPDATE_TIME"),"min-width":"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.transformTimestamp(t.row.ts))+" ")]}}])}),a("el-table-column",{attrs:{prop:"value",label:e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.ATTRIBUTE.HISTORY_DATA"),"min-width":"50",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("i",{staticClass:"el-icon-notebook-2",staticStyle:{padding:"3px 5px",cursor:"pointer"},on:{click:function(a){return e.showDeviceHistory(t.row.key)}}})]}}])}),a("el-table-column",{attrs:{prop:"value",label:e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.ATTRIBUTE.CHART_ANALYSIS"),"min-width":"50",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isShowDataChart(t.row)?a("i",{staticClass:"el-icon-pie-chart",staticStyle:{padding:"3px 5px",cursor:"pointer"},on:{click:function(a){return e.showDeviceDataChart(t.row.key)}}}):a("i",{staticClass:"el-icon-pie-chart",staticStyle:{padding:"3px 5px",cursor:"not-allowed"}})]}}])}),a("el-table-column",{attrs:{prop:"value",label:e.$t("COMMON.OPERATION"),"min-width":"50",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-popconfirm",{attrs:{"confirm-button-text":e.$t("COMMON.CONFIRM"),"cancel-button-text":e.$t("COMMON.CANCEL"),title:e.$t("COMMON.DELETE_CONFIRM")},on:{confirm:function(a){return e.deleteHistoryData(t.row.key)}}},[a("el-button",{attrs:{slot:"reference",size:"mini",type:"border"},slot:"reference"},[e._v(" "+e._s(e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.ATTRIBUTE.DELETE_HISTORY_DATA"))+" ")])],1)]}}])})],1)],1),a("el-dialog",{staticClass:"el-dark-dialog el-dark-input dialog-css",attrs:{title:e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.ATTRIBUTE.DELIVERY_ATTRIBUTE"),width:"30%","close-on-press-escape":!1,"show-close":"","append-to-body":"",visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t},close:e.handleClose}},[a("div",[a("h3",[e._v(e._s(e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.ATTRIBUTE.ATTRIBUTE_JSON_OBJECT")))])]),a("CodeEditor",{key:"upside",staticClass:"dark-code-editor",staticStyle:{width:"100%",height:"260px","overflow-y":"auto"},attrs:{min_height:"260px",copy_code:!0,hide_header:!1,theme:"dark",wrap_code:!0},model:{value:e.deliveryAttribute,callback:function(t){e.deliveryAttribute=t},expression:"deliveryAttribute"}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"cancel"},on:{click:e.handleClose}},[e._v(e._s(e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.CANCEL")))]),a("el-button",{attrs:{type:"save"},on:{click:e.handleSubmit}},[e._v(e._s(e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.CONFIRM")))])],1)],1),a("DeviceHistory",{attrs:{visible:e.deviceHistoryVisible,device:e.device,attributeName:e.attributeName},on:{"update:visible":function(t){e.deviceHistoryVisible=t}}}),a("DeviceDataChart",{attrs:{visible:e.deviceDataChartVisible,device:e.device,attributeName:e.attributeName},on:{"update:visible":function(t){e.deviceDataChartVisible=t}}})],1)},n=[],o=(a("d3b7"),a("4de4"),a("f314")),r=a("aa98"),s=a("3de1"),l=a("31e1"),c=a("6d09"),d=a("2fa3"),u=a("f570"),p={name:"Attribute",components:{CodeEditor:o["a"],DeviceHistory:l["default"],DeviceDataChart:c["default"]},props:{device:{type:[Object],default:function(){return{}}}},data:function(){return{dialogVisible:!1,deviceHistoryVisible:!1,deviceDataChartVisible:!1,attributeName:"",deliveryAttribute:"",attributeList:[],tableData:[],attributeLoading:!1}},computed:{},watch:{},mounted:function(){console.log("DeviceAttribute",this.device),this.getAttributeList()},methods:{getAttributeList:function(){var e=this;this.attributeLoading=!0,Object(r["c"])({device_id:this.device.id}).then((function(t){var a=t.data;if(console.debug("====getAttributeList",a),200==a.code){var i=a.data?a.data:[];e.attributeList=i.filter((function(e){return"systime"!==e.key&&"SYS_ONLINE"!==e.key}))}})).finally((function(){e.attributeLoading=!1}))},handleClose:function(){this.dialogVisible=!1,this.deliveryAttribute=""},showDialog:function(){this.dialogVisible=!0},transformTimestamp:function(e){return Object(s["a"])(e)},showDeviceHistory:function(e){this.deviceHistoryVisible=!0,this.attributeName=e},showDeviceDataChart:function(e){this.deviceDataChartVisible=!0,this.attributeName=e},deleteHistoryData:function(e){var t=this;this.attributeLoading=!0,Object(r["d"])({device_id:this.device.id,attribute:e}).then((function(e){var a=e.data;200===a.code?Object(d["i"])(u["a"].t("COMMON.DELETE_SUCCESS")):Object(d["h"])(u["a"].t("COMMON.DELETE_FAILED")),t.getAttributeList()}))},handleSubmit:function(){var e;try{e=JSON.parse(this.deliveryAttribute)}catch(t){e={}}console.debug("handleSubmit",e),Object(r["z"])({device_id:this.device.id,values:e}).then((function(e){var t=e.data;200===t.code?Object(d["i"])(u["a"].t("COMMON.EDIT_SUCCESS")):Object(d["h"])(u["a"].t("COMMON.EDIT_FAILED"))}))},isShowDataChart:function(e){if(!e)return!1;var t=e.str_v?e.str_v:e.dbl_v;return!t||"number"===typeof t}}},f=p,m=(a("2449"),a("2877")),v=Object(m["a"])(f,i,n,!1,null,"8adb6202",null);t["default"]=v.exports},"0615":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"el-dark-dialog el-dark-input",attrs:{"append-to-body":!0,visible:e.dialogVisible,title:e.$t("DEVICE_MANAGEMENT.EDIT_PARAMETER.EDITPARAMETER"),"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,width:"820px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{ref:"settingFormRef",staticClass:"inline-edit el-dark-input",attrs:{model:e.deviceData,rules:e.formRule,"label-width":"180px"}},[a("el-form-item",{attrs:{label:e.$t("DEVICE_MANAGEMENT.EDIT_PARAMETER.LABLE1"),prop:"protocol"}},[a("el-select",{attrs:{size:"medium",placeholder:e.$t("DEVICE_MANAGEMENT.EDIT_PARAMETER.PLACEHOLDER1"),disabled:e.deviceData.hasChildDevice},on:{change:e.handleChange},model:{value:e.deviceData.protocol,callback:function(t){e.$set(e.deviceData,"protocol",t)},expression:"deviceData.protocol"}},e._l(e.protocolOptions,(function(e){return a("el-option",{key:e.id,attrs:{label:e.label,value:e.value}})})),1)],1),"video_address"==e.deviceData.protocol?a("div",{staticStyle:{"margin-top":"10px","margin-bottom":"20px"}},[a("el-form-item",{attrs:{label:e.$t("DEVICE_MANAGEMENT.EDIT_PARAMETER.LABLE2")}},[a("el-input",{staticStyle:{width:"100%","margin-right":"20px"},attrs:{size:"medium",placeholder:e.$t("DEVICE_MANAGEMENT.EDIT_PARAMETER.PLACEHOLDER2")},model:{value:e.deviceData.video_address,callback:function(t){e.$set(e.deviceData,"video_address",t)},expression:"deviceData.video_address"}})],1)],1):"ezviz"==e.deviceData.protocol?a("div",{staticStyle:{"margin-top":"10px","margin-bottom":"20px"}},[a("el-form-item",{attrs:{label:e.$t("DEVICE_MANAGEMENT.EDIT_PARAMETER.LABLE2")}},[a("el-input",{staticStyle:{width:"100%","margin-right":"20px"},attrs:{size:"medium",placeholder:e.$t("DEVICE_MANAGEMENT.EDIT_PARAMETER.PLACEHOLDER2")},model:{value:e.deviceData.video_address,callback:function(t){e.$set(e.deviceData,"video_address",t)},expression:"deviceData.video_address"}})],1),a("el-form-item",{attrs:{label:"AppKey："}},[a("el-input",{staticStyle:{width:"100%","margin-right":"20px"},attrs:{size:"medium",placeholder:"请输入AppKey",type:"password"},model:{value:e.deviceData.app_key,callback:function(t){e.$set(e.deviceData,"app_key",t)},expression:"deviceData.app_key"}})],1),a("el-form-item",{attrs:{label:"Secret："}},[a("el-input",{staticStyle:{width:"100%","margin-right":"20px"},attrs:{size:"medium",placeholder:"请输入Secret",type:"password"},model:{value:e.deviceData.secret,callback:function(t){e.$set(e.deviceData,"secret",t)},expression:"deviceData.secret"}})],1)],1):a("div",[e.deviceData.protocol.startsWith("WVP_")?a("div",{staticStyle:{"margin-top":"10px","margin-bottom":"20px"}},[a("el-form-item",{attrs:{label:e.$t("DEVICE_MANAGEMENT.EDIT_PARAMETER.LABLE3"),prop:"authMode"}},[a("el-select",{attrs:{size:"medium",placeholder:e.$t("DEVICE_MANAGEMENT.EDIT_PARAMETER.PLACEHOLDER3"),disabled:!0},on:{change:e.handleAuthModeChange},model:{value:e.deviceData.authMode,callback:function(t){e.$set(e.deviceData,"authMode",t)},expression:"deviceData.authMode"}},[a("el-option",{attrs:{label:e.$t("DEVICE_MANAGEMENT.EDIT_PARAMETER.OPTIONLABLE1"),value:"accessToken"}})],1)],1)],1):a("div",[a("el-form-item",{attrs:{label:e.$t("DEVICE_MANAGEMENT.EDIT_PARAMETER.LABLE3"),prop:"authMode"}},[a("el-select",{attrs:{size:"medium",placeholder:e.$t("DEVICE_MANAGEMENT.EDIT_PARAMETER.PLACEHOLDER3")},on:{change:e.handleAuthModeChange},model:{value:e.deviceData.authMode,callback:function(t){e.$set(e.deviceData,"authMode",t)},expression:"deviceData.authMode"}},[a("el-option",{attrs:{label:"AccessToken接入",value:"accessToken"}}),a("el-option",{attrs:{label:"Basic",value:"mqttBasic"}}),a("el-option",{attrs:{disabled:!0,label:"X.509",value:"x509"}})],1)],1),"accessToken"==e.deviceData.authMode?a("el-form-item",{attrs:{label:"Access Token：",prop:"token"}},[a("el-input",{attrs:{size:"medium"},model:{value:e.deviceData.token,callback:function(t){e.$set(e.deviceData,"token",t)},expression:"deviceData.token"}})],1):e._e(),"mqttBasic"==e.deviceData.authMode?a("el-form-item",{attrs:{label:e.$t("DEVICE_MANAGEMENT.EDIT_PARAMETER.LABLE4"),prop:"username"}},[a("el-input",{attrs:{size:"medium"},model:{value:e.deviceData.username,callback:function(t){e.$set(e.deviceData,"username",t)},expression:"deviceData.username"}})],1):e._e(),"mqttBasic"==e.deviceData.authMode?a("el-form-item",{attrs:{label:e.$t("DEVICE_MANAGEMENT.EDIT_PARAMETER.LABLE5"),prop:"password"}},[a("el-input",{attrs:{size:"medium"},model:{value:e.deviceData.password,callback:function(t){e.$set(e.deviceData,"password",t)},expression:"deviceData.password"}})],1):e._e()],1),a("el-form-item",{attrs:{label:e.$t("DEVICE_MANAGEMENT.EDIT_PARAMETER.LABLE6")}},[a("el-descriptions",{staticClass:"el-dark-descriptions",attrs:{column:1,border:"",colon:!0}},e._l(e.connectInfo,(function(t,i){return a("el-descriptions-item",{key:i,attrs:{contentStyle:e.getDescriptionContentStyle(),labelStyle:e.getDescriptionLabelStyle(),label:t.label}},[t.link?a("el-link",{attrs:{href:t.value,target:"_blank"}},[e._v(e._s(t.value))]):a("el-tooltip",{attrs:{effect:"dark",content:t.tooltip?t.tooltip:e.$t("DEVICE_MANAGEMENT.EDIT_PARAMETER.COPY"),placement:"right-start"}},[t.payload?a("el-input",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:t.value,expression:"item.value",arg:"copy"}],ref:"payloadInput",refInFor:!0,attrs:{type:"textarea",autosize:{maxRows:6},readonly:""},on:{focus:function(a){return e.handleCopy(t)}},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"item.value"}},[e._v(e._s(t.value))]):a("el-input",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:t.value,expression:"item.value",arg:"copy"}],attrs:{readonly:""},nativeOn:{click:function(a){return e.handleCopy(t)}},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"item.value"}})],1)],1)})),1)],1),a("div",{staticStyle:{margin:"10px 0"}}),e.deviceData.protocol.startsWith("WVP_")?e._e():a("el-form-item",{attrs:{label:e.$t("DEVICE_MANAGEMENT.EDIT_PARAMETER.LABLE7")}},[a("el-select",{attrs:{size:"medium",placeholder:"",filterable:"","popper-class":"exchange-agreement","popper-append-to-body":!1},on:{change:e.handleExchangeAgreementChange},model:{value:e.deviceData.dataExchangeAgreement,callback:function(t){e.$set(e.deviceData,"dataExchangeAgreement",t)},expression:"deviceData.dataExchangeAgreement"}},[a("el-option-group",[a("el-option",{attrs:{label:e.$t("DEVICE_MANAGEMENT.EDIT_PARAMETER.OPTIONLABLE2"),value:""}}),a("el-option",{attrs:{label:e.$t("DEVICE_MANAGEMENT.EDIT_PARAMETER.OPTIONLABLE3"),value:"custom"}})],1),a("el-option-group",e._l(e.customExchangeAgreementList,(function(t){return a("el-option",{key:t.value,attrs:{value:t.value,label:t.label}},[a("span",{staticStyle:{float:"left",width:"200px"}},[e._v(e._s(t.label))]),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[a("el-button",{attrs:{icon:"el-icon-edit-outline",size:"mini"},on:{click:function(a){return e.handleShowExchangeAgreementDialog(t)}}}),a("el-button",{attrs:{icon:"el-icon-delete",size:"mini"},on:{click:function(a){return e.handleDeleteExchangeAgreement(t)}}})],1)])})),1)],1)],1)],1),a("div",{staticStyle:{display:"flex","justify-content":"center"}},[a("el-button",{attrs:{type:"cancel"},on:{click:e.onCancel}},[e._v(e._s(e.$t("DEVICE_MANAGEMENT.EDIT_PARAMETER.CANCEL")))]),a("el-button",{attrs:{type:"save"},on:{click:e.onSubmit}},[e._v(e._s(e.$t("DEVICE_MANAGEMENT.EDIT_PARAMETER.SAVE")))])],1)],1),a("custom-exchange-agreement",{attrs:{"dialog-visible":e.customExchangeAgreementVisible,"connect-info":e.connectInfo,data:e.exchangeAgreementData,device:e.deviceData},on:{"update:dialogVisible":function(t){e.customExchangeAgreementVisible=t},"update:dialog-visible":function(t){e.customExchangeAgreementVisible=t},submit:e.handleAddExchangeAgreement}})],1)},n=[],o=a("b85c"),r=a("1da1"),s=(a("96cf"),a("e9c4"),a("d3b7"),a("159b"),a("b0c0"),a("c740"),a("a434"),a("d81d"),a("ac1f"),a("5319"),a("5b81"),a("ed09")),l=a("aa98"),c=a("2fa3"),d=a("a44a"),u=(a("b705"),a("9448")),p=a("3541"),f=a("87cb"),m=a("f570"),v=Object(s["c"])({name:"DeviceSettingForm",components:{CustomExchangeAgreement:d["default"]},props:{dialogVisible:{type:[Boolean],default:!1},device_item:{type:Object,required:!0}},emits:["change","cancel"],setup:function(e,t){var a={},i={},n=Object(f["default"])(),d=n.getDeviceProtocolList,v=n.getGatewayProtocolList,b=n.getCustomConnectInformation,h=!0,g=Object(s["i"])({protocol:[{required:h,message:m["a"].t("DEVICE_MANAGEMENT.EDIT_PARAMETER.PLACEHOLDER5")}],token:[{required:h,message:m["a"].t("DEVICE_MANAGEMENT.EDIT_PARAMETER.PLACEHOLDER6")}],username:[{required:h,message:m["a"].t("DEVICE_MANAGEMENT.EDIT_PARAMETER.PLACEHOLDER7")}],password:[{required:h,message:m["a"].t("DEVICE_MANAGEMENT.EDIT_PARAMETER.PLACEHOLDER8")}],d_id:[{required:h,message:m["a"].t("DEVICE_MANAGEMENT.EDIT_PARAMETER.PLACEHOLDER9")}],dataExchangeAgreement:[{required:h,message:m["a"].t("DEVICE_MANAGEMENT.EDIT_PARAMETER.PLACEHOLDER10")}]});function _(){Object(l["p"])({id:a.id}).then((function(e){var t=e.data;200==t.code&&(console.log("getDeviceInformation",t.data),y(t.data))}))}Object(s["j"])((function(){return e.dialogVisible}),(function(t){t&&(a=e.device_item,_())}));var E=Object(s["i"])([]),D=Object(s["h"])({protocol:"",hasChildDevice:!1,authMode:"accessToken",video_address:"",app_key:"",secret:"",token:"",d_id:"",username:"",password:"",defaultSetting:"",dataExchangeAgreement:"",errors:{}});function y(e){return C.apply(this,arguments)}function C(){return C=Object(r["a"])(regeneratorRuntime.mark((function e(t){var n,r,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("1"!=t.device_type&&1!=t.device_type){e.next=6;break}return e.next=3,d();case 3:E.value=e.sent,e.next=9;break;case 6:return e.next=8,v();case 8:E.value=e.sent;case 9:if(console.log("====protocolOptions"),D.dataExchangeAgreement=t.script_id?t.script_id:"",D.id=t.id,D.hasChildDevice=!!a.children&&a.children.length>0,D.device_type=t.device_type,D.d_id=t.d_id,D.protocol=t.protocol,D.authMode=t.password?"mqttBasic":"accessToken",D.token=t.token,D.username=t.token,D.password=t.password?t.password:"",D.errors={},D.children=a.children,D.video_address=t.additional_info?JSON.parse(t.additional_info).video_address:"",D.app_key=t.additional_info?JSON.parse(t.additional_info).app_key:"",D.secret=t.additional_info?JSON.parse(t.additional_info).secret:"",D.additionalInfo=t.additional_info?JSON.parse(t.additional_info):{},j(t.protocol),"2"!=t.device_type){e.next=49;break}if(!D.hasChildDevice||"MQTT"!=D.protocol){e.next=47;break}n=Object(o["a"])(D.children),e.prev=30,n.s();case 32:if((r=n.n()).done){e.next=39;break}return s=r.value,e.next=36,x(s.type);case 36:i[s.subDeviceAddress]=e.sent;case 37:e.next=32;break;case 39:e.next=44;break;case 41:e.prev=41,e.t0=e["catch"](30),n.e(e.t0);case 44:return e.prev=44,n.f(),e.finish(44);case 47:e.next=52;break;case 49:return e.next=51,x(t.type);case 51:i["single"]=e.sent;case 52:return e.next=54,I(t.protocol);case 54:case"end":return e.stop()}}),e,null,[[30,41,44,47]])}))),C.apply(this,arguments)}function A(){t.emit("update:dialogVisible",!1)}function O(){this.$refs.settingFormRef.validate((function(e){e&&("video_address"==D.protocol?(D.additionalInfo.video_address=D.video_address,D.additional_info=JSON.stringify(D.additionalInfo)):"ezviz"==D.protocol?(D.additionalInfo.video_address=D.video_address,D.additionalInfo.app_key=D.app_key,D.additionalInfo.secret=D.secret,D.additional_info=JSON.stringify(D.additionalInfo)):(D.script_id=D.dataExchangeAgreement,"mqttBasic"==D.authMode?D.token=D.username:D.password=""),Object(l["A"])(D).then((function(e){var a=e.data;200==a.code&&(Object(c["i"])("更新成功！"),t.emit("submit"),A())})))}))}function T(e){console.log("handleChange",e),I(e),j(e)}function N(e){console.log("====handleAuthModeChange",D),I(D.protocol)}var M=Object(s["i"])([]);function I(e){return w.apply(this,arguments)}function w(){return w=Object(r["a"])(regeneratorRuntime.mark((function e(t){var i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log("getDefaultSetting",D),console.log("getDefaultSetting.protocolOptions",E.value),i=function(){var e=JSON.parse(JSON.stringify(p["default"][t])),i=S(),n=[];e.forEach((function(e){e.value=e.value.replaceAll("{AccessToken}",a.token),e.value=e.value.replaceAll("{payload}",i),e.show&&e.show.indexOf(D.authMode)>-1?n.push(e):e.show||n.push(e)})),M.value=n},t){e.next=5;break}return e.abrupt("return");case 5:if("1"!==D.device_type){e.next=16;break}if("mqtt"!==D.protocol){e.next=10;break}i(),e.next=14;break;case 10:if("mqtt"===D.protocol||"video_address"===D.protocol){e.next=14;break}return e.next=13,b(D);case 13:M.value=e.sent;case 14:e.next=25;break;case 16:if("2"!==D.device_type){e.next=25;break}if("MQTT"!==D.protocol){e.next=21;break}i(),e.next=25;break;case 21:return e.next=23,b(D);case 23:M.value=e.sent,console.log("====getDefaultSetting.getCustomConnectInformation",M);case 25:case"end":return e.stop()}}),e)}))),w.apply(this,arguments)}function S(){var e={};if(i.single)i.single.forEach((function(t){e[t.name]=t.title+"值"}));else{console.log("tslProperties",i);var t=function(t){var a=i[t],n={};a.forEach((function(e){console.log("tslList",e),n[e.name]=e.title+"值"})),t&&(e[t]=n)};for(var a in i)t(a)}var n=JSON.stringify(e,null,4);return n}function x(e){return k.apply(this,arguments)}function k(){return k=Object(r["a"])(regeneratorRuntime.mark((function e(t){var a,i,n,o,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a={current_page:1,per_page:10,id:t},e.next=3,u["a"].page(a);case 3:if(i=e.sent,n=i.data,200!=n.code){e.next=13;break}if(n.data.data&&0!=n.data.data.length){e.next=8;break}return e.abrupt("return",[]);case 8:if(o=n.data.data[0].chart_data,""!=o&&"{}"!=o&&void 0!=o){e.next=11;break}return e.abrupt("return",[]);case 11:return r=JSON.parse(o),e.abrupt("return",r.tsl.properties);case 13:return e.abrupt("return",[]);case 14:case"end":return e.stop()}}),e)}))),k.apply(this,arguments)}function V(e){console.log(e,"item");var t=M.value.findIndex((function(t){return t==e}));M.value.forEach((function(e){delete e.tooltip}));var a=M.value[t];a.tooltip=this.$t("DEVICE_MANAGEMENT.EDIT_PARAMETER.COPIED"),M.value.splice(t,1,a)}var G=Object(s["i"])(!1),L="",R=Object(s["i"])([]),$=Object(s["h"])({id:"",protocol_type:""});function j(e){$.protocol_type=e;var t={current_page:1,per_page:9999,protocol_type:e,device_type:D.device_type};Object(l["l"])(t).then((function(e){var t=e.data;200==t.code&&(t.data&&t.data.data&&t.data.data.length>0?R.value=t.data.data.map((function(e){return{value:e.id,label:e.script_name}})):R.value=[])}))}function P(e){"custom"==e?(D.dataExchangeAgreement=L,$.id="",G.value=!0):L=e}function F(e){console.log(e),Object(c["i"])("保存成功！"),j(a.protocol),L=D.dataExchangeAgreement=e}function U(e){$.id=e.value,G.value=!0}function B(e){Object(c["g"])("是否删除此协议！").then((function(){Object(l["e"])({id:e.value}).then((function(e){var t=e.data;200==t.code&&(j(a.protocol),D.dataExchangeAgreement="")}))})).catch((function(){console.log("====cancel")}))}function z(){return{color:"#fff",backgroundColor:"#2d3d88!important"}}function H(){return{width:"160px",fontSize:"11px!important",color:"#ccc!important",backgroundColor:"#2d3d88!important"}}return{formRule:g,protocolOptions:E,deviceData:D,connectInfo:M,handleCopy:V,onCancel:A,onSubmit:O,handleChange:T,handleAuthModeChange:N,handleExchangeAgreementChange:P,customExchangeAgreementVisible:G,customExchangeAgreementList:R,exchangeAgreementData:$,handleAddExchangeAgreement:F,handleShowExchangeAgreementDialog:U,handleDeleteExchangeAgreement:B,getDescriptionContentStyle:z,getDescriptionLabelStyle:H}}}),b=v,h=(a("86fa"),a("2877")),g=Object(h["a"])(b,i,n,!1,null,"5758b90a",null);t["default"]=g.exports},"0a67":function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return s}));var i=a("5530"),n=(a("b0c0"),a("d3b7"),a("ed09")),o=a("aa98"),r=a("2fa3");function s(e){var t=Object(n["i"])(),a=Object(n["i"])(!1);function s(){e.value.unshift({id:"",name:"",asset_id:"",d_id:"",location:"",protocol:"mqtt",device_type:"1",additional_info:'{"runningInfo":{"thresholdTime":0}}',errors:{name:"",asset_id:"",device_type:""}})}function l(e,t){console.log("===============handleSave===================="),console.log(e),console.log("================handleSave===================="),e.errors.name="",e.errors.asset_id="",e.errors.type="",e.name?e.asset_id?(console.log("====handleSave",a.value),a.value||(a.value=!0,e.id?Object(o["j"])(Object(i["a"])({},e)).then((function(e){var a=e.data;200===a.code&&(Object(r["i"])("更新成功！"),t&&t.call())})).finally((function(){a.value=!1})):Object(o["f"])(e).then((function(a){var i=a.data;200===i.code&&(Object(r["i"])("创建成功！"),e.id=i.data.id,e.name=i.data.name,t&&t.call())})).finally((function(){a.value=!1})))):e.errors.asset_id="请选择分组":e.errors.name="请填写用户名"}function c(e,t){if(e.id){if(a.value)return;a.value=!0,Object(o["h"])({id:e.id}).then((function(e){var t=e.data;200===t.code&&Object(r["i"])("删除成功！")})).finally((function(){a.value=!1,t&&t()}))}else t&&t(),Object(r["i"])("删除成功！")}return{deviceForm:t,handleCreate:s,handleSave:l,handleDelete:c}}},"19d0":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-cascader",{staticClass:"w-100",attrs:{placeholder:e.$t("DATA_MANAGEMENT.PLACEHOLDER2"),props:e.businessProps,clearable:e.clearable,filterable:""},on:{change:function(t){return e.handleChange()}},model:{value:e.businessCascaderData,callback:function(t){e.businessCascaderData=t},expression:"businessCascaderData"}})},n=[],o=(a("a15b"),a("d81d"),a("b0c0"),a("ed09")),r=a("2b6d"),s=Object(o["c"])({name:"BusinessSelector",props:{business_id:{required:!0,type:String},clearable:{default:!0},showAll:{default:!1}},setup:function(e,t){var a=Object(o["a"])({get:function(){return[e.business_id]},set:function(e){t.emit("update:business_id",e.join(""))}}),i=Object(o["h"])({lazy:!0,lazyLoad:function(t,a){Object(r["d"])({page:1}).then((function(t){var i=t.data,n=[];200===i.code&&i.data.data&&(n=i.data.data.map((function(e){return{value:e.id,label:e.name,leaf:!0}})),e.showAll&&n.unshift({label:"所有项目",value:"all",leaf:!0}),a(n))}))}});function n(){t.emit("change")}return{businessCascaderData:a,businessProps:i,handleChange:n}}}),l=s,c=(a("972c6"),a("2877")),d=Object(c["a"])(l,i,n,!1,null,null,null);t["a"]=d.exports},"1fda":function(e,t,a){},2206:function(e,t,a){},"239d":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("h3",{staticClass:"table-title h3 font-weight-bolder m-0 pt-2"},[e._t("default")],2)},n=[],o={name:"TableTitle"},r=o,s=a("2877"),l=Object(s["a"])(r,i,n,!1,null,"2001a59c",null);t["a"]=l.exports},2449:function(e,t,a){"use strict";a("6fc1")},2712:function(e,t,a){"use strict";a("57eb")},"27c0":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{width:"100%"}},[a("el-row",{staticClass:"pt-3 pb-4 px-3 el-dark-input",attrs:{type:"flex",gutter:10}},[a("el-col",{attrs:{span:5}},[a("el-select",{attrs:{size:"medium",placeholder:e.$t("SYSTEM_LOG.DEVICE_LOG.OPERATIONTYPE"),clearable:""},model:{value:e.params.operation_type,callback:function(t){e.$set(e.params,"operation_type",t)},expression:"params.operation_type"}},[a("el-option",{attrs:{label:e.$t("SYSTEM_LOG.DEVICE_LOG.TIMINGTRIGGER"),value:"1"}}),a("el-option",{attrs:{label:e.$t("SYSTEM_LOG.DEVICE_LOG.MANUALCONTROL"),value:"2"}}),a("el-option",{attrs:{label:e.$t("SYSTEM_LOG.DEVICE_LOG.AUTOMATICCONTROL"),value:"3"}})],1)],1),a("el-col",{attrs:{span:6}},[a("el-select",{attrs:{placeholder:e.$t("SYSTEM_LOG.DEVICE_LOG.SELECTSENDRESULTS"),clearable:"",size:"medium"},model:{value:e.params.send_result,callback:function(t){e.$set(e.params,"send_result",t)},expression:"params.send_result"}},[a("el-option",{attrs:{label:e.$t("SYSTEM_LOG.DEVICE_LOG.SUCCESSFUL"),value:"1"}}),a("el-option",{attrs:{label:e.$t("SYSTEM_LOG.DEVICE_LOG.FAILURE"),value:"2"}})],1)],1),a("el-col",{attrs:{span:14}},[a("el-button",{staticClass:"butStyle",attrs:{type:"border",size:"medium"},on:{click:function(t){return e.handleSearch()}}},[e._v(e._s(e.$t("SYSTEM_LOG.DEVICE_LOG.SEARCH")))]),a("el-button",{staticClass:"butStyle",attrs:{type:"default",size:"medium"},on:{click:function(t){return e.handleReset()}}},[e._v(e._s(e.$t("SYSTEM_LOG.DEVICE_LOG.RESET")))])],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.logLoading,expression:"logLoading"}],attrs:{data:e.tableData},scopedSlots:e._u([{key:"empty",fn:function(){return[a("div",[e._v(e._s(e.$t("COMMON.TABLE_NO_DATA")))])]},proxy:!0}])},[a("el-table-column",{attrs:{label:e.$t("SYSTEM_LOG.DEVICE_LOG.NUMBERID"),type:"index",width:"50",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(10*(e.params.page-1)+t.$index+1))])]}}])}),a("el-table-column",{attrs:{label:e.$t("SYSTEM_LOG.DEVICE_LOG.BUSINESSNAME1"),width:"150",align:"left",prop:"business_name"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"cursor-pointer",on:{click:function(a){return e.handleSearch({business_name:t.row.business_name})}}},[e._v(e._s(t.row.business_name))])]}}])}),a("el-table-column",{attrs:{label:e.$t("SYSTEM_LOG.DEVICE_LOG.DEVICENAME1"),prop:"device_name",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.device_name)+" ")]}}])}),a("el-table-column",{attrs:{label:e.$t("SYSTEM_LOG.DEVICE_LOG.DWVICEGROUPNAME1"),prop:"asset_name",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"cursor-pointer",on:{click:function(a){return e.handleSearch({asset_name:t.row.asset_name})}}},[e._v(e._s(t.row.asset_name))])]}}])}),a("el-table-column",{attrs:{label:e.$t("SYSTEM_LOG.DEVICE_LOG.INSTRUCTION1"),prop:"instruct"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.instruct)+" ")]}}])}),a("el-table-column",{attrs:{label:e.$t("SYSTEM_LOG.DEVICE_LOG.OPERATIONTYPE1"),prop:"operation_type",width:"90"},scopedSlots:e._u([{key:"default",fn:function(t){return["1"==t.row.operation_type?a("el-tag",{staticClass:"tag-operation-type"},[e._v(e._s(e.$t("SYSTEM_LOG.DEVICE_LOG.TIMINGTRIGGER")))]):e._e(),"2"==t.row.operation_type?a("el-tag",{staticClass:"tag-operation-type"},[e._v(e._s(e.$t("SYSTEM_LOG.DEVICE_LOG.MANUALCONTROL")))]):e._e(),"3"==t.row.operation_type?a("el-tag",{staticClass:"tag-operation-type"},[e._v(e._s(e.$t("SYSTEM_LOG.DEVICE_LOG.AUTOMATICCONTROL")))]):e._e()]}}])}),a("el-table-column",{attrs:{label:e.$t("SYSTEM_LOG.DEVICE_LOG.OPERATE_USER"),prop:"operation_type",width:"90"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.row.user_name,placement:"top-start"}},[a("span",[e._v(e._s(t.row.user_name?t.row.user_name.length>10?t.row.user_name.substr(0,5)+"...":t.row.user_name:""))])])]}}])}),a("el-table-column",{attrs:{label:e.$t("SYSTEM_LOG.DEVICE_LOG.TRIGGERINGTIME1"),prop:"cteate_time",width:"90"}}),a("el-table-column",{attrs:{label:e.$t("SYSTEM_LOG.DEVICE_LOG.SENDTHERESULIT1"),prop:"send_result",align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return["1"==t.row.send_result?a("el-tag",{staticClass:"tag-success"},[e._v(e._s(e.$t("SYSTEM_LOG.DEVICE_LOG.SUCCESSFUL")))]):a("el-tag",{staticClass:"tag-failed"},[e._v(e._s(e.$t("SYSTEM_LOG.DEVICE_LOG.FAILURE")))])]}}])}),a("el-table-column",{attrs:{label:e.$t("SYSTEM_LOG.DEVICE_LOG.PROTOCOLTYPE1"),prop:"protocol_type",align:"center",width:"80"}})],1),a("div",{staticClass:"text-right py-3"},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:e.logTotal,"current-page":e.params.page,"page-size":e.params.limit},on:{"update:currentPage":function(t){return e.$set(e.params,"page",t)},"update:current-page":function(t){return e.$set(e.params,"page",t)},"current-change":e.getOperationIndex}})],1)],1)},n=[],o=(a("d3b7"),a("7b99")),r={name:"DevicePlugin",components:{},props:{data:{type:Object,default:function(){return{}}},device:{type:[Object],default:function(){return{}}}},data:function(){return{tableData:[],attributeLoading:!1,logLoading:!1,logTotal:0,params:{device_id:this.device.id,business_name:"",per_page:10,current_page:1,asset_name:"",operation_type:"",send_result:""}}},computed:{formData:{get:function(){return this.data},set:function(e){this.$emit("update:data",e)}}},watch:{},mounted:function(){console.log("DevicePlugin",this.device),this.queryValue()},methods:{queryValue:function(){var e=this;this.logLoading=!0;var t=Object({NODE_ENV:"production",BASE_URL:"/"}).VUE_APP_BASE_URL||document.location.origin+"/";o["a"].post(t+"api/conditions/log/index",this.params).then((function(t){var a=t.data;200==a.code&&(console.log(a.data.data),e.tableData=a.data.data,e.logTotal=a.data.total,e.logLoading=!1)})).finally((function(){e.logLoading=!1}))},handleSearch:function(e){e&&("business_name"in e&&is_string(e.business_name)&&(this.params.business_name=e.business_name),"asset_name"in e&&is_string(e.asset_name)&&(this.params.asset_name=e.asset_name),"operation_type"in e&&is_string(e.operation_type)&&(this.params.operation_type=e.operation_type),"send_result"in e&&is_string(e.send_result)&&(this.params.send_result=e.send_result)),this.params.current_page=1,this.queryValue()},getOperationIndex:function(e){this.logLoading=!0,this.params.current_page=e,this.queryValue()},handleReset:function(){this.params={device_id:this.device.id,business_name:"",per_page:10,current_page:1,asset_name:"",operation_type:"",send_result:""},this.queryValue()}}},s=r,l=a("2877"),c=Object(l["a"])(s,i,n,!1,null,"3f44b20b",null);t["default"]=c.exports},"2adc":function(e,t,a){"use strict";a("5506")},"2b6d":function(e,t,a){"use strict";a.d(t,"d",(function(){return n})),a.d(t,"a",(function(){return o})),a.d(t,"c",(function(){return r})),a.d(t,"b",(function(){return s}));var i=a("18a6");function n(e){return Object(i["a"])({url:"/business/index",method:"post",data:e})}function o(e){return Object(i["a"])({url:"/business/add",method:"post",data:e})}function r(e){return Object(i["a"])({url:"/business/edit",method:"post",data:e})}function s(e){return Object(i["a"])({url:"/business/delete",method:"post",data:e})}},"2cd9":function(e,t,a){"use strict";a("2206")},"2df4":function(e,t,a){},"308f":function(e,t,a){"use strict";a.d(t,"c",(function(){return o})),a.d(t,"j",(function(){return r})),a.d(t,"d",(function(){return s})),a.d(t,"e",(function(){return l})),a.d(t,"f",(function(){return c})),a.d(t,"i",(function(){return d})),a.d(t,"g",(function(){return u})),a.d(t,"h",(function(){return p})),a.d(t,"a",(function(){return f})),a.d(t,"b",(function(){return m}));var i=a("5530"),n=(a("2ca0"),a("d3b7"),a("d81d"),a("18a6"));function o(){return Object(n["a"])({url:"/asset/index",method:"post"})}function r(e){return Object(n["a"])({url:"/structure/field",method:"post",data:e})}function s(e){return Object(n["a"])({url:"/asset/list",method:"post",data:e})}function l(e){return Object(n["a"])({url:"/asset/list/a",method:"post",data:e})}function c(e){return Object(n["a"])({url:"/asset/list/b",method:"post",data:e})}function d(e){var t=function(e){return e&&e.startsWith("/")?e.substring(1):e};return new Promise((function(a,i){Object(n["a"])({url:"/asset/list/d",method:"post",data:e}).then((function(e){var i=e.data.data.map((function(e){return e.device_group=t(e.device_group),e}));e.data.data=i,a(e)})).catch((function(e){i(e)}))}))}function u(e){return Object(n["a"])({url:"/asset/list/c",method:"post",data:e})}function p(e){return Object(n["a"])({url:"/asset/update_only",method:"post",data:e})}function f(e){return Object(n["a"])({url:"/asset/add_only",method:"post",data:e})}function m(e){return Object(n["a"])({url:"/asset/delete",method:"post",data:Object(i["a"])({type:1},e)})}},"31e1":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"el-dark-dialog el-dark-input",attrs:{title:e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.ATTRIBUTE_HISTORY_DATA"),width:"50%","close-on-press-escape":!1,"show-close":"","append-to-body":"",visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t},close:e.handleClose}},[a("div",[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:11}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{clearable:!1,"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetimerange","start-placeholder":e.$t("DATA_MANAGEMENT.PLACEHOLDER5"),"range-separator":e.$t("DATA_MANAGEMENT.PLACEHOLDER6"),"end-placeholder":e.$t("DATA_MANAGEMENT.PLACEHOLDER7")},on:{change:function(t){return e.getHistoryData()}},model:{value:e.choosedTimeRange,callback:function(t){e.choosedTimeRange=t},expression:"choosedTimeRange"}})],1),a("el-col",{attrs:{span:3}},[a("el-button",{attrs:{type:"border",size:"medium"},on:{click:function(t){return e.handleRefresh()}}},[e._v(e._s(e.$t("COMMON.REFRESH")))])],1),a("el-col",{staticStyle:{float:"right"},attrs:{span:3}},[a("el-popconfirm",{attrs:{"confirm-button-text":e.$t("COMMON.CONFIRM"),"cancel-button-text":e.$t("COMMON.CANCEL"),title:e.$t("COMMON.EXPORT_CONFIRM")},on:{confirm:function(t){return e.handleExport()}}},[a("el-button",{attrs:{slot:"reference",type:"border",size:"medium"},slot:"reference"},[e._v(e._s(e.$t("COMMON.EXPORT")))])],1)],1)],1),a("el-table",{attrs:{data:e.historyData},scopedSlots:e._u([{key:"empty",fn:function(){return[a("div",[e._v(e._s(e.$t("COMMON.TABLE_NO_DATA")))])]},proxy:!0}])},[a("el-table-column",{attrs:{type:"index",width:"50",align:"center"}}),a("el-table-column",{attrs:{prop:"time",label:e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.TIMESTAMP"),"min-width":"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.transformTimestamp(t.row.ts)))])]}}])}),a("el-table-column",{attrs:{prop:"key",label:e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.ATTRIBUTE.ATTRIBUTE_IDENTIFIER"),"min-width":"200",align:"center"}},[e._v(e._s(this.attributeName))]),a("el-table-column",{attrs:{prop:"value",label:e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.VALUE"),"min-width":"200",align:"center"}})],1),a("div",{staticClass:"text-center py-3"},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{staticStyle:{display:"inline-block"},attrs:{span:8}},[a("el-button",{staticStyle:{width:"45px","border-color":"#747474"},attrs:{icon:"el-icon-back",type:"border",disabled:1===this.page,size:"small"},on:{click:function(t){return e.pageChange(e.page-1)}}}),a("el-button",{staticStyle:{width:"45px","border-color":"#747474"},attrs:{icon:"el-icon-right",type:"border",disabled:this.dataCount!==this.pageSize,size:"small"},on:{click:function(t){return e.pageChange(e.page+1)}}})],1)],1)],1)],1),a("el-dialog",{staticClass:"el-dark-dialog el-dark-input",attrs:{width:"30%","append-to-body":"",title:e.$t("COMMON.EXPORT"),visible:e.exportVisible},on:{"update:visible":function(t){e.exportVisible=t}}},[a("div",{staticClass:"text-center"},[a("p",[e._v(e._s(e.downloadUrl?e.downloadUrl.split("/").pop().toString():e.$t("COMMON.GENERATE_WAIT")))]),e.exporting?e._e():a("p",[a("a",{attrs:{href:e.downloadUrl}},[e._v(e._s(e.$t("COMMON.DOWNLOAD")))])])])])],1)},n=[],o=(a("d3b7"),a("aa98")),r=a("3de1"),s={name:"DeviceHistory",props:{visible:{type:[Boolean],default:!1},data:{type:Object,default:function(){return{}}},device:{type:[Object],default:function(){return{}}},attributeName:{type:String,default:""}},data:function(){var e=Date.now();return{historyData:[],positionShow:!1,locationArray:[],choosedTimeRange:[new Date(e-36e5),new Date(e)],isCopy:!1,pageSize:10,page:1,dataCount:0,exporting:!1,exportVisible:!1,downloadUrl:""}},computed:{formData:{get:function(){return this.data},set:function(e){this.$emit("update:data",e)}},dialogVisible:{get:function(){return this.visible},set:function(e){this.$emit("update:visible",e)}}},watch:{dialogVisible:{handler:function(e){console.debug("DeviceHistory",this),e&&this.getHistoryData()}}},mounted:function(){},methods:{getHistoryData:function(e,t){var a=this,i=1e3*new Date(this.choosedTimeRange[0]).getTime(),n=1e3*new Date(this.choosedTimeRange[1]).getTime();Object(o["t"])({device_id:this.device.id,key:this.attributeName,start_time:i,end_time:n,page:e||this.page,page_records:t||this.pageSize}).then((function(e){var t=e.data;console.debug("====getHistoryData",t),200==t.code&&(a.historyData=t.data?t.data:[],a.dataCount=a.historyData.length),console.debug(a.historyData)}))},handleClose:function(){this.dialogVisible=!1,this.page=1,this.pageSize=10},transformTimestamp:function(e){return Object(r["a"])(e)},pageChange:function(e){this.page=e,this.getHistoryData()},handleExport:function(){var e=this;if(!this.exporting){this.exporting=!0,this.exportVisible=!0;var t=1e3*new Date(this.choosedTimeRange[0]).getTime(),a=1e3*new Date(this.choosedTimeRange[1]).getTime();Object(o["t"])({device_id:this.device.id,key:this.attributeName,start_time:t,end_time:a,page:this.page,page_records:this.pageSize,export_excel:!0}).then((function(t){var a=t.data;console.debug("====handleExport",a),200==a.code&&(e.downloadUrl=a.data?a.data:"")})).finally((function(){e.exporting=!1}))}},handleRefresh:function(){var e=Date.now();this.choosedTimeRange=[new Date(e-36e5),new Date(e)],this.getHistoryData()}}},l=s,c=(a("045f"),a("2877")),d=Object(c["a"])(l,i,n,!1,null,"de42b222",null);t["default"]=d.exports},3541:function(e,t,a){"use strict";a.r(t);a("add0");var i=!0,n=function(){return"dev.thingspanel.cn"===document.location.host?"dev.thingspanel.cn":"mqtt服务IP"};t["default"]={mqtt:[{label:"MQTT接入点",value:n()+":1883"},{label:"设备上报属性主题",value:"device/attributes"},{label:"设备订阅属性主题",value:"device/attributes/{AccessToken}"},{label:"MQTT用户名",value:"{AccessToken}"},{label:"MQTT密码",value:"在设备端密码为空即可连接",show:["accessToken"]},{label:"设备上报数据",value:"{payload}",payload:i}],MQTT:[{label:"MQTT接入点",value:n()},{label:"网关设备上报属性主题",value:"gateway/attributes"},{label:"网关设备订阅属性主题",value:"gateway/attributes/{AccessToken}"},{label:"MQTT用户名",value:"{AccessToken}"},{label:"设备上报数据",value:"{payload}",payload:i}],MODBUS_TCP:[{label:"协议端口",value:"503"},{label:"连接",value:"建立tcp连接时，将AccessToken:{AccessToken}上送。"}],MODBUS_RTU:[{label:"协议端口",value:"503"},{label:"连接",value:"建立tcp连接时，将AccessToken:{AccessToken}上送。"}]}},3819:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"detail-box"},[a("el-dialog",{staticClass:"el-dark-dialog el-dark-input",attrs:{title:e.pluginName,visible:e.dialogVisible,width:"1000px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("div",{staticClass:"container-fluid"},[a("el-row",{attrs:{gutter:40}},[a("el-col",{attrs:{span:24}},[a("tsl-editor",{staticClass:"tsl-editor",attrs:{"show-view":!1,"show-create":!0,data:e.tslData},on:{gotoPlugin:e.handleGotoPlugin}})],1)],1),a("el-row",{attrs:{gutter:40}},[a("el-col",{attrs:{span:24}},[a("grid-layout",{staticClass:"grid-box",attrs:{layout:e.optionsData,"col-num":e.colNum,"row-height":30,"is-draggable":!0,"is-resizable":!0,"is-mirrored":!1,"vertical-compact":!0,margin:[10,10],"use-css-transforms":!0},on:{"update:layout":function(t){e.optionsData=t}}},e._l(e.optionsData,(function(t,i){return a("grid-item",{key:t["id"]+i,staticClass:"grid-item",attrs:{x:t.x,y:t.y,w:t.w,h:t.h,i:t.i}},["dashboard"!=t.controlType||t.type?e._e():a("e-charts",{key:t["id"],ref:"component_"+t.i,refInFor:!0,staticClass:"component-item",attrs:{"show-header":!0,option:t,value:t.value}}),"history"==t.controlType?a("curve",{key:t["id"],ref:"component_"+t.i,refInFor:!0,staticClass:"component-item",attrs:{"show-header":!0,option:t,value:t.value}}):e._e(),"dashboard"==t.controlType&&"status"==t.type?a("status",{key:t["id"],ref:"component_"+t.i,refInFor:!0,staticClass:"component-item",attrs:{"show-header":!0,option:t}}):e._e(),"dashboard"==t.controlType&&"deviceStatus"==t.type?a("device-status",{key:t["id"],ref:"component_"+t.i,refInFor:!0,staticClass:"component-item",attrs:{"show-header":!0,option:t,value:t.value}}):e._e(),"control"==t.controlType?a("control",{key:t["id"],ref:"component_"+t.i,refInFor:!0,staticClass:"component-item",attrs:{"show-header":!0,option:t}}):e._e(),"video"==t.controlType?a("video-component",{key:t["id"],ref:"component_"+t.i,refInFor:!0,staticClass:"component-item",staticStyle:{"min-width":"200px","min-height":"200px"},attrs:{"show-header":!0,option:t}}):e._e()],1)})),1)],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"cancel"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("关闭")])],1)])],1)},n=[],o=a("9448"),r=a("7be8"),s=a("28b4"),l=a("7f74"),c=a("79ec"),d=a("60a6"),u=a("a8c7"),p=a("8731"),f={components:{GridLayout:r["GridLayout"],GridItem:r["GridItem"],ECharts:s["default"],Curve:l["default"],Control:c["default"],Status:d["default"],DeviceStatus:u["default"],VideoComponent:p["default"]},props:{visible:{type:[Boolean],default:!1},id:{type:[String],default:""}},data:function(){return{tslData:{},chartData:{},optionsData:[],colNum:24,pluginName:""}},computed:{dialogVisible:{get:function(){return this.visible},set:function(e){this.$emit("update:visible",e)}}},watch:{visible:function(e){e&&this.getPluginData(this.id)}},methods:{getPluginData:function(e){var t=this;o["a"].page({current_page:1,per_page:10,id:e}).then((function(e){var a=e.data;if(200==a.code){var i=a.data.data[0];t.pluginName=i.model_name;var n=JSON.parse((null===i||void 0===i?void 0:i.chart_data)||"{}");t.tslData=n.tsl||{};var o=n.chart||[];t.optionsData=t.getDefaultLayout(o,4)}}))},getDefaultLayout:function(e,t){for(var a=this.colNum/t,i=a,n=0,o=0,r=0;r<e.length;r++)n==t&&(o++,n=0),e[r].w=a,e[r].h=i,e[r].x=n*a,e[r].y=o*i,e[r].i=r,n++;return e},handleGotoPlugin:function(){this.$router.push({name:"Market",query:{tab:"deviceEditor"}})}}},m=f,v=(a("a4fd"),a("2877")),b=Object(v["a"])(m,i,n,!1,null,"5dfd0152",null);t["default"]=b.exports},"3a08":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticStyle:{display:"flex",float:"left","margin-bottom":"10px"}},[""!==e.eventSubject?a("span",[e._v("设备上报事件主题: "+e._s(e.eventSubject))]):e._e()]),a("div",{staticStyle:{display:"flex",float:"right","margin-bottom":"10px"}},[a("el-button",{attrs:{type:"border",size:"medium"},on:{click:e.getList}},[e._v("刷新")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.tableData}},[a("el-table-column",{attrs:{label:"事件标识符",prop:"event_identify",width:"240"}}),a("el-table-column",{attrs:{label:"事件上报时间",prop:"report_time",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return a("templace",{},[e._v(" "+e._s(e.dateFormat(t.row.report_time))+" ")])}}])}),a("el-table-column",{attrs:{label:"事件参数",prop:"data",width:"auto"}})],1),a("div",{staticClass:"text-right py-3"},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:e.total,"current-page":e.params.current_page,"page-size":e.params.per_page},on:{"update:currentPage":function(t){return e.$set(e.params,"current_page",t)},"update:current-page":function(t){return e.$set(e.params,"current_page",t)},"current-change":e.getList}})],1)],1)},n=[],o=a("5530"),r=a("aa98"),s=a("3de1"),l={components:{},props:{device:{type:[Object],default:function(){return{}}}},data:function(){return{dateFormat:s["a"],loading:!1,tableData:[],total:0,params:{current_page:1,per_page:10},eventSubject:"device/event"}},mounted:function(){"1"===this.device.device_type?this.eventSubject="device/event":"2"===this.device.device_type&&"MQTT"===this.device.protocol?this.eventSubject="gateway/event":this.eventSubject="",console.log("event.device",this.device),this.getList()},methods:{getList:function(){var e=this;Object(r["o"])(Object(o["a"])({device_id:this.device.device},this.params)).then((function(t){var a=t.data;200===a.code&&(e.tableData=a.data.data,e.total=a.data.total)})).catch((function(e){console.log(e)}))}}},c=l,d=a("2877"),u=Object(d["a"])(c,i,n,!1,null,"160a47aa",null);t["default"]=u.exports},"3fa2":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticStyle:{"margin-top":"20px"}},[a("el-form",{attrs:{"label-position":"left",model:e.formData,"label-width":"120px"}},[a("el-form-item",{attrs:{label:e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.FIRMWARE_VERSION")}},[e._v(" "+e._s(e.device.current_version||"")+" ")])],1)],1)])},n=[],o={name:"DevicePlugin",components:{},props:{data:{type:Object,default:function(){return{}}},device:{type:[Object],default:function(){return{}}}},data:function(){return{dialogVisible:!1,deviceHistoryVisible:!1,deviceDataChartVisible:!1,attributeName:"",deliveryAttribute:"",attributeList:[],tableData:[],attributeLoading:!1,logLoading:!1,logTotal:0,params:{device_id:this.device.id,business_name:"",per_page:10,current_page:1,asset_name:"",operation_type:"",send_result:""}}},computed:{formData:{get:function(){return this.data},set:function(e){this.$emit("update:data",e)}}},watch:{},mounted:function(){console.log("DevicePlugin",this.device)},methods:{}},r=o,s=a("2877"),l=Object(s["a"])(r,i,n,!1,null,"5828e910",null);t["default"]=l.exports},"455b":function(e,t,a){},"4a38":function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return l}));a("d3b7"),a("e9c4"),a("a15b"),a("fb6a"),a("159b"),a("b0c0");var i=a("ed09"),n=a("308f"),o=a("2fa3"),r=a("aa98"),s=a("6eee");function l(e){var t=Object(i["i"])([]),a=Object(i["i"])(!1),l=Object(i["h"])(g()),c=Object(i["i"])([]);e&&(l.business_id=e);var d=Object(i["i"])(0),u=Object(s["b"])();function p(){a.value||(a.value=!0,Object(r["r"])(m(l)).then((function(e){var a=e.data;if(200===a.code){d.value=a.data.total;var i=v(a.data.data),n=i.table,o=i.ids;t.value=a.data.data?n:[],c.value=o,console.log("====getDeviceTree.ids",o),y(o)}})).finally((function(){a.value=!1})))}var f=Object(i["i"])([]);function m(e){var t=JSON.parse(JSON.stringify(e));return Array.isArray(t.asset_id)&&(t.asset_id=t.asset_id.slice(-1).join("")),t}function v(e){var t=[],a=[];return e?(e.forEach((function(e){var i=b(e);e.children&&(i.children=[],e.children.forEach((function(e){i.children.push(b(e))}))),a.push(i.device),t.push(i)})),{table:t,ids:a}):{table:t,ids:a}}function b(e){var t={id:e.device,device:e.device,name:e.device_name,asset_id:e.asset_id,token:e.device_token,device_type:e.device_type,device_state:e.device_state,type:e.type,plugin_name:e.plugin_name,latest_ts:e.latest_ts,protocol:e.protocol,d_id:e.d_id,location:e.location,structure:e.structure?e.structure:[],parent_id:e.parent_id,additional_info:e.additional_info,protocol_config:e.protocol_config,subDeviceAddress:e.sub_device_addr?e.sub_device_addr:"",chart_names:e.chart_names,current_version:e.current_version||"",errors:{name:"",asset_id:"",type:"",device_type:"",protocol:""}};return t}function h(e){var t="";return f.value.some((function(a){if(a.id===e)return t=a.name,!0})),t}function g(){return{current_page:1,per_page:10,business_id:"",asset_id:"",device_id:"",device_type:"",token:"",name:""}}function _(e){e&&"token"in e&&Object(o["f"])(e.token)&&(l.token=e.token),l.current_page=1,p()}function E(){var e=g();for(var t in e)t in l&&"business_id"!==t&&(l[t]=e[t]);p()}Object(n["c"])().then((function(e){var t=e.data;200===t.code&&(f.value=t.data)})).finally((function(){p()}));var D=null;function y(a){if(console.log("====getDeviceStatus.getTimers:",u.getters.getTimers(e)),D&&clearInterval(D),a&&0!=a.length){var i=function(){Object(r["q"])({device_id_list:a}).then((function(e){var a=e.data;200==a.code&&t.value.forEach((function(e){e.device_state=a.data[e.id]?a.data[e.id]:"0"}))}))};i(),D=setInterval(i,5e3)}}return Object(i["f"])((function(){D&&clearInterval(D)})),{tableData:t,loading:a,params:l,deviceIds:c,getDeviceTree:r["r"],getDeviceIndex:p,total:d,handleSearch:_,handleReset:E,devicePluginOptions:f,deviceTypeMap:h}}},"4cf2":function(e,t,a){},"4df3":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"el-dark-dialog el-dark-input",attrs:{title:e.device.name+" - "+e.$t("DEVICE_MANAGEMENT.DEVICE_DETAIL"),width:"60%","close-on-press-escape":!1,"show-close":!1,"append-to-body":!0,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t},close:e.handleClose}},[a("div",{staticClass:"container-fluid"},[a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.tabList,(function(e){return a("el-tab-pane",{key:e.value,attrs:{label:e.label,name:e.value}})})),1),"deviceAttribute"==e.activeName?a("device-attribute",{attrs:{data:e.attrFormData,initAttributeCard:e.initAttributeCard,device:e.device,wvpDevice:e.wvpDeviceList},on:{"update:data":function(t){e.attrFormData=t},"update:initAttributeCard":function(t){e.initAttributeCard=t},"update:init-attribute-card":function(t){e.initAttributeCard=t}}}):"configParse"==e.activeName?a("data-parse",{ref:"dataParse",attrs:{data:e.formData,attrs:e.formAttr},on:{"update:data":function(t){e.formData=t}}}):"attribute"==e.activeName?a("attribute",{attrs:{device:e.device}}):"runningStatus"==e.activeName?a("running-info",{attrs:{data:e.runningFormData,device:e.device},on:{"update:data":function(t){e.runningFormData=t}}}):"event"==e.activeName?a("event",{attrs:{data:e.eventFormData,device:e.device},on:{"update:data":function(t){e.eventFormData=t}}}):"command"==e.activeName?a("command",{attrs:{data:e.commandFormData,device:e.device},on:{"update:data":function(t){e.commandFormData=t}}}):"devicePlugin"==e.activeName?a("device-plugin",{attrs:{data:e.attrFormData,device:e.device},on:{"update:data":function(t){e.attrFormData=t}}}):"deviceLog"==e.activeName?a("device-log",{attrs:{data:e.attrFormData,device:e.device},on:{"update:data":function(t){e.attrFormData=t}}}):e._e()],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"cancel"},on:{click:e.handleClose}},[e._v(e._s(e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.CANCEL")))]),a("el-button",{attrs:{type:"save"},on:{click:e.handleSubmit}},[e._v(e._s(e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.CONFIRM")))])],1)])},n=[],o=a("5530"),r=(a("e9c4"),a("4de4"),a("d3b7"),a("2ca0"),a("18a6")),s={getFormAttr:function(e){return Object(r["a"])({url:"/form/config",method:"post",data:e})},updateDeviceConfig:function(e){return Object(r["a"])({url:"/device/update_only",method:"post",data:e})}},l=a("3b63"),c=a("2fa3"),d=a("8553"),u=a("daa1"),p=a("3fa2"),f=a("27c0"),m=a("5592"),v=a("3a08"),b=a("7509"),h=a("0474"),g=a("f570"),_=[{value:"deviceAttribute",label:g["a"].t("DEVICE_MANAGEMENT.DEVICE_CONFIG.OVERVIEW")},{value:"configParse",label:g["a"].t("DEVICE_MANAGEMENT.DEVICE_CONFIG.DATAANALYSIS")},{value:"attribute",label:g["a"].t("DEVICE_MANAGEMENT.DEVICE_CONFIG.PROPERTIES_REPORT")},{value:"runningStatus",label:g["a"].t("DEVICE_MANAGEMENT.DEVICE_CONFIG.OPERATION")},{value:"event",label:g["a"].t("DEVICE_MANAGEMENT.DEVICE_CONFIG.EVENT_REPORT")},{value:"command",label:g["a"].t("DEVICE_MANAGEMENT.DEVICE_CONFIG.COMMAND_DELIVERY")},{value:"devicePlugin",label:g["a"].t("DEVICE_MANAGEMENT.DEVICE_CONFIG.DEVICE_PLUGIN")},{value:"deviceLog",label:g["a"].t("DEVICE_MANAGEMENT.DEVICE_CONFIG.DEVICE_LOG")}],E={name:"DeviceDetail",components:{DataParse:d["default"],DeviceAttribute:u["default"],DevicePlugin:p["default"],DeviceLog:f["default"],Attribute:h["default"],RunningInfo:m["default"],Event:v["default"],Command:b["default"]},props:{dialogVisible:{type:[Boolean],default:!1},device:{type:[Object],default:function(){return{}}}},data:function(){return{activeName:"",tabList:[],formAttr:[],formData:{},attrFormData:{},runningFormData:{thresholdTime:0},formRule:{},location:"",wvpDeviceList:[],eventFormData:{},commandFormData:{},initAttributeCard:!0}},watch:{activeName:{handler:function(e){this.initAttributeCard="deviceAttribute"===e}},dialogVisible:{handler:function(e){var t=this;if(!1===e&&(this.initAttributeCard=!1),e){console.log("====DeviceConfigForm.newValue",this.device),this.location=this.device.location?this.device.location:"";var a=this.device.additional_info&&"null"!=this.device.additional_info?JSON.parse(this.device.additional_info):{runningInfo:{thresholdTime:0}};if(this.attrFormData={d_id:this.device.d_id,subDeviceVideoAddress:a.video_address},this.runningFormData=a.runningInfo?Object(o["a"])(Object(o["a"])({},a.runningInfo),{},{location:this.device.location,subDeviceAddress:this.device.subDeviceAddress}):{},this.formData={},"{}"==JSON.stringify(this.device)||""==this.device)return;if("3"==this.device.device_type||"1"==this.device.device_type&&"mqtt"!=this.device.protocol){this.tabList=JSON.parse(JSON.stringify(_)),this.activeName="deviceAttribute";var i="1"==this.device.device_type?"1":"2";s.getFormAttr({protocol_type:this.device.protocol,device_type:i}).then((function(e){var a=e.data;200==a.code&&a.data&&a.data.config?(t.formAttr=a.data.config,console.log("data.data.config",a.data.config),console.log("this.device.protocol_config",t.device.protocol_config),"{}"!=t.device.protocol_config&&""!=t.device.protocol_config&&void 0!=t.device.protocol_config&&(t.formData=JSON.parse(t.device.protocol_config))):(t.tabList=t.tabList.filter((function(e){return"configParse"!==e.value})),t.activeName="deviceAttribute")}))}else this.tabList=JSON.parse(JSON.stringify(_)),this.tabList=this.tabList.filter((function(e){return"configParse"!==e.value})),this.activeName="deviceAttribute",this.formRule={location:[{required:!1,message:g["a"].t("DEVICE_MANAGEMENT.DEVICE_CONFIG.PLACEHOLDER3"),trigger:"change"}]},2==this.device.device_type&&this.device.protocol.startsWith("WVP_")&&this.getWVPDeviceList();this.initAttributeCard="deviceAttribute"===this.activeName}}}},methods:{handleClose:function(){this.$emit("update:dialogVisible",!1)},getWVPDeviceList:function(){var e=this;l["a"].getWVPDevices({id:this.device.id,count:"9999",page:"1"}).then((function(t){var a=t.data;console.log("====getWVPDeviceList",a),200==a.code&&(e.wvpDeviceList=a.data.list?a.data.list:[])}))},handleSubmit:function(){var e=this;console.log("====DeviceConfigForm",this.formData);var t=function(){var t=e.device,a=e.device.additional_info&&"null"!=e.device.additional_info?JSON.parse(e.device.additional_info):{};a.runningInfo=e.runningFormData,a.video_address=e.attrFormData.subDeviceVideoAddress;var i={id:t.id,d_id:e.attrFormData.d_id,additional_info:JSON.stringify(a),location:e.runningFormData.location,sub_device_addr:e.runningFormData.subDeviceAddress,protocol_config:JSON.stringify(Object(o["a"])({DeviceId:t.id,AccessToken:t.token},e.formData))};console.log("====DeviceConfigForm.config",i,e.attrFormData),s.updateDeviceConfig(i).then((function(t){var a=t.data;200==a.code&&(Object(c["i"])("配置成功！"),e.handleClose(),e.$emit("submit"))}))};this.$refs["dataParse"]?this.$refs["dataParse"].validate((function(e){console.log("====DeviceConfigForm.valid",e),e&&t()})):t()}}},D=E,y=a("2877"),C=Object(y["a"])(D,i,n,!1,null,"760112ee",null);t["default"]=C.exports},5506:function(e,t,a){},5592:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{attrs:{"label-position":"left",model:e.formData,"label-width":"120px"}},[a("el-form-item",{attrs:{label:e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.OFFLINETIME"),prop:"thresholdTime"}},[a("el-input-number",{attrs:{"controls-position":"right",size:"small",min:0},model:{value:e.formData.thresholdTime,callback:function(t){e.$set(e.formData,"thresholdTime",t)},expression:"formData.thresholdTime"}}),e._v(" 秒 ")],1),"3"==e.device.device_type?a("el-form-item",{attrs:{label:e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.SUBDEVICEADDRESS")}},[a("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.PLACEHOLDER1")},model:{value:e.formData.subDeviceAddress,callback:function(t){e.$set(e.formData,"subDeviceAddress",t)},expression:"formData.subDeviceAddress"}})],1):e._e(),a("el-form-item",{attrs:{label:e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.DEVICELOCATION")}},[a("el-input",{staticStyle:{width:"100%"},attrs:{readonly:"",placeholder:e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.PLACEHOLDER2")},nativeOn:{click:function(t){return e.showCheckLocation.apply(null,arguments)}},model:{value:e.formData.location,callback:function(t){e.$set(e.formData,"location",t)},expression:"formData.location"}})],1)],1),e.positionShow?a("device-location-config",{attrs:{"maker-position":e.locationArray,"dialog-visible":e.positionShow},on:{"update:makerPosition":function(t){e.locationArray=t},"update:maker-position":function(t){e.locationArray=t},"update:dialogVisible":function(t){e.positionShow=t},"update:dialog-visible":function(t){e.positionShow=t}}}):e._e()],1)},n=[],o=(a("a15b"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{top:"5vh","append-to-body":!0,title:e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.DEVICE_LOCATION.GET_MAP_LOCATION"),visible:e.dialogVisible,"before-close":e.handleClose,width:"1000px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("div",{staticClass:"amap-page-container"},[a("el-row",{staticStyle:{"margin-bottom":"20px"},attrs:{gutter:20,type:"flex",align:"middle",justify:"center"}},[a("el-col",{attrs:{span:9}},[a("el-amap-search-box",{staticClass:"search-box",attrs:{"search-option":e.searchOption,"on-search-result":e.onSearchResult}})],1),a("el-col",{staticStyle:{color:"white",height:"100%"},attrs:{span:12}},[a("div",{staticClass:"toolbar",staticStyle:{color:"white",height:"100%"}},[a("div",[e._v(" "+e._s(e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.DEVICE_LOCATION.CURRENT_COORDINATE"))+": "+e._s(e.lng)+", "+e._s(e.lat)+" ")]),a("div",[e._v(" "+e._s(e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.DEVICE_LOCATION.CURRENT_LOCATION"))+": "+e._s(e.address)+" ")])])]),a("el-col",{attrs:{span:3}},[a("el-button",{attrs:{type:"primary"},on:{click:e.select}},[e._v(e._s(e.$t("COMMON.CONFIRM")))])],1)],1),a("el-amap",{ref:"centerMap",staticClass:"amap-box",attrs:{vid:"amap","amap-manager":e.amapManager,plugin:e.plugin,center:e.center,zoom:e.zoom,viewMode:"3D",events:e.events}},e._l(e.markers,(function(e,t){return a("el-amap-marker",{key:t,attrs:{position:e.position}})})),1)],1)])}),r=[],s=(a("d3b7"),a("159b"),a("8f9b")),l=new s["AMapManager"],c={name:"DeviceLocationConfig",props:{dialogVisible:{type:Boolean,default:!1},makerPosition:{type:Array,default:function(){return[121.59996,31.197646]}}},data:function(){var e=this;return{zoom:7,center:[121.59996,31.197646],amapManager:l,address:"",cityCode:"",searchOption:{city:"上海",citylimit:!1},mapCenter:[121.59996,31.197646],markers:[],plugin:[{pName:"ToolBar",events:{init:function(e){}}},{pName:"Geolocation",events:{init:function(t){console.error("init geolocation"),t.getCurrentPosition((function(t,a){console.error(a,t,"getCurrentPosition"),a&&a.position&&(console.log(a),e.address=a.formattedAddress,e.center=[a.position.lng,a.position.lat],e.loaded=!0,e.$nextTick(),e.lng=a.position.lng,e.lat=a.position.lat)}))}}}],events:{click:function(t){var a=t.lnglat,i=a.lng,n=a.lat;e.lng=i,e.lat=n,e.markers[0]={position:[i,n]};var o=new AMap.Geocoder({radius:1e3,extensions:"all"});o.getAddress([i,n],(function(t,a){"complete"===t&&"OK"===a.info&&a&&a.regeocode&&(e.address=a.regeocode.formattedAddress,e.$nextTick())}))}},lng:0,lat:0}},created:function(){this.mapCenter=this.makerPosition,this.lng=this.makerPosition[0],this.lat=this.makerPosition[1]},methods:{onSearchResult:function(e){var t=0,a=0;if(e.length>0){e.forEach((function(e){var i=e.lng,n=e.lat;a+=i,t+=n}));var i={lng:a/e.length,lat:t/e.length};this.mapCenter=[i.lng,i.lat]}},handleClose:function(e){this.$emit("update:dialogVisible",!1),this.$nextTick((function(){e()}))},select:function(){this.$emit("update:dialogVisible",!1),this.$emit("update:makerPosition",this.markers[0].position)}}},d=c,u=(a("6b09"),a("2877")),p=Object(u["a"])(d,o,r,!1,null,"d8cfda08",null),f=p.exports,m={components:{DeviceLocationConfig:f},props:{data:{type:Object,default:function(){return{}}},device:{type:[Object],default:function(){return{}}}},data:function(){return{positionShow:!1,locationArray:[]}},watch:{locationArray:function(e){this.formData.location=e.join(",")}},computed:{formData:{get:function(){return this.data},set:function(e){this.$emit("update:data",e)}}},methods:{showCheckLocation:function(){this.positionShow=!0}}},v=m,b=Object(u["a"])(v,i,n,!1,null,"2ccd00e5",null);t["default"]=b.exports},"57eb":function(e,t,a){},"5b81":function(e,t,a){"use strict";var i=a("23e7"),n=a("da84"),o=a("c65b"),r=a("e330"),s=a("1d80"),l=a("1626"),c=a("44e7"),d=a("577e"),u=a("dc4a"),p=a("ad6d"),f=a("0cb2"),m=a("b622"),v=a("c430"),b=m("replace"),h=RegExp.prototype,g=n.TypeError,_=r(p),E=r("".indexOf),D=r("".replace),y=r("".slice),C=Math.max,A=function(e,t,a){return a>e.length?-1:""===t?a:E(e,t,a)};i({target:"String",proto:!0},{replaceAll:function(e,t){var a,i,n,r,p,m,O,T,N,M=s(this),I=0,w=0,S="";if(null!=e){if(a=c(e),a&&(i=d(s("flags"in h?e.flags:_(e))),!~E(i,"g")))throw g("`.replaceAll` does not allow non-global regexes");if(n=u(e,b),n)return o(n,e,M,t);if(v&&a)return D(d(M),e,t)}r=d(M),p=d(e),m=l(t),m||(t=d(t)),O=p.length,T=C(1,O),I=A(r,p,0);while(-1!==I)N=m?d(t(p,I,r)):f(p,r,I,[],void 0,t),S+=y(r,w,I)+N,w=I+O,I=A(r,p,I+T);return w<r.length&&(S+=y(r,w)),S}})},"5b83":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-select",{staticClass:"w-100",attrs:{size:"medium",placeholder:e.$t("DEVICE_MANAGEMENT.PLACEHOLDER1"),"no-data-text":e.$t("PUBLIC.NODATA"),disabled:e.disabled,filterable:"",autocomplete:"off",clearable:e.clearable},on:{change:function(t){return e.handleChange()}},model:{value:e.device_group_id,callback:function(t){e.device_group_id=t},expression:"device_group_id"}},e._l(e.options,(function(e){return a("el-option",{key:e.id,attrs:{value:e.id,label:e.device_group}})})),1)},n=[],o=a("ed09"),r=Object(o["c"])({name:"DeviceGroupSelector",props:{disabled:{default:!1,type:Boolean},clearable:{default:!1,type:Boolean},asset_id:{required:!0,type:String},options:{required:!0,type:Array}},emits:["change"],setup:function(e,t){var a=Object(o["a"])({get:function(){return e.asset_id},set:function(e){t.emit("update:asset_id",e)}});function i(){t.emit("change")}return{device_group_id:a,handleChange:i}}}),s=r,l=a("2877"),c=Object(l["a"])(s,i,n,!1,null,"2bd2d760",null);t["default"]=c.exports},6316:function(e,t,a){},"6b09":function(e,t,a){"use strict";a("aee2")},"6fc1":function(e,t,a){},7509:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticStyle:{"justify-content":"space-between",display:"flex","margin-bottom":"10px"}},[a("span",[e._v(e._s(e.subscribeTitle))]),a("el-button",{attrs:{type:"border",size:"medium"},on:{click:e.getList}},[e._v("刷新")])],1),a("div",{staticStyle:{display:"flex",float:"left","margin-bottom":"10px"}},[a("el-button",{attrs:{type:"border",size:"medium"},on:{click:function(t){e.commandDialogVisible=!0}}},[e._v("下发命令")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.tableData}},[a("el-table-column",{attrs:{label:"命令标识符",prop:"command_identify",width:"240"}}),a("el-table-column",{attrs:{label:"命令参数",prop:"data",width:"auto"}}),a("el-table-column",{attrs:{label:"命令下发时间",prop:"send_time",width:"auto"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.dateFormat(t.row.send_time))+" ")]}}])}),a("el-table-column",{attrs:{label:"状态",prop:"send_status",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s("1"==t.row.send_status?e.$t("AUTOMATION.SUCEESSFUL"):e.$t("AUTOMATION.FAILURE"))+" ")]}}])})],1),a("div",{staticClass:"text-right py-3"},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:e.total,"current-page":e.params.current_page,"page-size":e.params.per_page},on:{"update:currentPage":function(t){return e.$set(e.params,"current_page",t)},"update:current-page":function(t){return e.$set(e.params,"current_page",t)},"current-change":e.getList}})],1),a("el-dialog",{attrs:{title:"下发命令","append-to-body":!0,visible:e.commandDialogVisible,width:"30%","before-close":e.handleClose},on:{"update:visible":function(t){e.commandDialogVisible=t}}},[a("el-form",{ref:"ruleFormRef",staticClass:"el-dark-input",attrs:{"label-position":"left",model:e.commandFormData,rules:e.commandFormRule,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"命令标识符",prop:"command_identifier"}},[a("el-select",{attrs:{filterable:"","allow-create":""},on:{change:e.handleChangeCommandId},model:{value:e.commandFormData.command_identifier,callback:function(t){e.$set(e.commandFormData,"command_identifier",t)},expression:"commandFormData.command_identifier"}},e._l(e.commands,(function(t,i){return a("el-option",{key:i,attrs:{label:t.commandName,value:t.commandId}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.commandName))]),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.commandId))])])})),1)],1),a("el-form-item",{attrs:{label:"命令参数",prop:"command_data"}},[a("el-input",{attrs:{type:"textarea",rows:12},model:{value:e.commandFormData.command_data,callback:function(t){e.$set(e.commandFormData,"command_data",t)},expression:"commandFormData.command_data"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"cancel"},on:{click:e.handleClose}},[e._v("取消")]),a("el-button",{attrs:{type:"save"},on:{click:e.handleSendCommand}},[e._v("发送")])],1)],1)],1)},n=[],o=a("5530"),r=(a("c740"),a("d3b7"),a("159b"),a("e9c4"),a("aa98")),s=a("2fa3"),l=a("3de1"),c={components:{},props:{device:{type:[Object],default:function(){return{}}}},data:function(){return{dateFormat:l["a"],loading:!1,tableData:[],total:0,params:{current_page:1,per_page:10},commandDialogVisible:!1,commandFormData:{command_data:"{}"},commands:[],commandFormRule:{command_identifier:[{required:!0,message:"请选择命令标识符",trigger:"change"}],command_data:[{required:!0,message:"请输入命令内容",trigger:"blur"}]},subscribeTitle:"设备订阅命令主题:  device/command/"+this.device.token}},mounted:function(){"1"===this.device.device_type?this.subscribeTitle="设备订阅命令主题:  device/command/"+this.device.token:"2"===this.device.device_type&&"MQTT"===this.device.protocol?this.subscribeTitle="设备订阅命令主题:  gateway/command/"+this.device.token:this.subscribeTitle="",console.log("Command.device",this.device),this.getList(),this.getDeviceCommandList()},methods:{getList:function(){var e=this;Object(r["m"])(Object(o["a"])({device_id:this.device.device},this.params)).then((function(t){var a=t.data;200===a.code&&(e.tableData=a.data.data,e.total=a.data.total,console.log(e.tableData))}))},getDeviceCommandList:function(){var e=this;Object(r["n"])({device_id:this.device.device}).then((function(t){var a=t.data;200===a.code&&(e.commands=a.data)}))},handleChangeCommandId:function(e){var t=this;this.commands.findIndex((function(a){if(a.commandId===e){console.log("command.commandParams",a.commandParams);var i={};a.commandParams.forEach((function(e){switch(e.type.toLowerCase()){case"text":i[e.identifier]="";break;case"integer":case"float":case"number":i[e.identifier]=0;break;case"object":i[e.identifier]={};break;case"list":i[e.identifier]=[];break;default:i[e.identifier]="";break}})),t.commandFormData.command_data=JSON.stringify(i,null,4),console.log("params",i)}})),console.log("handleChangeCommandId",e,this.commands)},handleSendCommand:function(){var e=this;this.$refs["ruleFormRef"].validate((function(t){if(!t)return!1;Object(r["u"])(Object(o["a"])({device_id:e.device.device},e.commandFormData)).then((function(t){var a=t.data;200===a.code&&(Object(s["i"])("命令下发成功"),e.commandDialogVisible=!1,e.getList())}))}))},handleClose:function(){this.commandDialogVisible=!1}}},d=c,u=a("2877"),p=Object(u["a"])(d,i,n,!1,null,"20a3b64b",null);t["default"]=p.exports},"75fe":function(e,t,a){},"7fc0":function(e,t,a){"use strict";a("75fe")},8083:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return r}));a("d3b7"),a("a434"),a("b0c0"),a("4de4"),a("ac1f"),a("1276");var i=a("308f"),n=a("2fa3"),o=a("ed09");function r(e,t,a,r){var s=Object(o["i"])(!1);function l(){e.value.unshift({id:"",name:"",parent_id:"0",errors:{name:"",parent_id:""}})}function c(t){if(t.id){if(s.value)return;s.value=!0,Object(i["b"])({id:t.id}).then((function(i){var o=i.data;if(200===o.code){Object(n["i"])("删除成功");var r=e.value.indexOf(t);e.value.splice(r,1),a()}})).finally((function(){s.value=!1}))}else{var o=e.value.indexOf(t);e.value.splice(o,1)}}function d(e){if(e.errors.name="",e.errors.parent_id="",e.name)if(e.parent_id){if(e.id===e.parent_id)return e.errors.parent_id="上级分组不能是自己",void Object(n["h"])("上级分组不能是自己");var o=u(e,r);console.log("group",e),e.id?Object(i["h"])({business_id:t.value,id:e.id,name:e.name,parent_id:e.parent_id,tier:o}).then((function(e){var t=e.data;200===t.code&&(Object(n["i"])("修改成功"),a())})):Object(i["a"])({business_id:t.value,name:e.name,parent_id:e.parent_id,tier:o}).then((function(e){var t=e.data;200===t.code&&(Object(n["i"])("添加成功"),a())}))}else e.errors.parent_id="请选择分组";else e.errors.name="请填写用户名"}function u(e,t){var a=1;if("0"===e.parent_id)a=1;else{var i=t.value.filter((function(t){return t.id===e.parent_id}));if(i.length){var n=i[0].device_group;a=n.split("/").filter((function(e){return e})).length+1}}return a}return{handleCreate:l,handleDelete:c,handleSave:d}}},"83bb":function(e,t,a){},8553:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{margin:"20px 0"}},[a("el-form",{ref:"configForm",attrs:{model:e.formData,rules:e.formRules,"label-width":"260px"}},e._l(e.attrs,(function(t,i){return a("el-form-item",{key:i,attrs:{label:t.label,prop:t.dataKey}},["input"===t.type&&"number"!==t.validate.type?a("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:t.placeholder},model:{value:e.formData[t.dataKey],callback:function(a){e.$set(e.formData,t.dataKey,a)},expression:"formData[attr.dataKey]"}}):"input"===t.type&&"number"===t.validate.type?a("el-input-number",{staticStyle:{width:"80%"},attrs:{placeholder:t.placeholder},model:{value:e.formData[t.dataKey],callback:function(a){e.$set(e.formData,t.dataKey,a)},expression:"formData[attr.dataKey]"}}):"select"===t.type?a("el-select",{staticStyle:{width:"80%"},model:{value:e.formData[t.dataKey],callback:function(a){e.$set(e.formData,t.dataKey,a)},expression:"formData[attr.dataKey]"}},e._l(t.options,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1):e._e(),"table"===t.type?a("el-button",{attrs:{type:"save",size:"medium"},on:{click:function(a){return e.handleShowTableDialog(t)}}},[e._v(e._s(t.label))]):e._e()],1)})),1),a("data-parse-table",{attrs:{visible:e.dialogVisible,attrs:e.currentTableAttr,data:e.currentTableData},on:{"update:visible":function(t){e.dialogVisible=t},"update:data":function(t){e.currentTableData=t},submit:e.handleTableSubmit}})],1)},n=[],o=(a("d3b7"),a("159b"),a("fb6a"),a("4d63"),a("c607"),a("ac1f"),a("2c3e"),a("25f0"),a("e9c4"),a("d9e2"),a("d2f4")),r={components:{DataParseTable:o["default"]},props:{data:{type:Object,default:function(){return{}}},attrs:{type:Array,default:function(){return[]}}},data:function(){return{dialogVisible:!1,currentTableAttr:{},currentTableData:[]}},computed:{formRules:{get:function(){var e={};return this.attrs.forEach((function(t){if("table"!==t.type&&(e[t.dataKey]=[t.validate],t.validate.rules)){var a=t.validate.rules.slice(1,-1),i=new RegExp(a);e[t.dataKey].push({pattern:i,message:t.validate.message,trigger:"blur"})}})),e}},formData:{get:function(){if(console.log("computed.data",JSON.stringify(this.data)),this.data&&"{}"!==JSON.stringify(this.data))return this.data;var e={};return this.attrs.forEach((function(t){console.log("computed.forEach.attr",t),"input"===t.type?e[t.dataKey]="number"===t.validate.type?0:"":"table"===t.type&&(e[t.dataKey]=[])})),console.log("computed.obj",e),e}}},watch:{formData:{handler:function(e){console.log("watch.formData",e),JSON.stringify(e)!==JSON.stringify(this.data)&&this.$emit("update:data",e)},deep:!0,immediate:!0}},methods:{handleShowTableDialog:function(e){console.log("handleShowTableDialog",e),this.currentTableAttr=e,this.currentTableData=this.formData[e.dataKey],this.dialogVisible=!0},handleTableSubmit:function(e){console.log("handleTableSubmit",e),this.formData[this.currentTableAttr.dataKey]=e},validate:function(e){console.log("this.$refs.tableRef",this.$refs.tableRef),console.log("dataparse.formData",this.formData);try{this.$refs.configForm.validate((function(e){if(!e)throw new Error("")})),e(!0)}catch(t){console.log(t),e(!1)}}}},s=r,l=(a("9a74"),a("2877")),c=Object(l["a"])(s,i,n,!1,null,"3167314c",null);t["default"]=c.exports},"86fa":function(e,t,a){"use strict";a("4cf2")},"87cb":function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return r}));var i=a("1da1"),n=(a("ac1f"),a("1276"),a("a4d3"),a("e01a"),a("d81d"),a("d3b7"),a("96cf"),a("b705")),o=a("3b63");function r(){function e(){return t.apply(this,arguments)}function t(){return t=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,s("DRIECT_ATTACHED_PROTOCOL");case 2:return t=e.sent,t.unshift({value:"mqtt",label:"官方MQTT协议"}),t.push({value:"ezviz",label:"萤石云视频协议"}),e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)}))),t.apply(this,arguments)}function a(){return n.apply(this,arguments)}function n(){return n=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,s("GATEWAY_PROTOCOL");case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)}))),n.apply(this,arguments)}function r(e){return l.apply(this,arguments)}function l(){return l=Object(i["a"])(regeneratorRuntime.mark((function e(t){var a,i,n,r,s,l,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a={current_page:1,per_page:10,protocol_type:t.protocol,device_type:t.device_type},e.next=3,o["a"].page(a);case 3:if(i=e.sent,n=i.data,200!=n.code){e.next=18;break}if(console.log("====getDefaultSetting.getCustomConnectInformation",n.data.data),n.data.data){e.next=9;break}return e.abrupt("return",[]);case 9:if(r=n.data.data[0],s=r.access_address.split(":")[1],l=r.description?r.description:"",c=r.additional_info?JSON.parse(r.additional_info):[],!(c.length>0)){e.next=17;break}return e.abrupt("return",c.map((function(e){return{label:e.key,value:e.value}})));case 17:return e.abrupt("return",[{label:"协议端口",value:s},{label:"描述",value:l}]);case 18:case"end":return e.stop()}}),e)}))),l.apply(this,arguments)}return{getDeviceProtocolList:e,getGatewayProtocolList:a,getCustomConnectInformation:r}}var s=function(e){return new Promise((function(t,a){var i={current_page:1,per_page:9999,dict_code:e};n["a"].list(i).then((function(e){var i=e.data;if(200==i.code){var n=i.data.data.map((function(e){return{label:e.describe,value:e.dict_value}}));t(n)}else a(i)}))}))}},9448:function(e,t,a){"use strict";var i=a("18a6");t["a"]={add:function(e){return Object(i["a"])({url:"/device/model/add",method:"post",data:e})},edit:function(e){return Object(i["a"])({url:"/device/model/edit",method:"post",data:e})},del:function(e){return Object(i["a"])({url:"/device/model/delete",method:"post",data:e})},page:function(e){return Object(i["a"])({url:"/device/model/list",method:"post",data:e})},tree:function(e){return Object(i["a"])({url:"/device/model/tree",method:"post",data:e})},category:function(e){return Object(i["a"])({url:"/dict/list/",method:"post",data:e})},map:function(e){return Object(i["a"])({url:"/device/map",method:"post",data:e})},equip:function(e){return Object(i["a"])({url:"/kv/current/symbol",method:"post",data:e})},state:function(e){return Object(i["a"])({url:"/device/status",method:"post",data:e})}}},"972c6":function(e,t,a){"use strict";a("83bb")},"9a6c":function(e,t,a){"use strict";a("c4ff")},"9a74":function(e,t,a){"use strict";a("6316")},"9ac2":function(e,t,a){},"9cf9d":function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return o}));a("d81d"),a("b0c0");var i=a("ed09"),n=a("308f");function o(e){var t=Object(i["i"])([]),a=Object(i["h"])({business_id:e.value,current_page:1,per_page:10}),o=Object(i["i"])(0);function r(){Object(n["g"])(a).then((function(e){var a=e.data;200===a.code&&(a.data?t.value=l(a.data):t.value=[])}))}function s(){a.current_page=1,a.business_id=e.value,r()}function l(e){return e.map((function(e){return{id:e.id,name:e.name,parent_id:e.parent_id,errors:{name:"",parent_id:""}}}))}return r(),{tableData:t,params:a,total:o,getGroupIndex:r,handleSearch:s}}},a44a:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"el-dark-dialog el-dark-input",attrs:{width:"800px",title:e.$t("DEVICE_MANAGEMENT.CUSTOM_SCRIPT.TITLE"),"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,visible:e.dialogVisible,"append-to-body":!0},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{ref:"customForm",attrs:{model:e.formData,rules:e.formRule}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$t("DEVICE_MANAGEMENT.CUSTOM_SCRIPT.COMPANYNAME"),prop:"companyName"}},[a("el-input",{model:{value:e.formData.company,callback:function(t){e.$set(e.formData,"company",t)},expression:"formData.company"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:e.$t("DEVICE_MANAGEMENT.CUSTOM_SCRIPT.PRODUCTNAME"),prop:"productName"}},[a("el-input",{model:{value:e.formData.product_name,callback:function(t){e.$set(e.formData,"product_name",t)},expression:"formData.product_name"}})],1)],1)],1),a("p",{staticClass:"code-editor-label"},[e._v(e._s(e.$t("DEVICE_MANAGEMENT.CUSTOM_SCRIPT.TEXT1")))]),a("CodeEditor",{key:"upside",staticClass:"dark-code-editor",staticStyle:{width:"100%",height:"260px","overflow-y":"auto"},attrs:{min_height:"260px",copy_code:!0,hide_header:!1,theme:"dark",wrap_code:!0},model:{value:e.formData.script_content_a,callback:function(t){e.$set(e.formData,"script_content_a",t)},expression:"formData.script_content_a"}}),a("p",{staticClass:"code-editor-label"},[e._v(e._s(e.$t("DEVICE_MANAGEMENT.CUSTOM_SCRIPT.TEXT2")))]),a("CodeEditor",{key:"down",staticClass:"dark-code-editor",staticStyle:{width:"100%",height:"260px"},attrs:{min_height:"260px",copy_code:!0,hide_header:!1,theme:"dark",wrap_code:!0},model:{value:e.formData.script_content_b,callback:function(t){e.$set(e.formData,"script_content_b",t)},expression:"formData.script_content_b"}}),a("el-tabs",{model:{value:e.testTabValue,callback:function(t){e.testTabValue=t},expression:"testTabValue"}},[a("el-tab-pane",{attrs:{label:"模拟输入",name:"input"}},[a("div",{staticStyle:{"margin-bottom":"4px"}},[a("span",[e._v("Topic： ")]),a("el-select",{attrs:{size:"small"},model:{value:e.formData.topic,callback:function(t){e.$set(e.formData,"topic",t)},expression:"formData.topic"}},[a("el-option",{attrs:{label:"device/attributes",value:"device/attributes"}}),a("el-option",{attrs:{label:"device/event ",value:"device/event "}}),a("el-option",{attrs:{label:"gateway/attributes ",value:"gateway/attributes "}}),a("el-option",{attrs:{label:"gateway/event ",value:"gateway/event "}})],1)],1),a("CodeEditor",{key:"input",staticClass:"dark-code-editor",staticStyle:{width:"100%",height:"100px"},attrs:{min_height:"100px",copy_code:!0,hide_header:!0,theme:"dark",wrap_code:!0},model:{value:e.formData.msg_content,callback:function(t){e.$set(e.formData,"msg_content",t)},expression:"formData.msg_content"}})],1),a("el-tab-pane",{attrs:{label:"运行结果",name:"result"}},[a("CodeEditor",{key:"result",staticClass:"dark-code-editor",staticStyle:{width:"100%",height:"100px"},attrs:{min_height:"100px",copy_code:!0,hide_header:!0,theme:"dark",wrap_code:!0,read_only:!0},model:{value:e.formData.result,callback:function(t){e.$set(e.formData,"result",t)},expression:"formData.result"}})],1)],1),a("div",{staticStyle:{"margin-top":"10px",display:"flex","justify-content":"center"}},[a("el-button",{attrs:{type:"save"},on:{click:e.onUpTest}},[e._v("上行脚本调试")]),a("el-button",{attrs:{type:"save"},on:{click:e.onDownTest}},[e._v("下行脚本调试")]),a("el-button",{attrs:{type:"save"},on:{click:e.onSubmit}},[e._v(e._s(e.$t("DEVICE_MANAGEMENT.CUSTOM_SCRIPT.SAVE")))]),a("el-button",{attrs:{type:"save"},on:{click:e.onPublish}},[e._v("发布")]),a("el-button",{staticStyle:{color:"#000"},attrs:{type:"cancel"},on:{click:e.closeDialog}},[e._v(e._s(e.$t("DEVICE_MANAGEMENT.CUSTOM_SCRIPT.CANCEL")))])],1)],1),a("login-store",{attrs:{visible:e.loginStoreDialogVisible},on:{"update:visible":function(t){e.loginStoreDialogVisible=t}}})],1)},n=[],o=a("ed09"),r=a("f314"),s=(a("2fa3"),a("73f5")),l=a("aa98"),c=a("f8b4"),d=a("dd94"),u=a("6eee"),p=" function encodeInp(msg, topic){\n    // 将设备自定义msg（自定义形式）数据转换为json形式数据, 设备上报数据到物联网平台时调用\n    // 入参：topic string 设备上报消息的 topic\n    // 入参：msg byte[] 数组 不能为空\n    // 出参：string\n    // 处理完后将对象转回字符串形式\n    // 例，byte[]转string：var msgString = String.fromCharCode.apply(null, msg);\n    // 例，string转jsonObj：msgJson = JSON.parse(msgString);\n    // 例，jsonObj转string：msgString = JSON.stringify(msgJson);\n    var msgString = String.fromCharCode.apply(null, msg);\n    return msgString;\n }",f=" function encodeInp(msg, topic){\n    // 将平台规范的msg（json形式）数据转换为设备自定义形式数据, 物联网平台发送数据到设备时调用\n    // 入参：topic string 设备上报消息的 topic\n    // 入参：msg byte[] 数组 不能为空\n    // 出参：string\n    // 处理完后将对象转回字符串形式\n    // 例，byte[]转string：var msgString = String.fromCharCode.apply(null, msg);\n    // 例，string转jsonObj：msgJson = JSON.parse(msgString);\n    // 例，jsonObj转string：msgString = JSON.stringify(msgJson);\n    var msgString = String.fromCharCode.apply(null, msg);\n    return msgString;\n }",m=Object(o["c"])({name:"CustomExchangeAgreement",components:{CodeEditor:r["a"],LoginStore:c["default"]},props:{dialogVisible:{type:[Boolean],default:!1},data:{type:[Object],default:{}},device:{type:[Object]},connectInfo:{type:[Object,Array]}},setup:function(e,t){var a=Object(d["a"])(),i=(a.route,Object(o["h"])({id:"",company:"",product_name:"",script_content_a:p,script_content_b:f,script_type:"javascript",topic:"device/attributes",msg_content:"{}",result:""})),n={company:[{required:!0,message:"请输入公司名称"}],product_name:[{required:!0,message:"请输入产品名称"}]};function r(e){Object(l["l"])({current_page:1,per_page:10,id:e}).then((function(e){var t=e.data;if(200==t.code){var a=t.data.data[0];i.company=a.company,i.product_name=a.product_name,i.script_content_a=a.script_content_a,console.log("getCustomExchangeAgreementList",i.script_content_a),i.script_content_b=a.script_content_b}}))}function c(){t.emit("update:dialogVisible",!1)}Object(o["j"])((function(){return e.dialogVisible}),(function(t){t&&(i.id=e.data.id,i.protocol_type=e.data.protocol_type,i.id?r(i.id):(i.company="",i.product_name="",i.script_content_a=p,i.script_content_b=f))}));var m=Object(o["i"])(null),v=Object(o["i"])("input");function b(){var e=i.script_content_a,t=i.msg_content,a=i.topic;g(e,t,a)}function h(){var t=i.script_content_b,a=i.msg_content,n=i.topic;g(t,a,n+"/"+e.device.token)}function g(e,t,a){i.result="",Object(l["y"])({script_content:e,msg_content:t,topic_content:a}).then((function(e){var t=e.data;t.code,i.result=t.message,v.value="result"}))}function _(){i.script_name=i.company+""+i.product_name,i.protocol_type=e.device.protocol,i.device_type=e.device.device_type,i.script_content_a=i.script_content_a,i.script_content_b=i.script_content_b,m.value.validate((function(e){if(!e)return!1;i.id?Object(l["k"])(i).then((function(e){var a=e.data;200==a.code&&t.emit("submit",i.id)})):Object(l["a"])(i).then((function(e){var a=e.data;200==a.code&&t.emit("submit",a.data.id)}))}))}var E=Object(o["i"])(!1);function D(){var t=u["a"].getters.getStoreAuthenticated;if(t){var a={productCompany:i.company,productName:i.product_name,protocolType:e.device.protocol,scriptAuthor:"",scriptDescribe:"",scriptName:i.company+""+i.product_name,uplinkScript:i.script_content_a,downlinkScript:i.script_content_b};s["a"].publish.script(a).then((function(e){var t=e.data;console.log(t)}))}else E.value=!0}return{customForm:m,formRule:n,formData:i,closeDialog:c,onUpTest:b,onDownTest:h,testTabValue:v,onSubmit:_,onPublish:D,loginStoreDialogVisible:E}}}),v=m,b=(a("2cd9"),a("2877")),h=Object(b["a"])(v,i,n,!1,null,"b96d1dee",null);t["default"]=h.exports},a4fd:function(e,t,a){"use strict";a("2df4")},a7a0:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return s}));var i=a("1da1"),n=(a("96cf"),a("d3b7"),a("159b"),a("d81d"),a("99af"),a("9448")),o=a("aa98"),r=a("2fa3");a("73f5");function s(){var e=null;function t(){return a.apply(this,arguments)}function a(){return a=Object(i["a"])(regeneratorRuntime.mark((function t(){var a,i,o,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e){t.next=10;break}return a=[],t.next=4,n["a"].tree();case 4:i=t.sent,o=i.data,a=200===o.code?s(o.data):[],r=[],e=a.concat(r),console.log("pluginList",e);case 10:return t.abrupt("return",e);case 11:case"end":return t.stop()}}),t)}))),a.apply(this,arguments)}function s(e){var t=[];return e.forEach((function(e){e.device_model&&e.device_model.forEach((function(e){t.push({id:e.id,name:e.model_name,type:e.model_type,author:e.author,status:"install"})}))})),t}function l(e,t,a){var i={id:e.id,type:t.id};Object(o["j"])(i).then((function(e){var t=e.data;200==t.code&&(Object(r["i"])("绑定成功！"),a&&a())})).catch((function(e){}))}return{getPluginTree:t,bindPlugin:l}}},a902:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-select",{staticClass:"w-100",attrs:{size:"medium",placeholder:e.$t("DEVICE_MANAGEMENT.PLACEHOLDER4"),disabled:3==e.deviceType||!!e.currentItem.children,filterable:"",clearable:e.clearable},on:{change:e.handleChange},model:{value:e.deviceTypeId,callback:function(t){e.deviceTypeId=t},expression:"deviceTypeId"}},e._l(e.options,(function(e){return a("el-option",{key:e.value,attrs:{value:e.value,label:e.label}})})),1)},n=[],o=a("ed09"),r=a("f570"),s=Object(o["c"])({name:"DeviceTypeSelector",props:{clearable:{default:!1,type:Boolean},deviceType:{type:[String],default:"1"},currentItem:{type:[Object],default:function(){return{}}},disabled:{type:[Boolean],default:!1},options:{type:[Array],default:function(){return[{value:"1",label:r["a"].t("DEVICE_MANAGEMENT.EQUIPMENT")},{value:"2",label:r["a"].t("DEVICE_MANAGEMENT.THEGATEWAY")}]}}},emits:["change"],setup:function(e,t){var a=Object(o["a"])({get:function(){return"3"==e.deviceType?"1":e.deviceType},set:function(e){t.emit("update:deviceType",e),t.emit("change",e)}});function i(e){}return{deviceTypeId:a,handleChange:i}}}),l=s,c=a("2877"),d=Object(c["a"])(l,i,n,!1,null,"ec25dfb6",null);t["default"]=d.exports},aee2:function(e,t,a){},b183:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return o}));var i=a("ed09"),n=a("308f");function o(e){var t=Object(i["i"])([]);function a(){Object(n["i"])({business_id:e}).then((function(e){var a=e.data;200===a.code&&a.data&&(t.value=a.data)}))}return a(),{deviceGroupOptions:t,getGroupOptions:a}}},b2eb:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var i=a("1da1"),n=a("5530"),o=(a("96cf"),a("e9c4"),a("30ab")),r=(a("add0"),"ws://ws.qylian.cn/ws/device/current"),s=function(){var e=null,t=null,a=null,s=function(i){"undefined"===typeof WebSocket?alert("您的浏览器不支持socket"):(e=new WebSocket(r),e.onerror=function(t){console.log("ws连接发生错误",t),e=null,i&&i({code:401,message:"连接失败"})},e.onopen=function(){console.log("ws连接成功",new Date),t&&t(),i&&i({code:200,message:"连接成功"})},e.onclose=function(){console.log("ws连接关闭",new Date),e=null,a&&a(),i&&i({code:400,message:"连接关闭"})})},l=function(e){t=e},c=function(e){a=e},d=function(t){var a=Object(n["a"])(Object(n["a"])({},t),{},{token:o["a"].getToken()});e&&e.send(JSON.stringify(a))},u=function(t){e&&(e.onmessage=function(e){console.log("onMessage",e.data),t&&t(e.data)})},p=function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e){t.next=4;break}return t.next=3,e.close();case 3:e=null;case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return{init:s,send:d,onReady:l,onClose:c,onMessage:u,close:p}}},b705:function(e,t,a){"use strict";var i=a("18a6");t["a"]={list:function(e){return Object(i["a"])({url:"/dict/list/",method:"post",data:e})}}},bbd6:function(e,t,a){var i,n,o;((a,r)=>{n=[],i=r,o="function"===typeof i?i.apply(t,n):i,void 0===o||(e.exports=o)})(0,e=>{"use strict";var t=(e,t)=>{if("farzher"==e)return{target:"farzher was here (^-^*)/",score:0,_indexes:[0]};if(!e||!t)return N;var a=c(e);C(t)||(t=l(t));var i=a.bitflags;return(i&t._bitflags)!==i?N:u(a,t)},a=(e,t,a)=>{if("farzher"==e)return[{target:"farzher was here (^-^*)/",score:0,_indexes:[0],obj:t?t[0]:N}];if(!e)return a&&a.all?d(e,t,a):T;var i=c(e),n=i.bitflags,o=(i.containsSpace,a&&a.threshold||O),r=a&&a["limit"]||A,s=0,p=0,f=t.length;if(a&&a.key)for(var m=a.key,v=0;v<f;++v){var b=t[v],h=y(b,m);if(h&&(C(h)||(h=l(h)),(n&h._bitflags)===n)){var g=u(i,h);g!==N&&(g.score<o||(g={target:g.target,_targetLower:"",_targetLowerCodes:N,_nextBeginningIndexes:N,_bitflags:0,score:g.score,_indexes:g._indexes,obj:b},s<r?(I.add(g),++s):(++p,g.score>I.peek().score&&I.replaceTop(g))))}}else if(a&&a.keys){var _=a["scoreFn"]||D,E=a.keys,M=E.length;for(v=0;v<f;++v){b=t[v];for(var w=new Array(M),S=0;S<M;++S){m=E[S],h=y(b,m);h?(C(h)||(h=l(h)),(n&h._bitflags)!==n?w[S]=N:w[S]=u(i,h)):w[S]=N}w.obj=b;var x=_(w);x!==N&&(x<o||(w.score=x,s<r?(I.add(w),++s):(++p,x>I.peek().score&&I.replaceTop(w))))}}else for(v=0;v<f;++v){h=t[v];if(h&&(C(h)||(h=l(h)),(n&h._bitflags)===n)){g=u(i,h);g!==N&&(g.score<o||(s<r?(I.add(g),++s):(++p,g.score>I.peek().score&&I.replaceTop(g))))}}if(0===s)return T;var k=new Array(s);for(v=s-1;v>=0;--v)k[v]=I.poll();return k.total=s+p,k},i=(e,t,a)=>{if("function"===typeof t)return n(e,t);if(e===N)return N;void 0===t&&(t="<b>"),void 0===a&&(a="</b>");var i="",o=0,r=!1,s=e.target,l=s.length,c=e._indexes;c=c.slice(0,c.len).sort((e,t)=>e-t);for(var d=0;d<l;++d){var u=s[d];if(c[o]===d){if(++o,r||(r=!0,i+=t),o===c.length){i+=u+a+s.substr(d+1);break}}else r&&(r=!1,i+=a);i+=u}return i},n=(e,t)=>{if(e===N)return N;var a=e.target,i=a.length,n=e._indexes;n=n.slice(0,n.len).sort((e,t)=>e-t);for(var o="",r=0,s=0,l=!1,c=(e=[],0);c<i;++c){var d=a[c];if(n[s]===c){if(++s,l||(l=!0,e.push(o),o=""),s===n.length){o+=d,e.push(t(o,r++)),o="",e.push(a.substr(c+1));break}}else l&&(l=!1,e.push(t(o,r++)),o="");o+=d}return e},o=e=>e._indexes.slice(0,e._indexes.len).sort((e,t)=>e-t),r=e=>{"string"!==typeof e&&(e="");var t=f(e);return{target:e,_targetLower:t._lower,_targetLowerCodes:t.lowerCodes,_nextBeginningIndexes:N,_bitflags:t.bitflags,score:N,_indexes:[0],obj:N}},s=e=>{"string"!==typeof e&&(e=""),e=e.trim();var t=f(e),a=[];if(t.containsSpace){var i=e.split(/\s+/);i=[...new Set(i)];for(var n=0;n<i.length;n++)if(""!==i[n]){var o=f(i[n]);a.push({lowerCodes:o.lowerCodes,_lower:i[n].toLowerCase(),containsSpace:!1})}}return{lowerCodes:t.lowerCodes,bitflags:t.bitflags,containsSpace:t.containsSpace,_lower:t._lower,spaceSearches:a}},l=e=>{if(e.length>999)return r(e);var t=h.get(e);return void 0!==t||(t=r(e),h.set(e,t)),t},c=e=>{if(e.length>999)return s(e);var t=g.get(e);return void 0!==t||(t=s(e),g.set(e,t)),t},d=(e,t,a)=>{var i=[];i.total=t.length;var n=a&&a.limit||A;if(a&&a.key)for(var o=0;o<t.length;o++){var r=t[o],s=y(r,a.key);if(s){C(s)||(s=l(s)),s.score=O,s._indexes.len=0;var c=s;if(c={target:c.target,_targetLower:"",_targetLowerCodes:N,_nextBeginningIndexes:N,_bitflags:0,score:s.score,_indexes:N,obj:r},i.push(c),i.length>=n)return i}}else if(a&&a.keys)for(o=0;o<t.length;o++){r=t[o];for(var d=new Array(a.keys.length),u=a.keys.length-1;u>=0;--u){s=y(r,a.keys[u]);s?(C(s)||(s=l(s)),s.score=O,s._indexes.len=0,d[u]=s):d[u]=N}if(d.obj=r,d.score=O,i.push(d),i.length>=n)return i}else for(o=0;o<t.length;o++){s=t[o];if(s&&(C(s)||(s=l(s)),s.score=O,s._indexes.len=0,i.push(s),i.length>=n))return i}return i},u=(e,t,a=!1)=>{if(!1===a&&e.containsSpace)return p(e,t);for(var i=e._lower,n=e.lowerCodes,o=n[0],r=t._targetLowerCodes,s=n.length,l=r.length,c=0,d=0,u=0;;){var f=o===r[d];if(f){if(_[u++]=d,++c,c===s)break;o=n[c]}if(++d,d>=l)return N}c=0;var m=!1,b=0,h=t._nextBeginningIndexes;h===N&&(h=t._nextBeginningIndexes=v(t.target));d=0===_[0]?0:h[_[0]-1];var g=0;if(d!==l)for(;;)if(d>=l){if(c<=0)break;if(++g,g>200)break;--c;var D=E[--b];d=h[D]}else{f=n[c]===r[d];if(f){if(E[b++]=d,++c,c===s){m=!0;break}++d}else d=h[d]}var y=t._targetLower.indexOf(i,_[0]),C=~y;if(C&&!m)for(var A=0;A<u;++A)_[A]=y+A;var O=!1;if(C&&(O=t._nextBeginningIndexes[y-1]===y),m)var T=E,M=b;else T=_,M=u;var I=0,w=0;for(A=1;A<s;++A)T[A]-T[A-1]!==1&&(I-=T[A],++w);var S=T[s-1]-T[0]-(s-1);if(I-=(12+S)*w,0!==T[0]&&(I-=T[0]*T[0]*.2),m){var x=1;for(A=h[0];A<l;A=h[A])++x;x>24&&(I*=10*(x-24))}else I*=1e3;C&&(I/=1+s*s*1),O&&(I/=1+s*s*1),I-=l-s,t.score=I;for(A=0;A<M;++A)t._indexes[A]=T[A];return t._indexes.len=M,t},p=(e,t)=>{for(var a=new Set,i=0,n=N,o=0,r=e.spaceSearches,s=0;s<r.length;++s){var l=r[s];if(n=u(l,t),n===N)return N;i+=n.score,n._indexes[0]<o&&(i-=o-n._indexes[0]),o=n._indexes[0];for(var c=0;c<n._indexes.len;++c)a.add(n._indexes[c])}var d=u(e,t,!0);if(d!==N&&d.score>i)return d;n.score=i;s=0;for(let u of a)n._indexes[s++]=u;return n._indexes.len=s,n},f=e=>{for(var t=e.length,a=e.toLowerCase(),i=[],n=0,o=!1,r=0;r<t;++r){var s=i[r]=a.charCodeAt(r);if(32!==s){var l=s>=97&&s<=122?s-97:s>=48&&s<=57?26:s<=127?30:31;n|=1<<l}else o=!0}return{lowerCodes:i,bitflags:n,containsSpace:o,_lower:a}},m=e=>{for(var t=e.length,a=[],i=0,n=!1,o=!1,r=0;r<t;++r){var s=e.charCodeAt(r),l=s>=65&&s<=90,c=l||s>=97&&s<=122||s>=48&&s<=57,d=l&&!n||!o||!c;n=l,o=c,d&&(a[i++]=r)}return a},v=e=>{for(var t=e.length,a=m(e),i=[],n=a[0],o=0,r=0;r<t;++r)n>r?i[r]=n:(n=a[++o],i[r]=void 0===n?t:n);return i},b=()=>{h.clear(),g.clear(),_=[],E=[]},h=new Map,g=new Map,_=[],E=[],D=e=>{for(var t=O,a=e.length,i=0;i<a;++i){var n=e[i];if(n!==N){var o=n.score;o>t&&(t=o)}}return t===O?N:t},y=(e,t)=>{var a=e[t];if(void 0!==a)return a;var i=t;Array.isArray(t)||(i=t.split("."));var n=i.length,o=-1;while(e&&++o<n)e=e[i[o]];return e},C=e=>"object"===typeof e,A=1/0,O=-A,T=[];T.total=0;var N=null,M=e=>{var t=[],a=0,i={},n=e=>{for(var i=0,n=t[i],o=1;o<a;){var r=o+1;i=o,r<a&&t[r].score<t[o].score&&(i=r),t[i-1>>1]=t[i],o=1+(i<<1)}for(var s=i-1>>1;i>0&&n.score<t[s].score;s=(i=s)-1>>1)t[i]=t[s];t[i]=n};return i.add=e=>{var i=a;t[a++]=e;for(var n=i-1>>1;i>0&&e.score<t[n].score;n=(i=n)-1>>1)t[i]=t[n];t[i]=e},i.poll=e=>{if(0!==a){var i=t[0];return t[0]=t[--a],n(),i}},i.peek=e=>{if(0!==a)return t[0]},i.replaceTop=e=>{t[0]=e,n()},i},I=M();return{single:t,go:a,highlight:i,prepare:r,indexes:o,cleanup:b}})},c0f1:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",{staticClass:"px-3 pb-3",attrs:{type:"flex"}},[a("el-col",{staticClass:"pt-2 label-name",attrs:{span:5}},[e._v(" "+e._s(e.$t("DEVICE_MANAGEMENT.MANAGEMENT_GROUP_MODEL.BUSINESSNAME"))+" ")]),a("el-col",{attrs:{span:10}},[a("BusinessSelector",{attrs:{business_id:e.business_id,clearable:!1},on:{"update:business_id":function(t){e.business_id=t},change:function(t){return e.handleSearch()}}})],1),a("el-col",{attrs:{span:11}},[a("div",{staticClass:"text-right"},[a("el-button",{attrs:{type:"indigo",size:"medium"},on:{click:function(t){return e.handleCreate()}}},[e._v(e._s(e.$t("DEVICE_MANAGEMENT.MANAGEMENT_GROUP_MODEL.ADD")))])],1)])],1),a("el-form",{staticClass:"inline-edit"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,fit:""}},[a("el-table-column",{attrs:{label:e.$t("DEVICE_MANAGEMENT.MANAGEMENT_GROUP_MODEL.GROUPNAME"),width:"auto","min-width":"40%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form-item",{attrs:{error:t.row.errors.name}},[a("el-input",{attrs:{size:"medium"},on:{change:function(a){return e.handleSave(t.row)}},model:{value:t.row.name,callback:function(a){e.$set(t.row,"name",a)},expression:"scope.row.name"}})],1)]}}])}),a("el-table-column",{attrs:{label:e.$t("DEVICE_MANAGEMENT.MANAGEMENT_GROUP_MODEL.PARENTGROUP"),width:"auto","min-width":"40%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form-item",{attrs:{error:t.row.errors.parent_id}},[a("el-select",{staticClass:"w-100",attrs:{size:"medium",placeholder:e.$t("DEVICE_MANAGEMENT.MANAGEMENT_GROUP_MODEL.PLACEHOLDER"),filterable:""},on:{change:function(a){return e.handleSave(t.row)}},model:{value:t.row.parent_id,callback:function(a){e.$set(t.row,"parent_id",a)},expression:"scope.row.parent_id"}},[a("el-option",{attrs:{value:"0",label:"/"}}),e._l(e.deviceGroupOptions,(function(e){return a("el-option",{key:e.id,attrs:{value:e.id,label:e.device_group}})}))],2)],1)]}}])}),a("el-table-column",{attrs:{label:e.$t("DEVICE_MANAGEMENT.MANAGEMENT_GROUP_MODEL.OPERATION"),width:"auto","min-width":"20%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-popconfirm",{attrs:{"confirm-button-text":e.$t("COMMON.CONFIRM"),"cancel-button-text":e.$t("COMMON.CANCEL"),title:e.$t("DEVICE_MANAGEMENT.MANAGEMENT_GROUP_MODEL.DELETETHISITEM")},on:{confirm:function(a){return e.handleDelete(t.row)}}},[a("el-button",{attrs:{slot:"reference",type:"danger",size:"medium"},slot:"reference"},[e._v(e._s(e.$t("DEVICE_MANAGEMENT.MANAGEMENT_GROUP_MODEL.DELETE")))])],1)]}}])})],1)],1),a("div",{staticClass:"text-right py-3"},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:e.total,"current-page":e.params.current_page,"page-size":e.params.per_page},on:{"update:currentPage":function(t){return e.$set(e.params,"current_page",t)},"update:current-page":function(t){return e.$set(e.params,"current_page",t)},change:e.getGroupIndex}})],1)],1)},n=[],o=a("ed09"),r=a("dd94"),s=a("19d0"),l=a("b183"),c=a("5b83"),d=a("9cf9d"),u=a("8083"),p=Object(o["c"])({name:"ManagementGroupForm",components:{BusinessSelector:s["a"],DeviceGroupSelector:c["default"]},setup:function(e,t){var a=Object(r["a"])(),i=a.route,n=Object(o["i"])("");n.value=i.query.business_id;var s=Object(d["default"])(n),c=s.tableData,p=s.params,f=s.total,m=s.getGroupIndex,v=s.handleSearch,b=Object(l["default"])(n.value),h=b.deviceGroupOptions,g=b.getGroupOptions;function _(){t.emit("change"),g(),m()}var E=Object(u["default"])(c,n,_,h),D=E.handleCreate,y=E.handleDelete,C=E.handleSave;return{business_id:n,tableData:c,params:p,total:f,getGroupIndex:m,handleSearch:v,deviceGroupOptions:h,handleCreate:D,handleDelete:y,handleSave:C}}}),f=p,m=(a("da47"),a("2877")),v=Object(m["a"])(f,i,n,!1,null,"2b5cce98",null);t["default"]=v.exports},c458:function(e,t,a){},c4ff:function(e,t,a){},ce21:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"el-dark-dialog el-dark-input",attrs:{title:e.$t("DEVICE_MANAGEMENT.BINDDEVICEPLUG"),visible:e.showDialog,width:"1000px"},on:{"update:visible":function(t){e.showDialog=t}}},[a("div",{staticClass:"container-fluid"},[a("el-row",{attrs:{gutter:40}},[a("el-col",{attrs:{span:6}},[a("div",{staticClass:"tree-div",staticStyle:{"border-right":"4px solid #263373"}},[e.showDialog?a("el-tree",{ref:"tree",staticClass:"el-dark-tree plugin-binding-tree",attrs:{"default-expanded-keys":e.defaultExpandKeys,"node-key":"id",data:e.pluginTree,props:{children:"device_model",label:"model_name"}},on:{"node-click":e.nodeClick}}):e._e()],1)]),a("el-col",{attrs:{span:18}},[a("tsl-editor",{staticClass:"tsl-editor",attrs:{"show-view":!1,"show-create":!0,data:e.tslData},on:{gotoPlugin:e.handleGotoPlugin}})],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"cancel"},on:{click:function(t){e.showDialog=!1}}},[e._v(e._s(e.$t("DEVICE_MANAGEMENT.CANCEL")))]),a("el-button",{attrs:{type:"save"},on:{click:e.handleSubmit}},[e._v(e._s(e.$t("DEVICE_MANAGEMENT.SAVE")))])],1)])},n=[],o=a("ed09"),r=a("9448"),s=a("aa98"),l=a("2fa3"),c=a("dd94"),d=Object(o["c"])({name:"PluginBinding",props:{dialogVisible:{type:[Boolean],default:!1},device_item:{type:[Object],default:function(){return{}}}},setup:function(e,t){var a=Object(c["a"])(),i=a.router,n=Object(o["i"])(null),d=Object(o["i"])([]),u=Object(o["a"])({get:function(){if(v.value={},e.dialogVisible){var t=e.device_item.type;if(!t)return e.dialogVisible;d.value.push(t),Object(o["e"])((function(){n.value.setCurrentKey(t)})),g(t)}else d.value=[];return e.dialogVisible},set:function(e){t.emit("update:dialogVisible",e)}}),p=Object(o["a"])({get:function(){return console.log("plugin.id"),e.device_item.id}});var f=Object(o["i"])([]);function m(){r["a"].tree({}).then((function(e){var t=e.data;200==t.code&&(console.log("PluginAPI.tree",t.data),f.value=t.data)}))}m();var v=Object(o["i"])({}),b="";function h(e){e["dict_value"]||g(e.id)}function g(e){b=e,r["a"].page({current_page:1,per_page:10,id:e}).then((function(e){var t=e.data;200==t.code&&(v.value=JSON.parse(t.data.data[0].chart_data).tsl)}))}function _(){var e=this;console.log("handleSubmit"),this.showDialog=!1;var t={id:p.value,type:b};console.log(t),Object(s["j"])(t).then((function(t){var a=t.data;console.log(a),200==a.code&&(Object(l["i"])("绑定成功！"),e.$emit("submit"))})).catch((function(e){}))}function E(){i.push({name:"Market",query:{tab:"deviceEditor"}})}return{tree:n,defaultExpandKeys:d,pluginTree:f,showDialog:u,tslData:v,nodeClick:h,handleSubmit:_,handleGotoPlugin:E}}}),u=d,p=(a("2adc"),a("2877")),f=Object(p["a"])(u,i,n,!1,null,"6fae1dca",null);t["default"]=f.exports},d2f4:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"el-dark-dialog el-dark-input",attrs:{title:"配置",width:"80%","close-on-click-modal":!1,"close-on-press-escape":!1,"append-to-body":!0,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t},close:function(t){e.dialogVisible=!1}}},[a("el-table",{attrs:{data:e.tableData},on:{"update:data":function(t){e.tableData=t}}},[e._l(e.tableAttrs.array,(function(t,i){return a("el-table-column",{key:i,attrs:{prop:t.dataKey,label:t.label,width:"auto"},scopedSlots:e._u([{key:"default",fn:function(i){return[a("el-form",{ref:"tableRef",refInFor:!0,attrs:{model:i.row,rules:t.rules}},[a("el-form-item",{attrs:{prop:t.dataKey}},["input"===t.type?[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.placeholder,placement:"top-start"}},["number"===t.validate.type?a("el-input-number",{attrs:{size:"small",placeholder:t.placeholder},model:{value:i.row[t.dataKey],callback:function(a){e.$set(i.row,t.dataKey,a)},expression:"scope.row[item.dataKey]"}}):a("el-input",{attrs:{size:"small",placeholder:t.placeholder},model:{value:i.row[t.dataKey],callback:function(a){e.$set(i.row,t.dataKey,a)},expression:"scope.row[item.dataKey]"}})],1)]:"select"===t.type?[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.placeholder,placement:"top-start"}},[a("el-select",{attrs:{size:"small",placeholder:t.placeholder},model:{value:i.row[t.dataKey],callback:function(a){e.$set(i.row,t.dataKey,a)},expression:"scope.row[item.dataKey]"}},e._l(t.options,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)],1),a("span",{staticClass:"el-form-input_tip el-form-item__error",attrs:{slot:"error"},slot:"error"},[e._v(" "+e._s(t.validate.message)+" ")])]:e._e()],2)],1)]}}],null,!0)})})),a("el-table-column",{attrs:{prop:"handle",label:"操作",width:"100",align:"right"},scopedSlots:e._u([{key:"header",fn:function(t){return[a("el-button",{attrs:{type:"save",size:"small"},on:{click:e.handleAdd}},[e._v("新增")])]}},{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){return e.handleDel(t.$index,t.row)}}},[e._v("删除")])]}}])})],2),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"cancel"},on:{click:function(t){e.dialogVisible=!1}}},[e._v(e._s(e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.CANCEL")))]),a("el-button",{attrs:{type:"save"},on:{click:function(t){return e.handleSubmit(e.tableData)}}},[e._v(e._s(e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.CONFIRM")))])],1)],1)},n=[],o=(a("e9c4"),a("d3b7"),a("159b"),a("fb6a"),a("4d63"),a("c607"),a("ac1f"),a("2c3e"),a("25f0"),a("a434"),a("d9e2"),{components:{},props:{visible:{type:[Boolean],default:!1},attrs:{type:[Object],default:function(){return{}}},data:{type:[Array],default:function(){return[]}}},data:function(){return{}},computed:{dialogVisible:{get:function(){return this.visible},set:function(e){this.$emit("update:visible",e)}},tableAttrs:{get:function(){var e=JSON.parse(JSON.stringify(this.attrs));return e.array&&e.array.forEach((function(e){if(e.rules={},e.rules[e.dataKey]=[e.validate],e.validate.rules){var t=e.validate.rules.slice(1,-1),a=new RegExp(t);e.rules[e.dataKey].push({pattern:a,message:e.validate.message,trigger:"blur"})}})),console.log("attrs",e),e}},tableData:{get:function(){return JSON.parse(JSON.stringify(this.data))}}},methods:{handleAdd:function(){var e={};this.attrs.array.forEach((function(t){e[t.dataKey]=""})),this.tableData.push(e)},handleEdit:function(e,t,a){console.log("handleEdit",e,t,a)},handleDel:function(e,t){this.tableData[this.attrs.dataKey].splice(e,1),console.log("handleDel",e,this.tableData)},handleSubmit:function(e){try{for(var t=!0,a=0;a<this.$refs.tableRef.length;a++)this.$refs.tableRef[a].validate((function(e){if(!e)throw e=!1,new Error("")}));t&&(console.log("handleSubmit1",this.tableData),this.$emit("submit",JSON.parse(JSON.stringify(this.tableData))),this.dialogVisible=!1)}catch(i){}}}}),r=o,s=(a("9a6c"),a("2877")),l=Object(s["a"])(r,i,n,!1,null,"3d58c06c",null);t["default"]=l.exports},d40c4:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"rounded card p-4 "},[a("el-row",{staticClass:"pt-3 pb-3 px-3",attrs:{type:"flex",gutter:20}},[a("el-col",{attrs:{span:12}},[a("TableTitle",[e._v(e._s(e.$t("DEVICE_ACCESS.DEVICE")))])],1),a("el-col",{staticClass:"text-right",attrs:{span:12}})],1),a("el-row",{staticClass:"pt-3 pb-4 px-3 el-dark-input",attrs:{type:"flex",gutter:20}},[a("el-col",{attrs:{span:5}},[a("DeviceGroupSelector",{attrs:{asset_id:e.params.asset_id,options:e.deviceGroupOptions,clearable:!0},on:{"update:asset_id":function(t){return e.$set(e.params,"asset_id",t)},change:function(t){return e.handleSearch()}}})],1),a("el-col",{attrs:{span:5}},[a("el-input",{attrs:{placeholder:e.$t("DEVICE_MANAGEMENT.PLACEHOLDER2"),size:"medium",clearable:""},on:{clear:function(t){return e.handleSearch()}},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch()}},model:{value:e.params.name,callback:function(t){e.$set(e.params,"name",t)},expression:"params.name"}})],1),a("el-col",{attrs:{span:9}},[a("el-button",{attrs:{type:"border",size:"medium"},on:{click:function(t){return e.handleSearch()}}},[e._v(e._s(e.$t("DEVICE_MANAGEMENT.SEARCH")))])],1),a("el-col",{staticClass:"text-right",attrs:{span:12}},[a("el-button",{attrs:{type:"border",size:"medium"},on:{click:function(t){return e.handleCreate()}}},[e._v(e._s(e.$t("DEVICE_MANAGEMENT.CREATEDEVICE")))]),a("el-button",{attrs:{type:"indigo",size:"medium"},on:{click:function(t){e.showManagementGroup=!0}}},[e._v(e._s(e.$t("DEVICE_MANAGEMENT.MANAGEMENTGROUP")))])],1)],1),a("el-form",{staticClass:"inline-edit"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,"default-expand-all":"","row-key":"id",fit:"",indent:30},scopedSlots:e._u([{key:"empty",fn:function(){return[a("div",[e._v(e._s(e.$t("COMMON.TABLE_NO_DATA")))])]},proxy:!0}])},[a("el-table-column",{attrs:{label:e.$t("DEVICE_MANAGEMENT.TYPE"),width:"125px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(3==t.row.device_type?e.$t("DEVICE_MANAGEMENT.SUB_DEVICE"):2==t.row.device_type?e.$t("DEVICE_MANAGEMENT.THEGATEWAY"):e.$t("DEVICE_MANAGEMENT.EQUIPMENT"))+" ")]}}])}),a("el-table-column",{attrs:{label:e.$t("DEVICE_MANAGEMENT.DEVICENAME1"),"min-width":"14%",width:"auto",prop:"name"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form-item",{attrs:{error:t.row.errors.name}},[a("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("DEVICE_MANAGEMENT.PLACEHOLDER2"),size:"medium"},on:{change:function(a){return e.handleSave(t.row,e.getDeviceIndex)}},model:{value:t.row.name,callback:function(a){e.$set(t.row,"name",a)},expression:"scope.row.name"}})],1)]}}])}),a("el-table-column",{attrs:{label:e.$t("DEVICE_MANAGEMENT.DEVICELOCATION"),width:"auto","min-width":"15%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form-item",{attrs:{error:t.row.errors.asset_id}},[a("DeviceGroupSelector",{attrs:{disabled:3==t.row.device_type,asset_id:t.row.asset_id,options:e.deviceGroupOptions},on:{"update:asset_id":function(a){return e.$set(t.row,"asset_id",a)},change:function(a){return e.handleSave(t.row,e.getDeviceIndex)}}})],1)]}}])}),a("el-table-column",{attrs:{label:e.$t("DEVICE_MANAGEMENT.GATEWAYDEVICE"),width:"auto","min-width":"15%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form-item",{attrs:{error:t.row.errors.device_type}},[a("DeviceTypeSelector",{attrs:{"current-item":t.row,deviceType:t.row.device_type},on:{"update:deviceType":function(a){return e.$set(t.row,"device_type",a)},"update:device-type":function(a){return e.$set(t.row,"device_type",a)},change:function(a){return e.deviceTypeChange(t.row)}}})],1)]}}])}),a("el-table-column",{attrs:{label:e.$t("DEVICE_MANAGEMENT.BINGPLUGINS"),"min-width":"15%"},scopedSlots:e._u([{key:"default",fn:function(t){return["2"!=t.row.device_type?a("device-plugin-selector",{ref:"devicePluginSelectorRef",attrs:{data:t.row,options:e.pluginTree},on:{select:function(a,i){return e.handleSelectPlugin(t.row,a,i)}}}):e._e()]}}])}),a("el-table-column",{attrs:{label:e.$t("DEVICE_MANAGEMENT.CODEMANAGE"),"min-width":"13%"},scopedSlots:e._u([{key:"default",fn:function(t){return["3"!==t.row.device_type?a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleEditParameter(t.row,"编辑参数")}}},[e._v(e._s(e.$t("DEVICE_MANAGEMENT.EDITPARAMETERS")))]):e._e()]}}])}),a("el-table-column",{attrs:{label:e.$t("DEVICE_MANAGEMENT.STATE"),"min-width":"10%"},scopedSlots:e._u([{key:"default",fn:function(t){return["1"===t.row.device_state?a("el-tag",[e._v(e._s(e.$t("DEVICE_MANAGEMENT.ONLINE")))]):"3"!==t.row.device_type?a("el-tag",{attrs:{type:"info"}},[e._v(e._s(e.$t("DEVICE_MANAGEMENT.OFFLINE")))]):e._e()]}}])}),a("el-table-column",{attrs:{label:e.$t("DEVICE_MANAGEMENT.TITLE23"),"min-width":"16%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v(e._s(t.row.latest_ts?e.dateFormat(t.row.latest_ts):""))])]}}])}),a("el-table-column",{attrs:{label:e.$t("DEVICE_MANAGEMENT.TITLE24"),"min-width":"20%"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.chart_names?[e._l(t.row.chart_names,(function(t,i){return[i<3?a("el-tag",{key:i,staticClass:"mr-1 mb-1",attrs:{size:"mini"}},[e._v(e._s(t))]):e._e()]})),a("el-tooltip",{attrs:{placement:"top"}},[a("div",{staticStyle:{width:"200px"},attrs:{slot:"content"},slot:"content"},[e._l(t.row.chart_names,(function(t,i){return[a("el-tag",{key:i,staticClass:"mr-1 mb-1",attrs:{size:"mini"}},[e._v(e._s(t))])]}))],2),t.row.chart_names.length>5?a("el-tag",{key:"omit",staticClass:"mr-1 mb-1",attrs:{size:"mini"}},[e._v("...")]):e._e()],1)]:e._e()]}}])}),a("el-table-column",{attrs:{label:e.$t("DEVICE_MANAGEMENT.OPERATION"),"min-width":"40%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{"text-align":"right"}},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==t.row.device_type,expression:"scope.row.device_type==2"}],attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.addChildDevice(t.row)}}},[e._v(e._s(e.$t("DEVICE_MANAGEMENT.ADDINGCHILDDEVICE")))]),a("el-button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.deviceConfig(t.row)}}},[e._v(e._s(e.$t("DEVICE_MANAGEMENT.DEVICE_DETAIL")))]),a("el-popconfirm",{attrs:{"confirm-button-text":e.$t("COMMON.CONFIRM"),"cancel-button-text":e.$t("COMMON.CANCEL"),disabled:!e.hasAuth("device:del"),title:e.$t("DEVICE_MANAGEMENT.DELETETHISITEM")},on:{confirm:function(a){return e.handleDelete(t.row,e.getDeviceIndex)}}},[a("el-button",{attrs:{slot:"reference",type:"danger",size:"mini"},slot:"reference"},[e._v(e._s(e.$t("DEVICE_MANAGEMENT.DELETE")))])],1)],1)]}}])})],1)],1),a("div",{staticClass:"text-right py-3"},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:e.total,"current-page":e.params.current_page,"page-size":e.params.per_page},on:{"update:currentPage":function(t){return e.$set(e.params,"current_page",t)},"update:current-page":function(t){return e.$set(e.params,"current_page",t)},"current-change":e.getDeviceIndex}})],1),a("PluginBinding",{attrs:{"dialog-visible":e.showBindingDialog,device_item:e.currentDeviceItem},on:{"update:dialogVisible":function(t){e.showBindingDialog=t},"update:dialog-visible":function(t){e.showBindingDialog=t},submit:e.getDeviceIndex}}),a("DeviceSettingForm",{attrs:{"dialog-visible":e.showDeviceSetting,device_item:e.currentDeviceItem},on:{"update:dialogVisible":function(t){e.showDeviceSetting=t},"update:dialog-visible":function(t){e.showDeviceSetting=t},submit:e.getDeviceIndex}}),a("SubDeviceSettingForm",{attrs:{"dialog-visible":e.showSubDeviceSetting,device_item:e.currentDeviceItem},on:{"update:dialogVisible":function(t){e.showSubDeviceSetting=t},"update:dialog-visible":function(t){e.showSubDeviceSetting=t}}}),a("el-dialog",{attrs:{visible:e.showManagementGroup,title:e.$t("DEVICE_MANAGEMENT.MANAGEMENT_GROUP_MODEL.MANAGINGDEVICEGROUPS"),width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.showManagementGroup=t},open:function(t){e.showManagementGroupForm=!0},closed:function(t){e.showManagementGroupForm=!1}}},[e.showManagementGroupForm?a("ManagementGroupForm",{on:{change:e.handleGroupChange}}):e._e()],1),a("DeviceConfigForm",{attrs:{"dialog-visible":e.deviceConfigVisible,device:e.currentDeviceItem},on:{"update:dialogVisible":function(t){e.deviceConfigVisible=t},"update:dialog-visible":function(t){e.deviceConfigVisible=t},submit:e.deviceConfigUpdate}})],1)},n=[],o=a("1da1"),r=(a("9e1f"),a("450d"),a("6ed5")),s=a.n(r),l=(a("96cf"),a("b0c0"),a("e9c4"),a("c740"),a("a434"),a("ed09")),c=a("dd94"),d=a("3de1"),u=a("2fa3"),p=a("aa98"),f=a("5b83"),m=a("a902"),v=a("e947"),b=a("239d"),h=a("4a38"),g=a("0a67"),_=a("b183"),E=a("a7a0"),D=a("ce21"),y=a("0615"),C=a("db02"),A=a("c0f1"),O=a("4df3"),T=Object(l["c"])({name:"DeviceIndex",components:{PluginBinding:D["default"],DeviceGroupSelector:f["default"],DeviceTypeSelector:m["default"],DevicePluginSelector:v["default"],TableTitle:b["a"],DeviceSettingForm:y["default"],ManagementGroupForm:A["default"],DeviceConfigForm:O["default"],SubDeviceSettingForm:C["default"]},setup:function(){var e=Object(c["a"])(),t=e.route,a=t.query.business_id,i=Object(_["default"])(a),n=i.deviceGroupOptions,r=i.getGroupOptions,f=Object(h["default"])(a),m=f.tableData,v=f.loading,b=f.params,D=f.getDeviceIndex,y=f.total,C=f.handleSearch,A=f.handleReset,O=f.devicePluginOptions,T=f.deviceTypeMap,N=Object(g["default"])(m),M=N.handleCreate,I=N.handleSave,w=N.handleDelete;function S(e){s.a.confirm("是否切换设备类型？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){"1"==e.device_type||1==e.device_type?e.protocol="mqtt":e.protocol="MODBUS_TCP",H.value=e,console.log("deviceTypeChange",e),I(e,(function(){D()}))})).catch((function(){console.log("取消"),D()}))}var x=Object(E["default"])(),k=x.getPluginTree,V=x.bindPlugin,G=Object(l["i"])([]);function L(){return R.apply(this,arguments)}function R(){return R=Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,k();case 2:G.value=e.sent;case 3:case"end":return e.stop()}}),e)}))),R.apply(this,arguments)}L();var $=Object(l["i"])(null);function j(e,t,a){console.log("handleSelectPlugin",e),V(e,t,(function(){a&&a(),D()}))}var P=Object(l["i"])(!1),F=Object(l["i"])(!1),U=Object(l["i"])(!1),B=Object(l["i"])(!1),z=Object(l["i"])(""),H=Object(l["i"])({});function J(e){if(!e.name)return e.errors.name="请填写设备名称!",void Object(u["h"])("请填写设备名称!");H.value=JSON.parse(JSON.stringify(e)),P.value=!0}function q(e,t){return e.name?e.asset_id?e.device_type?(H.value=JSON.parse(JSON.stringify(e)),z.value=t,void(F.value=!0)):(e.errors.device_type="请选择设备类型",void Object(u["h"])("请选择设备类型")):(e.errors.asset_id="请选择设备分组!",void Object(u["h"])("请选择设备分组!")):(e.errors.name="请填写设备名称!",void Object(u["h"])("请填写设备名称!"))}function Y(e){if(console.log("====handleEditSubParameter",e),!e.name)return e.errors.name="请输入子设备名称",void Object(u["h"])(e.errors.name);U.value=!0,H.value=JSON.parse(JSON.stringify(e))}var K=Object(l["i"])(!1),W=Object(l["i"])(!1);function Q(){r(),C()}function X(e){I(e),Object(p["x"])({field:e.type}).then((function(t){var a=t.data;200===a.code&&a.data&&(e.structure=a.data)}))}function Z(e){console.log("addChildDevice",e);var t=JSON.parse(JSON.stringify(e)),a={id:"",name:"",asset_id:e.asset_id,d_id:"",location:"",protocol:e.protocol,device_type:"3",parent_id:e.id,errors:{name:"",asset_id:"",type:""}};t.children||(t.children=[]),t.children.unshift(a);var i=m.value.findIndex((function(e){return e.id==t.id}));m.value.splice(i,1,t)}var ee=Object(l["i"])(!1);function te(e){if(!e.name)return e.errors.name="请输入子设备名称",void Object(u["h"])(e.errors.name);H.value=JSON.parse(JSON.stringify(e)),ee.value=!0,console.log("deviceConfig",e);var t=m.value.findIndex((function(t){return t.id==e.id}));console.log(t)}function ae(){C()}function ie(e){e.showAllChartName=!0,console.log("====handleHoverOmit",e)}return{tableData:m,loading:v,params:b,getDeviceIndex:D,total:y,handleSearch:C,handleReset:A,pluginTree:G,devicePluginSelectorRef:$,handleSelectPlugin:j,devicePluginOptions:O,deviceTypeMap:T,handleCreate:M,handleSave:I,handleDelete:w,handleHoverOmit:ie,dateFormat:d["a"],deviceGroupOptions:n,deviceTypeChange:S,getGroupOptions:r,showBindingDialog:P,handleBindingClick:J,showEditDialog:B,EditDialogTitle:z,showDeviceSetting:F,handleEditParameter:q,showSubDeviceSetting:U,handleEditSubParameter:Y,currentDeviceItem:H,showManagementGroup:K,showManagementGroupForm:W,handleGroupChange:Q,handleDevicePluginChange:X,addChildDevice:Z,deviceConfigVisible:ee,deviceConfig:te,deviceConfigUpdate:ae}}}),N=T,M=(a("f75c"),a("2877")),I=Object(M["a"])(N,i,n,!1,null,"194f22be",null);t["default"]=I.exports},da47:function(e,t,a){"use strict";a("1fda")},daa1:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{"margin-top":"20px"}},[a("el-form",{attrs:{"label-position":"left",model:e.formData,"label-width":"120px"}},[a("el-form-item",{attrs:{label:e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.DEVICE_ID")}},[a("el-tooltip",{attrs:{effect:"dark",content:e.isCopy?e.$t("DEVICE_MANAGEMENT.EDIT_PARAMETER.COPIED"):e.$t("DEVICE_MANAGEMENT.EDIT_PARAMETER.COPY")}},[a("el-input",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:e.device.device,expression:"device.device",arg:"copy"}],staticStyle:{width:"30%"},attrs:{readonly:""},nativeOn:{click:function(t){return e.handleCopy.apply(null,arguments)}},model:{value:e.device.device,callback:function(t){e.$set(e.device,"device",t)},expression:"device.device"}})],1)],1),"2"==e.device.device_type&&e.device.protocol.startsWith("WVP_")?a("el-form-item",{attrs:{label:e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.LABLE1")}},[a("el-select",{staticStyle:{width:"100%"},model:{value:e.formData.d_id,callback:function(t){e.$set(e.formData,"d_id",t)},expression:"formData.d_id"}},e._l(e.wvpDevice,(function(t,i){return a("el-option",{key:t.deviceId,attrs:{label:t.deviceId+" ["+t.createTime+"] "+(1==t.online?e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.ONLINE"):e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.OFFLINE")),value:t.deviceId}})})),1)],1):e._e(),"2"!==e.device.device_type?a("div",{staticStyle:{"margin-bottom":"30px"}},[a("el-row",{staticStyle:{"flex-wrap":"wrap"},attrs:{gutter:12,type:"flex"}},e._l(e.deviceAttributeCardList,(function(t){return"systime"!==t.key&&"SYS_ONLINE"!==t.key?a("el-col",{key:t.key,staticStyle:{"min-width":"250px","margin-bottom":"10px"},attrs:{xs:24,sm:12,md:8,lg:8,xl:6}},[a("div",{staticStyle:{"background-color":"#2d3d88","border-radius":"4px",border:"1px solid #EBEEF5"}},[a("div",{staticStyle:{padding:"10px 10px 10px 20px",height:"30px"}},[a("span",{staticStyle:{"font-size":"18px"}},[e._v(e._s(t.name))]),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.CHECK_TIMING_CHART"),placement:"top-start"}},[e.isShowDataChart(t)?a("i",{staticClass:"el-icon-pie-chart",staticStyle:{float:"right",padding:"3px 5px",cursor:"pointer"},on:{click:function(a){return e.showDeviceDataChart(t)}}}):a("i",{staticClass:"el-icon-pie-chart",staticStyle:{float:"right",padding:"3px 5px",cursor:"not-allowed"}})]),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.CHECK_HISTORY_DATA"),placement:"top-start"}},[a("i",{staticClass:"el-icon-notebook-2",staticStyle:{float:"right",padding:"3px 5px",cursor:"pointer"},on:{click:function(a){return e.showDeviceHistory(t)}}})])],1),a("div",{staticStyle:{height:"3px !important"}},[a("hr",{staticStyle:{"border-top":"1px solid rgb(255 255 255 / 99%)"}})]),a("div",{staticStyle:{height:"115px",padding:"10px 5px 0px 10px"}},[a("div",{staticStyle:{height:"63px"}},[a("el-tooltip",{attrs:{content:e.getCardFullValue(t),placement:"top"}},[a("div",{staticStyle:{display:"flex"}},[a("div",{staticClass:"card_value_content"},[e._v(e._s(t.str_v?t.str_v:t.dbl_v))]),a("div",{staticClass:"card_value_unit"},[e._v(e._s(t.unit||""))])])])],1),a("div",{staticStyle:{float:"right",padding:"3px 5px","margin-bottom":"3px","margin-top":"11px"}},[e._v(e._s(e.calculateUpdateTime(t.ts)))])])])]):e._e()})),1)],1):e._e()],1),a("DeviceHistory",{attrs:{visible:e.deviceHistoryVisible,device:e.device,attributeName:e.choosedAttribute},on:{"update:visible":function(t){e.deviceHistoryVisible=t}}}),a("DeviceDataChart",{attrs:{visible:e.deviceDataChartVisible,device:e.device,attributeName:e.choosedAttribute},on:{"update:visible":function(t){e.deviceDataChartVisible=t}}})],1)},n=[],o=(a("99af"),a("31e1")),r=a("6d09"),s=a("f570"),l=a("aa98"),c=a("b2eb"),d={components:{DeviceHistory:o["default"],DeviceDataChart:r["default"]},props:{data:{type:Object,default:function(){return{}}},device:{type:[Object],default:function(){return{}}},wvpDevice:{type:Array,default:function(){return[]}},initAttributeCard:{type:Boolean,default:!1}},data:function(){return{isCopy:!1,choosedAttribute:"",deviceHistoryVisible:!1,deviceDataChartVisible:!1,deviceAttributeCardList:[],socket:null,firstLoad:!1}},computed:{formData:{get:function(){return this.data},set:function(e){this.$emit("update:data",e)}}},watch:{initAttributeCard:{handler:function(e){e&&(console.debug("initAttributeCard",e),this.getDeviceAttributeCardList())}}},beforeDestroy:function(){this.socket&&this.socket.close()},mounted:function(){console.log("DeviceAttribute",this.device),this.getDeviceAttributeCardList(),this.updateComponents()},methods:{getDeviceAttributeCardList:function(){var e=this;Object(l["c"])({device_id:this.device.id}).then((function(t){console.debug("====getDeviceAttributeCardList",t),200===t.data.code&&(e.deviceAttributeCardList=t.data.data?t.data.data:[])}))},handleCopy:function(){this.isCopy=!0},showDeviceHistory:function(e){this.choosedAttribute=e.key,this.deviceHistoryVisible=!0},showDeviceDataChart:function(e){this.choosedAttribute=e.key,this.deviceDataChartVisible=!0},calculateUpdateTime:function(e){var t=s["a"].t("COMMON.CURRENT_LANGUAGE"),a=Date.now(),i=a-parseInt(e/1e3);if(i<0)return"";for(var n=Math.floor(i/1e3),o=Math.floor(n/60),r=Math.floor(o/60),l=Math.floor(r/24),c=Math.floor(l/7),d=Math.floor(l/30),u=Math.floor(l/365),p=["年","个月","周","天","小时","分钟","秒"],f=["year(s)","month(s)","week(s)","day(s)","hour(s)","minute(s)","second(s)"],m="中文"===t?p:f,v=[u,d,c,l,r,o,n],b=0;b<v.length;b++)if(v[b]>0)return"中文"===t?"".concat(v[b]).concat(m[b],"前更新"):"Updated ".concat(v[b]," ").concat(m[b]," ago");return"中文"===t?"刚刚更新":"Just updated"},isShowDataChart:function(e){if(!e)return!1;var t=e.str_v?e.str_v:e.dbl_v;return!t||"number"===typeof t},getCardFullValue:function(e){var t=String(e.str_v?e.str_v:e.dbl_v);return e.unit&&(t+=" "+e.unit),console.error(e,t),t},updateComponents:function(){var e=this;console.error(this.device,this.websocket),this.socket&&(this.socket.close(),this.socket=null),this.socket=new c["a"],this.socket.init((function(e){})),this.socket.onReady((function(){e.socket.send({device_id:e.device.device})})),this.socket.onMessage((function(t){if(e.firstLoad)try{var a=JSON.parse(t);console.error(a);for(var i=1e3*new Date(a.ts).getTime(),n=0;n<e.deviceAttributeCardList.length;n++){var o=e.deviceAttributeCardList[n],r=a[o.key];void 0!==r&&(o.str_v=r,o.ts=i)}}catch(s){}else e.firstLoad=!0}))}}},u=d,p=(a("dc04"),a("2877")),f=Object(p["a"])(u,i,n,!1,null,"c3f5288a",null);t["default"]=f.exports},db02:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"el-dark-dialog el-dark-input",attrs:{visible:e.dialogVisible,title:e.$t("DEVICE_MANAGEMENT.CONFIG_PARAMETER.CONFIGPARAMETER"),"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,width:"600px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{attrs:{"label-width":"120px"}},[a("el-form-item",{staticStyle:{padding:"30px"},attrs:{label:e.device_item.protocol&&e.device_item.protocol.startsWith("WVP_")?e.$t("DEVICE_MANAGEMENT.CONFIG_PARAMETER.CHANGENUMBER"):e.$t("DEVICE_MANAGEMENT.CONFIG_PARAMETER.DEVICEADDRESS")}},[a("el-input",{attrs:{size:"medium"},model:{value:e.subDeviceAddress,callback:function(t){e.subDeviceAddress=t},expression:"subDeviceAddress"}})],1),e.device_item.protocol&&e.device_item.protocol.startsWith("WVP_")?a("el-form-item",{staticStyle:{padding:"30px"},attrs:{label:e.$t("DEVICE_MANAGEMENT.CONFIG_PARAMETER.PLAYBACKADDRESS")}},[a("el-input",{attrs:{size:"medium"},model:{value:e.subDeviceVideoAddress,callback:function(t){e.subDeviceVideoAddress=t},expression:"subDeviceVideoAddress"}})],1):e._e(),a("div",{staticStyle:{display:"flex","justify-content":"center","margin-bottom":"30px"}},[a("el-button",{on:{click:e.closeDialog}},[e._v(e._s(e.$t("DEVICE_MANAGEMENT.CONFIG_PARAMETER.CANCEL")))]),a("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v(e._s(e.$t("DEVICE_MANAGEMENT.CONFIG_PARAMETER.SAVE")))])],1)],1)],1)},n=[],o=(a("e9c4"),a("ed09")),r=a("aa98"),s=a("2fa3"),l=Object(o["c"])({name:"SubDeviceSettingForm",props:{dialogVisible:{type:[Boolean],default:!1},device_item:{type:[Object]}},setup:function(e,t){var a=Object(o["i"])(""),i=Object(o["i"])(""),n={},l={};function c(){t.emit("update:dialogVisible",!1)}function d(){var e={};e.id=l.id,e.sub_device_addr=a.value,n.video_address=i.value,e.additional_info=JSON.stringify(n),Object(r["A"])(e).then((function(e){var t=e.data;200==t.code&&(Object(s["i"])("修改成功！"),c())}))}function u(){Object(r["p"])({id:l.id}).then((function(e){var t=e.data;200==t.code&&(console.log("====getDeviceInformation",t),a.value=t.data.sub_device_addr?t.data.sub_device_addr:"",n=t.data.additional_info?JSON.parse(t.data.additional_info):{},i.value=n.video_address?n.video_address:"")}))}return Object(o["j"])((function(){return e.dialogVisible}),(function(t){t&&(l=e.device_item,u())})),{subDeviceAddress:a,subDeviceVideoAddress:i,closeDialog:c,onSubmit:d}}}),c=l,d=a("2877"),u=Object(d["a"])(c,i,n,!1,null,"065c3696",null);t["default"]=u.exports},dc04:function(e,t,a){"use strict";a("9ac2")},dd94:function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var i=a("ed09");function n(){var e=Object(i["d"])();return{route:e.proxy.$route,router:e.proxy.$router}}},e947:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-popover",{attrs:{placement:"bottom-start",width:"420",trigger:"click"},on:{show:e.showPopover}},[a("div",[a("el-input",{ref:"searchInput",attrs:{clearable:"",placeholder:"输入插件名称检索"},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}}),a("el-table",{attrs:{data:e.pageList,"row-class-name":e.tableRowClassName}},[a("el-table-column",{attrs:{width:"180",property:"name",label:"名称","show-overflow-tooltip":!0}}),a("el-table-column",{attrs:{width:"100",property:"author",label:"作者"}}),a("el-table-column",{attrs:{width:"100",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return["install"===t.row.status?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.handleSelect(t.row)}}},[e._v(e._s(t.row.bind?"已选择":"选择"))]):e._e(),"store"===t.row.status?a("el-button",{attrs:{type:"text",size:"mini"}},[e._v("安装")]):e._e(),"store"!==t.row.status?a("el-button",{attrs:{slot:"reference",type:"text",size:"mini"},on:{click:function(a){return e.handleView(t.row)}},slot:"reference"},[e._v(" 查看 ")]):e._e()]}}])})],1),a("div",{staticClass:"text-right py-3"},[a("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:e.total,"current-page":e.params.page,"page-size":e.params.pageSize},on:{"update:currentPage":function(t){return e.$set(e.params,"page",t)},"update:current-page":function(t){return e.$set(e.params,"page",t)},"current-change":e.getList}})],1),a("el-link",{staticClass:"link-create",attrs:{type:"warning",target:"_blank"},nativeOn:{click:function(t){return e.handleGoToPlugin.apply(null,arguments)}}},[e._v(e._s(e.$t("PLUGIN.MATTER_MODEL_INFO_TAB.BTN")))])],1),a("el-input",{attrs:{slot:"reference",size:"medium",readonly:"",placeholder:"绑定插件"},slot:"reference",model:{value:e.data.plugin_name,callback:function(t){e.$set(e.data,"plugin_name",t)},expression:"data.plugin_name"}})],1),a("device-plugin-detail",{attrs:{visible:e.showDetailDialog,id:e.currentItem.id},on:{"update:visible":function(t){e.showDetailDialog=t}}})],1)},n=[],o=(a("d81d"),a("e9c4"),a("fb6a"),a("c740"),a("b0c0"),a("2fa3")),r=a("3819"),s=a("bbd6"),l={components:{DevicePluginDetail:r["default"]},props:{options:{type:[Object,Array],default:function(){return{}}},data:{type:[Object,Array],default:function(){return{}}}},data:function(){return{searchText:"",currentItem:{},showDetailDialog:!1,debounceSearchTextChange:null,queryList:[],pageList:[],total:30,params:{page:1,pageSize:5}}},watch:{searchText:{handler:function(e){this.debounceSearchTextChange()},immediate:!0},data:{handler:function(e){e.plugin_name&&(this.searchText=e.plugin_name)},deep:!0,immediate:!0}},created:function(){this.debounceSearchTextChange=Object(o["a"])(this.querySearch,100)},methods:{getList:function(){var e=this.createPagination(this.queryList,this.params.page,this.params.pageSize),t=e.list,a=e.total;this.pageList=t,this.total=a},querySearch:function(){if(console.log("querySearch",this.searchText),!this.searchText)return this.queryList=this.options,void this.getList();var e=s.go(this.searchText,this.options,{keys:["name","author"]});this.queryList=e.map((function(e){return e.obj})),this.getList()},createPagination:function(e,t,a){var i=this,n=e.length,o=(t-1)*a,r=t*a,s=JSON.parse(JSON.stringify(e.slice(o,r)));if(this.data&&this.data.type){var l=s.findIndex((function(e){return e.id===i.data.type}));l>-1&&(s[l].bind=!0)}return{total:n,list:s}},showPopover:function(){var e=this;this.$nextTick((function(){console.log("showPopover",e.data.plugin_name),e.$refs.searchInput.focus(),e.debounceSearchTextChange()}))},handleSelect:function(e){var t=this;this.$emit("select",e,(function(){console.log("handleSelect",e),t.searchText=e.name,t.debounceSearchTextChange()}))},handleView:function(e){this.currentItem=e,this.showDetailDialog=!0,console.log("handleView",e)},handleGoToPlugin:function(){this.$router.push({name:"Market",query:{tab:"deviceEditor"}})},tableRowClassName:function(e){var t=e.row;e.rowIndex;return t.bind?"select-row":""}}},c=l,d=(a("7fc0"),a("2877")),u=Object(d["a"])(c,i,n,!1,null,"498bf1bd",null);t["default"]=u.exports},f75c:function(e,t,a){"use strict";a("c458")},f8b4:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{staticClass:"el-dark-dialog",attrs:{title:"登录应用商店",visible:e.dialogVisible,width:"30%","before-close":function(){return e.handleCancel()},"close-on-click-modal":!1,"append-to-body":!0},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{ref:"LoginForm",staticClass:"inline-edit",attrs:{"label-position":"left",model:e.formData,rules:e.formRules,"hide-required-asterisk":!0}},[a("el-form-item",{attrs:{label:"用户名",prop:"username"}},[a("el-input",{model:{value:e.formData.username,callback:function(t){e.$set(e.formData,"username",t)},expression:"formData.username"}})],1),a("el-form-item",{attrs:{label:"密码",prop:"password"}},[a("el-input",{attrs:{"show-password":""},model:{value:e.formData.password,callback:function(t){e.$set(e.formData,"password",t)},expression:"formData.password"}})],1),a("div",{staticClass:"text-right py-5"},[a("el-link",{staticClass:"link-signup",attrs:{href:"http://r.thingspanel.cn/",type:"success",target:"_blank"}},[e._v("没有账号？去创建")]),a("el-button",{attrs:{type:"border"},on:{click:e.handleCancel}},[e._v(e._s(e.$t("COMMON.CANCEL")))]),a("el-button",{attrs:{type:"primary",loading:e.btnLoading},on:{click:e.handleSubmit}},[e._v(e._s(e.$t("COMMON.LOG1")))])],1)],1)],1)],1)},n=[],o=(a("d3b7"),a("8252")),r=a("2fa3"),s={components:{},props:{visible:{type:[Boolean],default:!1},login:{type:[Function],default:function(){}}},data:function(){return{formData:{username:"",password:""},formRules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}]},btnLoading:!1}},computed:{dialogVisible:{get:function(){return this.visible},set:function(e){this.$emit("update:visible",e)}}},methods:{handleCancel:function(){this.dialogVisible=!1,this.login({code:400,msg:"取消登录"})},handleSubmit:function(){var e=this;this.btnLoading=!0,this.$refs.LoginForm.validate((function(t){if(!t)return e.btnLoading=!1,!1;e.$store.dispatch(o["a"],e.formData).then((function(t){0===t.code&&(Object(r["i"])("登录成功！"),e.dialogVisible=!1,e.login({code:200,msg:"登录成功"}))})).finally((function(){e.btnLoading=!1}))}))}}},l=s,c=(a("2712"),a("2877")),d=Object(c["a"])(l,i,n,!1,null,"1836bc6e",null);t["default"]=d.exports}}]);