(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-19cabaa0","chunk-231a4932","chunk-2d212c35"],{"045f":function(t,e,n){"use strict";n("455b")},"1da1":function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));n("d3b7");function r(t,e,n,r,i,o,a){try{var c=t[o](a),s=c.value}catch(u){return void n(u)}c.done?e(s):Promise.resolve(s).then(r,i)}function i(t){return function(){var e=this,n=arguments;return new Promise((function(i,o){var a=t.apply(e,n);function c(t){r(a,i,o,c,s,"next",t)}function s(t){r(a,i,o,c,s,"throw",t)}c(void 0)}))}}},"31e1":function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-dialog",{staticClass:"el-dark-dialog el-dark-input",attrs:{title:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.ATTRIBUTE_HISTORY_DATA"),width:"50%","close-on-press-escape":!1,"show-close":"","append-to-body":"",visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e},close:t.handleClose}},[n("div",[n("el-row",{attrs:{gutter:10}},[n("el-col",{attrs:{span:11}},[n("el-date-picker",{staticStyle:{width:"100%"},attrs:{clearable:!1,"value-format":"yyyy-MM-dd HH:mm:ss",type:"datetimerange","start-placeholder":t.$t("DATA_MANAGEMENT.PLACEHOLDER5"),"range-separator":t.$t("DATA_MANAGEMENT.PLACEHOLDER6"),"end-placeholder":t.$t("DATA_MANAGEMENT.PLACEHOLDER7")},on:{change:function(e){return t.getHistoryData()}},model:{value:t.choosedTimeRange,callback:function(e){t.choosedTimeRange=e},expression:"choosedTimeRange"}})],1),n("el-col",{attrs:{span:3}},[n("el-button",{attrs:{type:"border",size:"medium"},on:{click:function(e){return t.handleRefresh()}}},[t._v(t._s(t.$t("COMMON.REFRESH")))])],1),n("el-col",{staticStyle:{float:"right"},attrs:{span:3}},[n("el-popconfirm",{attrs:{"confirm-button-text":t.$t("COMMON.CONFIRM"),"cancel-button-text":t.$t("COMMON.CANCEL"),title:t.$t("COMMON.EXPORT_CONFIRM")},on:{confirm:function(e){return t.handleExport()}}},[n("el-button",{attrs:{slot:"reference",type:"border",size:"medium"},slot:"reference"},[t._v(t._s(t.$t("COMMON.EXPORT")))])],1)],1)],1),n("el-table",{attrs:{data:t.historyData},scopedSlots:t._u([{key:"empty",fn:function(){return[n("div",[t._v(t._s(t.$t("COMMON.TABLE_NO_DATA")))])]},proxy:!0}])},[n("el-table-column",{attrs:{type:"index",width:"50",align:"center"}}),n("el-table-column",{attrs:{prop:"time",label:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.TIMESTAMP"),"min-width":"200",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("span",[t._v(t._s(t.transformTimestamp(e.row.ts)))])]}}])}),n("el-table-column",{attrs:{prop:"key",label:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.ATTRIBUTE.ATTRIBUTE_IDENTIFIER"),"min-width":"200",align:"center"}},[t._v(t._s(this.attributeName))]),n("el-table-column",{attrs:{prop:"value",label:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.VALUE"),"min-width":"200",align:"center"}})],1),n("div",{staticClass:"text-center py-3"},[n("el-row",{attrs:{type:"flex",justify:"center"}},[n("el-col",{staticStyle:{display:"inline-block"},attrs:{span:8}},[n("el-button",{staticStyle:{width:"45px","border-color":"#747474"},attrs:{icon:"el-icon-back",type:"border",disabled:1===this.page,size:"small"},on:{click:function(e){return t.pageChange(t.page-1)}}}),n("el-button",{staticStyle:{width:"45px","border-color":"#747474"},attrs:{icon:"el-icon-right",type:"border",disabled:this.dataCount!==this.pageSize,size:"small"},on:{click:function(e){return t.pageChange(t.page+1)}}})],1)],1)],1)],1),n("el-dialog",{staticClass:"el-dark-dialog el-dark-input",attrs:{width:"30%","append-to-body":"",title:t.$t("COMMON.EXPORT"),visible:t.exportVisible},on:{"update:visible":function(e){t.exportVisible=e}}},[n("div",{staticClass:"text-center"},[n("p",[t._v(t._s(t.downloadUrl?t.downloadUrl.split("/").pop().toString():t.$t("COMMON.GENERATE_WAIT")))]),t.exporting?t._e():n("p",[n("a",{attrs:{href:t.downloadUrl}},[t._v(t._s(t.$t("COMMON.DOWNLOAD")))])])])])],1)},i=[],o=(n("d3b7"),n("aa98")),a=n("3de1"),c={name:"DeviceHistory",props:{visible:{type:[Boolean],default:!1},data:{type:Object,default:function(){return{}}},device:{type:[Object],default:function(){return{}}},attributeName:{type:String,default:""}},data:function(){var t=Date.now();return{historyData:[],positionShow:!1,locationArray:[],choosedTimeRange:[new Date(t-36e5),new Date(t)],isCopy:!1,pageSize:10,page:1,dataCount:0,exporting:!1,exportVisible:!1,downloadUrl:""}},computed:{formData:{get:function(){return this.data},set:function(t){this.$emit("update:data",t)}},dialogVisible:{get:function(){return this.visible},set:function(t){this.$emit("update:visible",t)}}},watch:{dialogVisible:{handler:function(t){console.debug("DeviceHistory",this),t&&this.getHistoryData()}}},mounted:function(){},methods:{getHistoryData:function(t,e){var n=this,r=1e3*new Date(this.choosedTimeRange[0]).getTime(),i=1e3*new Date(this.choosedTimeRange[1]).getTime();Object(o["t"])({device_id:this.device.id,key:this.attributeName,start_time:r,end_time:i,page:t||this.page,page_records:e||this.pageSize}).then((function(t){var e=t.data;console.debug("====getHistoryData",e),200==e.code&&(n.historyData=e.data?e.data:[],n.dataCount=n.historyData.length),console.debug(n.historyData)}))},handleClose:function(){this.dialogVisible=!1,this.page=1,this.pageSize=10},transformTimestamp:function(t){return Object(a["a"])(t)},pageChange:function(t){this.page=t,this.getHistoryData()},handleExport:function(){var t=this;if(!this.exporting){this.exporting=!0,this.exportVisible=!0;var e=1e3*new Date(this.choosedTimeRange[0]).getTime(),n=1e3*new Date(this.choosedTimeRange[1]).getTime();Object(o["t"])({device_id:this.device.id,key:this.attributeName,start_time:e,end_time:n,page:this.page,page_records:this.pageSize,export_excel:!0}).then((function(e){var n=e.data;console.debug("====handleExport",n),200==n.code&&(t.downloadUrl=n.data?n.data:"")})).finally((function(){t.exporting=!1}))}},handleRefresh:function(){var t=Date.now();this.choosedTimeRange=[new Date(t-36e5),new Date(t)],this.getHistoryData()}}},s=c,u=(n("045f"),n("2877")),l=Object(u["a"])(s,r,i,!1,null,"de42b222",null);e["default"]=l.exports},"455b":function(t,e,n){},"96cf":function(t,e,n){var r=function(t){"use strict";var e,n=Object.prototype,r=n.hasOwnProperty,i="function"===typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function s(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(I){s=function(t,e,n){return t[e]=n}}function u(t,e,n,r){var i=e&&e.prototype instanceof y?e:y,o=Object.create(i.prototype),a=new T(r||[]);return o._invoke=D(t,n,a),o}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(I){return{type:"throw",arg:I}}}t.wrap=u;var d="suspendedStart",f="suspendedYield",h="executing",p="completed",v={};function y(){}function m(){}function g(){}var b={};s(b,o,(function(){return this}));var E=Object.getPrototypeOf,_=E&&E(E(k([])));_&&_!==n&&r.call(_,o)&&(b=_);var w=g.prototype=y.prototype=Object.create(b);function C(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function n(i,o,a,c){var s=l(t[i],t,o);if("throw"!==s.type){var u=s.arg,d=u.value;return d&&"object"===typeof d&&r.call(d,"__await")?e.resolve(d.__await).then((function(t){n("next",t,a,c)}),(function(t){n("throw",t,a,c)})):e.resolve(d).then((function(t){u.value=t,a(u)}),(function(t){return n("throw",t,a,c)}))}c(s.arg)}var i;function o(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}this._invoke=o}function D(t,e,n){var r=d;return function(i,o){if(r===h)throw new Error("Generator is already running");if(r===p){if("throw"===i)throw o;return M()}n.method=i,n.arg=o;while(1){var a=n.delegate;if(a){var c=x(a,n);if(c){if(c===v)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===d)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=h;var s=l(t,e,n);if("normal"===s.type){if(r=n.done?p:f,s.arg===v)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r=p,n.method="throw",n.arg=s.arg)}}}function x(t,n){var r=t.iterator[n.method];if(r===e){if(n.delegate=null,"throw"===n.method){if(t.iterator["return"]&&(n.method="return",n.arg=e,x(t,n),"throw"===n.method))return v;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var i=l(r,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,v;var o=i.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,v):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function N(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function k(t){if(t){var n=t[o];if(n)return n.call(t);if("function"===typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function n(){while(++i<t.length)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}return{next:M}}function M(){return{value:e,done:!0}}return m.prototype=g,s(w,"constructor",g),s(g,"constructor",m),m.displayName=s(g,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"===typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,s(t,c,"GeneratorFunction")),t.prototype=Object.create(w),t},t.awrap=function(t){return{__await:t}},C(O.prototype),s(O.prototype,a,(function(){return this})),t.AsyncIterator=O,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new O(u(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},C(w),s(w,c,"Generator"),s(w,o,(function(){return this})),s(w,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){while(e.length){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=k,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(N),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0],e=t.completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return c.type="throw",c.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],c=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),N(n),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;N(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:k(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),v}},t}(t.exports);try{regeneratorRuntime=r}catch(i){"object"===typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},"9ac2":function(t,e,n){},aa98:function(t,e,n){"use strict";n.d(e,"g",(function(){return i})),n.d(e,"f",(function(){return o})),n.d(e,"j",(function(){return a})),n.d(e,"h",(function(){return c})),n.d(e,"i",(function(){return s})),n.d(e,"x",(function(){return u})),n.d(e,"b",(function(){return l})),n.d(e,"c",(function(){return d})),n.d(e,"t",(function(){return f})),n.d(e,"v",(function(){return h})),n.d(e,"w",(function(){return p})),n.d(e,"z",(function(){return v})),n.d(e,"r",(function(){return y})),n.d(e,"p",(function(){return m})),n.d(e,"A",(function(){return g})),n.d(e,"l",(function(){return b})),n.d(e,"a",(function(){return E})),n.d(e,"k",(function(){return _})),n.d(e,"e",(function(){return w})),n.d(e,"y",(function(){return C})),n.d(e,"q",(function(){return O})),n.d(e,"m",(function(){return D})),n.d(e,"n",(function(){return x})),n.d(e,"u",(function(){return A})),n.d(e,"o",(function(){return N})),n.d(e,"d",(function(){return T})),n.d(e,"s",(function(){return k}));var r=n("18a6");function i(t){return Object(r["a"])({url:"/index/show",method:"post",data:t})}function o(t){return Object(r["a"])({url:"/device/add_only",method:"post",data:t})}function a(t){return Object(r["a"])({url:"/device/update_only",method:"post",data:t})}function c(t){return Object(r["a"])({url:"/device/delete",method:"post",data:t})}function s(t){return Object(r["a"])({url:"/device/data",method:"post",data:t})}function u(t){return Object(r["a"])({url:"/structure/field",method:"post",data:t})}function l(t){return Object(r["a"])({url:"/kv/current",method:"post",data:t})}function d(t){return Object(r["a"])({url:"/kv/current/detail",method:"post",data:t})}function f(t){return Object(r["a"])({url:"/kv/history/data",method:"post",data:t})}function h(t){return Object(r["a"])({url:"/kv/statistic",method:"post",data:t})}function p(t){return Object(r["a"])({url:"/kv/statistic/batch",method:"post",data:t})}function v(t){return Object(r["a"])({url:"/device/operating_device",method:"post",data:t})}function y(t){return Object(r["a"])({url:"/device/list/tree",method:"post",data:t})}function m(t){return Object(r["a"])({url:"/device/data",method:"post",data:t})}function g(t){return Object(r["a"])({url:"/device/update_only",method:"post",data:t})}function b(t){return Object(r["a"])({url:"/tp_script/list",method:"post",data:t})}function E(t){return Object(r["a"])({url:"/tp_script/add",method:"post",data:t})}function _(t){return Object(r["a"])({url:"/tp_script/edit",method:"post",data:t})}function w(t){return Object(r["a"])({url:"/tp_script/delete",method:"post",data:t})}function C(t){return Object(r["a"])({url:"/tp_script/quiz",method:"post",data:t})}function O(t){return Object(r["a"])({url:"/device/status",method:"post",data:t})}function D(t){return Object(r["a"])({url:"/device/command/history/list",method:"post",data:t})}function x(t){return Object(r["a"])({url:"/device/command/list",method:"post",data:t})}function A(t){return Object(r["a"])({url:"/device/command/send",method:"post",data:t})}function N(t){return Object(r["a"])({url:"/device/event/history/list",method:"post",data:t})}function T(t){return Object(r["a"])({url:"/kv/history/delete",method:"post",data:t})}function k(){return Object(r["a"])({url:"/home/system/time",method:"post"})}},b2eb:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var r=n("1da1"),i=n("5530"),o=(n("96cf"),n("e9c4"),n("30ab")),a=(n("add0"),"ws://ws.qylian.cn/ws/device/current"),c=function(){var t=null,e=null,n=null,c=function(r){"undefined"===typeof WebSocket?alert("您的浏览器不支持socket"):(t=new WebSocket(a),t.onerror=function(e){console.log("ws连接发生错误",e),t=null,r&&r({code:401,message:"连接失败"})},t.onopen=function(){console.log("ws连接成功",new Date),e&&e(),r&&r({code:200,message:"连接成功"})},t.onclose=function(){console.log("ws连接关闭",new Date),t=null,n&&n(),r&&r({code:400,message:"连接关闭"})})},s=function(t){e=t},u=function(t){n=t},l=function(e){var n=Object(i["a"])(Object(i["a"])({},e),{},{token:o["a"].getToken()});t&&t.send(JSON.stringify(n))},d=function(e){t&&(t.onmessage=function(t){console.log("onMessage",t.data),e&&e(t.data)})},f=function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t){e.next=4;break}return e.next=3,t.close();case 3:t=null;case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{init:c,send:l,onReady:s,onClose:u,onMessage:d,close:f}}},daa1:function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{"margin-top":"20px"}},[n("el-form",{attrs:{"label-position":"left",model:t.formData,"label-width":"120px"}},[n("el-form-item",{attrs:{label:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.DEVICE_ID")}},[n("el-tooltip",{attrs:{effect:"dark",content:t.isCopy?t.$t("DEVICE_MANAGEMENT.EDIT_PARAMETER.COPIED"):t.$t("DEVICE_MANAGEMENT.EDIT_PARAMETER.COPY")}},[n("el-input",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:t.device.device,expression:"device.device",arg:"copy"}],staticStyle:{width:"30%"},attrs:{readonly:""},nativeOn:{click:function(e){return t.handleCopy.apply(null,arguments)}},model:{value:t.device.device,callback:function(e){t.$set(t.device,"device",e)},expression:"device.device"}})],1)],1),"2"==t.device.device_type&&t.device.protocol.startsWith("WVP_")?n("el-form-item",{attrs:{label:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.LABLE1")}},[n("el-select",{staticStyle:{width:"100%"},model:{value:t.formData.d_id,callback:function(e){t.$set(t.formData,"d_id",e)},expression:"formData.d_id"}},t._l(t.wvpDevice,(function(e,r){return n("el-option",{key:e.deviceId,attrs:{label:e.deviceId+" ["+e.createTime+"] "+(1==e.online?t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.ONLINE"):t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.OFFLINE")),value:e.deviceId}})})),1)],1):t._e(),"2"!==t.device.device_type?n("div",{staticStyle:{"margin-bottom":"30px"}},[n("el-row",{staticStyle:{"flex-wrap":"wrap"},attrs:{gutter:12,type:"flex"}},t._l(t.deviceAttributeCardList,(function(e){return"systime"!==e.key&&"SYS_ONLINE"!==e.key?n("el-col",{key:e.key,staticStyle:{"min-width":"250px","margin-bottom":"10px"},attrs:{xs:24,sm:12,md:8,lg:8,xl:6}},[n("div",{staticStyle:{"background-color":"#2d3d88","border-radius":"4px",border:"1px solid #EBEEF5"}},[n("div",{staticStyle:{padding:"10px 10px 10px 20px",height:"30px"}},[n("span",{staticStyle:{"font-size":"18px"}},[t._v(t._s(e.name))]),n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.CHECK_TIMING_CHART"),placement:"top-start"}},[t.isShowDataChart(e)?n("i",{staticClass:"el-icon-pie-chart",staticStyle:{float:"right",padding:"3px 5px",cursor:"pointer"},on:{click:function(n){return t.showDeviceDataChart(e)}}}):n("i",{staticClass:"el-icon-pie-chart",staticStyle:{float:"right",padding:"3px 5px",cursor:"not-allowed"}})]),n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.$t("DEVICE_MANAGEMENT.DEVICE_CONFIG.CHECK_HISTORY_DATA"),placement:"top-start"}},[n("i",{staticClass:"el-icon-notebook-2",staticStyle:{float:"right",padding:"3px 5px",cursor:"pointer"},on:{click:function(n){return t.showDeviceHistory(e)}}})])],1),n("div",{staticStyle:{height:"3px !important"}},[n("hr",{staticStyle:{"border-top":"1px solid rgb(255 255 255 / 99%)"}})]),n("div",{staticStyle:{height:"115px",padding:"10px 5px 0px 10px"}},[n("div",{staticStyle:{height:"63px"}},[n("el-tooltip",{attrs:{content:t.getCardFullValue(e),placement:"top"}},[n("div",{staticStyle:{display:"flex"}},[n("div",{staticClass:"card_value_content"},[t._v(t._s(e.str_v?e.str_v:e.dbl_v))]),n("div",{staticClass:"card_value_unit"},[t._v(t._s(e.unit||""))])])])],1),n("div",{staticStyle:{float:"right",padding:"3px 5px","margin-bottom":"3px","margin-top":"11px"}},[t._v(t._s(t.calculateUpdateTime(e.ts)))])])])]):t._e()})),1)],1):t._e()],1),n("DeviceHistory",{attrs:{visible:t.deviceHistoryVisible,device:t.device,attributeName:t.choosedAttribute},on:{"update:visible":function(e){t.deviceHistoryVisible=e}}}),n("DeviceDataChart",{attrs:{visible:t.deviceDataChartVisible,device:t.device,attributeName:t.choosedAttribute},on:{"update:visible":function(e){t.deviceDataChartVisible=e}}})],1)},i=[],o=(n("99af"),n("31e1")),a=n("6d09"),c=n("f570"),s=n("aa98"),u=n("b2eb"),l={components:{DeviceHistory:o["default"],DeviceDataChart:a["default"]},props:{data:{type:Object,default:function(){return{}}},device:{type:[Object],default:function(){return{}}},wvpDevice:{type:Array,default:function(){return[]}},initAttributeCard:{type:Boolean,default:!1}},data:function(){return{isCopy:!1,choosedAttribute:"",deviceHistoryVisible:!1,deviceDataChartVisible:!1,deviceAttributeCardList:[],socket:null,firstLoad:!1}},computed:{formData:{get:function(){return this.data},set:function(t){this.$emit("update:data",t)}}},watch:{initAttributeCard:{handler:function(t){t&&(console.debug("initAttributeCard",t),this.getDeviceAttributeCardList())}}},beforeDestroy:function(){this.socket&&this.socket.close()},mounted:function(){console.log("DeviceAttribute",this.device),this.getDeviceAttributeCardList(),this.updateComponents()},methods:{getDeviceAttributeCardList:function(){var t=this;Object(s["c"])({device_id:this.device.id}).then((function(e){console.debug("====getDeviceAttributeCardList",e),200===e.data.code&&(t.deviceAttributeCardList=e.data.data?e.data.data:[])}))},handleCopy:function(){this.isCopy=!0},showDeviceHistory:function(t){this.choosedAttribute=t.key,this.deviceHistoryVisible=!0},showDeviceDataChart:function(t){this.choosedAttribute=t.key,this.deviceDataChartVisible=!0},calculateUpdateTime:function(t){var e=c["a"].t("COMMON.CURRENT_LANGUAGE"),n=Date.now(),r=n-parseInt(t/1e3);if(r<0)return"";for(var i=Math.floor(r/1e3),o=Math.floor(i/60),a=Math.floor(o/60),s=Math.floor(a/24),u=Math.floor(s/7),l=Math.floor(s/30),d=Math.floor(s/365),f=["年","个月","周","天","小时","分钟","秒"],h=["year(s)","month(s)","week(s)","day(s)","hour(s)","minute(s)","second(s)"],p="中文"===e?f:h,v=[d,l,u,s,a,o,i],y=0;y<v.length;y++)if(v[y]>0)return"中文"===e?"".concat(v[y]).concat(p[y],"前更新"):"Updated ".concat(v[y]," ").concat(p[y]," ago");return"中文"===e?"刚刚更新":"Just updated"},isShowDataChart:function(t){if(!t)return!1;var e=t.str_v?t.str_v:t.dbl_v;return!e||"number"===typeof e},getCardFullValue:function(t){var e=String(t.str_v?t.str_v:t.dbl_v);return t.unit&&(e+=" "+t.unit),console.error(t,e),e},updateComponents:function(){var t=this;console.error(this.device,this.websocket),this.socket&&(this.socket.close(),this.socket=null),this.socket=new u["a"],this.socket.init((function(t){})),this.socket.onReady((function(){t.socket.send({device_id:t.device.device})})),this.socket.onMessage((function(e){if(t.firstLoad)try{var n=JSON.parse(e);console.error(n);for(var r=1e3*new Date(n.ts).getTime(),i=0;i<t.deviceAttributeCardList.length;i++){var o=t.deviceAttributeCardList[i],a=n[o.key];void 0!==a&&(o.str_v=a,o.ts=r)}}catch(c){}else t.firstLoad=!0}))}}},d=l,f=(n("dc04"),n("2877")),h=Object(f["a"])(d,r,i,!1,null,"c3f5288a",null);e["default"]=h.exports},dc04:function(t,e,n){"use strict";n("9ac2")}}]);