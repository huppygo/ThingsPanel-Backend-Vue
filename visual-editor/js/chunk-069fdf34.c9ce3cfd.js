(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-069fdf34","chunk-2d212c35"],{"20e1":function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"chart-div"},[t.showHeader?n("div",{staticClass:"chart-header"},[n("span",{staticClass:"title"},[t._v(t._s(t.option.name))]),n("div",{staticClass:"tool-right"},[n("status-icon",{ref:"statusIconRef",attrs:{status:t.status}}),n("el-button",{staticClass:"tool-item",attrs:{size:"mini",icon:"el-icon-more"}})],1)]):t._e(),n("common-signal-status",{ref:"signalStatusRef",attrs:{option:t.option,value:t.value}})],1)},a=[],i=n("d7ac"),r={components:{StatusIcon:i["default"]},props:{showHeader:{type:[Boolean],default:!1},option:{type:[Object],default:function(){return{}}},device:{type:[Object],default:function(){return{}}},status:{type:[Boolean,Object],default:function(){return{}}}},data:function(){return{value:!1}},methods:{updateOption:function(t){this.value=t,this.$refs["signalStatusRef"].updateValue(t),this.$refs["statusIconRef"].flush()}}},s=r,c=(n("6154"),n("2877")),u=Object(c["a"])(s,o,a,!1,null,"3fc16b4e",null);e["default"]=u.exports},"2f56":function(t,e,n){"use strict";n("4278")},3895:function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{width:"100%",height:"100%","overflow-y":"auto"}},[n("grid-layout",{staticStyle:{width:"100%",height:"100%"},attrs:{layout:t.optionsData,"col-num":t.colNum,"row-height":30,"is-draggable":!0,"is-resizable":!0,"is-mirrored":!1,"vertical-compact":!0,margin:[10,10],"use-css-transforms":!0},on:{"update:layout":function(e){t.optionsData=e},"layout-updated":t.handleLayoutUpdatedEvent}},t._l(t.optionsData,(function(e,o){return n("grid-item",{key:e["id"]+o,staticClass:"grid-item",attrs:{x:e.x,y:e.y,w:e.w,h:e.h,i:e.i,dragAllowFrom:".chart-header"},on:{moved:function(n){return t.handleResized(e.i)},resized:function(n,o,a,i){return t.handleResized(e.i,{l:n,r:o,w:a,h:i})}}},["dashboard"!=e.controlType||e.type?t._e():n("e-charts",{key:e["id"],ref:"component_"+e.i,refInFor:!0,staticClass:"component-item",attrs:{"show-header":!0,option:e,device:t.device,value:e.value,status:t.deviceStatus}}),"history"==e.controlType?n("curve",{key:e["id"],ref:"component_"+e.i,refInFor:!0,staticClass:"component-item",attrs:{"show-header":!0,status:t.deviceStatus,option:e,device:t.device,value:e.value}}):t._e(),"status"==e.type?n("status",{key:e["id"],ref:"component_"+e.i,refInFor:!0,staticClass:"component-item",attrs:{"show-header":!0,status:t.deviceStatus,option:e,device:t.device}}):t._e(),"deviceStatus"==e.type?n("device-status",{key:e["id"],ref:"component_"+e.i,refInFor:!0,staticClass:"component-item",attrs:{"show-header":!0,status:t.deviceStatus,option:e,device:t.device,value:e.value}}):t._e(),"signalStatus"==e.type?n("signal-status",{key:e["id"],ref:"component_"+e.i,refInFor:!0,staticClass:"component-item",attrs:{"show-header":!0,status:t.deviceStatus,option:e,device:t.device,value:e.value}}):t._e(),"textInfo"==e.type?n("text-info",{key:e["id"],ref:"component_"+e.i,refInFor:!0,staticClass:"component-item",attrs:{"show-header":!0,status:t.deviceStatus,option:e,device:t.device,value:e.value}}):t._e(),"control"==e.controlType?n("control",{key:e["id"],ref:"component_"+e.i,refInFor:!0,staticClass:"component-item",attrs:{"show-header":!0,status:t.deviceStatus,option:e,device:t.device}}):t._e(),"video"==e.controlType?n("video-component",{key:e["id"],ref:"component_"+e.i,refInFor:!0,staticClass:"component-item",staticStyle:{"min-width":"200px","min-height":"200px"},attrs:{status:t.deviceStatus,"show-header":!0,option:e,device:t.device}}):t._e()],1)})),1)],1)},a=[],i=n("53ca"),r=n("5530"),s=n("1da1"),c=(n("96cf"),n("e9c4"),n("7db0"),n("d3b7"),n("d9e2"),n("d81d"),n("25f0"),n("159b"),n("c740"),n("b0c0"),n("7be8")),u=n("28b4"),d=n("7f74"),l=n("79ec"),f=n("60a6"),p=n("20e1"),h=n("a8c7"),m=n("a2cb"),v=n("8731"),y=n("aa98"),g=n("b2eb"),b={name:"PluginCharts",components:{GridLayout:c["GridLayout"],GridItem:c["GridItem"],ECharts:u["default"],Curve:d["default"],Control:l["default"],Status:f["default"],SignalStatus:p["default"],DeviceStatus:h["default"],TextInfo:m["default"],VideoComponent:v["default"]},props:{options:{type:[Array],default:function(){return[]}},tsl:{type:[Array],default:function(){return[]}},device:{type:[Object],default:function(){return{}}}},data:function(){return{optionsData:[],colNum:24,pluginStatus:{LOADING:0,LOADED:1,NONE:2},status:0,flushTime:5,timer:null,socket:null,firstLoaded:!0,deviceStatus:{status:!1,lastPushTime:""}}},watch:{options:{handler:function(t){var e=localStorage.getItem("deviceWatch_timer");if(e&&clearInterval(parseInt(e)),t&&t.length>0){var n=JSON.parse(JSON.stringify(t));this.getLayout(n,4)}else this.optionsData=[],this.status=this.pluginStatus.NONE}},"device.device":{handler:function(t){this.socket&&(this.firstLoaded=!0,this.socket.close(),this.socket=null)}},immediate:!0,deep:!0},beforeDestroy:function(){this.timer&&clearInterval(this.timer),this.socket&&this.socket.close()},methods:{handleResized:function(t,e){var n=this;this.$nextTick((function(){n.$refs["component_"+t][0].sizeChange&&n.$refs["component_"+t][0].sizeChange()}))},getLayout:function(t){var e=this,n=JSON.parse(JSON.stringify(t));Object(y["i"])({id:this.device.device}).then((function(o){var a=o.data;if(200==a.code){if(a.data["chart_option"]&&"[]"!=a.data["chart_option"]&&"{}"!=a.data["chart_option"])try{for(var i=JSON.parse(a.data["chart_option"]),r=function(t){var o=i.find((function(n){return n.id==e.options[t].id}));if(!o)throw new Error("布局数据错误");n[t].x=o.x,n[t].y=o.y,n[t].w=o.w,n[t].h=o.h,n[t].i=o.i},s=0;s<e.options.length;s++)r(s);e.optionsData=n}catch(c){e.optionsData=e.getDefaultLayout(t,4)}else e.optionsData=e.getDefaultLayout(n,4);e.status=e.pluginStatus.LOADED,e.getComponentMaps(e.optionsData)}}))},getDefaultLayout:function(t,e){for(var n=this.colNum/e,o=n,a=0,i=0,r=0;r<t.length;r++)a==e&&(i++,a=0),t[r].w=n,t[r].h=o,t[r].x=a*n,t[r].y=i*o,t[r].i=r,a++;return t},setLayout:function(){if(this.device.device&&this.optionsData){var t=this.optionsData.map((function(t){return{x:t.x,y:t.y,w:t.w,h:t.h,i:t.i,id:t.id}}));this.firstLoaded||Object(y["j"])({id:this.device.device,chart_option:JSON.stringify(t)}).then((function(t){})),this.firstLoaded=!1}},handleLayoutUpdatedEvent:function(t){this.setLayout()},getComponentMaps:function(t){for(var e={current:[],history:[]},n=0;n<t.length;n++){var o=t[n];"dashboard"===o.controlType||"information"===o.controlType?e.current.push({id:o.id,map:this.getMapping(o)}):"control"===o.controlType&&"setValue"!=o.type?e.current.push({id:o.id,map:this.getControlMapping(o)}):"history"===o.controlType&&e.history.push({id:o.id,i:o.i,map:this.getMapping(o)})}this.updateComponents(e)},updateComponents:function(t){var e=this;this.getDeviceStatus(),this.getHistory(t.history),this.socket&&(this.socket.close(),this.socket=null),this.socket=new g["a"],this.socket.init((function(t){})),this.socket.onReady((function(){e.socket.send({device_id:e.device.device})})),this.socket.onMessage((function(n){try{var o=JSON.parse(n);e.deviceStatus.lastPushTime=o.systime||(new Date).Format("yyyy-MM-dd hh:mm:ss"),e.setComponentsValue(t.current,o),e.setComponentsValue(t.history,o)}catch(a){}}))},getDeviceStatus:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var n,o,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={device_id_list:[t.device.device]},e.prev=1,e.next=4,Object(y["q"])(n);case 4:o=e.sent,a=o.data,200===a.code&&(t.deviceStatus.status="1"===a.data[t.device.device].toString()),e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](1),t.deviceStatus.status=!1;case 12:case"end":return e.stop()}}),e,null,[[1,9]])})))()},getHistory:function(t){var e=this;t&&0!==t.length&&this.$nextTick((function(){t.forEach((function(t){var n=e.$refs["component_"+t.i];n&&n[0]&&n[0].getHistory(t.map)}))}))},setComponentsValue:function(t,e){var n=this;if(t&&0!==t.length&&e&&"{}"!==JSON.stringify(e))try{this.optionsData.forEach((function(o){var a=t.findIndex((function(t){return t.id==o.id}));if(t[a]){var i=t[a].map,s=null;"dashboard"==o.controlType||"information"==o.controlType?s="deviceStatus"==o.type?e.systime||"":"signalStatus"==o.type||"textInfo"==o.type?e&&e[i[0].name]?e[i[0].name]:null:i.map((function(t){return e&&e[t.name]?Object(r["a"])(Object(r["a"])({},t),{},{value:e[t.name]||""}):Object(r["a"])(Object(r["a"])({},t),{},{value:""})})):"control"==o.controlType?(s={},i.forEach((function(t){e&&e[t]&&(s[t]=e[t])}))):"history"===o.controlType&&(console.log("curve.history",i,e,o),s={},i.forEach((function(t){e&&e[t.name]&&(s[t.name]=e[t.name],s["systime"]=e["systime"])}))),n.$nextTick((function(){var t=n.$refs["component_"+o.i];t&&t[0]&&n.$refs["component_"+o.i][0].updateOption(s)}))}}))}catch(o){}},getMapping:function(t){if(t.mapping){var e=[];return this.tsl.map((function(n){"object"==Object(i["a"])(t.mapping)?t.mapping.forEach((function(t){n.name==t&&e.push(n)})):t.mapping===n.name&&e.push(n)})),e}return[]},getControlMapping:function(t){if(t.series&&t.series.length>0){var e=[];return t.series.forEach((function(t){t&&t.mapping&&e.push(t.mapping.value)})),e}}}},O=b,j=(n("2f56"),n("2877")),w=Object(j["a"])(O,o,a,!1,null,"7cea18b0",null);e["default"]=w.exports},4278:function(t,e,n){},"53b5":function(t,e,n){},6154:function(t,e,n){"use strict";n("87e4")},"87e4":function(t,e,n){},a2cb:function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"chart-div"},[t.showHeader?n("div",{staticClass:"chart-header"},[n("span",{staticClass:"title"},[t._v(t._s(t.option.name))]),n("div",{staticClass:"tool-right"},[n("status-icon",{ref:"statusIconRef",attrs:{status:t.status}})],1)]):t._e(),n("common-text-info",{ref:"textInfoRef",attrs:{option:t.option,value:t.value}})],1)},a=[],i=n("53ca"),r=n("d7ac"),s={components:{StatusIcon:r["default"]},props:{showHeader:{type:[Boolean],default:!1},option:{type:[Object],default:function(){return{}}},device:{type:[Object],default:function(){return{}}},status:{type:[Boolean,Object],default:function(){return{}}}},data:function(){return{value:""}},methods:{updateOption:function(t){t&&("object"===Object(i["a"])(t)?this.value=t[0].value:this.value=t,this.$refs.statusIconRef.flush())}}},c=s,u=(n("f0ef"),n("2877")),d=Object(u["a"])(c,o,a,!1,null,"11628972",null);e["default"]=d.exports},aa98:function(t,e,n){"use strict";n.d(e,"g",(function(){return a})),n.d(e,"f",(function(){return i})),n.d(e,"j",(function(){return r})),n.d(e,"h",(function(){return s})),n.d(e,"i",(function(){return c})),n.d(e,"x",(function(){return u})),n.d(e,"b",(function(){return d})),n.d(e,"c",(function(){return l})),n.d(e,"t",(function(){return f})),n.d(e,"v",(function(){return p})),n.d(e,"w",(function(){return h})),n.d(e,"z",(function(){return m})),n.d(e,"r",(function(){return v})),n.d(e,"p",(function(){return y})),n.d(e,"A",(function(){return g})),n.d(e,"l",(function(){return b})),n.d(e,"a",(function(){return O})),n.d(e,"k",(function(){return j})),n.d(e,"e",(function(){return w})),n.d(e,"y",(function(){return _})),n.d(e,"q",(function(){return k})),n.d(e,"m",(function(){return S})),n.d(e,"n",(function(){return C})),n.d(e,"u",(function(){return x})),n.d(e,"o",(function(){return D})),n.d(e,"d",(function(){return I})),n.d(e,"s",(function(){return T}));var o=n("18a6");function a(t){return Object(o["a"])({url:"/index/show",method:"post",data:t})}function i(t){return Object(o["a"])({url:"/device/add_only",method:"post",data:t})}function r(t){return Object(o["a"])({url:"/device/update_only",method:"post",data:t})}function s(t){return Object(o["a"])({url:"/device/delete",method:"post",data:t})}function c(t){return Object(o["a"])({url:"/device/data",method:"post",data:t})}function u(t){return Object(o["a"])({url:"/structure/field",method:"post",data:t})}function d(t){return Object(o["a"])({url:"/kv/current",method:"post",data:t})}function l(t){return Object(o["a"])({url:"/kv/current/detail",method:"post",data:t})}function f(t){return Object(o["a"])({url:"/kv/history/data",method:"post",data:t})}function p(t){return Object(o["a"])({url:"/kv/statistic",method:"post",data:t})}function h(t){return Object(o["a"])({url:"/kv/statistic/batch",method:"post",data:t})}function m(t){return Object(o["a"])({url:"/device/operating_device",method:"post",data:t})}function v(t){return Object(o["a"])({url:"/device/list/tree",method:"post",data:t})}function y(t){return Object(o["a"])({url:"/device/data",method:"post",data:t})}function g(t){return Object(o["a"])({url:"/device/update_only",method:"post",data:t})}function b(t){return Object(o["a"])({url:"/tp_script/list",method:"post",data:t})}function O(t){return Object(o["a"])({url:"/tp_script/add",method:"post",data:t})}function j(t){return Object(o["a"])({url:"/tp_script/edit",method:"post",data:t})}function w(t){return Object(o["a"])({url:"/tp_script/delete",method:"post",data:t})}function _(t){return Object(o["a"])({url:"/tp_script/quiz",method:"post",data:t})}function k(t){return Object(o["a"])({url:"/device/status",method:"post",data:t})}function S(t){return Object(o["a"])({url:"/device/command/history/list",method:"post",data:t})}function C(t){return Object(o["a"])({url:"/device/command/list",method:"post",data:t})}function x(t){return Object(o["a"])({url:"/device/command/send",method:"post",data:t})}function D(t){return Object(o["a"])({url:"/device/event/history/list",method:"post",data:t})}function I(t){return Object(o["a"])({url:"/kv/history/delete",method:"post",data:t})}function T(){return Object(o["a"])({url:"/home/system/time",method:"post"})}},b2eb:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var o=n("1da1"),a=n("5530"),i=(n("96cf"),n("e9c4"),n("30ab")),r=(n("add0"),"ws://ws.qylian.cn/ws/device/current"),s=function(){var t=null,e=null,n=null,s=function(o){"undefined"===typeof WebSocket?alert("您的浏览器不支持socket"):(t=new WebSocket(r),t.onerror=function(e){console.log("ws连接发生错误",e),t=null,o&&o({code:401,message:"连接失败"})},t.onopen=function(){console.log("ws连接成功",new Date),e&&e(),o&&o({code:200,message:"连接成功"})},t.onclose=function(){console.log("ws连接关闭",new Date),t=null,n&&n(),o&&o({code:400,message:"连接关闭"})})},c=function(t){e=t},u=function(t){n=t},d=function(e){var n=Object(a["a"])(Object(a["a"])({},e),{},{token:i["a"].getToken()});t&&t.send(JSON.stringify(n))},l=function(e){t&&(t.onmessage=function(t){console.log("onMessage",t.data),e&&e(t.data)})},f=function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t){e.next=4;break}return e.next=3,t.close();case 3:t=null;case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{init:s,send:d,onReady:c,onClose:u,onMessage:l,close:f}}},f0ef:function(t,e,n){"use strict";n("53b5")}}]);