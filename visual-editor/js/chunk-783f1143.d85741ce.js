(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-783f1143","chunk-548098a9","chunk-2d212c35"],{"2b6d":function(t,e,a){"use strict";a.d(e,"d",(function(){return o})),a.d(e,"a",(function(){return r})),a.d(e,"c",(function(){return i})),a.d(e,"b",(function(){return u}));var n=a("18a6");function o(t){return Object(n["a"])({url:"/business/index",method:"post",data:t})}function r(t){return Object(n["a"])({url:"/business/add",method:"post",data:t})}function i(t){return Object(n["a"])({url:"/business/edit",method:"post",data:t})}function u(t){return Object(n["a"])({url:"/business/delete",method:"post",data:t})}},"308f":function(t,e,a){"use strict";a.d(e,"c",(function(){return r})),a.d(e,"j",(function(){return i})),a.d(e,"d",(function(){return u})),a.d(e,"e",(function(){return d})),a.d(e,"f",(function(){return c})),a.d(e,"i",(function(){return s})),a.d(e,"g",(function(){return l})),a.d(e,"h",(function(){return f})),a.d(e,"a",(function(){return p})),a.d(e,"b",(function(){return h}));var n=a("5530"),o=(a("2ca0"),a("d3b7"),a("d81d"),a("18a6"));function r(){return Object(o["a"])({url:"/asset/index",method:"post"})}function i(t){return Object(o["a"])({url:"/structure/field",method:"post",data:t})}function u(t){return Object(o["a"])({url:"/asset/list",method:"post",data:t})}function d(t){return Object(o["a"])({url:"/asset/list/a",method:"post",data:t})}function c(t){return Object(o["a"])({url:"/asset/list/b",method:"post",data:t})}function s(t){var e=function(t){return t&&t.startsWith("/")?t.substring(1):t};return new Promise((function(a,n){Object(o["a"])({url:"/asset/list/d",method:"post",data:t}).then((function(t){var n=t.data.data.map((function(t){return t.device_group=e(t.device_group),t}));t.data.data=n,a(t)})).catch((function(t){n(t)}))}))}function l(t){return Object(o["a"])({url:"/asset/list/c",method:"post",data:t})}function f(t){return Object(o["a"])({url:"/asset/update_only",method:"post",data:t})}function p(t){return Object(o["a"])({url:"/asset/add_only",method:"post",data:t})}function h(t){return Object(o["a"])({url:"/asset/delete",method:"post",data:Object(n["a"])({type:1},t)})}},7667:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{display:"flex"}},[a("el-select",{ref:"projectRef",staticStyle:{width:"100px","margin-right":"10px"},attrs:{placeholder:t.$t("AUTOMATION.PLACEHOLDER.SELECT_PROJECT")},on:{change:t.handleProjectChange},model:{value:t.formData.projectId,callback:function(e){t.$set(t.formData,"projectId",e)},expression:"formData.projectId"}},t._l(t.projectOptions,(function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.id}})})),1),t.formData.projectId?a("el-select",{ref:"groupRef",staticStyle:{width:"100px","margin-right":"10px"},attrs:{placeholder:t.$t("AUTOMATION.PLACEHOLDER.SELECT_GROUP")},on:{change:t.handleGroupChange},model:{value:t.formData.groupId,callback:function(e){t.$set(t.formData,"groupId",e)},expression:"formData.groupId"}},t._l(t.groupOptions,(function(t,e){return a("el-option",{key:e,attrs:{label:t.device_group,value:t.id}})})),1):t._e(),t.formData.groupId?a("el-cascader",{ref:"deviceRef",staticStyle:{width:"100px","margin-right":"10px"},attrs:{placeholder:t.$t("AUTOMATION.PLACEHOLDER.SELECT_DEVICE"),options:t.deviceOptions,clearable:"",props:{checkStrictly:!0,emitPath:!1}},on:{change:t.handleDeviceChange},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.node,o=e.data;return[a("span",[t._v(t._s(o.label))]),n.isLeaf?t._e():a("span",[t._v(" ("+t._s(o.children.length)+") ")])]}}],null,!1,1996962598),model:{value:t.formData.device,callback:function(e){t.$set(t.formData,"device",e)},expression:"formData.device"}}):t._e(),t.formData.device?a("el-select",{ref:"stateRef",staticStyle:{width:"100px","margin-right":"10px"},on:{change:t.handleStateChange},model:{value:t.formData.messageType,callback:function(e){t.$set(t.formData,"messageType",e)},expression:"formData.messageType"}},t._l(t.stateOptions,(function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.messageType}})})),1):t._e()],1)},o=[],r=a("5530"),i=(a("e9c4"),a("d81d"),a("7db0"),a("d3b7"),a("b0c0"),a("2b6d")),u=a("308f"),d=a("aa98"),c=a("9448"),s=a("2fa3"),l=(a("f570"),{name:"DeviceTypeSelector",components:{},props:{option:{type:[Object],default:function(){return{operator:!0}}},data:{type:[Object],default:function(){return{}}}},data:function(){return{formData:{projectId:"",groupId:"",deviceId:"",device:"",messageType:""},projectOptions:[],groupOptions:[],deviceOptions:[],stateOptions:[{name:"属性上报",messageType:1},{name:"属性下发",messageType:2},{name:"事件上报",messageType:3},{name:"自定义上报",messageType:4}]}},watch:{data:{handler:function(t){console.log("data",t),t&&(this.formData=JSON.parse(JSON.stringify(t)),console.log("formData",this.formData))},immediate:!0},"formData.projectId":{handler:function(t){t&&this.getGroupList(t)},immediate:!0},"formData.groupId":{handler:function(t){t&&(console.log("formData.groupId",t),this.getDeviceList(t))},immediate:!0}},created:function(){this.getProjectList()},methods:{handleProjectChange:function(t){this.formData.projectId=t,this.formData.groupId="",this.updateData(),this.getGroupList(t)},handleGroupChange:function(t){console.log("handleGroupChange",t),this.formData.groupId=t,this.formData.deviceId="",this.updateData(),this.getDeviceList(t)},handleDeviceChange:function(t){var e=this.$refs.deviceRef,a=e.getCheckedNodes()[0].data;console.log("handleDeviceChange.device",this.formData.device),this.formData.deviceId=a.value,this.updateData()},handleStateChange:function(t){this.formData.state=t,this.updateData()},handleDurationChange:function(t){this.formData.state.duration=t,this.updateData()},handleOperatorChange:function(t){this.formData.state.operator=t,this.updateData()},updateData:function(){console.log("updateData",this.formData),this.$emit("change",this.formData)},getProjectList:function(){var t=this;Object(i["d"])({limit:100,page:1}).then((function(e){var a,n=e.data;200==n.code&&(t.projectOptions=(null===(a=n.data)||void 0===a?void 0:a.data)||[])}))},getGroupList:function(t){var e=this;Object(u["i"])({business_id:t}).then((function(t){var a=t.data;200==a.code&&(e.groupOptions=(null===a||void 0===a?void 0:a.data)||[])}))},getDeviceList:function(t){var e=this,a={current_page:1,per_page:9999,asset_id:t};Object(d["r"])(a).then((function(t){var a=t.data;if(console.log(a,"res"),200==a.code){var n,o=(null===(n=a.data)||void 0===n?void 0:n.data)||[];e.deviceOptions=o.map((function(t){return{label:t.device_name,value:t.device,pluginId:t.type}})),e.formData.deviceId&&(e.formData.device=e.deviceOptions.find((function(t){return t.value==e.formData.deviceId})),e.updateData())}}))},getStateList:function(t){var e=this;if(console.log("getStateList",t),this.stateOptions=[],this.option.operator&&(this.stateOptions.push({label:this.$t("AUTOMATION.ONLINE_STATUS"),options:[{mode:"onlineDuration",label:this.$t("AUTOMATION.ONLINE_DURATION"),name:"onlineDuration"}]}),this.stateOptions.push({label:this.$t("AUTOMATION.ONLINE_OFFLINE"),options:[{mode:"onlineState",label:this.$t("AUTOMATION.ONLINE"),name:"online"},{mode:"onlineState",label:this.$t("AUTOMATION.OFFLINE"),name:"offline"},{mode:"onlineState",label:this.$t("AUTOMATION.ONLINE_OFFLINE"),name:"onAndOff"}]})),t){var a={current_page:1,per_page:9999,id:t};c["a"].page(a).then((function(t){var a=t.data;if(200==a.code){var n,o,i,u=(null===(n=a.data)||void 0===n||null===(o=n.data[0])||void 0===o?void 0:o.chart_data)||"{}",d=JSON.parse(u),c=(null===(i=d.tsl)||void 0===i?void 0:i.properties)||[],s=c.map((function(t){return e.formData.state&&e.formData.state.name===t.name&&(e.formData.state=Object(r["a"])(Object(r["a"])({},e.formData.state),{},{unit:t.unit,type:t.type})),{label:t.title,name:t.name,unit:t.unit,mode:"property",type:t.dataType}}));e.stateOptions.push({label:e.$t("AUTOMATION.PROPERTY"),options:s}),console.log(e.stateOptions),e.updateData()}}))}else this.updateData()},validate:function(){var t=this.$refs,e=this.formData;return e.projectId&&""!==e.projectId?e.groupId&&""!==e.groupId?e.device&&""!==e.device?e.messageType&&""!==e.messageType?!(t.onlineDurationRef&&!t.onlineDurationRef.validate())&&!(t.operatorSelectorRef&&!t.operatorSelectorRef.validate()):(t.stateRef.focus(),Object(s["h"])(this.$t("AUTOMATION.ERROR.MESSAGETYPE")),!1):(t.deviceRef.focus(),Object(s["h"])(this.$t("AUTOMATION.ERROR.DEVICE")),!1):(t.groupRef.focus(),Object(s["h"])(this.$t("AUTOMATION.ERROR.GROUP")),!1):(t.projectRef.focus(),Object(s["h"])(this.$t("AUTOMATION.ERROR.PROJECT")),!1)}}}),f=l,p=a("2877"),h=Object(p["a"])(f,n,o,!1,null,"737c8286",null);e["default"]=h.exports},9448:function(t,e,a){"use strict";var n=a("18a6");e["a"]={add:function(t){return Object(n["a"])({url:"/device/model/add",method:"post",data:t})},edit:function(t){return Object(n["a"])({url:"/device/model/edit",method:"post",data:t})},del:function(t){return Object(n["a"])({url:"/device/model/delete",method:"post",data:t})},page:function(t){return Object(n["a"])({url:"/device/model/list",method:"post",data:t})},tree:function(t){return Object(n["a"])({url:"/device/model/tree",method:"post",data:t})},category:function(t){return Object(n["a"])({url:"/dict/list/",method:"post",data:t})},map:function(t){return Object(n["a"])({url:"/device/map",method:"post",data:t})},equip:function(t){return Object(n["a"])({url:"/kv/current/symbol",method:"post",data:t})},state:function(t){return Object(n["a"])({url:"/device/status",method:"post",data:t})}}},aa98:function(t,e,a){"use strict";a.d(e,"g",(function(){return o})),a.d(e,"f",(function(){return r})),a.d(e,"j",(function(){return i})),a.d(e,"h",(function(){return u})),a.d(e,"i",(function(){return d})),a.d(e,"x",(function(){return c})),a.d(e,"b",(function(){return s})),a.d(e,"c",(function(){return l})),a.d(e,"t",(function(){return f})),a.d(e,"v",(function(){return p})),a.d(e,"w",(function(){return h})),a.d(e,"z",(function(){return m})),a.d(e,"r",(function(){return O})),a.d(e,"p",(function(){return v})),a.d(e,"A",(function(){return b})),a.d(e,"l",(function(){return g})),a.d(e,"a",(function(){return j})),a.d(e,"k",(function(){return D})),a.d(e,"e",(function(){return I})),a.d(e,"y",(function(){return T})),a.d(e,"q",(function(){return y})),a.d(e,"m",(function(){return _})),a.d(e,"n",(function(){return A})),a.d(e,"u",(function(){return E})),a.d(e,"o",(function(){return R})),a.d(e,"d",(function(){return N})),a.d(e,"s",(function(){return L}));var n=a("18a6");function o(t){return Object(n["a"])({url:"/index/show",method:"post",data:t})}function r(t){return Object(n["a"])({url:"/device/add_only",method:"post",data:t})}function i(t){return Object(n["a"])({url:"/device/update_only",method:"post",data:t})}function u(t){return Object(n["a"])({url:"/device/delete",method:"post",data:t})}function d(t){return Object(n["a"])({url:"/device/data",method:"post",data:t})}function c(t){return Object(n["a"])({url:"/structure/field",method:"post",data:t})}function s(t){return Object(n["a"])({url:"/kv/current",method:"post",data:t})}function l(t){return Object(n["a"])({url:"/kv/current/detail",method:"post",data:t})}function f(t){return Object(n["a"])({url:"/kv/history/data",method:"post",data:t})}function p(t){return Object(n["a"])({url:"/kv/statistic",method:"post",data:t})}function h(t){return Object(n["a"])({url:"/kv/statistic/batch",method:"post",data:t})}function m(t){return Object(n["a"])({url:"/device/operating_device",method:"post",data:t})}function O(t){return Object(n["a"])({url:"/device/list/tree",method:"post",data:t})}function v(t){return Object(n["a"])({url:"/device/data",method:"post",data:t})}function b(t){return Object(n["a"])({url:"/device/update_only",method:"post",data:t})}function g(t){return Object(n["a"])({url:"/tp_script/list",method:"post",data:t})}function j(t){return Object(n["a"])({url:"/tp_script/add",method:"post",data:t})}function D(t){return Object(n["a"])({url:"/tp_script/edit",method:"post",data:t})}function I(t){return Object(n["a"])({url:"/tp_script/delete",method:"post",data:t})}function T(t){return Object(n["a"])({url:"/tp_script/quiz",method:"post",data:t})}function y(t){return Object(n["a"])({url:"/device/status",method:"post",data:t})}function _(t){return Object(n["a"])({url:"/device/command/history/list",method:"post",data:t})}function A(t){return Object(n["a"])({url:"/device/command/list",method:"post",data:t})}function E(t){return Object(n["a"])({url:"/device/command/send",method:"post",data:t})}function R(t){return Object(n["a"])({url:"/device/event/history/list",method:"post",data:t})}function N(t){return Object(n["a"])({url:"/kv/history/delete",method:"post",data:t})}function L(){return Object(n["a"])({url:"/home/system/time",method:"post"})}}}]);