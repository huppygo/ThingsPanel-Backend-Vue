(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d7931cb8","chunk-65563274"],{"0bb4":function(e,t,i){"use strict";i.d(t,"e",(function(){return o})),i.d(t,"a",(function(){return n})),i.d(t,"d",(function(){return s})),i.d(t,"c",(function(){return r})),i.d(t,"b",(function(){return c})),i.d(t,"g",(function(){return l})),i.d(t,"f",(function(){return f}));var a=i("18a6");function o(e){return Object(a["a"])({url:"/notification/list",method:"post",data:e})}function n(e){return Object(a["a"])({url:"/notification/save",method:"post",data:e})}function s(e){return Object(a["a"])({url:"/notification/save",method:"post",data:e})}function r(e){return Object(a["a"])({url:"/notification/detail",method:"post",data:e})}function c(e){return Object(a["a"])({url:"/notification/delete",method:"post",data:e})}function l(e){return Object(a["a"])({url:"/user/index",method:"post",data:e})}function f(e){return Object(a["a"])({url:"/notification/switch",method:"post",data:e})}},1750:function(e,t,i){"use strict";i("d5c0")},"8dc8":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{display:"flex"}},[i("el-select",{ref:"userRef",staticStyle:{width:"200px","margin-right":"10px"},on:{change:e.handleUserChange},model:{value:e.formData.user_id,callback:function(t){e.$set(e.formData,"user_id",t)},expression:"formData.user_id"}},e._l(e.userOptions,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.id}})})),1),i("el-checkbox-group",{model:{value:e.list,callback:function(t){e.list=t},expression:"list"}},e._l(e.dataList,(function(t,a){return i("el-checkbox",{key:a,attrs:{label:t.label},on:{change:function(i){return e.chooseChange(i,t)}}},[e._v(e._s(t.name))])})),1)],1)},o=[],n=(i("e9c4"),i("0bb4")),s=i("2fa3"),r=i("f570"),c={name:"DeviceTypeSelector",components:{},props:{option:{type:[Object],default:function(){return{operator:!0}}},data:{type:[Object],default:function(){return{}}}},data:function(){return{formData:{user_id:"",list:[],is_email:0,is_message:0,is_phone:0},list:[],userOptions:[],params:{page:1,limit:100},dataList:[{name:r["a"].t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.EMAIL"),label:"is_email"},{name:r["a"].t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.SMS"),label:"is_message"},{name:r["a"].t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.PHONE"),label:"is_phone"}]}},watch:{data:{handler:function(e){if(e){var t=[];for(var i in e)console.log(i),1===e[i]&&t.push(i);this.list=t,this.formData=JSON.parse(JSON.stringify(e)),console.log("formData",this.formData)}},immediate:!0}},created:function(){this.getUser()},methods:{handleUserChange:function(e){this.formData.user_id=e,this.updateData()},chooseChange:function(e,t){"is_email"===t.label?this.formData.is_email=e?1:0:"is_message"===t.label?this.formData.is_message=e?1:0:"is_phone"===t.label&&(this.formData.is_phone=e?1:0),this.updateData()},updateData:function(){console.log("updateData",this.formData),this.$emit("change",this.formData)},getUser:function(){var e=this;Object(n["g"])(this.params).then((function(t){200===t.data.code&&(e.userOptions=t.data.data.data)}))},validate:function(){var e=this.$refs,t=this.formData;return t.user_id&&""!==t.user_id?!(!this.list||0===this.list.length)||(Object(s["h"])(this.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.PLACEHOLDER4")),!1):(e.userRef.focus(),Object(s["h"])(this.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.PLACEHOLDER3")),!1)}}},l=c,f=i("2877"),m=Object(f["a"])(l,a,o,!1,null,"4979be05",null);t["default"]=m.exports},ce67:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-dialog",{staticClass:"el-dark-dialog",attrs:{title:e.id?e.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.EDITTITLE"):e.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.ADDTITLE"),"close-on-click-modal":!1,"before-close":e.handleClose,visible:e.dialogVisible,width:"60%",height:"60%",top:"10vh"},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("el-form",{ref:"CreateForm",attrs:{"label-position":"left","label-width":"140px",model:e.form}},[i("el-form-item",{attrs:{label:e.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.GROUPNAME"),required:""}},[i("el-input",{ref:"nameRef",model:{value:e.form.group_name,callback:function(t){e.$set(e.form,"group_name",t)},expression:"form.group_name"}})],1),i("el-form-item",{attrs:{label:e.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.DESC"),required:""}},[i("el-input",{ref:"descRef",staticClass:"el-dark-input",attrs:{type:"textarea"},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1),i("el-form-item",{attrs:{label:e.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.METHOD"),required:""}},[i("el-select",{ref:"selRef",staticClass:"w-100",attrs:{placeholder:e.$t("COMMON.PLACEHOLDER5")},on:{change:e.handleTypeChange},model:{value:e.form.notification_type,callback:function(t){e.$set(e.form,"notification_type",t)},expression:"form.notification_type"}},[i("el-option",{attrs:{label:"成员通知",value:1}}),i("el-option",{attrs:{label:"邮箱通知",value:2}}),i("el-option",{attrs:{label:"短信通知",value:4}}),i("el-option",{attrs:{label:"语音通知",value:5}}),i("el-option",{attrs:{label:"企业微信群机器人",value:6}}),i("el-option",{attrs:{label:"钉钉群机器人",value:7}}),i("el-option",{attrs:{label:"飞书群机器人",value:8}}),i("el-option",{attrs:{label:"webhook",value:3}})],1)],1),1==e.noticeType?i("div",[i("el-form-item",{attrs:{label:e.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.SETMETHOD"),required:""}},e._l(e.form.commands,(function(t,a){return i("div",{key:a,staticStyle:{display:"flex","margin-bottom":"10px"}},[i("DeviceTypeSelector",{ref:"deviceTypeRef",refInFor:!0,attrs:{data:t.data,option:{operator:!1}},on:{change:function(i){return e.handleCommandChange(t,i)}}}),0==a?i("el-button",{staticStyle:{"margin-left":"auto"},attrs:{type:"indigo",size:"small"},on:{click:function(i){return e.handleAddCommand(t)}}},[e._v(e._s(e.$t("COMMON.ADD")))]):e._e(),a>0?i("el-button",{staticStyle:{"margin-left":"auto"},attrs:{type:"danger",size:"small"},on:{click:function(i){return e.handleDeleteCommand(t)}}},[e._v(e._s(e.$t("COMMON.DELETE")))]):e._e()],1)})),0)],1):e._e(),2==e.noticeType?i("div",[i("el-form-item",{attrs:{label:e.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.SETEMAIL"),required:""}},[i("el-input",{staticClass:"el-dark-input",attrs:{type:"textarea",placeholder:e.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.PLACEHOLDER6")},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1)],1):e._e(),4==e.noticeType?i("div",[i("el-form-item",{attrs:{label:e.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.SETSMS"),required:""}},[i("el-input",{staticClass:"el-dark-input",attrs:{type:"textarea",placeholder:e.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.PLACEHOLDER7")},model:{value:e.form.message,callback:function(t){e.$set(e.form,"message",t)},expression:"form.message"}})],1)],1):e._e(),5==e.noticeType?i("div",[i("el-form-item",{attrs:{label:e.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.SETVOICE"),required:""}},[i("el-input",{staticClass:"el-dark-input",attrs:{type:"textarea",placeholder:e.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.PLACEHOLDER8")},model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",t)},expression:"form.phone"}})],1)],1):e._e(),3==e.noticeType||6==e.noticeType||7==e.noticeType||8==e.noticeType?i("div",[i("el-form-item",{attrs:{label:e.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.SETURL"),required:""}},[i("el-input",{model:{value:e.form.webhook,callback:function(t){e.$set(e.form,"webhook",t)},expression:"form.webhook"}})],1)],1):e._e(),i("div",{staticStyle:{display:"flex","justify-content":"center"}},[i("el-button",{staticClass:"cancel-button",attrs:{type:"cancel",size:"medium",plain:""},on:{click:e.cancelDialog}},[e._v(e._s(e.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.CANCEL")))]),i("el-button",{staticClass:"medium",attrs:{type:"save",size:"medium"},on:{click:e.onSubmit}},[e._v(e._s(e.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.SAVE")))])],1)],1)],1)],1)},o=[],n=(i("c740"),i("a434"),i("e9c4"),i("d81d"),i("2fa3")),s=i("8dc8"),r=i("0bb4"),c={name:"CreateForm",components:{DeviceTypeSelector:s["default"]},props:{id:{default:null},visible:{type:[Boolean],default:!1}},computed:{dialogVisible:{get:function(){return this.visible},set:function(e){this.$emit("update:visible",e)}}},watch:{visible:{handler:function(e){e?this.id?this.getDetail(this.id):this.form={group_name:"",desc:"",notification_type:"",commands:[{data:{}}],notification_config:{},email:"",message:"",phone:"",webhook:""}:this.form={}}}},data:function(){return{noticeType:"",form:{group_name:"",desc:"",notification_type:"",commands:[{data:{}}],notification_config:{},email:"",message:"",phone:"",webhook:""}}},created:function(){},methods:{handleTypeChange:function(e){this.form.notification_type=e,this.noticeType=e},handleAddCommand:function(){this.form.commands.push({data:{}})},handleCommandChange:function(e,t){e.data=t},handleDeleteCommand:function(e){var t=this.form.commands.findIndex((function(t){return t==e}));this.form.commands.splice(t,1)},getDetail:function(e){var t=this;Object(r["c"])({id:e}).then((function(e){if(console.log(e,"res"),200===e.data.code){var i=e.data.data;if("{}"!==i){var a=t.getCommands(JSON.parse(JSON.stringify(i))),o=JSON.parse(JSON.stringify(i));o.commands=a,t.noticeType=o.notification_type;var n=JSON.parse(JSON.stringify(i)),s=JSON.parse(n.notification_config);o.email=s.email,o.message=s.message,o.phone=s.phone,o.webhook=s.webhook,t.form=o}}}))},getCommands:function(e){var t=(null===e||void 0===e?void 0:e.notification_members)||[{data:{}}],i=t.map((function(e){return{data:{is_email:e.is_email,is_message:e.is_message,is_phone:e.is_phone,user_id:e.users_id}}}));return i},onSubmit:function(){var e=this;if(this.validate()){var t=JSON.parse(JSON.stringify(this.form)),i={};if(this.id){var a=JSON.parse(t.notification_config);1===t.notification_type?(t.notification_config={},t.notification_members=this.form.commands.map((function(e){return{user_id:e.data.user_id,is_email:e.data.is_email,is_message:e.data.is_message,is_phone:e.data.is_phone}}))):2===t.notification_type?(a.email=this.form.email,i.email=a.email,t.notification_config=i):4===t.notification_type?(a.message=this.form.message,i.message=a.message,t.notification_config=i):5===t.notification_type?(a.phone=this.form.phone,i.phone=a.phone,t.notification_config=i):3!==t.notification_type&&6!==t.notification_type&&7!==t.notification_type&&8!==t.notification_type||(a.webhook=this.form.webhook,i.webhook=a.webhook,t.notification_config=i)}else 1===t.notification_type?(t.notification_config={},t.notification_members=this.form.commands.map((function(e){return{user_id:e.data.user_id,is_email:e.data.is_email,is_message:e.data.is_message,is_phone:e.data.is_phone}}))):2===t.notification_type?t.notification_config.email=this.form.email:4===t.notification_type?t.notification_config.message=this.form.message:5===t.notification_type?t.notification_config.phone=this.form.phone:3!==t.notification_type&&6!==t.notification_type&&7!==t.notification_type&&8!==t.notification_type||(t.notification_config.webhook=this.form.webhook);this.id?Object(r["d"])(t).then((function(t){200===t.data.code&&(e.$emit("submit"),e.noticeType="",e.dialogVisible=!1,e.$message({message:"编辑成功",center:!0,type:"success"}))})):Object(r["a"])(t).then((function(t){200===t.data.code&&(e.$emit("submit"),e.noticeType="",e.dialogVisible=!1,e.$message({message:"新建成功",center:!0,type:"success"}))}))}},handleClose:function(){this.form={},this.noticeType="",this.dialogVisible=!1},cancelDialog:function(){this.form={},this.noticeType="",this.dialogVisible=!1},validate:function(){if(!this.form.group_name||""===this.form.group_name)return this.$refs.nameRef.focus(),Object(n["h"])(this.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.PLACEHOLDER")),!1;if(!this.form.desc||""===this.form.desc)return this.$refs.descRef.focus(),Object(n["h"])(this.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.PLACEHOLDER1")),!1;if(!this.form.notification_type||""===this.form.notification_type)return this.$refs.selRef.focus(),Object(n["h"])(this.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.PLACEHOLDER2")),!1;if(2===this.noticeType&&(!this.form.email||""===this.form.email))return Object(n["h"])(this.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.PLACEHOLDER5")),!1;if(4===this.noticeType&&(!this.form.message||""===this.form.message))return Object(n["h"])(this.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.PLACEHOLDER10")),!1;if(5===this.noticeType&&(!this.form.phone||""===this.form.phone))return Object(n["h"])(this.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.PLACEHOLDER10")),!1;if((3===this.noticeType||6===this.noticeType||7===this.noticeType||8===this.noticeType)&&(!this.form.webhook||""===this.form.webhook))return Object(n["h"])(this.$t("SYSTEM_MANAGEMENT.NOTICE_MANAGEMENT.PLACEHOLDER7")),!1;if(1===this.noticeType)for(var e=0;e<this.$refs.deviceTypeRef.length;e++){var t=this.$refs.deviceTypeRef[e];if(!t.validate())return!1}return!0}}},l=c,f=(i("1750"),i("2877")),m=Object(f["a"])(l,a,o,!1,null,"14516f72",null);t["default"]=m.exports},d5c0:function(e,t,i){}}]);