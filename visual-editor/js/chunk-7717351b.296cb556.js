(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7717351b","chunk-2e150752","chunk-201b469e"],{"0b4d":function(t,e,a){},"2b6d":function(t,e,a){"use strict";a.d(e,"d",(function(){return o})),a.d(e,"a",(function(){return n})),a.d(e,"c",(function(){return s})),a.d(e,"b",(function(){return r}));var i=a("18a6");function o(t){return Object(i["a"])({url:"/business/index",method:"post",data:t})}function n(t){return Object(i["a"])({url:"/business/add",method:"post",data:t})}function s(t){return Object(i["a"])({url:"/business/edit",method:"post",data:t})}function r(t){return Object(i["a"])({url:"/business/delete",method:"post",data:t})}},"308f":function(t,e,a){"use strict";a.d(e,"c",(function(){return n})),a.d(e,"j",(function(){return s})),a.d(e,"d",(function(){return r})),a.d(e,"e",(function(){return l})),a.d(e,"f",(function(){return d})),a.d(e,"i",(function(){return c})),a.d(e,"g",(function(){return u})),a.d(e,"h",(function(){return f})),a.d(e,"a",(function(){return m})),a.d(e,"b",(function(){return p}));var i=a("5530"),o=(a("2ca0"),a("d3b7"),a("d81d"),a("18a6"));function n(){return Object(o["a"])({url:"/asset/index",method:"post"})}function s(t){return Object(o["a"])({url:"/structure/field",method:"post",data:t})}function r(t){return Object(o["a"])({url:"/asset/list",method:"post",data:t})}function l(t){return Object(o["a"])({url:"/asset/list/a",method:"post",data:t})}function d(t){return Object(o["a"])({url:"/asset/list/b",method:"post",data:t})}function c(t){var e=function(t){return t&&t.startsWith("/")?t.substring(1):t};return new Promise((function(a,i){Object(o["a"])({url:"/asset/list/d",method:"post",data:t}).then((function(t){var i=t.data.data.map((function(t){return t.device_group=e(t.device_group),t}));t.data.data=i,a(t)})).catch((function(t){i(t)}))}))}function u(t){return Object(o["a"])({url:"/asset/list/c",method:"post",data:t})}function f(t){return Object(o["a"])({url:"/asset/update_only",method:"post",data:t})}function m(t){return Object(o["a"])({url:"/asset/add_only",method:"post",data:t})}function p(t){return Object(o["a"])({url:"/asset/delete",method:"post",data:Object(i["a"])({type:1},t)})}},"739b":function(t,e,a){},7667:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{display:"flex"}},[a("el-select",{ref:"projectRef",staticStyle:{width:"100px","margin-right":"10px"},attrs:{placeholder:t.$t("AUTOMATION.PLACEHOLDER.SELECT_PROJECT")},on:{change:t.handleProjectChange},model:{value:t.formData.projectId,callback:function(e){t.$set(t.formData,"projectId",e)},expression:"formData.projectId"}},t._l(t.projectOptions,(function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.id}})})),1),t.formData.projectId?a("el-select",{ref:"groupRef",staticStyle:{width:"100px","margin-right":"10px"},attrs:{placeholder:t.$t("AUTOMATION.PLACEHOLDER.SELECT_GROUP")},on:{change:t.handleGroupChange},model:{value:t.formData.groupId,callback:function(e){t.$set(t.formData,"groupId",e)},expression:"formData.groupId"}},t._l(t.groupOptions,(function(t,e){return a("el-option",{key:e,attrs:{label:t.device_group,value:t.id}})})),1):t._e(),t.formData.groupId?a("el-cascader",{ref:"deviceRef",staticStyle:{width:"100px","margin-right":"10px"},attrs:{placeholder:t.$t("AUTOMATION.PLACEHOLDER.SELECT_DEVICE"),options:t.deviceOptions,clearable:"",props:{checkStrictly:!0,emitPath:!1}},on:{change:t.handleDeviceChange},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.node,o=e.data;return[a("span",[t._v(t._s(o.label))]),i.isLeaf?t._e():a("span",[t._v(" ("+t._s(o.children.length)+") ")])]}}],null,!1,1996962598),model:{value:t.formData.device,callback:function(e){t.$set(t.formData,"device",e)},expression:"formData.device"}}):t._e(),t.formData.device?a("el-select",{ref:"stateRef",staticStyle:{width:"100px","margin-right":"10px"},on:{change:t.handleStateChange},model:{value:t.formData.messageType,callback:function(e){t.$set(t.formData,"messageType",e)},expression:"formData.messageType"}},t._l(t.stateOptions,(function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.messageType}})})),1):t._e()],1)},o=[],n=a("5530"),s=(a("e9c4"),a("d81d"),a("7db0"),a("d3b7"),a("b0c0"),a("2b6d")),r=a("308f"),l=a("aa98"),d=a("9448"),c=a("2fa3"),u=(a("f570"),{name:"DeviceTypeSelector",components:{},props:{option:{type:[Object],default:function(){return{operator:!0}}},data:{type:[Object],default:function(){return{}}}},data:function(){return{formData:{projectId:"",groupId:"",deviceId:"",device:"",messageType:""},projectOptions:[],groupOptions:[],deviceOptions:[],stateOptions:[{name:"属性上报",messageType:1},{name:"属性下发",messageType:2},{name:"事件上报",messageType:3},{name:"自定义上报",messageType:4}]}},watch:{data:{handler:function(t){console.log("data",t),t&&(this.formData=JSON.parse(JSON.stringify(t)),console.log("formData",this.formData))},immediate:!0},"formData.projectId":{handler:function(t){t&&this.getGroupList(t)},immediate:!0},"formData.groupId":{handler:function(t){t&&(console.log("formData.groupId",t),this.getDeviceList(t))},immediate:!0}},created:function(){this.getProjectList()},methods:{handleProjectChange:function(t){this.formData.projectId=t,this.formData.groupId="",this.updateData(),this.getGroupList(t)},handleGroupChange:function(t){console.log("handleGroupChange",t),this.formData.groupId=t,this.formData.deviceId="",this.updateData(),this.getDeviceList(t)},handleDeviceChange:function(t){var e=this.$refs.deviceRef,a=e.getCheckedNodes()[0].data;console.log("handleDeviceChange.device",this.formData.device),this.formData.deviceId=a.value,this.updateData()},handleStateChange:function(t){this.formData.state=t,this.updateData()},handleDurationChange:function(t){this.formData.state.duration=t,this.updateData()},handleOperatorChange:function(t){this.formData.state.operator=t,this.updateData()},updateData:function(){console.log("updateData",this.formData),this.$emit("change",this.formData)},getProjectList:function(){var t=this;Object(s["d"])({limit:100,page:1}).then((function(e){var a,i=e.data;200==i.code&&(t.projectOptions=(null===(a=i.data)||void 0===a?void 0:a.data)||[])}))},getGroupList:function(t){var e=this;Object(r["i"])({business_id:t}).then((function(t){var a=t.data;200==a.code&&(e.groupOptions=(null===a||void 0===a?void 0:a.data)||[])}))},getDeviceList:function(t){var e=this,a={current_page:1,per_page:9999,asset_id:t};Object(l["r"])(a).then((function(t){var a=t.data;if(console.log(a,"res"),200==a.code){var i,o=(null===(i=a.data)||void 0===i?void 0:i.data)||[];e.deviceOptions=o.map((function(t){return{label:t.device_name,value:t.device,pluginId:t.type}})),e.formData.deviceId&&(e.formData.device=e.deviceOptions.find((function(t){return t.value==e.formData.deviceId})),e.updateData())}}))},getStateList:function(t){var e=this;if(console.log("getStateList",t),this.stateOptions=[],this.option.operator&&(this.stateOptions.push({label:this.$t("AUTOMATION.ONLINE_STATUS"),options:[{mode:"onlineDuration",label:this.$t("AUTOMATION.ONLINE_DURATION"),name:"onlineDuration"}]}),this.stateOptions.push({label:this.$t("AUTOMATION.ONLINE_OFFLINE"),options:[{mode:"onlineState",label:this.$t("AUTOMATION.ONLINE"),name:"online"},{mode:"onlineState",label:this.$t("AUTOMATION.OFFLINE"),name:"offline"},{mode:"onlineState",label:this.$t("AUTOMATION.ONLINE_OFFLINE"),name:"onAndOff"}]})),t){var a={current_page:1,per_page:9999,id:t};d["a"].page(a).then((function(t){var a=t.data;if(200==a.code){var i,o,s,r=(null===(i=a.data)||void 0===i||null===(o=i.data[0])||void 0===o?void 0:o.chart_data)||"{}",l=JSON.parse(r),d=(null===(s=l.tsl)||void 0===s?void 0:s.properties)||[],c=d.map((function(t){return e.formData.state&&e.formData.state.name===t.name&&(e.formData.state=Object(n["a"])(Object(n["a"])({},e.formData.state),{},{unit:t.unit,type:t.type})),{label:t.title,name:t.name,unit:t.unit,mode:"property",type:t.dataType}}));e.stateOptions.push({label:e.$t("AUTOMATION.PROPERTY"),options:c}),console.log(e.stateOptions),e.updateData()}}))}else this.updateData()},validate:function(){var t=this.$refs,e=this.formData;return e.projectId&&""!==e.projectId?e.groupId&&""!==e.groupId?e.device&&""!==e.device?e.messageType&&""!==e.messageType?!(t.onlineDurationRef&&!t.onlineDurationRef.validate())&&!(t.operatorSelectorRef&&!t.operatorSelectorRef.validate()):(t.stateRef.focus(),Object(c["h"])(this.$t("AUTOMATION.ERROR.MESSAGETYPE")),!1):(t.deviceRef.focus(),Object(c["h"])(this.$t("AUTOMATION.ERROR.DEVICE")),!1):(t.groupRef.focus(),Object(c["h"])(this.$t("AUTOMATION.ERROR.GROUP")),!1):(t.projectRef.focus(),Object(c["h"])(this.$t("AUTOMATION.ERROR.PROJECT")),!1)}}}),f=u,m=a("2877"),p=Object(m["a"])(f,i,o,!1,null,"737c8286",null);e["default"]=p.exports},"78dc":function(t,e,a){"use strict";a("739b")},"8689c":function(t,e,a){"use strict";a("0b4d")},"8ac2":function(t,e,a){"use strict";a("ad8c")},9448:function(t,e,a){"use strict";var i=a("18a6");e["a"]={add:function(t){return Object(i["a"])({url:"/device/model/add",method:"post",data:t})},edit:function(t){return Object(i["a"])({url:"/device/model/edit",method:"post",data:t})},del:function(t){return Object(i["a"])({url:"/device/model/delete",method:"post",data:t})},page:function(t){return Object(i["a"])({url:"/device/model/list",method:"post",data:t})},tree:function(t){return Object(i["a"])({url:"/device/model/tree",method:"post",data:t})},category:function(t){return Object(i["a"])({url:"/dict/list/",method:"post",data:t})},map:function(t){return Object(i["a"])({url:"/device/map",method:"post",data:t})},equip:function(t){return Object(i["a"])({url:"/kv/current/symbol",method:"post",data:t})},state:function(t){return Object(i["a"])({url:"/device/status",method:"post",data:t})}}},ad8c:function(t,e,a){},b027:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-form",{ref:"form",attrs:{rules:t.rules,"label-position":"left",model:t.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:t.$t("RULE_ENGINE.DATA_FORWARDINGNEW.URL"),prop:"url",required:""}},[a("el-input",{model:{value:t.form.url,callback:function(e){t.$set(t.form,"url",e)},expression:"form.url"}})],1),a("div",{staticStyle:{display:"flex","justify-content":"center"}},[a("el-button",{staticClass:"cancel-button",attrs:{type:"cancel",size:"medium",plain:""},on:{click:t.cancelDialog}},[t._v(t._s(t.$t("RULE_ENGINE.ACCESS_ENGINE.CANCEL")))]),a("el-button",{staticClass:"medium",attrs:{type:"save",size:"medium"},on:{click:t.onSubmit}},[t._v(t._s(t.$t("RULE_ENGINE.ACCESS_ENGINE.SUBMIT")))])],1)],1)},o=[],n=a("f570"),s={name:"UrlContent",components:{},props:{init_data:{default:null},type:{default:null}},data:function(){return{form:{url:""},rules:{url:[{required:!0,message:n["a"].t("RULE_ENGINE.DATA_FORWARDINGNEW.PLACEHOLDER8"),trigger:"blur"}]}}},created:function(){},methods:{edit:function(t){t.target_info?this.form=Object.assign({},t.target_info):this.form=Object.assign({},t)},onSubmit:function(){var t=this;this.$refs.form.validate((function(e){e&&t.$emit("save",t.form)}))},cancelDialog:function(){this.$emit("cancel")}}},r=s,l=(a("78dc"),a("2877")),d=Object(l["a"])(r,i,o,!1,null,"78cd9860",null);e["default"]=d.exports},bc25:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"el-dark-dialog",attrs:{title:t.id?t.$t("RULE_ENGINE.DATA_FORWARDINGNEW.EDIT_TITLE"):t.$t("RULE_ENGINE.DATA_FORWARDINGNEW.ADD_TITLE"),"close-on-click-modal":!1,"before-close":t.handleClose,visible:t.dialogVisible,width:"60%",height:"60%",top:"10vh"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-form",{ref:"CreateForm",attrs:{"label-position":"left","label-width":"120px",model:t.form}},[a("el-form-item",{attrs:{label:t.$t("RULE_ENGINE.ACCESS_ENGINE.RULE_NAME_NEW"),required:""}},[a("el-input",{ref:"nameRef",model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),a("el-form-item",{attrs:{label:t.$t("RULE_ENGINE.ACCESS_ENGINE.RULE_DESCRIBE"),required:""}},[a("el-input",{ref:"descRef",staticClass:"el-dark-input",attrs:{type:"textarea"},model:{value:t.form.desc,callback:function(e){t.$set(t.form,"desc",e)},expression:"form.desc"}})],1),a("el-form-item",{attrs:{label:t.$t("RULE_ENGINE.ACCESS_ENGINE.DATA"),required:""}},t._l(t.form.commands,(function(e,i){return a("div",{key:i,staticStyle:{display:"flex","margin-bottom":"10px"}},[a("DeviceTypeSelector",{ref:"deviceTypeRef",refInFor:!0,attrs:{data:e.data},on:{change:function(a){return t.handleCommandChange(e,a)}}}),0==i?a("el-button",{staticStyle:{"margin-left":"auto"},attrs:{type:"indigo",size:"small"},on:{click:function(a){return t.handleAddCommand(e)}}},[t._v(t._s(t.$t("RULE_ENGINE.ACCESS_ENGINE.ADD")))]):t._e(),i>0?a("el-button",{staticStyle:{"margin-left":"auto"},attrs:{type:"danger",size:"small"},on:{click:function(a){return t.handleDeleteCommand(e)}}},[t._v(t._s(t.$t("RULE_ENGINE.ACCESS_ENGINE.DELETE")))]):t._e()],1)})),0),a("p",{staticClass:"code-editor-label"},[a("span",{staticStyle:{color:"red"}},[t._v("* ")]),t._v(t._s(t.$t("RULE_ENGINE.ACCESS_ENGINE.PARSING_SCRIPTS")))]),a("CodeEditor",{key:"upside",staticClass:"dark-code-editor",staticStyle:{width:"100%",height:"260px","overflow-y":"auto"},attrs:{min_height:"260px",copy_code:!0,hide_header:!1,theme:"dark",wrap_code:!0},model:{value:t.form.script,callback:function(e){t.$set(t.form,"script",e)},expression:"form.script"}}),a("el-form-item",{attrs:{label:t.$t("RULE_ENGINE.ACCESS_ENGINE.DATAPURPOSE")}},[a("el-button",{staticStyle:{"margin-left":"auto"},attrs:{type:"indigo",size:"small"},on:{click:function(e){return t.handleAdd()}}},[t._v(t._s(t.$t("RULE_ENGINE.ACCESS_ENGINE.ADDACTION")))]),t.listData.length>0?a("div",{staticClass:"list_box"},t._l(t.listData,(function(e,i){return a("div",{key:i,staticClass:"item"},[a("span",[t._v(t._s(e.title))]),a("div",{staticClass:"flex_full"}),a("el-button",{attrs:{type:"primary",icon:"el-icon-edit",circle:""},on:{click:function(a){return t.editBtn(e,i)}}}),a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(e){return t.deleteBtn(i)}}})],1)})),0):t._e()],1),a("div",{staticStyle:{display:"flex","justify-content":"center"}},[a("el-button",{staticClass:"cancel-button",attrs:{type:"cancel",size:"medium",plain:""},on:{click:t.cancelDialog}},[t._v(t._s(t.$t("COMMON.CANCEL")))]),a("el-button",{staticClass:"medium",attrs:{type:"save",size:"medium"},on:{click:t.onSubmit}},[t._v(t._s(t.$t("COMMON.SUBMIT")))])],1),a("el-dialog",{staticClass:"el-dark-dialog el-dark-input",attrs:{title:t.$t("RULE_ENGINE.ACCESS_ENGINE.ADDACTION"),visible:t.dialogChooseVisible,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,"append-to-body":!0,width:"400px"},on:{"update:visible":function(e){t.dialogChooseVisible=e}}},[a("div",{staticClass:"dialog-body"},[a("div",{class:0===t.isChoose?"dialog-border":"dialog-box",on:{click:function(e){return t.choose(0)}}},[a("p",[t._v(t._s(t.$t("RULE_ENGINE.ACCESS_ENGINE.PUSH_OUTSIDE_MQTT")))]),a("p",[t._v(t._s(t.$t("RULE_ENGINE.ACCESS_ENGINE.PUSH_OUTSIDE_MQTT_DES")))])]),a("div",{class:1===t.isChoose?"dialog-border":"dialog-box",on:{click:function(e){return t.choose(1)}}},[a("p",[t._v(t._s(t.$t("RULE_ENGINE.ACCESS_ENGINE.PUSH_OUTSIDE_URL")))]),a("p",[t._v(t._s(t.$t("RULE_ENGINE.ACCESS_ENGINE.PUSH_OUTSIDE_URL_DES")))])])])]),a("el-dialog",{staticClass:"el-dark-dialog el-dark-input",attrs:{title:t.$t("RULE_ENGINE.ACCESS_ENGINE.ADDACTION"),visible:t.dialogMQTTVisible,"destroy-on-close":!0,"close-on-click-modal":!1,"append-to-body":!0,width:"830px"},on:{"update:visible":function(e){t.dialogMQTTVisible=e}}},[a("MqttContent",{ref:"realForm",attrs:{type:t.type,fromData:t.editData},on:{cancel:function(e){t.dialogMQTTVisible=!1},save:t.create}})],1),a("el-dialog",{staticClass:"el-dark-dialog el-dark-input",attrs:{title:t.$t("RULE_ENGINE.ACCESS_ENGINE.ADDACTION"),visible:t.dialogUrlVisible,"destroy-on-close":!0,"close-on-click-modal":!1,"append-to-body":!0,width:"830px"},on:{"update:visible":function(e){t.dialogUrlVisible=e}}},[a("UrlContent",{ref:"realForms",attrs:{type:t.type,fromData:t.editData},on:{cancel:function(e){t.dialogUrlVisible=!1},save:t.create2}})],1)],1)],1)},o=[],n=(a("a434"),a("c740"),a("e9c4"),a("d81d"),a("a9e3"),a("b0c0"),a("de55")),s=a("b027"),r=a("f314"),l=a("7667"),d=a("2fa3"),c=a("ccb0"),u=a("f570"),f=u["a"].t("RULE_ENGINE.ACCESS_ENGINE.CODE_TEMP"),m={name:"CreateForm",components:{DeviceTypeSelector:l["default"],CodeEditor:r["a"],MqttContent:n["default"],UrlContent:s["default"]},props:{id:{default:null},visible:{type:[Boolean],default:!1}},computed:{dialogVisible:{get:function(){return this.visible},set:function(t){this.$emit("update:visible",t)}}},watch:{visible:{handler:function(t){t?this.id?this.getDetail(this.id):this.form={name:"",desc:"",script:f,script_type:"javascript",commands:[{data:{}}],target_info:{},objData:{}}:this.form={}}},dialogMQTTVisible:{handler:function(t){t||(this.editData="")},deep:!0,immediate:!0},dialogUrlVisible:{handler:function(t){t||(this.editData="")},deep:!0,immediate:!0}},data:function(){return{dialogChooseVisible:!1,dialogMQTTVisible:!1,dialogUrlVisible:!1,listData:[],isShow:!1,editData:"",type:"",isChoose:null,form:{name:"",desc:"",script:f,script_type:"javascript",commands:[{data:{}}],target_info:{},objData:{}}}},created:function(){},methods:{create:function(t){"add"==this.type?(t.title=u["a"].t("RULE_ENGINE.ACCESS_ENGINE.PUSH_OUTSIDE_MQTT"),this.listData.push(t),this.form.target_info.mqtt=t,this.dialogMQTTVisible=!1):(t.title=u["a"].t("RULE_ENGINE.ACCESS_ENGINE.PUSH_OUTSIDE_MQTT"),this.listData[this.editIndex]=t,this.form.target_info.mqtt=t,this.dialogMQTTVisible=!1)},create2:function(t){"add"==this.type?(t.title=u["a"].t("RULE_ENGINE.ACCESS_ENGINE.PUSH_OUTSIDE_URL"),this.listData.push(t),this.form.target_info.url=t.url,this.dialogUrlVisible=!1):(t.title=u["a"].t("RULE_ENGINE.ACCESS_ENGINE.PUSH_OUTSIDE_URL"),this.listData[this.editIndex]=t,this.form.target_info.url=t.url,this.dialogUrlVisible=!1)},deleteBtn:function(t){this.listData.splice(t,1)},editBtn:function(t,e){var a=this;switch(this.editData=t,this.editIndex=e,this.type="edit",t.title){case u["a"].t("RULE_ENGINE.ACCESS_ENGINE.PUSH_OUTSIDE_MQTT"):this.dialogMQTTVisible=!0,this.$nextTick((function(){a.$refs.realForm.edit(t)}));break;case u["a"].t("RULE_ENGINE.ACCESS_ENGINE.PUSH_OUTSIDE_URL"):this.dialogUrlVisible=!0,this.$nextTick((function(){a.$refs.realForms.edit(t)}));break}},handleAddCommand:function(){this.form.commands.push({data:{}})},handleCommandChange:function(t,e){t.data=e},handleDeleteCommand:function(t){var e=this.form.commands.findIndex((function(e){return e==t}));this.form.commands.splice(e,1)},handleAdd:function(){if(console.log(this.listData,"this"),this.listData.length>0)return this.$message({message:u["a"].t("RULE_ENGINE.DATA_FORWARDINGNEW.PLACEHOLDER9"),center:!0,type:"waring"}),void(this.dialogChooseVisible=!1);this.dialogChooseVisible=!0},choose:function(t){this.editIndex="",0==t?(this.type="add",this.isChoose=0,this.dialogChooseVisible=!1,this.dialogMQTTVisible=!0):(this.type="add",this.isChoose=1,this.dialogChooseVisible=!1,this.dialogUrlVisible=!0)},getDetail:function(t){var e=this;this.listData=[],Object(c["c"])({data_transpond_id:t}).then((function(t){if(200===t.data.code){var a=t.data.data;if("{}"!==a){var i=e.getCommands(JSON.parse(JSON.stringify(a))),o=JSON.parse(JSON.stringify(a));o.commands=i,e.form=o,""!==a.target_info.url?(a.title=u["a"].t("RULE_ENGINE.ACCESS_ENGINE.PUSH_OUTSIDE_URL"),e.listData.push(a)):(a.title=u["a"].t("RULE_ENGINE.ACCESS_ENGINE.PUSH_OUTSIDE_MQTT"),e.listData.push(a))}}}))},getCommands:function(t){var e=(null===t||void 0===t?void 0:t.device_info)||[],a=e.map((function(t){return{data:{projectId:t.business_id,groupId:t.asset_group_id,device:t.device_id,messageType:t.message_type}}}));return a},onSubmit:function(){var t=this;if(this.validate()){var e=JSON.parse(JSON.stringify(this.form));e.device_info=this.form.commands.map((function(t){return{business_id:t.data.projectId,asset_group_id:t.data.groupId,device_id:t.data.device,message_type:t.data.messageType}})),this.id?e.target_info.url?e.target_info={mqtt:{host:"",topic:"",password:"",username:"",client_id:"",port:null},url:e.target_info.url}:e.target_info={mqtt:{host:this.form.target_info.mqtt.host,topic:this.form.target_info.mqtt.topic,password:this.form.target_info.mqtt.password,username:this.form.target_info.mqtt.username,client_id:this.form.target_info.mqtt.client_id,port:Number(this.form.target_info.mqtt.port)},url:""}:this.form.target_info.url?e.target_info={mqtt:{host:"",topic:"",password:"",username:"",client_id:"",port:null},url:this.form.target_info.url}:e.target_info={mqtt:{host:this.form.target_info.mqtt.host,topic:this.form.target_info.mqtt.topic,password:this.form.target_info.mqtt.password,username:this.form.target_info.mqtt.username,client_id:this.form.target_info.mqtt.client_id,port:Number(this.form.target_info.mqtt.port)},url:""},this.id?Object(c["d"])(e).then((function(e){200===e.data.code&&(t.$emit("submit"),t.listData=[],t.dialogVisible=!1,t.$message({message:"编辑成功",center:!0,type:"success"}))})):Object(c["a"])(e).then((function(e){200===e.data.code&&(t.$emit("submit"),t.listData=[],t.dialogVisible=!1,t.$message({message:"新建成功",center:!0,type:"success"}))}))}},handleClose:function(){this.form={},this.listData=[],this.dialogVisible=!1},cancelDialog:function(){this.form={},this.listData=[],this.dialogVisible=!1},validate:function(){if(!this.form.name||""===this.form.name)return this.$refs.nameRef.focus(),Object(d["h"])(this.$t("RULE_ENGINE.DATA_FORWARDINGNEW.PLACEHOLDER")),!1;if(!this.form.desc||""===this.form.desc)return this.$refs.descRef.focus(),Object(d["h"])(this.$t("RULE_ENGINE.DATA_FORWARDINGNEW.PLACEHOLDER1")),!1;if(this.form.script){for(var t=0;t<this.$refs.deviceTypeRef.length;t++){var e=this.$refs.deviceTypeRef[t];if(!e.validate())return!1}return!0}Object(d["h"])("解析脚本不能为空")}}},p=m,h=(a("8689c"),a("2877")),E=Object(h["a"])(p,i,o,!1,null,"9dc8355e",null);e["default"]=E.exports},ccb0:function(t,e,a){"use strict";a.d(e,"e",(function(){return o})),a.d(e,"a",(function(){return n})),a.d(e,"d",(function(){return s})),a.d(e,"c",(function(){return r})),a.d(e,"b",(function(){return l})),a.d(e,"f",(function(){return d}));var i=a("18a6");function o(t){return Object(i["a"])({url:"/tp_data/transpond/list",method:"post",data:t})}function n(t){return Object(i["a"])({url:"/tp_data/transpond/add",method:"post",data:t})}function s(t){return Object(i["a"])({url:"/tp_data/transpond/edit",method:"post",data:t})}function r(t){return Object(i["a"])({url:"/tp_data/transpond/detail",method:"post",data:t})}function l(t){return Object(i["a"])({url:"/tp_data/transpond/delete",method:"post",data:t})}function d(t){return Object(i["a"])({url:"/tp_data/transpond/switch",method:"post",data:t})}},de55:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-form",{ref:"form",attrs:{rules:t.rules,"label-position":"left",model:t.form,"label-width":"170px"}},[a("el-form-item",{attrs:{label:t.$t("RULE_ENGINE.DATA_FORWARDINGNEW.LABLE1"),prop:"host",required:""}},[a("el-input",{model:{value:t.form.host,callback:function(e){t.$set(t.form,"host",e)},expression:"form.host"}})],1),a("el-form-item",{attrs:{label:t.$t("RULE_ENGINE.DATA_FORWARDINGNEW.LABLE2"),prop:"port",required:""}},[a("el-input",{model:{value:t.form.port,callback:function(e){t.$set(t.form,"port",e)},expression:"form.port"}})],1),a("el-form-item",{attrs:{label:t.$t("RULE_ENGINE.DATA_FORWARDINGNEW.LABLE3"),prop:"client_id"}},[a("el-input",{model:{value:t.form.client_id,callback:function(e){t.$set(t.form,"client_id",e)},expression:"form.client_id"}})],1),a("el-form-item",{attrs:{label:t.$t("RULE_ENGINE.DATA_FORWARDINGNEW.LABLE4"),prop:"username"}},[a("el-input",{model:{value:t.form.username,callback:function(e){t.$set(t.form,"username",e)},expression:"form.username"}})],1),a("el-form-item",{attrs:{label:t.$t("RULE_ENGINE.DATA_FORWARDINGNEW.LABLE5"),prop:"password"}},[a("el-input",{model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}})],1),a("el-form-item",{attrs:{label:t.$t("RULE_ENGINE.DATA_FORWARDINGNEW.LABLE6"),prop:"topic",required:""}},[a("el-input",{model:{value:t.form.topic,callback:function(e){t.$set(t.form,"topic",e)},expression:"form.topic"}})],1),a("div",{staticStyle:{display:"flex","justify-content":"center"}},[a("el-button",{staticClass:"cancel-button",attrs:{type:"cancel",size:"medium",plain:""},on:{click:t.cancelDialog}},[t._v(t._s(t.$t("COMMON.CANCEL")))]),a("el-button",{staticClass:"medium",attrs:{type:"save",size:"medium"},on:{click:t.onSubmit}},[t._v(t._s(t.$t("COMMON.SUBMIT")))])],1)],1)},o=[],n=a("f570"),s={name:"MqttContent",components:{},props:{},data:function(){return{form:{host:"",port:"",client_id:"",username:"",password:"",topic:""},rules:{host:[{required:!0,message:n["a"].t("RULE_ENGINE.DATA_FORWARDINGNEW.PLACEHOLDER2"),trigger:"blur"}],port:[{required:!0,message:n["a"].t("RULE_ENGINE.DATA_FORWARDINGNEW.PLACEHOLDER3"),trigger:"blur"}],client_id:[{required:!1,message:n["a"].t("RULE_ENGINE.DATA_FORWARDINGNEW.PLACEHOLDER4"),trigger:"blur"}],username:[{required:!1,message:n["a"].t("RULE_ENGINE.DATA_FORWARDINGNEW.PLACEHOLDER5"),trigger:"blur"}],password:[{required:!1,message:n["a"].t("RULE_ENGINE.DATA_FORWARDINGNEW.PLACEHOLDER6"),trigger:"blur"}],topic:[{required:!0,message:n["a"].t("RULE_ENGINE.DATA_FORWARDINGNEW.PLACEHOLDER7"),trigger:"blur"}]}}},created:function(){},methods:{edit:function(t){t.target_info?this.form=Object.assign({},t.target_info.mqtt):this.form=Object.assign({},t)},onSubmit:function(){var t=this;this.$refs.form.validate((function(e){e&&t.$emit("save",t.form)}))},cancelDialog:function(){this.$emit("cancel")}}},r=s,l=(a("8ac2"),a("2877")),d=Object(l["a"])(r,i,o,!1,null,"881642a6",null);e["default"]=d.exports}}]);